(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1290:function(e,t,r){var content=r(1593);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(15).default)("3e634d03",content,!0,{sourceMap:!1})},1592:function(e,t,r){"use strict";r(1290)},1593:function(e,t,r){var n=r(14)((function(i){return i[1]}));n.push([e.i,".maintenance-dialog[data-v-6d6080eb]{display:flex;flex-direction:column;height:100vh}.dialog-toolbar[data-v-6d6080eb]{border-radius:0!important;flex-shrink:0;min-height:56px!important}.toolbar-title[data-v-6d6080eb]{font-size:1.1rem;font-weight:500}.dialog-content[data-v-6d6080eb]{background-color:#fafafa;flex:1;overflow-y:auto;padding:12px 8px!important}.form-container[data-v-6d6080eb]{background:#fff;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);margin:0 auto;max-width:1400px;padding:16px!important}.section-header[data-v-6d6080eb]{align-items:center;border-bottom:1px solid #e3f2fd;display:flex;margin-bottom:12px;padding-bottom:8px}.section-header.compact[data-v-6d6080eb]{margin-bottom:8px;padding-bottom:4px}.section-title[data-v-6d6080eb]{color:#1976d2;font-size:.95rem;font-weight:600;margin:0}.dialog-actions[data-v-6d6080eb]{background:#fff;border-top:1px solid #e0e0e0;flex-shrink:0}.v-select--outlined[data-v-6d6080eb] .v-input__control>.v-input__slot,.v-text-field--outlined[data-v-6d6080eb] .v-input__control>.v-input__slot,.v-textarea[data-v-6d6080eb] .v-input__control>.v-input__slot{min-height:40px!important}.v-text-field.v-text-field--enclosed[data-v-6d6080eb]:not(.v-text-field--rounded) .v-input__prepend-inner{margin-top:8px!important}.v-expansion-panel-header[data-v-6d6080eb]{min-height:40px!important}.v-expansion-panel-content[data-v-6d6080eb] .v-expansion-panel-content__wrap,.v-expansion-panel-header[data-v-6d6080eb]{padding:8px 16px!important}.v-chip-group[data-v-6d6080eb]{gap:4px}.v-chip.v-size--small[data-v-6d6080eb]{font-size:.75rem;height:24px!important}.v-chip.v-size--x-small[data-v-6d6080eb]{font-size:.7rem;height:20px!important}.pdf-viewer-content[data-v-6d6080eb]{height:calc(100vh - 64px)}.pdf-container[data-v-6d6080eb]{background:#f5f5f5;height:100%;position:relative;width:100%}.pdf-iframe[data-v-6d6080eb]{background:#fff;border:none;height:100%;width:100%}.pdf-error[data-v-6d6080eb],.pdf-loading[data-v-6d6080eb]{align-items:center;color:#666;display:flex;flex-direction:column;font-size:14px;height:100%;justify-content:center}@media (max-width:768px){.form-container[data-v-6d6080eb]{border-radius:6px;margin:0 4px;padding:12px!important}.toolbar-title[data-v-6d6080eb]{font-size:1rem}.pdf-viewer-content[data-v-6d6080eb]{height:calc(100vh - 56px)}}.v-input--dense[data-v-6d6080eb] .v-messages{min-height:0!important}.v-text-field[data-v-6d6080eb] .v-text-field__details{margin-bottom:0!important;padding-top:2px!important}",""]),n.locals={},e.exports=n},1733:function(e,t,r){"use strict";r.r(t);var n=r(321),o=r(318),c=r(19),l=r(322),d=r(1744),m=r(797),f=r(792),v=r(771),h=r(803),x=r(805),w=r(804),_=r(802),y=r(970),k=r(798),C=r(168),I=r(244),$=r(251),D=r(319),P=r(796),O=r(66),j=r(794),R=r(112),E=r(828),F=r(92),U=r(339),L=(r(35),r(7),r(12),r(13),r(17)),T=r(3);r(85),r(64),r(5),r(39),r(9),r(69),r(54),r(101),r(38),r(52),r(53),r(833),r(448),r(62),r(113),r(30),r(34),r(75),r(344),r(8),r(10);function A(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function S(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?A(Object(source),!0).forEach((function(t){Object(T.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):A(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var z={name:"MouMaintenanceDialog",props:{value:{type:Boolean,default:!1},editingItem:{type:Object,default:null}},data:function(){return{isFormValid:!1,saving:!1,loadingAgencies:!1,loadingCurrencies:!1,processingFiles:!1,fileProgress:{current:0,total:0},agencies:[],currencies:[],selectedImages:[],selectedDocuments:[],imagePreviewDialog:!1,previewImage:null,previewImageIndex:null,pdfViewerDialog:!1,currentPdfUrl:null,currentPdfName:null,form:{jobCode:"",mouNumber:"",pmCharge:0,projectAmount:0,exchangeRate:1,agencyId:null,employerCompany:"",workLocation:"",jobTitle:"",numberOfWorkers:1,workerType:"Any",jobStatus:"draft",documents:[],images:[],notes:"",currencyId:null},statusOptions:[{value:"draft",text:"ຮ່າງ"},{value:"open",text:"ເປີດ"},{value:"in_progress",text:"ກຳລັງດຳເນີນການ"},{value:"completed",text:"ສຳເລັດແລ້ວ"},{value:"cancelled",text:"ຍົກເລີກແລ້ວ"}],workerTypeOptions:[{value:"Any",text:"ເພດໃດກໍໄດ້"},{value:"Man",text:"ຜູ້ຊາຍເທົ່ານັ້ນ"},{value:"Woman",text:"ຜູ້ຍິງເທົ່ານັ້ນ"},{value:"Spous",text:"ຄູ່ສົມລົດ"}],rules:{required:function(e){return!!e||"ຈຳເປັນຕ້ອງໃສ່ຂໍ້ມູນ"},positiveNumber:function(e){return e>0||"ຕ້ອງໃຫ່ຍກວ່າ 0"}}}},computed:{isEditing:function(){return!!this.editingItem},selectedCurrency:function(){var e=this;return this.currencies.find((function(t){return t.id===e.form.currencyId}))}},watch:{value:function(e){e&&(this.initForm(),this.fetchDropdownData())},editingItem:{handler:function(){this.editingItem&&this.populateForm()},deep:!0}},methods:{initForm:function(){this.isEditing?this.populateForm():this.resetForm()},resetForm:function(){var e=this;this.form={jobCode:"",mouNumber:"",pmCharge:0,projectAmount:0,exchangeRate:1,agencyId:null,employerCompany:"",workLocation:"",jobTitle:"",numberOfWorkers:1,workerType:"Any",jobStatus:"draft",documents:[],images:[],notes:"",currencyId:null},this.selectedImages=[],this.selectedDocuments=[],this.$nextTick((function(){var t;null===(t=e.$refs.form)||void 0===t||t.resetValidation()}))},populateForm:function(){var e=this;if(this.editingItem){var t,r,n=(this.editingItem.images||[]).map((function(img){return{id:img.id,name:img.orgName||img.img_path,size:img.imageSize||img.size,type:img.imageMimeType||img.type,url:e.getFileUrl("images",img.img_name||img.img_path),preview:e.getFileUrl("images",img.img_name||img.img_path),isExisting:!0}})),o=(this.editingItem.documents||[]).map((function(t,r){return{id:t.id||r,name:t.name,size:t.size,type:t.mimetype||t.type,url:t.path?e.getDocumentDownloadUrl(e.editingItem.id,r):null,path:t.path,filename:t.filename,isExisting:!0}}));this.form=S(S(S({},this.form),this.editingItem),{},{agencyId:(null===(t=this.editingItem.agency)||void 0===t?void 0:t.id)||null,currencyId:(null===(r=this.editingItem.currency)||void 0===r?void 0:r.id)||null,documents:o,images:n})}},handleImageSelection:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){var n,i,o,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&0!==e.length){r.next=2;break}return r.abrupt("return");case 2:if(5242880,n=Array.from(e).filter((function(e){return e.type.startsWith("image/")?!(e.size>5242880)||(t.$toast.error("".concat(e.name," ມີຂະໜາດໃຫຍ່ເກີນ 5MB")),!1):(t.$toast.error("".concat(e.name," ບໍ່ແມ່ນໄຟລ໌ຮູບພາບ")),!1)})),0!==n.length){r.next=7;break}return t.selectedImages=[],r.abrupt("return");case 7:t.processingFiles=!0,t.fileProgress={current:0,total:n.length},r.prev=9,i=0;case 11:if(!(i<n.length)){r.next=30;break}return o=n[i],t.fileProgress.current=i,r.prev=14,r.next=17,t.readFileAsDataURL(o);case 17:return c=r.sent,t.form.images.push({name:o.name,size:o.size,type:o.type,file:o,preview:c,isNew:!0}),r.next=21,t.delay(10);case 21:r.next=27;break;case 23:r.prev=23,r.t0=r.catch(14),console.error("Error processing image ".concat(o.name,":"),r.t0),t.$toast.error("ໂຫລດຮູບພາບ ".concat(o.name," ບໍ່ສຳເລັດ"));case 27:i++,r.next=11;break;case 30:t.fileProgress.current=n.length,t.$toast.success("ໂຫລດຮູບພາບ ".concat(n.length," ໄຟລ໌ສຳເລັດ")),r.next=38;break;case 34:r.prev=34,r.t1=r.catch(9),console.error("Error in handleImageSelection:",r.t1),t.$toast.error("ເກີດຂໍ້ຜິດພາດໃນການໂຫລດຮູບພາບ");case 38:return r.prev=38,t.processingFiles=!1,t.fileProgress={current:0,total:0},t.selectedImages=[],t.$nextTick((function(){t.$refs.imageInput&&t.$refs.imageInput.reset()})),r.finish(38);case 44:case"end":return r.stop()}}),r,null,[[9,34,38,44],[14,23]])})))()},handleDocumentSelection:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){var n,o,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&0!==e.length){r.next=2;break}return r.abrupt("return");case 2:if(10485760,n=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain"],o=Array.from(e).filter((function(e){return n.includes(e.type)||t.isValidDocumentExtension(e.name)?!(e.size>10485760)||(t.$toast.error("".concat(e.name," ມີຂະໜາດໃຫຍ່ເກີນ 10MB")),!1):(t.$toast.error("".concat(e.name," ບໍ່ແມ່ນໄຟລ໌ເອກະສານທີ່ຮອງຮັບ")),!1)})),0!==o.length){r.next=8;break}return t.selectedDocuments=[],r.abrupt("return");case 8:t.processingFiles=!0,t.fileProgress={current:0,total:o.length},r.prev=10,i=0;case 12:if(!(i<o.length)){r.next=21;break}return c=o[i],t.fileProgress.current=i+1,t.form.documents.push({name:c.name,size:c.size,type:c.type,file:c,isNew:!0}),r.next=18,t.delay(5);case 18:i++,r.next=12;break;case 21:t.$toast.success("ໂຫລດເອກະສານ ".concat(o.length," ໄຟລ໌ສຳເລັດ")),r.next=28;break;case 24:r.prev=24,r.t0=r.catch(10),console.error("Error in handleDocumentSelection:",r.t0),t.$toast.error("ເກີດຂໍ້ຜິດພາດໃນການໂຫລດເອກະສານ");case 28:return r.prev=28,t.processingFiles=!1,t.fileProgress={current:0,total:0},t.selectedDocuments=[],t.$nextTick((function(){t.$refs.documentInput&&t.$refs.documentInput.reset()})),r.finish(28);case 34:case"end":return r.stop()}}),r,null,[[10,24,28,34]])})))()},readFileAsDataURL:function(e){var t=this;return new Promise((function(r,n){var o=new FileReader;o.onload=function(e){return r(e.target.result)},o.onerror=function(e){return n(new Error("Failed to read file"))},o.onabort=function(e){return n(new Error("File reading aborted"))},e.size>1048576?t.createImageThumbnail(e,300,300).then(r).catch((function(){o.readAsDataURL(e)})):o.readAsDataURL(e)}))},createImageThumbnail:function(e,t,r){return new Promise((function(n,o){var canvas=document.createElement("canvas"),c=canvas.getContext("2d"),img=new Image;img.onload=function(){var e=img.width,o=img.height;e>o?e>t&&(o=o*t/e,e=t):o>r&&(e=e*r/o,o=r),canvas.width=e,canvas.height=o,c.drawImage(img,0,0,e,o),n(canvas.toDataURL("image/jpeg",.8))},img.onerror=o,img.src=URL.createObjectURL(e)}))},isValidDocumentExtension:function(e){var t=e.toLowerCase().substring(e.lastIndexOf("."));return[".pdf",".doc",".docx",".xls",".xlsx",".txt"].includes(t)},isPdfFile:function(e){return!!e&&".pdf"===e.toLowerCase().substring(e.lastIndexOf("."))},viewPdf:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t.currentPdfName=e.name,!e.isExisting||!e.url){r.next=10;break}return r.next=5,t.$axios({method:"GET",url:e.url,responseType:"blob"});case 5:n=r.sent,o=new Blob([n.data],{type:"application/pdf"}),t.currentPdfUrl=window.URL.createObjectURL(o),r.next=11;break;case 10:e.file&&e.isNew&&(t.currentPdfUrl=URL.createObjectURL(e.file));case 11:t.pdfViewerDialog=!0,r.next=18;break;case 14:r.prev=14,r.t0=r.catch(0),console.error("Error viewing PDF:",r.t0),t.$toast.error("ເປີດ PDF ບໍ່ສຳເລັດ");case 18:case"end":return r.stop()}}),r,null,[[0,14]])})))()},downloadCurrentPdf:function(){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){var link;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.currentPdfUrl&&e.currentPdfName)try{(link=document.createElement("a")).href=e.currentPdfUrl,link.download=e.currentPdfName,document.body.appendChild(link),link.click(),document.body.removeChild(link),e.$toast.success("ດາວໂຫລດ PDF ສຳເລັດ")}catch(t){console.error("Error downloading PDF:",t),e.$toast.error("ດາວໂຫລດ PDF ບໍ່ສຳເລັດ")}case 1:case"end":return t.stop()}}),t)})))()},delay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},removeImage:function(e){var t=this.form.images[e];t.isExisting&&t.id&&this.deleteExistingImage(t.id),this.form.images.splice(e,1)},removeDocument:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.form.documents[e].isExisting||null===(n=t.editingItem)||void 0===n||!n.id){r.next=4;break}return r.next=4,t.deleteExistingDocument(t.editingItem.id,e);case 4:t.form.documents.splice(e,1);case 5:case"end":return r.stop()}}),r)})))()},openImagePreview:function(image,e){this.previewImage=image,this.previewImageIndex=e,this.imagePreviewDialog=!0},removeImageFromPreview:function(){null!==this.previewImageIndex&&(this.removeImage(this.previewImageIndex),this.imagePreviewDialog=!1,this.previewImage=null,this.previewImageIndex=null)},downloadDocument:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){var n,o,c,link;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.url){r.next=23;break}return r.prev=1,r.next=4,t.$axios({method:"GET",url:e.url,responseType:"blob"});case 4:n=r.sent,o=new Blob([n.data]),c=window.URL.createObjectURL(o),(link=document.createElement("a")).href=c,link.download=e.name||"document",document.body.appendChild(link),link.click(),document.body.removeChild(link),window.URL.revokeObjectURL(c),t.$toast.success("ດາວໂຫລດເອກະສານສຳເລັດ"),r.next=21;break;case 17:r.prev=17,r.t0=r.catch(1),console.error("Download error:",r.t0),t.$toast.error("ດາວໂຫລດເອກະສານບໍ່ສຳເລັດ");case 21:r.next=24;break;case 23:t.$toast.warning("ເອກະສານຍັງບໍ່ໄດ້ຖືກບັນທຶກ");case 24:case"end":return r.stop()}}),r,null,[[1,17]])})))()},downloadImage:function(image){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){var r,n,o,link;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!image.url){t.next=23;break}return t.prev=1,t.next=4,e.$axios({method:"GET",url:image.url,responseType:"blob"});case 4:r=t.sent,n=new Blob([r.data]),o=window.URL.createObjectURL(n),(link=document.createElement("a")).href=o,link.download=image.name||"image",document.body.appendChild(link),link.click(),document.body.removeChild(link),window.URL.revokeObjectURL(o),e.$toast.success("ດາວໂຫລດຮູບພາບສຳເລັດ"),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(1),console.error("Download error:",t.t0),e.$toast.error("ດາວໂຫລດຮູບພາບບໍ່ສຳເລັດ");case 21:t.next=24;break;case 23:image.preview&&(e.downloadDataURL(image.preview,image.name),e.$toast.success("ດາວໂຫລດຮູບພາບສຳເລັດ"));case 24:case"end":return t.stop()}}),t,null,[[1,17]])})))()},downloadDataURL:function(e,t){var link=document.createElement("a");link.href=e,link.download=t,document.body.appendChild(link),link.click(),document.body.removeChild(link)},deleteExistingImage:function(e){var t=this;return Object(L.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$axios.$delete("/api/mous/image/".concat(e));case 3:r.sent.success&&t.$toast.success("ລຶບຮູບພາບສຳເລັດແລ້ວ"),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("Error deleting image:",r.t0),t.$toast.error("ລຶບຮູບພາບບໍ່ສຳເລັດ");case 11:case"end":return r.stop()}}),r,null,[[0,7]])})))()},deleteExistingDocument:function(e,t){var r=this;return Object(L.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$axios.$delete("/api/mous/".concat(e,"/document/").concat(t));case 3:n.sent.success&&r.$toast.success("ລຶບເອກະສານສຳເລັດແລ້ວ"),n.next=11;break;case 7:n.prev=7,n.t0=n.catch(0),console.error("Error deleting document:",n.t0),r.$toast.error("ລຶບເອກະສານບໍ່ສຳເລັດ");case 11:case"end":return n.stop()}}),n,null,[[0,7]])})))()},getFileUrl:function(e,t){if(!t)return"";var r=this.$axios.defaults.baseURL||"";return"".concat(r,"/uploads/").concat(e,"/").concat(t).replace(/\/+/g,"/").replace(":/","://")},getDocumentDownloadUrl:function(e,t){var r=this.$axios.defaults.baseURL||"";return"".concat(r,"/api/mous/download/document/").concat(e,"/").concat(t).replace(/\/+/g,"/").replace(":/","://")},getImageDownloadUrl:function(e){var t=this.$axios.defaults.baseURL||"";return"".concat(t,"/api/mous/download/image/").concat(e).replace(/\/+/g,"/").replace(":/","://")},formatFileSize:function(e){if(0===e)return"0 Bytes";var i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(2))+" "+["Bytes","KB","MB","GB"][i]},getDocumentTypeIcon:function(e){var t={pdf:"mdi-file-pdf-box",doc:"mdi-file-word-box",docx:"mdi-file-word-box",xls:"mdi-file-excel-box",xlsx:"mdi-file-excel-box",txt:"mdi-file-document-outline",default:"mdi-file-document"};return t[e.split(".").pop().toLowerCase()]||t.default},getDocumentTypeColor:function(e){var t={pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",txt:"grey",default:"primary"};return t[e.split(".").pop().toLowerCase()]||t.default},fetchDropdownData:function(){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([e.fetchAgencies(),e.fetchCurrencies()]);case 2:case"end":return t.stop()}}),t)})))()},fetchAgencies:function(){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingAgencies=!0,t.prev=1,t.next=4,e.$axios.$get("/api/agency");case 4:(r=t.sent).success&&r.data&&r.data.agencies?e.agencies=r.data.agencies:r.success&&Array.isArray(r.data)&&(e.agencies=r.data),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error("Error fetching agencies:",t.t0),e.$toast.error("ໂຫລດຂໍ້ມູນຕົວແທນບໍ່ສຳເລັດ");case 12:return t.prev=12,e.loadingAgencies=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,8,12,15]])})))()},fetchCurrencies:function(){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingCurrencies=!0,t.prev=1,t.next=4,e.$axios.$get("/api/currency/find");case 4:r=t.sent,Array.isArray(r)?e.currencies=r:r.success&&r.data?e.currencies=r.data:r&&!r.success&&(e.currencies=r),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error("Error fetching currencies:",t.t0),e.$toast.error("ໂຫລດຂໍ້ມູນສະກຸນເງິນບໍ່ສຳເລັດ");case 12:return t.prev=12,e.loadingCurrencies=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,8,12,15]])})))()},save:function(){var e=this;return Object(L.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.form.validate()){t.next=3;break}return e.$toast.error("ກະລຸນາແກ້ໄຂຂໍ້ຜິດພາດໃນແບບຟອມກ່ອນບັນທຶກ"),t.abrupt("return");case 3:if(e.saving=!0,t.prev=4,(r=S({},e.form)).pmCharge||(r.pmCharge=0),r.exchangeRate||(r.exchangeRate=1),r.numberOfWorkers||(r.numberOfWorkers=1),n=new FormData,Object.keys(r).forEach((function(e){"images"!==e&&"documents"!==e&&n.append(e,r[e])})),r.images.forEach((function(image){image.isNew&&image.file&&n.append("images",image.file)})),r.documents.forEach((function(e){e.isNew&&e.file&&n.append("documents",e.file)})),!e.isEditing){t.next=19;break}return t.next=16,e.$axios.$put("/api/mous/".concat(e.editingItem.id),n,{headers:{"Content-Type":"multipart/form-data"}});case 16:o=t.sent,t.next=22;break;case 19:return t.next=21,e.$axios.$post("/api/mous",n,{headers:{"Content-Type":"multipart/form-data"}});case 21:o=t.sent;case 22:o.success&&(e.$toast.success("MOU ".concat(e.isEditing?"ອັບເດດ":"ສ້າງ","ສຳເລັດແລ້ວ")),e.$emit("saved",o.data)),t.next=30;break;case 25:t.prev=25,t.t0=t.catch(4),console.error("Error saving MOU:",t.t0),d=(null===(c=t.t0.response)||void 0===c||null===(l=c.data)||void 0===l?void 0:l.message)||"ເກີດຂໍ້ຜິດພາດໃນການບັນທຶກ",e.$toast.error(d);case 30:return t.prev=30,e.saving=!1,t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[4,25,30,33]])})))()},cancel:function(){this.$emit("cancelled")},getStatusColor:function(e){return{draft:"grey",open:"blue",in_progress:"orange",completed:"green",cancelled:"red"}[e]||"grey"},getWorkerTypeColor:function(e){return{Man:"blue",Woman:"pink",Spous:"purple",Any:"green"}[e]||"grey"},getWorkerTypeIcon:function(e){return{Man:"mdi-account",Woman:"mdi-account-outline",Spous:"mdi-account-heart",Any:"mdi-account-group"}[e]||"mdi-account"}}},M=(r(1592),r(31)),component=Object(M.a)(z,(function(){var e,t=this,r=t._self._c;return r(v.a,{attrs:{value:t.value,fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition",scrollable:""},on:{input:function(e){return t.$emit("input",e)}}},[r(o.a,{staticClass:"maintenance-dialog"},[r(F.a,{staticClass:"dialog-toolbar",attrs:{color:"primary",dark:"",flat:""}},[r(n.a,{staticClass:"close-btn",attrs:{icon:""},on:{click:t.cancel}},[r(C.a,[t._v("mdi-close")])],1),t._v(" "),r(U.a,{staticClass:"toolbar-title"},[r(C.a,{staticClass:"mr-2",attrs:{left:""}},[t._v("mdi-file-document-edit")]),t._v("\n        "+t._s(t.isEditing?"ແກ້ໄຂ MOU":"ສ້າງ MOU ໃໝ່")+"\n      ")],1),t._v(" "),r(j.a),t._v(" "),r(n.a,{staticClass:"save-btn",attrs:{text:"",loading:t.saving,disabled:!t.isFormValid},on:{click:t.save}},[r(C.a,{attrs:{left:""}},[t._v("mdi-content-save")]),t._v("\n        ບັນທຶກ\n      ")],1)],1),t._v(" "),r(c.c,{staticClass:"dialog-content pa-0"},[r(f.a,{staticClass:"form-container",attrs:{fluid:""}},[r(k.a,{ref:"form",attrs:{"lazy-validation":""},model:{value:t.isFormValid,callback:function(e){t.isFormValid=e},expression:"isFormValid"}},[r(P.a,{attrs:{dense:""}},[r(m.a,{staticClass:"pb-0",attrs:{cols:"12"}},[r("div",{staticClass:"section-header compact"},[r(C.a,{staticClass:"mr-2",attrs:{color:"primary",small:""}},[t._v("mdi-information")]),t._v(" "),r("h3",{staticClass:"section-title"},[t._v("ຂໍ້ມູນພື້ນຖານ")])],1)]),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"4",md:"3"}},[r(R.a,{attrs:{label:"ລະຫັດວຽກ *",rules:[t.rules.required],outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-identifier",disabled:t.isEditing},model:{value:t.form.jobCode,callback:function(e){t.$set(t.form,"jobCode",e)},expression:"form.jobCode"}})],1),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"4",md:"3"}},[r(R.a,{attrs:{label:"ມູນຄ່າ Order",outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-file-document"},model:{value:t.form.projectAmount,callback:function(e){t.$set(t.form,"projectAmount",e)},expression:"form.projectAmount"}})],1),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"4",md:"2"}},[r(R.a,{attrs:{label:"ຄ່າບໍລິຫານ PM",outlined:"",dense:"","hide-details":"auto",type:"number",min:"0",step:"0.01","prepend-inner-icon":"mdi-cash",suffix:(null===(e=t.selectedCurrency)||void 0===e?void 0:e.code)||"USD"},model:{value:t.form.pmCharge,callback:function(e){t.$set(t.form,"pmCharge",t._n(e))},expression:"form.pmCharge"}})],1),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"4",md:"2"}},[r(O.a,{attrs:{items:t.currencies,"item-text":"code","item-value":"id",label:"ສະກຸນເງິນ",outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-currency-usd",loading:t.loadingCurrencies},model:{value:t.form.currencyId,callback:function(e){t.$set(t.form,"currencyId",e)},expression:"form.currencyId"}})],1),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"3",md:"2"}},[r(R.a,{attrs:{label:"ອັດຕາແລກປ່ຽນ",outlined:"",dense:"","hide-details":"auto",type:"number",min:"0",step:"0.001","prepend-inner-icon":"mdi-swap-horizontal"},model:{value:t.form.exchangeRate,callback:function(e){t.$set(t.form,"exchangeRate",t._n(e))},expression:"form.exchangeRate"}})],1),t._v(" "),r(m.a,{attrs:{cols:"4",sm:"4",md:"2"}},[r(O.a,{attrs:{items:t.agencies,"item-text":"agencyName","item-value":"id",label:"ຕົວແທນ",outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-domain",loading:t.loadingAgencies,clearable:""},model:{value:t.form.agencyId,callback:function(e){t.$set(t.form,"agencyId",e)},expression:"form.agencyId"}})],1),t._v(" "),r(m.a,{attrs:{cols:"4",md:"4"}},[r(R.a,{attrs:{label:"ບໍລິສັດນາຍຈ້າງ",outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-office-building"},model:{value:t.form.employerCompany,callback:function(e){t.$set(t.form,"employerCompany",e)},expression:"form.employerCompany"}})],1),t._v(" "),r(m.a,{staticClass:"pb-0 pt-2",attrs:{cols:"12"}},[r("div",{staticClass:"section-header compact"},[r(C.a,{staticClass:"mr-2",attrs:{color:"primary",small:""}},[t._v("mdi-domain")]),t._v(" "),r("h3",{staticClass:"section-title"},[t._v("ບໍລິສັດ & ສະຖານທີ່")])],1)]),t._v(" "),r(m.a,{attrs:{cols:"4",md:"4"}},[r(R.a,{attrs:{label:"ສະຖານທີ່ເຮັດວຽກ",outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-map-marker"},model:{value:t.form.workLocation,callback:function(e){t.$set(t.form,"workLocation",e)},expression:"form.workLocation"}})],1),t._v(" "),r(m.a,{attrs:{cols:"4",md:"4"}},[r(R.a,{attrs:{label:"ໜ້າວຽກ *",rules:[t.rules.required],outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-briefcase"},model:{value:t.form.jobTitle,callback:function(e){t.$set(t.form,"jobTitle",e)},expression:"form.jobTitle"}})],1),t._v(" "),r(m.a,{staticClass:"pb-0 pt-2",attrs:{cols:"12"}},[r("div",{staticClass:"section-header compact"},[r(C.a,{staticClass:"mr-2",attrs:{color:"primary",small:""}},[t._v("mdi-account-group")]),t._v(" "),r("h3",{staticClass:"section-title"},[t._v("ແຮງງານ & ການເງິນ")])],1)]),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"3",md:"2"}},[r(R.a,{attrs:{label:"ຈຳນວນແຮງງານ *",rules:[t.rules.required,t.rules.positiveNumber],outlined:"",dense:"","hide-details":"auto",type:"number",min:"1","prepend-inner-icon":"mdi-counter"},model:{value:t.form.numberOfWorkers,callback:function(e){t.$set(t.form,"numberOfWorkers",t._n(e))},expression:"form.numberOfWorkers"}})],1),t._v(" "),r(m.a,{attrs:{cols:"6",sm:"3",md:"2"}},[r(O.a,{attrs:{items:t.workerTypeOptions,label:"ປະເພດແຮງງານ *",rules:[t.rules.required],outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-account"},model:{value:t.form.workerType,callback:function(e){t.$set(t.form,"workerType",e)},expression:"form.workerType"}})],1),t._v(" "),r(m.a,{attrs:{cols:"4",sm:"4",md:"3"}},[r(O.a,{attrs:{items:t.statusOptions,label:"ສະຖານະວຽກ *",rules:[t.rules.required],outlined:"",dense:"","hide-details":"auto","prepend-inner-icon":"mdi-flag"},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;return[r(l.a,{attrs:{color:t.getStatusColor(n.value),"x-small":"","text-color":"white"}},[t._v("\n                    "+t._s(n.text)+"\n                  ")])]}}]),model:{value:t.form.jobStatus,callback:function(e){t.$set(t.form,"jobStatus",e)},expression:"form.jobStatus"}})],1),t._v(" "),r(m.a,{staticClass:"pb-0 pt-2",attrs:{cols:"12"}},[r("div",{staticClass:"section-header compact"},[r(C.a,{staticClass:"mr-2",attrs:{color:"primary",small:""}},[t._v("mdi-note-text")]),t._v(" "),r("h3",{staticClass:"section-title"},[t._v("ໝາຍເຫດ")])],1)]),t._v(" "),r(m.a,{attrs:{cols:"12"}},[r(E.a,{attrs:{label:"ໝາຍເຫດ",outlined:"",dense:"",rows:"2","hide-details":"auto","prepend-inner-icon":"mdi-note"},model:{value:t.form.notes,callback:function(e){t.$set(t.form,"notes",e)},expression:"form.notes"}})],1),t._v(" "),r(m.a,{staticClass:"pb-0 pt-2",attrs:{cols:"12"}},[r("div",{staticClass:"section-header compact"},[r(C.a,{staticClass:"mr-2",attrs:{color:"primary",small:""}},[t._v("mdi-file-multiple")]),t._v(" "),r("h3",{staticClass:"section-title"},[t._v("ໄຟລ໌ແນບ")])],1)]),t._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,{ref:"imageInput",attrs:{label:"ຮູບພາບ (5MB)",multiple:"",accept:"image/*","prepend-icon":"mdi-camera",outlined:"",dense:"","hide-details":"auto",clearable:!1,disabled:t.processingFiles},on:{change:t.handleImageSelection},scopedSlots:t._u([{key:"selection",fn:function(e){e.text;return[r(l.a,{attrs:{"x-small":"",label:"",color:"primary"}},[t._v("\n                    "+t._s(t.selectedImages?t.selectedImages.length:0)+" ຮູບ\n                  ")])]}}]),model:{value:t.selectedImages,callback:function(e){t.selectedImages=e},expression:"selectedImages"}})],1),t._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,{ref:"documentInput",attrs:{label:"ເອກະສານ (10MB)",multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.txt","prepend-icon":"mdi-file-document",outlined:"",dense:"","hide-details":"auto",clearable:!1,disabled:t.processingFiles},on:{change:t.handleDocumentSelection},scopedSlots:t._u([{key:"selection",fn:function(e){e.text;return[r(l.a,{attrs:{"x-small":"",label:"",color:"primary"}},[t._v("\n                    "+t._s(t.selectedDocuments?t.selectedDocuments.length:0)+"\n                    ເອກະສານ\n                  ")])]}}]),model:{value:t.selectedDocuments,callback:function(e){t.selectedDocuments=e},expression:"selectedDocuments"}})],1),t._v(" "),t.processingFiles&&t.fileProgress.total>0?r(m.a,{attrs:{cols:"12"}},[r(D.a,{attrs:{value:t.fileProgress.current/t.fileProgress.total*100,color:"primary",height:"3"},scopedSlots:t._u([{key:"default",fn:function(){return[r("small",[t._v(t._s(t.fileProgress.current)+"/"+t._s(t.fileProgress.total))])]},proxy:!0}],null,!1,245601818)})],1):t._e(),t._v(" "),t.form.images&&t.form.images.length>0||t.form.documents&&t.form.documents.length>0?r(m.a,{attrs:{cols:"12"}},[r(_.a,{attrs:{flat:""}},[r(h.a,[r(w.a,{staticClass:"pa-2"},[r("div",{staticClass:"d-flex align-center"},[r(C.a,{staticClass:"mr-2",attrs:{small:""}},[t._v("mdi-paperclip")]),t._v(" "),r("span",{staticClass:"text-caption"},[t._v("\n                        "+t._s(t.form.images.length)+" ຮູບພາບ,\n                        "+t._s(t.form.documents.length)+" ເອກະສານ\n                      ")])],1)]),t._v(" "),r(x.a,[t.form.images.length>0?r("div",{staticClass:"mb-2"},[r(d.a,{attrs:{column:""}},t._l(t.form.images,(function(image,e){return r(l.a,{key:"img-".concat(e),attrs:{small:"",close:""},on:{"click:close":function(r){return t.removeImage(e)},click:function(r){return t.openImagePreview(image,e)}}},[r(C.a,{attrs:{small:"",left:""}},[t._v("mdi-image")]),t._v("\n                          "+t._s(image.name)+"\n                        ")],1)})),1)],1):t._e(),t._v(" "),t.form.documents.length>0?r("div",[r(d.a,{attrs:{column:""}},t._l(t.form.documents,(function(e,o){return r(l.a,{key:"doc-".concat(o),attrs:{small:"",close:""},on:{"click:close":function(e){return t.removeDocument(o)}}},[r(C.a,{attrs:{small:"",left:"",color:t.getDocumentTypeColor(e.name)}},[t._v("\n                            "+t._s(t.getDocumentTypeIcon(e.name))+"\n                          ")]),t._v("\n                          "+t._s(e.name)+"\n                          "),t.isPdfFile(e.name)&&e.url?r(n.a,{staticClass:"ml-1",attrs:{icon:"","x-small":""},on:{click:function(r){return r.stopPropagation(),t.viewPdf(e)}}},[r(C.a,{attrs:{"x-small":""}},[t._v("mdi-eye")])],1):t._e(),t._v(" "),e.url?r(n.a,{staticClass:"ml-1",attrs:{icon:"","x-small":""},on:{click:function(r){return r.stopPropagation(),t.downloadDocument(e)}}},[r(C.a,{attrs:{"x-small":""}},[t._v("mdi-download")])],1):t._e()],1)})),1)],1):t._e()])],1)],1)],1):t._e()],1)],1)],1)],1),t._v(" "),r(c.a,{staticClass:"dialog-actions pa-3"},[r(j.a),t._v(" "),r(n.a,{staticClass:"mr-2",attrs:{text:""},on:{click:t.cancel}},[r(C.a,{attrs:{left:"",small:""}},[t._v("mdi-cancel")]),t._v("\n        ຍົກເລີກ\n      ")],1),t._v(" "),r(n.a,{attrs:{color:"primary",loading:t.saving,disabled:!t.isFormValid},on:{click:t.save}},[r(C.a,{attrs:{left:"",small:""}},[t._v("mdi-content-save")]),t._v("\n        "+t._s(t.isEditing?"ອັບເດດ":"ສ້າງ")+"\n      ")],1)],1)],1),t._v(" "),r(v.a,{attrs:{"max-width":"90vw"},model:{value:t.imagePreviewDialog,callback:function(e){t.imagePreviewDialog=e},expression:"imagePreviewDialog"}},[t.previewImage?r(o.a,[r(c.d,{staticClass:"d-flex justify-space-between align-center"},[r("span",[t._v(t._s(t.previewImage.name))]),t._v(" "),r(n.a,{attrs:{icon:""},on:{click:function(e){t.imagePreviewDialog=!1}}},[r(C.a,[t._v("mdi-close")])],1)],1),t._v(" "),r(c.c,{staticClass:"pa-0"},[r(I.a,{attrs:{src:t.previewImage.preview||t.previewImage.url,contain:"","max-height":"70vh"}})],1),t._v(" "),r(c.a,[r(j.a),t._v(" "),t.previewImage.url?r(n.a,{attrs:{color:"primary",text:""},on:{click:function(e){return t.downloadImage(t.previewImage)}}},[r(C.a,{attrs:{left:""}},[t._v("mdi-download")]),t._v("\n          ດາວໂຫລດ\n        ")],1):t._e(),t._v(" "),r(n.a,{attrs:{color:"red",text:""},on:{click:t.removeImageFromPreview}},[r(C.a,{attrs:{left:""}},[t._v("mdi-delete")]),t._v("\n          ລຶບ\n        ")],1)],1)],1):t._e()],1),t._v(" "),r(v.a,{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition",scrollable:""},model:{value:t.pdfViewerDialog,callback:function(e){t.pdfViewerDialog=e},expression:"pdfViewerDialog"}},[r(o.a,[r(F.a,{attrs:{dark:"",color:"primary"}},[r(n.a,{attrs:{icon:""},on:{click:function(e){t.pdfViewerDialog=!1}}},[r(C.a,[t._v("mdi-close")])],1),t._v(" "),r(U.a,[r(C.a,{attrs:{left:""}},[t._v("mdi-file-pdf-box")]),t._v("\n          "+t._s(t.currentPdfName)+"\n        ")],1),t._v(" "),r(j.a),t._v(" "),t.currentPdfUrl?r(n.a,{attrs:{text:""},on:{click:t.downloadCurrentPdf}},[r(C.a,{attrs:{left:""}},[t._v("mdi-download")]),t._v("\n          ດາວໂຫລດ\n        ")],1):t._e()],1),t._v(" "),r(c.c,{staticClass:"pa-0 pdf-viewer-content"},[r("div",{staticClass:"pdf-container"},[t.currentPdfUrl?r("iframe",{staticClass:"pdf-iframe",attrs:{src:t.currentPdfUrl+"#toolbar=1&navpanes=1&scrollbar=1",width:"100%",height:"100%",frameborder:"0"}},[r("p",[t._v("Your browser does not support iframes.")])]):r("div",{staticClass:"pdf-loading"},[r($.a,{attrs:{indeterminate:"",size:"64",color:"primary"}}),t._v(" "),r("p",{staticClass:"mt-4"},[t._v("ກຳລັງໂຫລດ PDF...")])],1)])])],1)],1)],1)}),[],!1,null,"6d6080eb",null);t.default=component.exports}}]);