(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1271:function(t,e,n){var content=n(1579);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("c7379172",content,!0,{sourceMap:!1})},1578:function(t,e,n){"use strict";n(1271)},1579:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,'.modal-overlay[data-v-fbf9c31a]{align-items:center;background-color:rgba(0,0,0,.6);display:flex;height:100%;justify-content:center;left:0;padding:10px;position:fixed;top:0;width:100%;z-index:1050}.enhanced-dialog[data-v-fbf9c31a]{background:#fff;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;height:95vh;max-height:95vh;max-width:98vw;overflow:hidden;width:100%}.modal-header[data-v-fbf9c31a]{background:linear-gradient(135deg,#01532b,#337555);border-bottom:1px solid #e9ecef;color:#fff;justify-content:space-between;min-height:50px;padding:10px 15px}.modal-header[data-v-fbf9c31a],.modal-title[data-v-fbf9c31a]{align-items:center;display:flex}.modal-title[data-v-fbf9c31a]{font-size:16px;font-weight:600;gap:8px;margin:0}.audit-btn[data-v-fbf9c31a]{align-items:center;background:hsla(0,0%,100%,.2);border:1px solid hsla(0,0%,100%,.3);border-radius:4px;color:#fff;cursor:pointer;display:flex;font-size:12px;gap:4px;padding:4px 8px}.audit-btn[data-v-fbf9c31a]:hover{background:hsla(0,0%,100%,.3)}.audit-text[data-v-fbf9c31a]{font-size:11px}.close-button[data-v-fbf9c31a]{background:none;border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:18px;padding:4px;transition:background .2s}.close-button[data-v-fbf9c31a]:hover{background:hsla(0,0%,100%,.2)}.modal-body[data-v-fbf9c31a]{flex:1;overflow:hidden}.loading-state[data-v-fbf9c31a],.modal-body[data-v-fbf9c31a]{display:flex;flex-direction:column}.loading-state[data-v-fbf9c31a]{align-items:center;color:#666;justify-content:center;padding:30px}.spinner[data-v-fbf9c31a]{animation:spin-fbf9c31a 1s linear infinite;border:3px solid #f3f3f3;border-radius:50%;border-top-color:#3498db;height:30px;margin-bottom:10px;width:30px}@keyframes spin-fbf9c31a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.invoice-form[data-v-fbf9c31a]{display:flex;flex:1;flex-direction:column;overflow:hidden}.tab-navigation[data-v-fbf9c31a]{background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;min-height:45px}.tab-btn[data-v-fbf9c31a]{align-items:center;background:none;border:none;color:#666;cursor:pointer;display:flex;flex:1;font-size:13px;font-weight:500;gap:6px;justify-content:center;padding:8px 15px;position:relative;transition:all .2s}.tab-btn[data-v-fbf9c31a]:hover{background:rgba(102,126,234,.1);color:#667eea}.tab-btn.active[data-v-fbf9c31a]{background:#fff;border-bottom:2px solid #667eea;color:#667eea}.line-count[data-v-fbf9c31a]{background:#667eea;border-radius:10px;color:#fff;font-size:11px;min-width:18px;padding:1px 6px;text-align:center}.tab-content[data-v-fbf9c31a]{flex:1;overflow-y:auto;padding:0}.form-container[data-v-fbf9c31a]{padding:15px}.form-row[data-v-fbf9c31a]{grid-gap:10px;display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:12px}.form-group[data-v-fbf9c31a]{margin-bottom:0}.form-group.full-width[data-v-fbf9c31a]{grid-column:1/-1}.form-group label[data-v-fbf9c31a]{color:#333;display:block;font-size:12px;font-weight:500;margin-bottom:3px}.form-group label.required[data-v-fbf9c31a]:after{color:#e74c3c;content:" *"}.form-control[data-v-fbf9c31a]{border:1px solid #ddd;border-radius:4px;font-size:13px;line-height:1.2;padding:6px 8px;transition:border-color .2s,box-shadow .2s;width:100%}.form-control[data-v-fbf9c31a]:focus{border-color:#667eea;box-shadow:0 0 0 2px rgba(102,126,234,.1);outline:none}.form-control.is-invalid[data-v-fbf9c31a]{border-color:#e74c3c;box-shadow:0 0 0 2px rgba(231,76,60,.1)}.form-control-xs[data-v-fbf9c31a]{font-size:12px;padding:4px 6px}.textarea-compact[data-v-fbf9c31a]{min-height:50px;resize:vertical}.invalid-feedback[data-v-fbf9c31a]{color:#e74c3c;display:block;font-size:11px;margin-top:3px;width:100%}.amount-summary[data-v-fbf9c31a]{background:#f8f9fa;border-left:3px solid #667eea;border-radius:6px;margin-top:15px;padding:12px}.totals-compact[data-v-fbf9c31a]{grid-gap:8px;display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}.total-item[data-v-fbf9c31a]{align-items:center;display:flex;font-size:12px;justify-content:space-between;padding:4px 0}.total-item.grand-total[data-v-fbf9c31a]{border-top:1px solid #667eea;font-size:13px;font-weight:600;grid-column:1/-1;margin-top:4px;padding-top:6px}.total-item .amount[data-v-fbf9c31a]{color:#333;font-weight:600}.line-items-section[data-v-fbf9c31a]{padding:15px}.add-line-header[data-v-fbf9c31a]{margin-bottom:15px}.add-line-actions[data-v-fbf9c31a]{align-items:center;display:flex;flex-wrap:wrap;gap:10px}.btn[data-v-fbf9c31a]{align-items:center;border:none;border-radius:4px;cursor:pointer;display:inline-flex;font-size:12px;gap:4px;line-height:1.2;padding:6px 12px;transition:all .2s ease}.btn-compact[data-v-fbf9c31a]{font-size:12px;padding:5px 10px}.btn-primary[data-v-fbf9c31a]{background:#007bff;color:#fff}.btn-secondary[data-v-fbf9c31a]{background:#6c757d;color:#fff}.btn-outline-secondary[data-v-fbf9c31a]{background:#fff;border:1px solid #6c757d;color:#6c757d}.btn-danger[data-v-fbf9c31a]{background:#dc3545;color:#fff}.btn-xs[data-v-fbf9c31a]{align-items:center;border-radius:50%;display:flex;font-size:10px;height:24px;justify-content:center;padding:0;width:24px}.btn[data-v-fbf9c31a]:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}.btn[data-v-fbf9c31a]:disabled{cursor:not-allowed;opacity:.6;transform:none}.line-count-info[data-v-fbf9c31a]{background:#e9ecef;border-radius:12px;color:#666;font-size:11px;font-weight:500;padding:4px 8px}.empty-line-state[data-v-fbf9c31a]{background:#f8f9fa;border:1px dashed #dee2e6;border-radius:6px;padding:30px 15px;text-align:center}.empty-content i[data-v-fbf9c31a]{color:#dee2e6;font-size:36px;margin-bottom:10px}.empty-content h4[data-v-fbf9c31a]{color:#666;font-size:16px;margin-bottom:8px}.line-items-table-container[data-v-fbf9c31a]{border:1px solid #e9ecef;border-radius:6px;margin-bottom:15px;overflow:hidden}.line-items-table .table[data-v-fbf9c31a]{border-collapse:collapse;margin:0;width:100%}.table-compact[data-v-fbf9c31a]{font-size:12px}.line-items-table .table th[data-v-fbf9c31a]{background:#f8f9fa;border-bottom:1px solid #dee2e6;font-size:11px;font-weight:600;padding:6px 4px;text-align:center}.line-items-table .table td[data-v-fbf9c31a]{border-top:1px solid #dee2e6;font-size:11px;padding:4px;vertical-align:middle}.line-number[data-v-fbf9c31a]{color:#666;font-weight:600;text-align:center}.line-total[data-v-fbf9c31a],.tax-amount[data-v-fbf9c31a]{color:#333;font-size:11px;font-weight:600;text-align:right}.line-row[data-v-fbf9c31a]{transition:background-color .2s}.line-row[data-v-fbf9c31a]:hover{background-color:rgba(102,126,234,.05)}.line-totals-summary[data-v-fbf9c31a]{background:#f8f9fa;border-left:3px solid #667eea;border-radius:6px;padding:12px}.modal-footer[data-v-fbf9c31a]{background:#f8f9fa;border-top:1px solid #e9ecef;min-height:50px;padding:10px 15px}.footer-actions[data-v-fbf9c31a]{display:flex;gap:8px;justify-content:flex-end}@media (max-width:768px){.enhanced-dialog[data-v-fbf9c31a]{border-radius:0;height:100vh;max-height:100vh;padding:0;width:100%}.modal-overlay[data-v-fbf9c31a]{padding:0}.form-row[data-v-fbf9c31a],.totals-compact[data-v-fbf9c31a]{grid-template-columns:1fr}.add-line-actions[data-v-fbf9c31a]{align-items:stretch}.add-line-actions[data-v-fbf9c31a],.footer-actions[data-v-fbf9c31a]{flex-direction:column}.footer-actions .btn[data-v-fbf9c31a]{justify-content:center;width:100%}.line-items-table-container[data-v-fbf9c31a]{overflow-x:auto}.line-items-table .table[data-v-fbf9c31a]{min-width:600px}}@media (max-width:480px){.modal-header[data-v-fbf9c31a]{padding:8px 10px}.modal-title[data-v-fbf9c31a]{font-size:14px}.form-container[data-v-fbf9c31a],.line-items-section[data-v-fbf9c31a]{padding:10px}.modal-footer[data-v-fbf9c31a]{padding:8px 10px}.tab-btn[data-v-fbf9c31a]{font-size:11px;padding:6px 8px}}',""]),o.locals={},t.exports=o},1697:function(t,e,n){"use strict";n.r(e);n(44),n(9),n(5),n(35),n(7),n(67),n(12),n(13);var o=n(3),r=n(20);n(92),n(66),n(8),n(121),n(10),n(100),n(30);function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function l(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var d={name:"InvoiceHeaderMaintain",components:{InvoiceAuditDialog:n(1698).default},props:{visible:{type:Boolean,default:!1},invoice:{type:Object,default:null},customers:{type:Array,default:function(){return[]}},currencies:{type:Array,default:function(){return[]}}},data:function(){return{showAuditDialog:!1,activeTab:"header",formLoading:!1,saving:!1,errors:{},lineItems:[],nextTempId:1,selectedCustomer:null,selectedCurrency:null,form:{id:null,invoiceNumber:"",invoiceDate:"",dueDate:"",clientId:"",currencyId:"",exchangeRate:1,totalAmount:0,taxAmount:0,netAmount:0,status:"draft",description:"",reason:""}}},computed:{isEdit:function(){return!(!this.invoice||!this.invoice.id)},user:function(){return this.$auth.user||""},invoiceInfoForAudit:function(){return this.form.id?{invoiceNumber:this.form.invoiceNumber,totalAmount:this.calculatedTotal,invoiceDate:this.form.invoiceDate,status:this.form.status,clientId:this.form.clientId,currencyId:this.form.currencyId,description:this.form.description}:null},calculatedSubtotal:function(){return this.lineItems.reduce((function(t,line){return t+(parseFloat(line.quantity)||0)*(parseFloat(line.unitPrice)||0)}),0)},calculatedTax:function(){return this.lineItems.reduce((function(t,line){return t+(parseFloat(line.taxAmount)||0)}),0)},calculatedNet:function(){return this.calculatedSubtotal},calculatedTotal:function(){return this.lineItems.reduce((function(t,line){return t+(parseFloat(line.lineTotal)||0)}),0)},isFormValid:function(){var t=this.form.invoiceNumber&&this.form.invoiceDate&&this.form.clientId&&(!this.isEdit||this.form.reason),e=this.lineItems.length>0&&this.lineItems.every((function(line){return line.description&&(parseFloat(line.quantity)||0)>0&&(parseFloat(line.unitPrice)||0)>=0}));return t&&e}},watch:{visible:{handler:function(t){t?this.initializeDialog():this.resetDialog()},immediate:!0},invoice:{handler:function(){this.visible&&this.initializeDialog()}}},methods:{openAuditDialog:function(){console.warn("Opening dialog"),this.showAuditDialog=!0},closeAuditDialog:function(){this.showAuditDialog=!1},initializeDialog:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.activeTab="header",t.clearErrors(),!t.invoice){e.next=8;break}return t.form={id:t.invoice.id,invoiceNumber:t.invoice.invoiceNumber,invoiceDate:t.invoice.invoiceDate?t.invoice.invoiceDate.split("T")[0]:"",dueDate:t.invoice.dueDate?t.invoice.dueDate.split("T")[0]:"",clientId:t.invoice.clientId,currencyId:t.invoice.currencyId,exchangeRate:t.invoice.exchangeRate||1,totalAmount:t.invoice.totalAmount||0,taxAmount:t.invoice.taxAmount||0,netAmount:t.invoice.netAmount||0,status:t.invoice.status||"draft",description:t.invoice.description||"",reason:""},e.next=6,t.loadLineItems(t.invoice.id);case 6:e.next=15;break;case 8:t.resetForm(),t.form.invoiceDate=(new Date).toISOString().split("T")[0],(n=new Date).setDate(n.getDate()+30),t.form.dueDate=n.toISOString().split("T")[0],t.currencies.length>0&&(o=t.currencies.find((function(t){return"USD"===t.code}))||t.currencies[0],t.form.currencyId=o.id,t.selectedCurrency=o),t.lineItems=[t.createEmptyLine()];case 15:t.updateSelectedCustomer(),t.updateSelectedCurrency();case 17:case"end":return e.stop()}}),e)})))()},resetDialog:function(){this.resetForm(),this.lineItems=[],this.selectedCustomer=null,this.selectedCurrency=null,this.clearErrors(),this.activeTab="header",this.formLoading=!1,this.saving=!1},loadLineItems:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$axios.get("/api/ar-invoice-lines/by-header/".concat(t));case 3:o=n.sent,data=o.data,e.lineItems=data.data||[e.createEmptyLine()],e.lineItems.forEach((function(line){line.tempId||(line.tempId=e.nextTempId++)})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error("Error loading line items:",n.t0),e.lineItems=[e.createEmptyLine()];case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},createEmptyLine:function(){return{tempId:this.nextTempId++,lineNumber:this.lineItems.length+1,description:"",quantity:1,unitPrice:0,taxRate:0,taxAmount:0,lineTotal:0}},addNewLine:function(){this.lineItems.push(this.createEmptyLine())},addMultipleLines:function(t){for(var i=0;i<t;i++)this.lineItems.push(this.createEmptyLine())},removeLine:function(t){this.lineItems.length>1&&(this.lineItems.splice(t,1),this.updateLineNumbers())},updateLineNumbers:function(){this.lineItems.forEach((function(line,t){line.lineNumber=t+1}))},calculateLineTotal:function(line){var t=(parseFloat(line.quantity)||0)*(parseFloat(line.unitPrice)||0),e=t*((parseFloat(line.taxRate)||0)/100);line.taxAmount=e,line.lineTotal=t+e},updateSelectedCustomer:function(){var t=this;this.form.clientId&&this.customers.length>0?this.selectedCustomer=this.customers.find((function(e){return e.id===t.form.clientId})):this.selectedCustomer=null},updateSelectedCurrency:function(){var t=this;this.form.currencyId&&this.currencies.length>0?(this.selectedCurrency=this.currencies.find((function(e){return e.id===t.form.currencyId})),console.info("Currency structure ".concat(JSON.stringify(this.currencies))),this.form.exchangeRate=this.currencies.find((function(e){return e.id===t.form.currencyId})).rate):this.selectedCurrency=null},onCustomerChange:function(){this.updateSelectedCustomer(),this.calculateDueDate(),this.clearFieldError("clientId")},onCurrencyChange:function(){this.updateSelectedCurrency(),this.clearFieldError("currencyId")},calculateDueDate:function(){var t;if(this.form.invoiceDate&&null!==(t=this.selectedCustomer)&&void 0!==t&&t.paymentTerms){var e=new Date(this.form.invoiceDate),n=new Date(e);n.setDate(n.getDate()+parseInt(this.selectedCustomer.paymentTerms)),this.form.dueDate=n.toISOString().split("T")[0]}},validateForm:function(){if(this.errors={},this.form.invoiceNumber||(this.errors.invoiceNumber="ກະລຸນາໃສ່ເລກທີໃບແຈ້ງໜີ້"),this.form.clientId||(this.errors.clientId="ກະລຸນາເລືອກລູກຄ້າ"),this.form.invoiceDate||(this.errors.invoiceDate="ກະລຸນາໃສ່ວັນທີໃບແຈ້ງໜີ້"),this.form.invoiceDate&&this.form.dueDate){var t=new Date(this.form.invoiceDate);new Date(this.form.dueDate)<=t&&(this.errors.dueDate="ວັນທີຄົບກຳນົດຕ້ອງຫຼັງຈາກວັນທີໃບແຈ້ງໜີ້")}if(0===this.lineItems.length)this.errors.lineItems="ກະລຸນາເພີ່ມລາຍການສິນຄ້າຢ່າງໜ້ອຍ 1 ລາຍການ";else for(var i=0;i<this.lineItems.length;i++){var line=this.lineItems[i];line.description||(this.errors["line_".concat(i,"_description")]="ກະລຸນາໃສ່ລາຍລະອຽດສິນຄ້າ"),(!line.quantity||parseFloat(line.quantity)<=0)&&(this.errors["line_".concat(i,"_quantity")]="ຈຳນວນຕ້ອງຫຼາຍກວ່າ 0"),(""===line.unitPrice||parseFloat(line.unitPrice)<0)&&(this.errors["line_".concat(i,"_unitPrice")]="ລາຄາຕ້ອງເປັນຄ່າບວກ")}return this.isEdit&&!this.form.reason&&(this.errors.reason="ກະລຸນາລະບຸເຫດຜົນຂອງການແກ້ໄຂ"),0===Object.keys(this.errors).length},clearErrors:function(){this.errors={}},clearFieldError:function(t){this.errors[t]&&this.$delete(this.errors,t)},handleSubmit:function(){if(this.validateForm()){this.saving=!0;var t=l(l({},this.form),{},{totalAmount:this.calculatedTotal,taxAmount:this.calculatedTax,netAmount:this.calculatedNet,updateUserId:this.user.id,exchangeRate:parseFloat(this.form.exchangeRate)||1,lineItems:this.lineItems.map((function(line,t){return l(l({},line),{},{lineNumber:t+1,quantity:parseFloat(line.quantity)||0,unitPrice:parseFloat(line.unitPrice)||0,taxRate:parseFloat(line.taxRate)||0})}))});this.$emit("save",t)}else Object.keys(this.errors).some((function(t){return t.startsWith("line_")}))?this.activeTab="lines":this.activeTab="header"},handleOverlayClick:function(){this.saving||this.handleClose()},handleClose:function(){this.$emit("close")},resetForm:function(){this.form={id:null,invoiceNumber:"",invoiceDate:"",dueDate:"",clientId:"",currencyId:"",exchangeRate:1,totalAmount:0,taxAmount:0,netAmount:0,status:"draft",description:"",reason:""}},formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0)},showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";console.log("".concat(e,": ").concat(t)),this.$toast?this.$toast[e](t):"error"===e&&alert("Error: ".concat(t))}}},f=d,v=(n(1578),n(32)),component=Object(v.a)(f,(function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"modal-overlay",on:{click:t.handleOverlayClick}},[e("div",{staticClass:"enhanced-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h4",{staticClass:"modal-title"},[e("i",{staticClass:"fas fa-file-invoice"}),t._v("\n        "+t._s(t.isEdit?"ແກ້ໄຂໃບແຈ້ງໜີ້":"ເພີ່ມໃບແຈ້ງໜີ້ໃໝ່")+"\n      ")]),t._v(" "),t.isEdit?e("button",{staticClass:"audit-btn",attrs:{type:"button",title:"ເບິ່ງປະຫວັດການດຳເນີນງານ"},on:{click:t.openAuditDialog}},[e("i",{staticClass:"fas fa-history"}),t._v(" "),e("span",{staticClass:"audit-text"},[t._v("ປະຫວັດ")])]):t._e(),t._v(" "),e("button",{staticClass:"close-button",attrs:{type:"button"},on:{click:t.handleClose}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[t.formLoading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),t._v(" "),e("p",[t._v("ກຳລັງໂຫຼດຂໍ້ມູນ...")])]):e("div",{staticClass:"invoice-form"},[e("div",{staticClass:"tab-navigation"},[e("button",{class:["tab-btn",{active:"header"===t.activeTab}],attrs:{type:"button"},on:{click:function(e){t.activeTab="header"}}},[e("i",{staticClass:"fas fa-file-alt"}),t._v("\n            ຂໍ້ມູນໃບແຈ້ງໜີ້\n          ")]),t._v(" "),e("button",{class:["tab-btn",{active:"lines"===t.activeTab}],attrs:{type:"button"},on:{click:function(e){t.activeTab="lines"}}},[e("i",{staticClass:"fas fa-list"}),t._v("\n            ລາຍການສິນຄ້າ\n            "),t.lineItems.length>0?e("span",{staticClass:"line-count"},[t._v(t._s(t.lineItems.length))]):t._e()])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"header"===t.activeTab,expression:"activeTab === 'header'"}],staticClass:"tab-content"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-container"},[e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"required",attrs:{for:"invoiceNumber"}},[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.invoiceNumber,expression:"form.invoiceNumber"}],staticClass:"form-control",class:{"is-invalid":t.errors.invoiceNumber},attrs:{id:"invoiceNumber",type:"text",placeholder:"INV-2025-001",readonly:t.isEdit},domProps:{value:t.form.invoiceNumber},on:{input:function(e){e.target.composing||t.$set(t.form,"invoiceNumber",e.target.value)}}}),t._v(" "),t.errors.invoiceNumber?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.invoiceNumber)+"\n                  ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{staticClass:"required",attrs:{for:"clientId"}},[t._v("ລູກຄ້າ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.clientId,expression:"form.clientId"}],staticClass:"form-control",class:{"is-invalid":t.errors.clientId},attrs:{id:"clientId"},on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"clientId",e.target.multiple?n:n[0])},t.onCustomerChange]}},[e("option",{attrs:{value:""}},[t._v("ເລືອກລູກຄ້າ")]),t._v(" "),t._l(t.customers,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                      "+t._s(n.name)+" ("+t._s(n.code||n.email)+")\n                    ")])}))],2),t._v(" "),t.errors.clientId?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.clientId)+"\n                  ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"status"}},[t._v("ສະຖານະ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.status,expression:"form.status"}],staticClass:"form-control",attrs:{id:"status"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"status",e.target.multiple?n:n[0])}}},[e("option",{attrs:{value:"draft"}},[t._v("ແບບຮ່າງ")]),t._v(" "),e("option",{attrs:{value:"sent"}},[t._v("ສົ່ງແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"paid"}},[t._v("ຈ່າຍແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"overdue"}},[t._v("ເກີນກຳນົດ")]),t._v(" "),e("option",{attrs:{value:"cancelled"}},[t._v("ຍົກເລີກ")])])])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group"},[e("label",{staticClass:"required",attrs:{for:"invoiceDate"}},[t._v("ວັນທີໃບແຈ້ງໜີ້")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.invoiceDate,expression:"form.invoiceDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.invoiceDate},attrs:{id:"invoiceDate",type:"date"},domProps:{value:t.form.invoiceDate},on:{change:t.calculateDueDate,input:function(e){e.target.composing||t.$set(t.form,"invoiceDate",e.target.value)}}}),t._v(" "),t.errors.invoiceDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.invoiceDate)+"\n                  ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"dueDate"}},[t._v("ວັນທີຄົບກຳນົດ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.dueDate,expression:"form.dueDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.dueDate},attrs:{id:"dueDate",type:"date"},domProps:{value:t.form.dueDate},on:{input:function(e){e.target.composing||t.$set(t.form,"dueDate",e.target.value)}}}),t._v(" "),t.errors.dueDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.dueDate)+"\n                  ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"currencyId"}},[t._v("ສະກຸນເງິນ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.currencyId,expression:"form.currencyId"}],staticClass:"form-control",attrs:{id:"currencyId"},on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"currencyId",e.target.multiple?n:n[0])},t.onCurrencyChange]}},[e("option",{attrs:{value:""}},[t._v("ເລືອກສະກຸນເງິນ")]),t._v(" "),t._l(t.currencies,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                      "+t._s(n.name)+" ("+t._s(n.code)+")\n                    ")])}))],2)]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"exchangeRate"}},[t._v("ອັດຕາແລກປ່ຽນ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.exchangeRate,expression:"form.exchangeRate"}],staticClass:"form-control",attrs:{id:"exchangeRate",type:"number",step:"0.0001",min:"0",placeholder:"1.0000"},domProps:{value:t.form.exchangeRate},on:{input:function(e){e.target.composing||t.$set(t.form,"exchangeRate",e.target.value)}}})])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group full-width"},[e("label",{attrs:{for:"description"}},[t._v("ລາຍລະອຽດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],staticClass:"form-control textarea-compact",attrs:{id:"description",rows:"2",placeholder:"ລາຍລະອຽດກ່ຽວກັບໃບແຈ້ງໜີ້..."},domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}})])]),t._v(" "),t.isEdit?e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group full-width"},[e("label",{staticClass:"required",attrs:{for:"reason"}},[t._v("ເຫດຜົນຂອງການແກ້ໄຂ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.reason,expression:"form.reason"}],staticClass:"form-control",class:{"is-invalid":t.errors.reason},attrs:{id:"reason",type:"text",placeholder:"ລະບຸເຫດຜົນຂອງການແກ້ໄຂ..."},domProps:{value:t.form.reason},on:{input:function(e){e.target.composing||t.$set(t.form,"reason",e.target.value)}}}),t._v(" "),t.errors.reason?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.reason)+"\n                  ")]):t._e()])]):t._e(),t._v(" "),e("div",{staticClass:"amount-summary"},[e("div",{staticClass:"totals-compact"},[e("div",{staticClass:"total-item"},[e("span",[t._v("ລວມຍ່ອຍ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedSubtotal)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",[t._v("ພາສີລວມ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedTax)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",[t._v("ຍອດສຸດທິ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedNet)))])]),t._v(" "),e("div",{staticClass:"total-item grand-total"},[e("span",[t._v("ລວມທັງໝົດ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedTotal)))])])])])])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"lines"===t.activeTab,expression:"activeTab === 'lines'"}],staticClass:"tab-content"},[e("div",{staticClass:"line-items-section"},[e("div",{staticClass:"add-line-header"},[e("div",{staticClass:"add-line-actions"},[e("button",{staticClass:"btn btn-primary btn-compact",attrs:{type:"button"},on:{click:t.addNewLine}},[e("i",{staticClass:"fas fa-plus"}),t._v("\n                  ເພີ່ມລາຍການ\n                ")]),t._v(" "),e("button",{staticClass:"btn btn-outline-secondary btn-compact",attrs:{type:"button"},on:{click:function(e){return t.addMultipleLines(5)}}},[t._v("\n                  ເພີ່ມ 5 ລາຍການ\n                ")]),t._v(" "),e("span",{staticClass:"line-count-info"},[t._v(t._s(t.lineItems.length)+" ລາຍການ")])])]),t._v(" "),0===t.lineItems.length?e("div",{staticClass:"empty-line-state"},[e("div",{staticClass:"empty-content"},[e("i",{staticClass:"fas fa-shopping-cart"}),t._v(" "),e("h4",[t._v("ຍັງບໍ່ມີລາຍການສິນຄ້າ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.addNewLine}},[e("i",{staticClass:"fas fa-plus"}),t._v("\n                  ເພີ່ມລາຍການທຳອິດ\n                ")])])]):e("div",{staticClass:"line-items-table-container"},[e("div",{staticClass:"line-items-table"},[e("table",{staticClass:"table table-compact"},[t._m(0),t._v(" "),e("tbody",t._l(t.lineItems,(function(line,n){return e("tr",{key:line.tempId||line.id,staticClass:"line-row"},[e("td",{staticClass:"line-number"},[t._v(t._s(n+1))]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:line.description,expression:"line.description"}],staticClass:"form-control form-control-xs",class:{"is-invalid":t.errors["line_".concat(n,"_description")]},attrs:{type:"text",placeholder:"ລາຍລະອຽດສິນຄ້າ..."},domProps:{value:line.description},on:{blur:function(e){return t.calculateLineTotal(line)},input:function(e){e.target.composing||t.$set(line,"description",e.target.value)}}})]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:line.quantity,expression:"line.quantity"}],staticClass:"form-control form-control-xs",class:{"is-invalid":t.errors["line_".concat(n,"_quantity")]},attrs:{type:"number",step:"0.01",min:"0"},domProps:{value:line.quantity},on:{blur:function(e){return t.calculateLineTotal(line)},input:function(e){e.target.composing||t.$set(line,"quantity",e.target.value)}}})]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:line.unitPrice,expression:"line.unitPrice"}],staticClass:"form-control form-control-xs",class:{"is-invalid":t.errors["line_".concat(n,"_unitPrice")]},attrs:{type:"number",step:"0.01",min:"0"},domProps:{value:line.unitPrice},on:{blur:function(e){return t.calculateLineTotal(line)},input:function(e){e.target.composing||t.$set(line,"unitPrice",e.target.value)}}})]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:line.taxRate,expression:"line.taxRate"}],staticClass:"form-control form-control-xs",attrs:{type:"number",step:"0.01",min:"0",max:"100"},domProps:{value:line.taxRate},on:{blur:function(e){return t.calculateLineTotal(line)},input:function(e){e.target.composing||t.$set(line,"taxRate",e.target.value)}}})]),t._v(" "),e("td",{staticClass:"tax-amount"},[t._v("\n                        "+t._s(t.formatCurrency(line.taxAmount||0))+"\n                      ")]),t._v(" "),e("td",{staticClass:"line-total"},[t._v("\n                        "+t._s(t.formatCurrency(line.lineTotal||0))+"\n                      ")]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-xs btn-danger",attrs:{type:"button",title:"ລຶບລາຍການ"},on:{click:function(e){return t.removeLine(n)}}},[e("i",{staticClass:"fas fa-trash"})])])])})),0)])]),t._v(" "),e("div",{staticClass:"line-totals-summary"},[e("div",{staticClass:"totals-compact"},[e("div",{staticClass:"total-item"},[e("span",[t._v("ລວມຍ່ອຍ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedSubtotal)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",[t._v("ພາສີລວມ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedTax)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("span",[t._v("ຍອດສຸດທິ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedNet)))])]),t._v(" "),e("div",{staticClass:"total-item grand-total"},[e("span",[t._v("ລວມທັງໝົດ:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.calculatedTotal)))])])])])])])])])]),t._v(" "),e("div",{staticClass:"modal-footer"},[e("div",{staticClass:"footer-actions"},[e("button",{staticClass:"btn btn-secondary btn-compact",attrs:{type:"button",disabled:t.saving},on:{click:t.handleClose}},[e("i",{staticClass:"fas fa-times"}),t._v("\n          ຍົກເລີກ\n        ")]),t._v(" "),e("button",{staticClass:"btn btn-primary btn-compact",attrs:{type:"button",disabled:t.saving||!t.isFormValid},on:{click:t.handleSubmit}},[t.saving?e("i",{staticClass:"fas fa-spinner fa-spin"}):e("i",{staticClass:"fas fa-save"}),t._v("\n          "+t._s(t.saving?"ກຳລັງບັນທຶກ...":t.isEdit?"ອັບເດດ":"ບັນທຶກ")+"\n        ")])])])]),t._v(" "),e("invoice-audit-dialog",{attrs:{visible:t.showAuditDialog,"invoice-id":t.form.id,"invoice-info":t.invoiceInfoForAudit},on:{close:t.closeAuditDialog}})],1):t._e()}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{width:"30px"}},[t._v("#")]),t._v(" "),e("th",{staticStyle:{width:"250px"}},[t._v("ລາຍລະອຽດ *")]),t._v(" "),e("th",{staticStyle:{width:"70px"}},[t._v("ຈຳນວນ *")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ລາຄາຕໍ່ຫົວ *")]),t._v(" "),e("th",{staticStyle:{width:"60px"}},[t._v("ພາສີ %")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ຍອດພາສີ")]),t._v(" "),e("th",{staticStyle:{width:"90px"}},[t._v("ລວມຕໍ່ແຖວ")]),t._v(" "),e("th",{staticStyle:{width:"40px"}},[t._v("ລຶບ")])])])}],!1,null,"fbf9c31a",null);e.default=component.exports}}]);