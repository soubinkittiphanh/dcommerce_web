(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1246:function(t,e,o){var content=o(1539);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("29b780be",content,!0,{sourceMap:!1})},1538:function(t,e,o){"use strict";o(1246)},1539:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,'.modal-overlay[data-v-1a8d2800]{align-items:center;background-color:rgba(0,0,0,.6);display:flex;height:100%;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:1050}.enhanced-dialog[data-v-1a8d2800]{max-height:90vh;max-width:1200px}.enhanced-dialog[data-v-1a8d2800],.invoice-browser-dialog[data-v-1a8d2800]{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;overflow:hidden;width:100%}.invoice-browser-dialog[data-v-1a8d2800]{max-height:80vh;max-width:1000px}.modal-header[data-v-1a8d2800]{background:linear-gradient(135deg,#28a745,#20c997);border-bottom:1px solid #e9ecef;color:#fff;justify-content:space-between;padding:20px}.modal-header[data-v-1a8d2800],.modal-title[data-v-1a8d2800]{align-items:center;display:flex}.modal-title[data-v-1a8d2800]{font-size:18px;font-weight:600;gap:10px;margin:0}.close-button[data-v-1a8d2800]{background:none;border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:20px;padding:5px;transition:background .2s}.close-button[data-v-1a8d2800]:hover{background:hsla(0,0%,100%,.2)}.modal-body[data-v-1a8d2800]{flex:1;overflow:hidden}.loading-state[data-v-1a8d2800],.modal-body[data-v-1a8d2800]{display:flex;flex-direction:column}.loading-state[data-v-1a8d2800]{align-items:center;color:#666;justify-content:center;padding:40px}.spinner[data-v-1a8d2800]{animation:spin-1a8d2800 1s linear infinite;border:4px solid #f3f3f3;border-radius:50%;border-top-color:#28a745;height:40px;margin-bottom:15px;width:40px}@keyframes spin-1a8d2800{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.receipt-form[data-v-1a8d2800]{display:flex;flex:1;flex-direction:column;overflow:hidden}.tab-navigation[data-v-1a8d2800]{background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex}.tab-btn[data-v-1a8d2800]{align-items:center;background:none;border:none;color:#666;cursor:pointer;display:flex;flex:1;font-size:14px;font-weight:500;gap:8px;justify-content:center;padding:15px 20px;position:relative;transition:all .2s}.tab-btn[data-v-1a8d2800]:hover{background:rgba(40,167,69,.1);color:#28a745}.tab-btn.active[data-v-1a8d2800]{background:#fff;border-bottom:3px solid #28a745;color:#28a745}.line-count[data-v-1a8d2800]{background:#28a745;border-radius:12px;color:#fff;font-size:12px;min-width:20px;padding:2px 8px;text-align:center}.tab-content[data-v-1a8d2800]{flex:1;overflow-y:auto;padding:0}.form-section[data-v-1a8d2800]{border-bottom:1px solid #f0f0f0;padding:25px}.form-section[data-v-1a8d2800]:last-child{border-bottom:none}.section-title[data-v-1a8d2800]{align-items:center;border-bottom:2px solid #e9ecef;color:#333;display:flex;font-size:16px;font-weight:600;gap:10px;margin-bottom:20px;padding-bottom:10px}.section-title i[data-v-1a8d2800]{color:#28a745}.form-row[data-v-1a8d2800]{display:flex;flex-wrap:wrap;margin:-10px}.form-group[data-v-1a8d2800]{margin-bottom:20px;padding:10px}.col-md-6[data-v-1a8d2800]{flex:0 0 50%;max-width:50%}.form-group label[data-v-1a8d2800]{color:#333;display:block;font-size:14px;font-weight:500;margin-bottom:5px}.form-group label.required[data-v-1a8d2800]:after{color:#e74c3c;content:" *"}.form-control[data-v-1a8d2800]{border:1px solid #ddd;border-radius:6px;font-size:14px;padding:10px 12px;transition:border-color .2s,box-shadow .2s;width:100%}.form-control[data-v-1a8d2800]:focus{border-color:#28a745;box-shadow:0 0 0 3px rgba(40,167,69,.1);outline:none}.form-control.is-invalid[data-v-1a8d2800]{border-color:#e74c3c;box-shadow:0 0 0 3px rgba(231,76,60,.1)}.form-control-sm[data-v-1a8d2800]{font-size:13px;padding:6px 8px}.invalid-feedback[data-v-1a8d2800]{color:#e74c3c;display:block;font-size:12px;margin-top:5px;width:100%}.auto-calculated-field[data-v-1a8d2800]{background-color:#f8f9fa!important;border-style:dashed!important;color:#495057!important;cursor:not-allowed;font-weight:600}.auto-calculated-field[data-v-1a8d2800]:disabled{opacity:.8}.form-group label.auto-calculated[data-v-1a8d2800]{align-items:center;color:#28a745;display:flex;font-weight:600;gap:8px}.form-text.text-muted[data-v-1a8d2800]{align-items:center;color:#6c757d!important;display:flex;font-size:12px;gap:5px;margin-top:5px}.invoice-selector[data-v-1a8d2800]{display:flex;gap:10px}.invoice-selector select[data-v-1a8d2800]{flex:1}.btn-browse-invoice[data-v-1a8d2800]{padding:10px 16px;white-space:nowrap}.allocation-summary[data-v-1a8d2800],.amount-summary[data-v-1a8d2800]{background:#f8f9fa;border-left:4px solid #28a745;border-radius:8px;margin:20px 25px;padding:20px}.totals-grid[data-v-1a8d2800]{grid-gap:15px;display:grid;gap:15px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.total-item[data-v-1a8d2800]{align-items:center;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;padding:8px 0}.total-item[data-v-1a8d2800]:last-child{border-bottom:none}.total-item.balance-warning[data-v-1a8d2800]{background:#fff3cd;border:1px solid #ffeaa7;border-radius:6px;display:none;padding:12px}.total-item .amount[data-v-1a8d2800]{color:#333;font-weight:600}.total-item .amount.received[data-v-1a8d2800]{color:#28a745}.total-item .amount.allocated[data-v-1a8d2800]{color:#007bff}.total-item .amount.balance.negative[data-v-1a8d2800]{color:#dc3545}.total-item .amount.balance.positive[data-v-1a8d2800]{color:#ffc107}.success-balance[data-v-1a8d2800]{background:#d4edda;border-radius:6px;padding:8px 12px}.amount.balanced[data-v-1a8d2800]{color:#155724!important;font-weight:600;gap:5px}.amount.balanced[data-v-1a8d2800],.balance-info[data-v-1a8d2800]{align-items:center;display:flex}.balance-info[data-v-1a8d2800]{background:#e7f3ff;border:1px solid #bee5eb;border-radius:6px;color:#0c5460;font-size:14px;gap:8px;margin-top:15px;padding:12px}.balance-message[data-v-1a8d2800]{display:none}.allocation-section[data-v-1a8d2800]{padding:25px}.allocation-header[data-v-1a8d2800]{align-items:center;display:flex;justify-content:space-between;margin-bottom:20px}.allocation-info[data-v-1a8d2800]{align-items:center;display:flex;gap:15px}.invoice-info[data-v-1a8d2800]{color:#666;font-size:14px}.allocation-count-info[data-v-1a8d2800]{background:#e9ecef;border-radius:20px;color:#666;font-size:12px;font-weight:500;padding:8px 12px}.no-invoice-state[data-v-1a8d2800],.no-lines-state[data-v-1a8d2800],.no-results-state[data-v-1a8d2800]{background:#f8f9fa;border:2px dashed #dee2e6;border-radius:8px;padding:60px 20px;text-align:center}.empty-content i[data-v-1a8d2800]{color:#dee2e6;font-size:64px;margin-bottom:20px}.empty-content h4[data-v-1a8d2800]{color:#666;margin-bottom:10px}.empty-content p[data-v-1a8d2800]{color:#999;margin-bottom:30px}.allocation-notice[data-v-1a8d2800]{align-items:center;background:#e7f3ff;border-left:4px solid #007bff;border-radius:6px;color:#495057;display:flex;font-size:14px;gap:10px;margin-bottom:20px;padding:15px}.allocation-table-container[data-v-1a8d2800]{border:1px solid #e9ecef;border-radius:8px;margin-bottom:20px;overflow:hidden}.allocation-table .table[data-v-1a8d2800],.invoice-table-container .table[data-v-1a8d2800]{border-collapse:collapse;margin:0;width:100%}.allocation-table .table th[data-v-1a8d2800],.invoice-table-container .table th[data-v-1a8d2800]{background:#f8f9fa;border-bottom:2px solid #dee2e6;font-size:13px;font-weight:600;padding:12px 8px;text-align:center}.allocation-table .table td[data-v-1a8d2800],.invoice-table-container .table td[data-v-1a8d2800]{border-top:1px solid #dee2e6;font-size:13px;padding:8px;vertical-align:middle}.line-number[data-v-1a8d2800]{color:#666;font-weight:600;text-align:center}.invoice-line-display[data-v-1a8d2800]{line-height:1.4}.line-description[data-v-1a8d2800]{color:#333;font-weight:500;margin-bottom:4px}.line-details[data-v-1a8d2800]{color:#666;font-size:12px}.invoice-line-total[data-v-1a8d2800],.remaining-amount[data-v-1a8d2800]{color:#28a745;font-weight:600;text-align:right}.over-allocated[data-v-1a8d2800]{color:#dc3545!important}.fully-allocated[data-v-1a8d2800]{color:#6c757d!important}.allocation-row[data-v-1a8d2800],.invoice-row[data-v-1a8d2800]{transition:background-color .2s}.allocation-row[data-v-1a8d2800]:hover,.invoice-row[data-v-1a8d2800]:hover{background-color:rgba(40,167,69,.05)}.quick-allocation-actions[data-v-1a8d2800]{align-items:center;border-top:1px solid #e9ecef;display:flex;justify-content:space-between;margin-top:10px;padding:15px 0}.quick-actions-left[data-v-1a8d2800]{display:flex;gap:10px}.allocation-helper[data-v-1a8d2800]{align-items:center;color:#666;display:flex;font-size:12px;font-style:italic;gap:5px}.search-section[data-v-1a8d2800]{background:#f8f9fa;border-bottom:1px solid #e9ecef;padding:20px}.search-input-group[data-v-1a8d2800]{max-width:400px;position:relative}.search-icon[data-v-1a8d2800]{color:#666;font-size:16px;left:12px;position:absolute;top:50%;transform:translateY(-50%)}.search-input[data-v-1a8d2800]{border-radius:8px;font-size:16px;padding-left:40px}.invoice-list[data-v-1a8d2800]{flex:1;max-height:500px;overflow-y:auto}.customer-info[data-v-1a8d2800]{line-height:1.4}.customer-name[data-v-1a8d2800]{color:#333;font-weight:500}.customer-email[data-v-1a8d2800]{color:#666;font-size:12px}.amount-cell[data-v-1a8d2800]{color:#28a745;font-weight:600;text-align:right}.status-badge[data-v-1a8d2800]{border-radius:12px;font-size:11px;font-weight:500;padding:4px 8px;text-transform:uppercase}.status-draft[data-v-1a8d2800]{background:#ffeaa7;color:#fdcb6e}.status-sent[data-v-1a8d2800]{background:#74b9ff;color:#0984e3}.status-paid[data-v-1a8d2800]{background:#00b894;color:#00a085}.status-overdue[data-v-1a8d2800]{background:#ff7675;color:#d63031}.status-cancelled[data-v-1a8d2800]{background:#636e72;color:#2d3436}.btn[data-v-1a8d2800]{align-items:center;border:none;border-radius:4px;cursor:pointer;display:inline-flex;font-size:14px;gap:8px;padding:8px 16px;-webkit-text-decoration:none;text-decoration:none;transition:all .2s ease}.btn-primary[data-v-1a8d2800]{background:#28a745;color:#fff}.btn-secondary[data-v-1a8d2800]{background:#6c757d;color:#fff}.btn-outline-primary[data-v-1a8d2800]{background:#fff;border:2px solid #007bff;color:#007bff}.btn-outline-primary[data-v-1a8d2800]:hover{background:#007bff;color:#fff}.btn-outline-success[data-v-1a8d2800]{background:#fff;border:2px solid #28a745;color:#28a745}.btn-outline-info[data-v-1a8d2800]{background:#fff;border:2px solid #17a2b8;color:#17a2b8}.btn-outline-warning[data-v-1a8d2800]{background:#fff;border:2px solid #ffc107;color:#ffc107}.btn-danger[data-v-1a8d2800]{background:#dc3545;color:#fff}.btn[data-v-1a8d2800]:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}.btn[data-v-1a8d2800]:disabled{cursor:not-allowed;opacity:.6;transform:none}.btn-sm[data-v-1a8d2800]{font-size:12px;padding:6px 12px}.btn-lg[data-v-1a8d2800]{font-size:16px;padding:12px 30px}.modal-footer[data-v-1a8d2800]{background:#f8f9fa;border-top:1px solid #e9ecef;justify-content:space-between;padding:20px}.footer-info[data-v-1a8d2800],.modal-footer[data-v-1a8d2800]{align-items:center;display:flex}.result-count[data-v-1a8d2800]{color:#666;font-size:14px}.footer-actions[data-v-1a8d2800]{display:flex;gap:10px;justify-content:flex-end}@media (max-width:768px){.enhanced-dialog[data-v-1a8d2800],.invoice-browser-dialog[data-v-1a8d2800]{border-radius:0;height:100%;max-height:100vh;max-width:100%}.totals-grid[data-v-1a8d2800]{grid-template-columns:1fr}.allocation-header[data-v-1a8d2800]{flex-direction:column;gap:15px}.allocation-info[data-v-1a8d2800]{flex-direction:column;gap:10px}.allocation-table-container[data-v-1a8d2800],.invoice-table-container[data-v-1a8d2800]{overflow-x:auto}.allocation-table .table[data-v-1a8d2800],.invoice-table-container .table[data-v-1a8d2800]{min-width:900px}.footer-actions[data-v-1a8d2800]{flex-direction:column}.footer-actions .btn[data-v-1a8d2800]{justify-content:center;width:100%}.tab-btn[data-v-1a8d2800]{font-size:12px;gap:4px;padding:12px 8px}.form-row[data-v-1a8d2800],.tab-btn[data-v-1a8d2800]{flex-direction:column}.col-md-6[data-v-1a8d2800]{flex:1;max-width:100%}.invoice-selector[data-v-1a8d2800]{flex-direction:column;gap:10px}.quick-allocation-actions[data-v-1a8d2800]{flex-direction:column;gap:15px}.search-input-group[data-v-1a8d2800]{max-width:100%}}@media (max-width:480px){.modal-header[data-v-1a8d2800]{padding:15px}.modal-title[data-v-1a8d2800]{font-size:16px}.form-section[data-v-1a8d2800]{padding:20px 15px}.section-title[data-v-1a8d2800]{font-size:14px}.modal-footer[data-v-1a8d2800]{padding:15px}.allocation-section[data-v-1a8d2800]{padding:20px 15px}.no-invoice-state[data-v-1a8d2800],.no-lines-state[data-v-1a8d2800],.no-results-state[data-v-1a8d2800]{padding:40px 15px}.empty-content i[data-v-1a8d2800]{font-size:48px}.allocation-summary[data-v-1a8d2800],.amount-summary[data-v-1a8d2800]{margin:20px 15px}}',""]),n.locals={},t.exports=n},1637:function(t,e,o){"use strict";o.r(e);o(44),o(9),o(5),o(34),o(7),o(67),o(11),o(12);var n=o(3),r=o(20);o(92),o(39),o(51),o(8),o(66),o(340),o(10),o(100),o(30);function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function l(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var d={name:"ReceiveHeaderMaintain",props:{visible:{type:Boolean,default:!1},receipt:{type:Object,default:null},invoices:{type:Array,default:function(){return[]}},users:{type:Array,default:function(){return[]}}},data:function(){return{activeTab:"header",formLoading:!1,saving:!1,errors:{},allocationLines:[],nextTempId:1,selectedInvoice:null,showInvoiceBrowser:!1,invoiceBrowserLoading:!1,filteredInvoices:[],invoiceSearchQuery:"",form:{id:null,receiptNumber:"",bookingDate:"",receivedDate:"",invoiceHeaderId:"",totalReceivedAmount:0,paymentMethod:"cash",referenceNumber:"",notes:"",inputterId:"",reason:""}}},computed:{isEdit:function(){return!(!this.receipt||!this.receipt.id)},user:function(){return this.$auth.user||""},calculatedAllocatedTotal:function(){return this.allocationLines.reduce((function(t,e){return t+(parseFloat(e.allocatedAmount)||0)}),0)},allocationBalance:function(){return 0},autoCalculatedTotal:function(){return this.calculatedAllocatedTotal},availableInvoiceLines:function(){return this.selectedInvoice&&this.selectedInvoice.invoiceLines||[]},isFormValid:function(){var t=this.form.receiptNumber&&this.form.bookingDate&&this.form.receivedDate&&this.form.invoiceHeaderId&&this.form.paymentMethod&&(!this.isEdit||this.form.reason),e=this.allocationLines.length>0&&this.allocationLines.some((function(t){return t.invoiceLineId&&(parseFloat(t.allocatedAmount)||0)>0&&t.allocationDate}))&&(parseFloat(this.form.totalReceivedAmount)||0)>0;return t&&e},searchFilteredInvoices:function(){if(!this.invoiceSearchQuery)return this.filteredInvoices;var t=this.invoiceSearchQuery.toLowerCase();return this.filteredInvoices.filter((function(e){return e.invoiceNumber.toLowerCase().includes(t)||e.customer&&e.customer.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)}))}},watch:{visible:{handler:function(t){t?this.initializeDialog():this.resetDialog()},immediate:!0},receipt:{handler:function(){this.visible&&this.initializeDialog()}},calculatedAllocatedTotal:{handler:function(t){this.form.totalReceivedAmount=t},immediate:!0},"form.receivedDate":{handler:function(t){t&&this.allocationLines.length>0&&this.allocationLines.forEach((function(e){e.allocationDate&&""!==e.allocationDate||(e.allocationDate=t)}))}}},methods:{forceCreateAllocations:function(){this.selectedInvoice&&this.selectedInvoice.invoiceLines?(this.createAllocationLinesFromInvoice(),this.showToast("Created ".concat(this.allocationLines.length," allocation lines"),"success")):this.showToast("Please select an invoice first","warning")},initializeDialog:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.activeTab="header",t.clearErrors(),!t.receipt){e.next=10;break}return t.form={id:t.receipt.id,receiptNumber:t.receipt.receiptNumber,bookingDate:t.receipt.bookingDate?t.receipt.bookingDate.split("T")[0]:"",receivedDate:t.receipt.receivedDate?t.receipt.receivedDate.split("T")[0]:"",invoiceHeaderId:t.receipt.invoiceHeaderId,totalReceivedAmount:t.receipt.totalReceivedAmount||0,paymentMethod:t.receipt.paymentMethod||"cash",referenceNumber:t.receipt.referenceNumber||"",notes:t.receipt.notes||"",inputterId:t.receipt.inputterId||"",reason:""},e.next=6,t.loadAllocationLines(t.receipt.id);case 6:return e.next=8,t.updateSelectedInvoice();case 8:e.next=15;break;case 10:t.resetForm(),o=(new Date).toISOString().split("T")[0],t.form.bookingDate=o,t.form.receivedDate=o,t.allocationLines=[];case 15:case"end":return e.stop()}}),e)})))()},resetDialog:function(){this.resetForm(),this.allocationLines=[],this.selectedInvoice=null,this.clearErrors(),this.activeTab="header",this.formLoading=!1,this.saving=!1,this.showInvoiceBrowser=!1,this.filteredInvoices=[],this.invoiceSearchQuery=""},loadAllocationLines:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var n,data;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.$axios.get("/api/ar-receive-lines/by-header/".concat(t));case 3:n=o.sent,data=n.data,e.allocationLines=data.data||[],e.allocationLines.forEach((function(t){t.tempId||(t.tempId=e.nextTempId++),t.allocationDate&&(t.allocationDate=t.allocationDate.split("T")[0])})),o.next=13;break;case 9:o.prev=9,o.t0=o.catch(0),console.error("Error loading allocation lines:",o.t0),e.allocationLines=[];case 13:case"end":return o.stop()}}),o,null,[[0,9]])})))()},createEmptyAllocation:function(){return{tempId:this.nextTempId++,lineNumber:this.allocationLines.length+1,invoiceLineId:"",allocatedAmount:0,allocationDate:(new Date).toISOString().split("T")[0],notes:""}},updateSelectedInvoice:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updateSelectedInvoice called with invoiceHeaderId:",t.form.invoiceHeaderId),!(t.form.invoiceHeaderId&&t.invoices.length>0)){e.next=10;break}if(t.selectedInvoice=t.invoices.find((function(e){return e.id===parseInt(t.form.invoiceHeaderId)})),console.log("Selected invoice found:",t.selectedInvoice),!t.selectedInvoice||t.selectedInvoice.invoiceLines&&0!==t.selectedInvoice.invoiceLines.length){e.next=7;break}return e.next=7,t.loadSelectedInvoiceLines();case 7:t.selectedInvoice&&t.selectedInvoice.invoiceLines&&t.selectedInvoice.invoiceLines.length>0&&!t.isEdit&&(console.log("Creating allocation lines from invoice lines:",t.selectedInvoice.invoiceLines),t.createAllocationLinesFromInvoice()),e.next=12;break;case 10:t.selectedInvoice=null,t.isEdit||(t.allocationLines=[]);case 12:console.log("Final allocation lines:",t.allocationLines);case 13:case"end":return e.stop()}}),e)})))()},loadSelectedInvoiceLines:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.selectedInvoice){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,console.log("Loading invoice lines for invoice:",t.selectedInvoice.id),e.next=6,t.$axios.get("/api/ar-invoices/".concat(t.selectedInvoice.id),{params:{include:["invoiceLines"]}});case 6:o=e.sent,data=o.data,console.log("API response for invoice lines:",data),data.success&&data.data&&data.data.invoiceLines?t.selectedInvoice.invoiceLines=data.data.invoiceLines:data.data&&Array.isArray(data.data)?t.selectedInvoice.invoiceLines=data.data:data.invoiceLines?t.selectedInvoice.invoiceLines=data.invoiceLines:(console.warn("No invoice lines found in response:",data),t.selectedInvoice.invoiceLines=[]),console.log("Loaded invoice lines:",t.selectedInvoice.invoiceLines),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Error loading invoice lines:",e.t0),t.selectedInvoice.invoiceLines=[],t.showToast("ມີປັນຫາໃນການໂຫຼດລາຍການໃບແຈ້ງໜີ້","error");case 18:case"end":return e.stop()}}),e,null,[[2,13]])})))()},createAllocationLinesFromInvoice:function(){var t,e=this;if(console.log("createAllocationLinesFromInvoice called"),console.log("Selected invoice:",this.selectedInvoice),console.log("Invoice lines:",null===(t=this.selectedInvoice)||void 0===t?void 0:t.invoiceLines),!this.selectedInvoice||!this.selectedInvoice.invoiceLines||0===this.selectedInvoice.invoiceLines.length)return console.warn("No invoice lines available to create allocations"),void(this.allocationLines=[]);this.allocationLines=this.selectedInvoice.invoiceLines.map((function(line,t){var o={tempId:e.nextTempId++,lineNumber:t+1,invoiceLineId:line.id,invoiceLine:line,allocatedAmount:0,allocationDate:e.form.receivedDate||(new Date).toISOString().split("T")[0],notes:""};return console.log("Created allocation:",o),o})),console.log("Final allocation lines created:",this.allocationLines)},onInvoiceChange:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onInvoiceChange called"),e.next=3,t.updateSelectedInvoice();case 3:t.clearFieldError("invoiceHeaderId");case 4:case"end":return e.stop()}}),e)})))()},onInvoiceLineChange:function(t){t.allocationDate||(t.allocationDate=(new Date).toISOString().split("T")[0])},openInvoiceBrowser:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showInvoiceBrowser=!0,t.invoiceBrowserLoading=!0,t.invoiceSearchQuery="",e.prev=3,e.next=6,t.$axios.get("/api/ar-invoices",{params:{status:["draft","sent"],include:["customer","invoiceLines"]}});case 6:o=e.sent,data=o.data,console.log("Invoice browser API response:",data),data.success&&data.data&&Array.isArray(data.data)?t.filteredInvoices=data.data:data.data&&data.data.invoices&&Array.isArray(data.data.invoices)?t.filteredInvoices=data.data.invoices:Array.isArray(data)?t.filteredInvoices=data:(console.warn("Unexpected response structure:",data),t.filteredInvoices=[]),console.log("Filtered invoices loaded:",t.filteredInvoices),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(3),console.error("Error loading invoices:",e.t0),t.showToast("ມີປັນຫາໃນການໂຫຼດໃບແຈ້ງໜີ້","error"),t.filteredInvoices=[];case 18:return e.prev=18,t.invoiceBrowserLoading=!1,e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,13,18,21]])})))()},closeInvoiceBrowser:function(){this.showInvoiceBrowser=!1,this.filteredInvoices=[],this.invoiceSearchQuery=""},selectInvoiceFromBrowser:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return console.log("Selecting invoice from browser:",t),e.form.invoiceHeaderId=t.id,t.invoiceLines&&0!==t.invoiceLines.length||e.invoices.find((function(e){return e.id===t.id}))||e.invoices.push(t),o.next=5,e.onInvoiceChange();case 5:e.closeInvoiceBrowser(),e.clearFieldError("invoiceHeaderId");case 7:case"end":return o.stop()}}),o)})))()},allocateFullAmount:function(){0!==this.allocationLines.length&&this.selectedInvoice&&this.allocationLines.forEach((function(t){if(t.invoiceLine){var e=parseFloat(t.invoiceLine.lineTotal)||0;t.allocatedAmount=e.toFixed(2)}}))},allocateEqually:function(){if(0!==this.allocationLines.length&&this.selectedInvoice){var t=(parseFloat(this.selectedInvoice.totalAmount)||0)/this.allocationLines.length;this.allocationLines.forEach((function(e){e.allocatedAmount=t.toFixed(2)}))}},allocateProportionally:function(){0!==this.allocationLines.length&&this.selectedInvoice&&(0!==(parseFloat(this.selectedInvoice.totalAmount)||0)&&this.allocationLines.forEach((function(t){if(t.invoiceLine){var e=parseFloat(t.invoiceLine.lineTotal)||0;t.allocatedAmount=e.toFixed(2)}})))},clearAllAllocations:function(){this.allocationLines.forEach((function(t){t.allocatedAmount=0})),this.validateAllocationTotal()},getRemainingAmount:function(t){return t.invoiceLine?(parseFloat(t.invoiceLine.lineTotal)||0)-(parseFloat(t.allocatedAmount)||0):0},isFullyAllocated:function(t){return 0===this.getRemainingAmount(t)},isOverAllocated:function(t){return this.getRemainingAmount(t)<0},validateAllocation:function(t,e){var o=parseFloat(t.allocatedAmount)||0,n=parseFloat(t.invoiceLine.lineTotal)||0;o>n?this.errors["allocation_".concat(e,"_allocatedAmount")]="ຈຳນວນເກີນກວ່າທີ່ເຫຼືອ (ສູງສຸດ: ".concat(this.formatCurrency(n),")"):this.clearFieldError("allocation_".concat(e,"_allocatedAmount"))},validateAllocationTotal:function(){},validateForm:function(){if(this.errors={},this.form.receiptNumber||(this.errors.receiptNumber="ກະລຸນາໃສ່ເລກທີໃບຮັບ"),this.form.invoiceHeaderId||(this.errors.invoiceHeaderId="ກະລຸນາເລືອກໃບແຈ້ງໜີ້"),this.form.bookingDate||(this.errors.bookingDate="ກະລຸນາໃສ່ວັນທີບັນທຶກ"),this.form.receivedDate||(this.errors.receivedDate="ກະລຸນາໃສ່ວັນທີຮັບເງິນ"),this.form.paymentMethod||(this.errors.paymentMethod="ກະລຸນາເລືອກວິທີຈ່າຍ"),this.form.bookingDate&&this.form.receivedDate){var t=new Date(this.form.bookingDate);new Date(this.form.receivedDate)<t&&(this.errors.receivedDate="ວັນທີຮັບເງິນຕ້ອງບໍ່ກ່ອນວັນທີບັນທຶກ")}if(0===this.allocationLines.length)this.errors.allocations="ກະລຸນາເພີ່ມການແບ່ງປັນຢ່າງໜ້ອຍ 1 ລາຍການ";else{for(var e=!1,o=0,i=0;i<this.allocationLines.length;i++){var n=this.allocationLines[i];n.invoiceLineId||(this.errors["allocation_".concat(i,"_invoiceLineId")]="ກະລຸນາເລືອກລາຍການໃບແຈ້ງໜີ້");var r=parseFloat(n.allocatedAmount)||0;r<=0?this.errors["allocation_".concat(i,"_allocatedAmount")]="ຍອດແບ່ງປັນຕ້ອງຫຼາຍກວ່າ 0":(e=!0,o+=r),n.allocationDate||(this.errors["allocation_".concat(i,"_allocationDate")]="ກະລຸນາໃສ່ວັນທີແບ່ງປັນ"),this.isOverAllocated(n)&&(this.errors["allocation_".concat(i,"_allocatedAmount")]="ຍອດແບ່ງປັນເກີນກວ່າທີ່ເຫຼືອ")}e||(this.errors.allocations="ຢ່າງໜ້ອຍຕ້ອງມີ 1 ລາຍການທີ່ມີຍອດແບ່ງປັນ"),o<=0&&(this.errors.totalReceivedAmount="ຍອດລວມການແບ່ງປັນຕ້ອງຫຼາຍກວ່າ 0")}return this.isEdit&&!this.form.reason&&(this.errors.reason="ກະລຸນາລະບຸເຫດຜົນຂອງການແກ້ໄຂ"),0===Object.keys(this.errors).length},clearErrors:function(){this.errors={}},clearFieldError:function(t){this.errors[t]&&this.$delete(this.errors,t)},handleSubmit:function(){if(console.log("handleSubmit called"),console.log("Form data before validation:",JSON.stringify(this.form,null,2)),console.log("Allocation lines before validation:",JSON.stringify(this.allocationLines,null,2)),!this.validateForm())return console.log("Validation failed. Errors:",this.errors),void(Object.keys(this.errors).some((function(t){return t.startsWith("allocation_")}))?this.activeTab="allocations":this.activeTab="header");this.saving=!0;var t=this.allocationLines.filter((function(t){return(parseFloat(t.allocatedAmount)||0)>0&&t.invoiceLineId}));this.isEdit?this.form.updateUserId=this.user.id:this.form.inputterId=this.user.id;var e=l(l({},this.form),{},{totalReceivedAmount:parseFloat(this.form.totalReceivedAmount)||0,allocationLines:t.map((function(t,e){return{tempId:t.tempId,lineNumber:e+1,invoiceLineId:t.invoiceLineId,allocatedAmount:parseFloat(t.allocatedAmount)||0,allocationDate:t.allocationDate,notes:t.notes||""}}))});console.log("Final form data being sent:",JSON.stringify(e,null,2)),this.$emit("save",e)},handleOverlayClick:function(){this.saving||this.handleClose()},handleClose:function(){this.$emit("close")},resetForm:function(){this.form={id:null,receiptNumber:"",bookingDate:"",receivedDate:"",invoiceHeaderId:"",totalReceivedAmount:0,paymentMethod:"cash",referenceNumber:"",notes:"",inputterId:this.user.id,reason:""}},formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0)},formatNumber:function(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):""},getStatusLabel:function(t){return{draft:"ຮ່າງ",sent:"ສົ່ງແລ້ວ",paid:"ຈ່າຍແລ້ວ",overdue:"ເກີນກຳໜົດ",cancelled:"ຍົກເລີກ"}[t]||t},showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";console.log("".concat(e,": ").concat(t)),this.$toast?this.$toast[e](t):"error"===e&&alert("Error: ".concat(t))}}},v=d,f=(o(1538),o(32)),component=Object(f.a)(v,(function(){var t=this,e=t._self._c;return e("div",[t.visible?e("div",{staticClass:"modal-overlay",on:{click:t.handleOverlayClick}},[e("div",{staticClass:"enhanced-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h4",{staticClass:"modal-title"},[e("i",{staticClass:"fas fa-receipt"}),t._v("\n          "+t._s(t.isEdit?"ແກ້ໄຂການຮັບຊຳລະ":"ເພີ່ມການຮັບຊຳລະໃໝ່")+"\n        ")]),t._v(" "),e("button",{staticClass:"close-button",attrs:{type:"button"},on:{click:t.handleClose}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[t.formLoading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),t._v(" "),e("p",[t._v("ກຳລັງໂຫຼດຂໍ້ມູນ...")])]):e("div",{staticClass:"receipt-form"},[e("div",{staticClass:"tab-navigation"},[e("button",{class:["tab-btn",{active:"header"===t.activeTab}],attrs:{type:"button"},on:{click:function(e){t.activeTab="header"}}},[e("i",{staticClass:"fas fa-file-alt"}),t._v("\n              ຂໍ້ມູນການຮັບຊຳລະ\n            ")]),t._v(" "),e("button",{class:["tab-btn",{active:"allocations"===t.activeTab}],attrs:{type:"button"},on:{click:function(e){t.activeTab="allocations"}}},[e("i",{staticClass:"fas fa-list"}),t._v("\n              ການແບ່ງປັນຊຳລະ\n              "),t.allocationLines.length>0?e("span",{staticClass:"line-count"},[t._v(t._s(t.allocationLines.length))]):t._e()])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"header"===t.activeTab,expression:"activeTab === 'header'"}],staticClass:"tab-content"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[e("div",{staticClass:"form-section"},[t._m(0),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",{staticClass:"required",attrs:{for:"receiptNumber"}},[t._v("ເລກທີໃບຮັບ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.receiptNumber,expression:"form.receiptNumber"}],staticClass:"form-control",class:{"is-invalid":t.errors.receiptNumber},attrs:{id:"receiptNumber",type:"text",placeholder:"ເຊັ່ນ: RCP-2025-001",readonly:t.isEdit},domProps:{value:t.form.receiptNumber},on:{input:function(e){e.target.composing||t.$set(t.form,"receiptNumber",e.target.value)}}}),t._v(" "),t.errors.receiptNumber?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.receiptNumber)+"\n                    ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",{staticClass:"required",attrs:{for:"invoiceHeaderId"}},[t._v("ໃບແຈ້ງໜີ້")]),t._v(" "),e("div",{staticClass:"invoice-selector"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.invoiceHeaderId,expression:"form.invoiceHeaderId"}],staticClass:"form-control",class:{"is-invalid":t.errors.invoiceHeaderId},attrs:{id:"invoiceHeaderId"},on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"invoiceHeaderId",e.target.multiple?o:o[0])},t.onInvoiceChange]}},[e("option",{attrs:{value:""}},[t._v("ເລືອກໃບແຈ້ງໜີ້")]),t._v(" "),t._l(t.invoices,(function(o){return e("option",{key:o.id,domProps:{value:o.id}},[t._v("\n                          "+t._s(o.invoiceNumber)+" -\n                          "+t._s(o.customer?o.customer.name:"N/A")+"\n                          ("+t._s(t.formatCurrency(o.totalAmount))+")\n                        ")])}))],2),t._v(" "),e("button",{staticClass:"btn btn-outline-primary btn-browse-invoice",attrs:{type:"button",title:"ເລືອກໃບແຈ້ງໜີ້"},on:{click:t.openInvoiceBrowser}},[e("i",{staticClass:"fas fa-search"}),t._v("\n                        ຄົ້ນຫາ\n                      ")])]),t._v(" "),t.errors.invoiceHeaderId?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.invoiceHeaderId)+"\n                    ")]):t._e()])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[t._m(1),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.totalReceivedAmount,expression:"form.totalReceivedAmount"}],staticClass:"form-control auto-calculated-field",class:{"is-invalid":t.errors.totalReceivedAmount},attrs:{id:"totalReceivedAmount",type:"number",step:"0.01",min:"0",placeholder:"0.00",readonly:"",disabled:""},domProps:{value:t.form.totalReceivedAmount},on:{input:function(e){e.target.composing||t.$set(t.form,"totalReceivedAmount",e.target.value)}}}),t._v(" "),t._m(2),t._v(" "),t.errors.totalReceivedAmount?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.totalReceivedAmount)+"\n                    ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",{staticClass:"required",attrs:{for:"paymentMethod"}},[t._v("ວິທີຈ່າຍ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.paymentMethod,expression:"form.paymentMethod"}],staticClass:"form-control",class:{"is-invalid":t.errors.paymentMethod},attrs:{id:"paymentMethod"},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"paymentMethod",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"cash"}},[t._v("ເງິນສົດ")]),t._v(" "),e("option",{attrs:{value:"check"}},[t._v("ເຊັກ")]),t._v(" "),e("option",{attrs:{value:"bank_transfer"}},[t._v("ໂອນເງິນທະນາຄານ")]),t._v(" "),e("option",{attrs:{value:"credit_card"}},[t._v("ບັດເຄຣດິດ")]),t._v(" "),e("option",{attrs:{value:"other"}},[t._v("ອື່ນໆ")])]),t._v(" "),t.errors.paymentMethod?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.paymentMethod)+"\n                    ")]):t._e()])])]),t._v(" "),e("div",{staticClass:"form-section"},[t._m(3),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",{staticClass:"required",attrs:{for:"bookingDate"}},[t._v("ວັນທີບັນທຶກ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.bookingDate,expression:"form.bookingDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.bookingDate},attrs:{id:"bookingDate",type:"date"},domProps:{value:t.form.bookingDate},on:{input:function(e){e.target.composing||t.$set(t.form,"bookingDate",e.target.value)}}}),t._v(" "),t.errors.bookingDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.bookingDate)+"\n                    ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",{staticClass:"required",attrs:{for:"receivedDate"}},[t._v("ວັນທີຮັບເງິນ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.receivedDate,expression:"form.receivedDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.receivedDate},attrs:{id:"receivedDate",type:"date"},domProps:{value:t.form.receivedDate},on:{input:function(e){e.target.composing||t.$set(t.form,"receivedDate",e.target.value)}}}),t._v(" "),t.errors.receivedDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                      "+t._s(t.errors.receivedDate)+"\n                    ")]):t._e()])])]),t._v(" "),e("div",{staticClass:"form-section"},[t._m(4),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",{attrs:{for:"referenceNumber"}},[t._v("ເລກອ້າງອີງ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.referenceNumber,expression:"form.referenceNumber"}],staticClass:"form-control",attrs:{id:"referenceNumber",type:"text",placeholder:"ເລກອ້າງອີງ (ຖ້າມີ)..."},domProps:{value:t.form.referenceNumber},on:{input:function(e){e.target.composing||t.$set(t.form,"referenceNumber",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",{attrs:{for:"inputterId"}},[t._v("ຜູ້ບັນທຶກ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.inputterId,expression:"form.inputterId"}],staticClass:"form-control",attrs:{id:"inputterId",disabled:""},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"inputterId",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("ເລືອກຜູ້ບັນທຶກ")]),t._v(" "),t._l(t.users,(function(o){return e("option",{key:o.id,domProps:{value:o.id}},[t._v("\n                        "+t._s(o.cus_name)+" - "+t._s(o.cus_email)+"\n                      ")])}))],2)])]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"notes"}},[t._v("ໝາຍເຫດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.notes,expression:"form.notes"}],staticClass:"form-control",attrs:{id:"notes",rows:"3",placeholder:"ໝາຍເຫດກ່ຽວກັບການຮັບຊຳລະ..."},domProps:{value:t.form.notes},on:{input:function(e){e.target.composing||t.$set(t.form,"notes",e.target.value)}}})]),t._v(" "),t.isEdit?e("div",{staticClass:"form-group"},[e("label",{staticClass:"required",attrs:{for:"reason"}},[t._v("ເຫດຜົນຂອງການແກ້ໄຂ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.reason,expression:"form.reason"}],staticClass:"form-control",class:{"is-invalid":t.errors.reason},attrs:{id:"reason",type:"text",placeholder:"ລະບຸເຫດຜົນຂອງການແກ້ໄຂ..."},domProps:{value:t.form.reason},on:{input:function(e){e.target.composing||t.$set(t.form,"reason",e.target.value)}}}),t._v(" "),t.errors.reason?e("div",{staticClass:"invalid-feedback"},[t._v("\n                    "+t._s(t.errors.reason)+"\n                  ")]):t._e()]):t._e()]),t._v(" "),e("div",{staticClass:"amount-summary"},[e("div",{staticClass:"totals-grid"},[e("div",{staticClass:"total-item"},[e("label",[t._v("ຍອດທີ່ຮັບ (ຄຳນວນອັດຕະໂນມັດ):")]),t._v(" "),e("span",{staticClass:"amount received"},[t._v(t._s(t.formatCurrency(t.form.totalReceivedAmount)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("label",[t._v("ລວມການແບ່ງປັນ:")]),t._v(" "),e("span",{staticClass:"amount allocated"},[t._v(t._s(t.formatCurrency(t.calculatedAllocatedTotal)))])]),t._v(" "),t._m(5)]),t._v(" "),t._m(6)])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"allocations"===t.activeTab,expression:"activeTab === 'allocations'"}],staticClass:"tab-content"},[e("div",{staticClass:"allocation-section"},[e("div",{staticClass:"allocation-header"},[t._m(7),t._v(" "),e("div",{staticClass:"allocation-info"},[t.selectedInvoice?e("span",{staticClass:"invoice-info"},[e("strong",[t._v(t._s(t.selectedInvoice.invoiceNumber))]),t._v(" -\n                    "+t._s(t.selectedInvoice.customer?t.selectedInvoice.customer.name:"N/A")+"\n                  ")]):t._e(),t._v(" "),t.allocationLines.length>0?e("span",{staticClass:"allocation-count-info"},[t._v("\n                    "+t._s(t.allocationLines.length)+" ລາຍການ\n                  ")]):t._e()])]),t._v(" "),t.selectedInvoice?t.allocationLines.length>0?e("div",{staticClass:"allocation-table-container"},[t._m(8),t._v(" "),e("div",{staticClass:"allocation-table"},[e("table",{staticClass:"table"},[t._m(9),t._v(" "),e("tbody",t._l(t.allocationLines,(function(o,n){return e("tr",{key:o.invoiceLineId,staticClass:"allocation-row"},[e("td",{staticClass:"line-number"},[t._v("\n                          "+t._s(o.lineNumber)+"\n                        ")]),t._v(" "),e("td",[e("div",{staticClass:"invoice-line-display"},[e("div",{staticClass:"line-description"},[e("strong",[t._v(t._s(o.invoiceLine.description))])]),t._v(" "),e("div",{staticClass:"line-details"},[t._v("\n                              ຈຳນວນ:\n                              "+t._s(t.formatNumber(o.invoiceLine.quantity))+"\n                              ×\n                              "+t._s(t.formatCurrency(o.invoiceLine.unitPrice))+"\n                              "),o.invoiceLine.taxRate>0?e("span",[t._v("\n                                + ພາສີ "+t._s(o.invoiceLine.taxRate)+"%\n                              ")]):t._e()])])]),t._v(" "),e("td",{staticClass:"invoice-line-total"},[t._v("\n                          "+t._s(t.formatCurrency(o.invoiceLine.lineTotal))+"\n                        ")]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:o.allocatedAmount,expression:"allocation.allocatedAmount"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.errors["allocation_".concat(n,"_allocatedAmount")]},attrs:{type:"number",step:"0.01",min:"0",max:o.invoiceLine.lineTotal,placeholder:"0.00"},domProps:{value:o.allocatedAmount},on:{blur:function(e){return t.validateAllocation(o,n)},input:function(e){e.target.composing||t.$set(o,"allocatedAmount",e.target.value)}}}),t._v(" "),t.errors["allocation_".concat(n,"_allocatedAmount")]?e("div",{staticClass:"invalid-feedback"},[t._v("\n                            "+t._s(t.errors["allocation_".concat(n,"_allocatedAmount")])+"\n                          ")]):t._e()]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:o.allocationDate,expression:"allocation.allocationDate"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.errors["allocation_".concat(n,"_allocationDate")]},attrs:{type:"date"},domProps:{value:o.allocationDate},on:{input:function(e){e.target.composing||t.$set(o,"allocationDate",e.target.value)}}})]),t._v(" "),e("td",{staticClass:"remaining-amount"},[e("span",{class:{"over-allocated":t.isOverAllocated(o),"fully-allocated":t.isFullyAllocated(o)}},[t._v("\n                            "+t._s(t.formatCurrency(t.getRemainingAmount(o)))+"\n                          ")])]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:o.notes,expression:"allocation.notes"}],staticClass:"form-control form-control-sm",attrs:{type:"text",placeholder:"ໝາຍເຫດ..."},domProps:{value:o.notes},on:{input:function(e){e.target.composing||t.$set(o,"notes",e.target.value)}}})])])})),0)])]),t._v(" "),e("div",{staticClass:"quick-allocation-actions"},[e("div",{staticClass:"quick-actions-left"},[e("button",{staticClass:"btn btn-outline-primary btn-sm",attrs:{type:"button",title:"ແບ່ງປັນຍອດເຕັມຂອງໃບແຈ້ງໜີ້"},on:{click:t.allocateFullAmount}},[e("i",{staticClass:"fas fa-file-invoice-dollar"}),t._v("\n                      ຍອດເຕັມ\n                    ")]),t._v(" "),e("button",{staticClass:"btn btn-outline-success btn-sm",attrs:{type:"button",title:"ແບ່ງຍອດໃບແຈ້ງໜີ້ເທົ່າກັນ"},on:{click:t.allocateEqually}},[e("i",{staticClass:"fas fa-equals"}),t._v("\n                      ແບ່ງເທົ່າກັນ\n                    ")]),t._v(" "),e("button",{staticClass:"btn btn-outline-info btn-sm",attrs:{type:"button",title:"ແບ່ງຕາມອັດຕາສ່ວນຂອງແຕ່ລະລາຍການ"},on:{click:t.allocateProportionally}},[e("i",{staticClass:"fas fa-percentage"}),t._v("\n                      ແບ່ງຕາມອັດຕາສ່ວນ\n                    ")]),t._v(" "),e("button",{staticClass:"btn btn-outline-warning btn-sm",attrs:{type:"button"},on:{click:t.clearAllAllocations}},[e("i",{staticClass:"fas fa-eraser"}),t._v("\n                      ລົບລ້າງທັງໝົດ\n                    ")])]),t._v(" "),t._m(10)]),t._v(" "),e("div",{staticClass:"allocation-summary"},[e("div",{staticClass:"totals-grid"},[e("div",{staticClass:"total-item"},[e("label",[t._v("ຍອດໃບແຈ້ງໜີ້:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(t.selectedInvoice.totalAmount)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("label",[t._v("ຍອດທີ່ຮັບ (ຄຳນວນອັດຕະໂນມັດ):")]),t._v(" "),e("span",{staticClass:"amount received"},[t._v(t._s(t.formatCurrency(t.form.totalReceivedAmount)))])]),t._v(" "),e("div",{staticClass:"total-item"},[e("label",[t._v("ລວມການແບ່ງປັນ:")]),t._v(" "),e("span",{staticClass:"amount allocated"},[t._v(t._s(t.formatCurrency(t.calculatedAllocatedTotal)))])]),t._v(" "),t._m(11)]),t._v(" "),t._m(12)])]):e("div",{staticClass:"no-lines-state"},[t._m(13)]):e("div",{staticClass:"no-invoice-state"},[e("div",{staticClass:"empty-content"},[e("i",{staticClass:"fas fa-file-invoice"}),t._v(" "),e("h4",[t._v("ກະລຸນາເລືອກໃບແຈ້ງໜີ້ກ່ອນ")]),t._v(" "),e("p",[t._v("\n                    ເພື່ອເຮັດການແບ່ງປັນການຮັບຊຳລະ\n                    ກະລຸນາເລືອກໃບແຈ້ງໜີ້ໃນແຖບຂໍ້ມູນການຮັບຊຳລະກ່ອນ\n                  ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){t.activeTab="header"}}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v("\n                    ກັບໄປເລືອກໃບແຈ້ງໜີ້\n                  ")])])])])])])]),t._v(" "),e("div",{staticClass:"modal-footer"},[e("div",{staticClass:"footer-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button",disabled:t.saving},on:{click:t.handleClose}},[e("i",{staticClass:"fas fa-times"}),t._v("\n            ຍົກເລີກ\n          ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:t.saving||!t.isFormValid},on:{click:t.handleSubmit}},[t.saving?e("i",{staticClass:"fas fa-spinner fa-spin"}):e("i",{staticClass:"fas fa-save"}),t._v("\n            "+t._s(t.saving?"ກຳລັງບັນທຶກ...":t.isEdit?"ອັບເດດ":"ບັນທຶກ")+"\n          ")])])])])]):t._e(),t._v(" "),t.showInvoiceBrowser?e("div",{staticClass:"modal-overlay",on:{click:t.closeInvoiceBrowser}},[e("div",{staticClass:"invoice-browser-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[t._m(14),t._v(" "),e("button",{staticClass:"close-button",attrs:{type:"button"},on:{click:t.closeInvoiceBrowser}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"search-section"},[e("div",{staticClass:"search-input-group"},[e("i",{staticClass:"fas fa-search search-icon"}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.invoiceSearchQuery,expression:"invoiceSearchQuery"}],staticClass:"form-control search-input",attrs:{type:"text",placeholder:"ຄົ້ນຫາເລກໃບແຈ້ງໜີ້, ຊື່ລູກຄ້າ, ຫຼື ລາຍລະອຽດ..."},domProps:{value:t.invoiceSearchQuery},on:{input:function(e){e.target.composing||(t.invoiceSearchQuery=e.target.value)}}})])]),t._v(" "),t.invoiceBrowserLoading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),t._v(" "),e("p",[t._v("ກຳລັງໂຫຼດໃບແຈ້ງໜີ້...")])]):t.searchFilteredInvoices.length>0?e("div",{staticClass:"invoice-list"},[e("div",{staticClass:"invoice-table-container"},[e("table",{staticClass:"table"},[t._m(15),t._v(" "),e("tbody",t._l(t.searchFilteredInvoices,(function(o){return e("tr",{key:o.id,staticClass:"invoice-row"},[e("td",[e("strong",[t._v(t._s(o.invoiceNumber))])]),t._v(" "),e("td",[e("div",{staticClass:"customer-info"},[e("div",{staticClass:"customer-name"},[t._v("\n                        "+t._s(o.customer?o.customer.name:"N/A")+"\n                      ")]),t._v(" "),o.customer&&o.customer.email?e("div",{staticClass:"customer-email"},[t._v("\n                        "+t._s(o.customer.email)+"\n                      ")]):t._e()])]),t._v(" "),e("td",[t._v(t._s(t.formatDate(o.invoiceDate)))]),t._v(" "),e("td",[t._v(t._s(t.formatDate(o.dueDate)))]),t._v(" "),e("td",{staticClass:"amount-cell"},[t._v("\n                    "+t._s(t.formatCurrency(o.totalAmount))+"\n                  ")]),t._v(" "),e("td",[e("span",{staticClass:"status-badge",class:"status-".concat(o.status)},[t._v("\n                      "+t._s(t.getStatusLabel(o.status))+"\n                    ")])]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button",disabled:o.id===t.form.invoiceHeaderId},on:{click:function(e){return t.selectInvoiceFromBrowser(o)}}},[e("i",{staticClass:"fas fa-check"}),t._v("\n                      "+t._s(o.id===t.form.invoiceHeaderId?"ເລືອກແລ້ວ":"ເລືອກ")+"\n                    ")])])])})),0)])])]):e("div",{staticClass:"no-results-state"},[e("div",{staticClass:"empty-content"},[e("i",{staticClass:"fas fa-file-invoice"}),t._v(" "),e("h4",[t._v("\n              "+t._s(t.invoiceSearchQuery?"ບໍ່ພົບໃບແຈ້ງໜີ້":"ບໍ່ມີໃບແຈ້ງໜີ້")+"\n            ")]),t._v(" "),e("p",[t._v("\n              "+t._s(t.invoiceSearchQuery?'ບໍ່ພົບໃບແຈ້ງໜີ້ທີ່ຕົງກັບ "'.concat(t.invoiceSearchQuery,'"'):"ບໍ່ມີໃບແຈ້ງໜີ້ທີ່ສາມາດເລືອກໄດ້")+"\n            ")])])])]),t._v(" "),e("div",{staticClass:"modal-footer"},[e("div",{staticClass:"footer-info"},[t.searchFilteredInvoices.length>0?e("span",{staticClass:"result-count"},[t._v("\n            ພົບ "+t._s(t.searchFilteredInvoices.length)+" ໃບແຈ້ງໜີ້\n          ")]):t._e()]),t._v(" "),e("div",{staticClass:"footer-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeInvoiceBrowser}},[e("i",{staticClass:"fas fa-times"}),t._v("\n            ປິດ\n          ")])])])])]):t._e()])}),[function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-info-circle"}),this._v("\n                  ຂໍ້ມູນພື້ນຖານ\n                ")])},function(){var t=this._self._c;return t("label",{staticClass:"auto-calculated",attrs:{for:"totalReceivedAmount"}},[t("i",{staticClass:"fas fa-calculator"}),this._v("\n                      ຍອດເງິນທີ່ຮັບ (ຄຳນວນອັດຕະໂນມັດ)\n                    ")])},function(){var t=this._self._c;return t("small",{staticClass:"form-text text-muted"},[t("i",{staticClass:"fas fa-info-circle"}),this._v("\n                      ຍອດນີ້ຈະຖືກຄຳນວນອັດຕະໂນມັດຈາກການແບ່ງປັນ\n                    ")])},function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-calendar-alt"}),this._v("\n                  ວັນທີ\n                ")])},function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-clipboard-list"}),this._v("\n                  ຂໍ້ມູນເພີ່ມເຕີມ\n                ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"total-item success-balance"},[e("label",[t._v("ສະຖານະ:")]),t._v(" "),e("span",{staticClass:"amount balance balanced"},[e("i",{staticClass:"fas fa-check-circle"}),t._v("\n                      ສົມດຸນ\n                    ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"balance-info"},[e("i",{staticClass:"fas fa-lightbulb"}),t._v(" "),e("span",[t._v('\n                    ກະລຸນາໄປທີ່ແຖບ "ການແບ່ງປັນຊຳລະ"\n                    ເພື່ອໃສ່ຍອດແບ່ງປັນສຳລັບແຕ່ລະລາຍການ\n                  ')])])},function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-list"}),this._v("\n                  ການແບ່ງປັນການຮັບຊຳລະ\n                ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"allocation-notice"},[e("i",{staticClass:"fas fa-info-circle"}),t._v(" "),e("span",[t._v("ລາຍການດ້ານລຸ່ມແມ່ນມາຈາກໃບແຈ້ງໜີ້ທີ່ເລືອກ -\n                    ກະລຸນາໃສ່ຍອດແບ່ງປັນສຳລັບແຕ່ລະລາຍການ")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{width:"40px"}},[t._v("#")]),t._v(" "),e("th",{staticStyle:{width:"250px"}},[t._v("ລາຍການໃບແຈ້ງໜີ້")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ຍອດໃບແຈ້ງໜີ້")]),t._v(" "),e("th",{staticStyle:{width:"120px"}},[t._v("ຍອດແບ່ງປັນ *")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ວັນທີແບ່ງປັນ *")]),t._v(" "),e("th",{staticStyle:{width:"120px"}},[t._v("ຍອດຄົງເຫຼືອ")]),t._v(" "),e("th",{staticStyle:{width:"150px"}},[t._v("ໝາຍເຫດ")])])])},function(){var t=this._self._c;return t("div",{staticClass:"quick-actions-right"},[t("span",{staticClass:"allocation-helper"},[t("i",{staticClass:"fas fa-lightbulb"}),this._v("\n                      ໃຊ້ປຸ່ມດ້ານຊ້າຍເພື່ອແບ່ງປັນອັດຕະໂນມັດ\n                    ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"total-item success-balance"},[e("label",[t._v("ສະຖານະ:")]),t._v(" "),e("span",{staticClass:"amount balance balanced"},[e("i",{staticClass:"fas fa-check-circle"}),t._v("\n                        ສົມດຸນ\n                      ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"balance-info"},[e("i",{staticClass:"fas fa-info-circle"}),t._v(" "),e("span",[t._v("\n                      ຍອດທີ່ຮັບຈະຖືກຄຳນວນອັດຕະໂນມັດຈາກລວມຍອດການແບ່ງປັນທັງໝົດ\n                    ")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"empty-content"},[e("i",{staticClass:"fas fa-list"}),t._v(" "),e("h4",[t._v("ໃບແຈ້ງໜີ້ນີ້ບໍ່ມີລາຍການ")]),t._v(" "),e("p",[t._v("ໃບແຈ້ງໜີ້ທີ່ເລືອກບໍ່ມີລາຍການສິນຄ້າ/ການບໍລິການ")])])},function(){var t=this._self._c;return t("h4",{staticClass:"modal-title"},[t("i",{staticClass:"fas fa-search"}),this._v("\n          ເລືອກໃບແຈ້ງໜີ້\n        ")])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{width:"120px"}},[t._v("ເລກໃບແຈ້ງໜີ້")]),t._v(" "),e("th",{staticStyle:{width:"200px"}},[t._v("ລູກຄ້າ")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ວັນທີ")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ຄົບກຳໜົດ")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ຍອດເງິນ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ສະຖານະ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ເລືອກ")])])])}],!1,null,"1a8d2800",null);e.default=component.exports}}]);