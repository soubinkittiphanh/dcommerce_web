(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1234:function(t,e,o){var content=o(1507);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("23ab9b5f",content,!0,{sourceMap:!1})},1506:function(t,e,o){"use strict";o(1234)},1507:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,".modal-overlay[data-v-6cf28f8a]{align-items:center;background-color:rgba(0,0,0,.6);display:flex;height:100%;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:1000}.settlement-dialog[data-v-6cf28f8a]{background:#fff;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;max-height:90vh;max-width:1000px;overflow:hidden;width:100%}.dialog-header[data-v-6cf28f8a]{align-items:center;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;padding:20px}.dialog-header h4[data-v-6cf28f8a]{color:#333;font-weight:600;margin:0}.close-btn[data-v-6cf28f8a]{background:none;border:none;border-radius:50%;color:#666;cursor:pointer;font-size:18px;padding:5px;transition:all .2s ease}.close-btn[data-v-6cf28f8a]:hover{background:rgba(0,0,0,.1);color:#333}.dialog-body[data-v-6cf28f8a]{flex:1;overflow-y:auto;padding:20px}.form-section[data-v-6cf28f8a]{background:#fafafa;border:1px solid #e9ecef;border-radius:8px;margin-bottom:30px;padding:20px}.section-title[data-v-6cf28f8a]{border-bottom:2px solid #007bff;color:#333;font-size:16px;font-weight:600;margin-bottom:20px;padding-bottom:8px}.section-header[data-v-6cf28f8a]{align-items:center;display:flex;justify-content:space-between;margin-bottom:20px}.form-row[data-v-6cf28f8a]{display:flex;flex-wrap:wrap;margin:0 -10px}.form-group[data-v-6cf28f8a]{margin-bottom:20px;padding:0 10px}.col-md-4[data-v-6cf28f8a]{flex:0 0 33.333%;max-width:33.333%}.form-group label[data-v-6cf28f8a]{color:#333;display:block;font-size:14px;font-weight:600;margin-bottom:5px}.required[data-v-6cf28f8a]{color:#e74c3c}.form-control[data-v-6cf28f8a]{border:1px solid #ddd;border-radius:4px;font-size:14px;padding:10px 12px;transition:border-color .2s ease;width:100%}.form-control[data-v-6cf28f8a]:focus{border-color:#007bff;box-shadow:0 0 0 .2rem rgba(0,123,255,.25);outline:none}.form-control[data-v-6cf28f8a]:disabled{background-color:#f8f9fa;color:#6c757d}.form-control.is-invalid[data-v-6cf28f8a]{border-color:#e74c3c}.invalid-feedback[data-v-6cf28f8a]{color:#e74c3c;display:block;font-size:12px;margin-top:5px;width:100%}.no-invoices[data-v-6cf28f8a]{background:#fff;border:2px dashed #ddd;border-radius:8px;color:#666;padding:40px 20px;text-align:center}.no-invoices i[data-v-6cf28f8a]{font-size:36px;margin-bottom:15px;opacity:.5}.no-invoices p[data-v-6cf28f8a]{font-weight:600;margin:10px 0 5px}.no-invoices small[data-v-6cf28f8a]{color:#999}.invoice-allocations[data-v-6cf28f8a]{background:#fff;border-radius:8px;overflow:hidden}.table[data-v-6cf28f8a]{border-collapse:collapse;margin:0}.table th[data-v-6cf28f8a]{background:#f8f9fa;border-bottom:2px solid #dee2e6;font-size:12px;font-weight:600;padding:12px 10px;white-space:nowrap}.table td[data-v-6cf28f8a]{border-top:1px solid #dee2e6;font-size:12px;padding:10px;vertical-align:middle}.table-sm td[data-v-6cf28f8a],.table-sm th[data-v-6cf28f8a]{padding:8px}.form-control-sm[data-v-6cf28f8a]{font-size:12px;padding:4px 8px}.allocation-summary[data-v-6cf28f8a]{background:#f8f9fa;border-top:1px solid #dee2e6;display:flex;font-size:14px;justify-content:space-between;padding:15px}.form-actions[data-v-6cf28f8a]{background:#f8f9fa;border-top:1px solid #e9ecef;display:flex;gap:12px;justify-content:flex-end;padding:20px}.btn[data-v-6cf28f8a]{align-items:center;border:none;border-radius:4px;cursor:pointer;display:inline-flex;font-size:14px;font-weight:600;gap:8px;padding:10px 20px;transition:all .2s ease}.btn-primary[data-v-6cf28f8a]{background:#007bff;color:#fff}.btn-secondary[data-v-6cf28f8a]{background:#6c757d;color:#fff}.btn-success[data-v-6cf28f8a]{background:#28a745;color:#fff}.btn-info[data-v-6cf28f8a]{background:#17a2b8;color:#fff}.btn-danger[data-v-6cf28f8a]{background:#dc3545;color:#fff}.btn-sm[data-v-6cf28f8a]{font-size:12px;padding:4px 8px}.btn[data-v-6cf28f8a]:hover{box-shadow:0 2px 4px rgba(0,0,0,.1);opacity:.9;transform:translateY(-1px)}.btn[data-v-6cf28f8a]:disabled{cursor:not-allowed;opacity:.6;transform:none}.invoice-selector-overlay[data-v-6cf28f8a]{align-items:center;background-color:rgba(0,0,0,.7);display:flex;height:100%;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:1100}.invoice-selector-modal[data-v-6cf28f8a]{background:#fff;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;max-height:80vh;max-width:800px;overflow:hidden;width:100%}.modal-header[data-v-6cf28f8a]{align-items:center;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;padding:15px 20px}.modal-header h5[data-v-6cf28f8a]{color:#333;font-weight:600;margin:0}.modal-body[data-v-6cf28f8a]{flex:1;overflow-y:auto;padding:20px}.invoice-filters[data-v-6cf28f8a]{background:#f8f9fa;border-radius:6px;margin-bottom:20px;padding:15px}.row[data-v-6cf28f8a]{display:flex;flex-wrap:wrap;margin:0 -10px}.col-md-6[data-v-6cf28f8a]{flex:0 0 50%;max-width:50%;padding:0 10px}.invoice-list[data-v-6cf28f8a]{border:1px solid #e9ecef;border-radius:6px;max-height:400px;overflow-y:auto}.table-hover tbody tr[data-v-6cf28f8a]:hover{background-color:rgba(0,0,0,.075)}.selected-row[data-v-6cf28f8a]{background-color:rgba(0,123,255,.1)!important}.no-data[data-v-6cf28f8a]{color:#666;padding:40px 20px;text-align:center}.modal-actions[data-v-6cf28f8a]{background:#f8f9fa;border-top:1px solid #e9ecef;display:flex;gap:12px;justify-content:flex-end;padding:15px 20px}@media (max-width:768px){.settlement-dialog[data-v-6cf28f8a]{max-height:95vh;max-width:95vw}.form-row[data-v-6cf28f8a]{flex-direction:column}.col-md-4[data-v-6cf28f8a],.col-md-6[data-v-6cf28f8a]{flex:1;margin-bottom:15px;max-width:100%}.dialog-body[data-v-6cf28f8a],.form-section[data-v-6cf28f8a]{padding:15px}.allocation-summary[data-v-6cf28f8a]{flex-direction:column;gap:10px}.form-actions[data-v-6cf28f8a]{flex-direction:column-reverse}.form-actions .btn[data-v-6cf28f8a]{justify-content:center;width:100%}.invoice-selector-modal[data-v-6cf28f8a]{max-width:95vw}.col-md-6[data-v-6cf28f8a]{flex:1;margin-bottom:10px;max-width:100%}}",""]),n.locals={},t.exports=n},1610:function(t,e,o){"use strict";o.r(e);o(44),o(9),o(5),o(7),o(67),o(35),o(39),o(11),o(12);var n=o(3),r=o(33),c=o(20);o(92),o(254),o(54),o(255),o(256),o(257),o(258),o(259),o(260),o(261),o(262),o(263),o(264),o(265),o(266),o(267),o(53),o(8),o(51),o(66),o(121),o(10);function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function d(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={name:"SettlementDialog",props:{visible:{type:Boolean,default:!1},settlement:{type:Object,default:null},outstandingInvoices:{type:Array,default:function(){return[]}},user:{type:Object,required:!0}},data:function(){return{form:{id:null,settlementDate:(new Date).toISOString().split("T")[0],paymentAmount:0,baseAmount:0,paymentMethodId:"",bankAccountId:"",reference:"",description:"",note:"",status:"draft",makerId:null,checkerId:null,approvalNote:""},selectedInvoices:[],tempSelectedInvoices:[],paymentMethods:[],bankAccounts:[],errors:{},isSubmitting:!1,showInvoiceSelector:!1,invoiceSearchTerm:"",selectedVendorFilter:"",filteredInvoices:[]}},computed:{isEditMode:function(){return!(!this.settlement||!this.settlement.id)},canModify:function(){return["draft","pending"].includes(this.form.status)},canModifyStatus:function(){return this.user.canManageSettlements||this.form.makerId===this.user.id},canModifyAllocations:function(){return this.canModify},canApprove:function(){return this.user.canApproveSettlements&&"pending"===this.form.status},canComplete:function(){return this.user.canCompleteSettlements&&["pending","approved"].includes(this.form.status)},showApprovalSection:function(){return this.isEditMode&&["pending","approved","completed"].includes(this.form.status)},totalAllocated:function(){return this.selectedInvoices.reduce((function(t,e){return t+parseFloat(e.settledAmount||0)}),0)},unallocatedAmount:function(){return parseFloat(this.form.baseAmount)-this.totalAllocated},availableVendors:function(){var t=[],e=new Map;return this.outstandingInvoices.forEach((function(o){o.vendor&&!e.has(o.vendor.id)&&(e.set(o.vendor.id,o.vendor),t.push(o.vendor))})),t},makerName:function(){var t;return this.isEditMode&&null!==(t=this.settlement)&&void 0!==t&&t.maker?this.settlement.maker.fullName||this.settlement.maker.username:this.user.fullName||this.user.username},checkerName:function(){var t;return this.isEditMode&&null!==(t=this.settlement)&&void 0!==t&&t.checker?this.settlement.checker.fullName||this.settlement.checker.username:""}},watch:{visible:function(t){t&&this.initializeDialog()},settlement:{handler:function(t){t&&this.loadSettlementData(t)},immediate:!0}},mounted:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadReferenceData();case 2:case"end":return e.stop()}}),e)})))()},methods:{initializeDialog:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadReferenceData();case 2:t.settlement?t.loadSettlementData(t.settlement):t.resetForm(),t.filteredInvoices=Object(r.a)(t.outstandingInvoices);case 4:case"end":return e.stop()}}),e)})))()},loadReferenceData:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([t.loadPaymentMethods(),t.loadBankAccounts()]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error loading reference data:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},loadPaymentMethods:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/paymentMethod/find");case 3:o=e.sent,data=o.data,t.paymentMethods=data||[],e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error loading payment methods:",e.t0),t.paymentMethods=[];case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadBankAccounts:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/bank_account/find");case 3:o=e.sent,data=o.data,t.bankAccounts=data||[],e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error loading bank accounts:",e.t0),t.bankAccounts=[];case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadSettlementData:function(t){this.form={id:t.id,settlementDate:t.settlementDate||(new Date).toISOString().split("T")[0],paymentAmount:parseFloat(t.paymentAmount||0),baseAmount:parseFloat(t.baseAmount||0),paymentMethodId:t.paymentMethodId||"",bankAccountId:t.bankAccountId||"",reference:t.reference||"",description:t.description||"",note:t.note||"",status:t.status||"draft",makerId:t.makerId||this.user.id,checkerId:t.checkerId||null,approvalNote:t.approvalNote||""},t.invoiceSettlements&&(this.selectedInvoices=t.invoiceSettlements.map((function(t){return{id:t.invoice.id,invoiceNumber:t.invoice.invoiceNumber,vendor:t.invoice.vendor,outstandingAmount:parseFloat(t.invoice.outstandingAmount||0),settledAmount:parseFloat(t.amount||0)}})))},resetForm:function(){this.form={id:null,settlementDate:(new Date).toISOString().split("T")[0],paymentAmount:0,baseAmount:0,paymentMethodId:"",bankAccountId:"",reference:"",description:"",note:"",status:"draft",makerId:this.user.id,checkerId:null,approvalNote:""},this.selectedInvoices=[],this.errors={}},calculateBaseAmount:function(){this.form.paymentAmount&&(this.form.baseAmount=this.form.paymentAmount)},calculateUnallocatedAmount:function(){this.$forceUpdate()},calculateTotals:function(){this.$forceUpdate()},filterInvoices:function(){var t=this,e=Object(r.a)(this.outstandingInvoices);if(this.invoiceSearchTerm){var o=this.invoiceSearchTerm.toLowerCase();e=e.filter((function(t){var e,n;return t.invoiceNumber.toLowerCase().includes(o)||(null===(e=t.vendor)||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(o))}))}this.selectedVendorFilter&&(e=e.filter((function(e){var o;return(null===(o=e.vendor)||void 0===o?void 0:o.id)===t.selectedVendorFilter}))),this.filteredInvoices=e},toggleInvoiceSelection:function(t,e){e.target.checked?this.tempSelectedInvoices.find((function(e){return e.id===t.id}))||this.tempSelectedInvoices.push(d(d({},t),{},{settledAmount:parseFloat(t.outstandingAmount||0)})):this.tempSelectedInvoices=this.tempSelectedInvoices.filter((function(e){return e.id!==t.id}))},isInvoiceSelected:function(t){return this.tempSelectedInvoices.some((function(e){return e.id===t}))},confirmInvoiceSelection:function(){var t=this;try{this.tempSelectedInvoices.forEach((function(e){t.selectedInvoices.find((function(t){return t.id===e.id}))||t.selectedInvoices.push(e)})),this.closeInvoiceSelector(),this.calculateTotals()}catch(t){console.error("Error in confirmInvoiceSelection:",t)}},removeInvoice:function(t){this.selectedInvoices.splice(t,1),this.calculateTotals()},closeInvoiceSelector:function(){this.showInvoiceSelector=!1,this.tempSelectedInvoices=[],this.invoiceSearchTerm="",this.selectedVendorFilter="",this.filteredInvoices=Object(r.a)(this.outstandingInvoices)},validateForm:function(){return this.errors={},this.form.settlementDate||(this.errors.settlementDate="ກະລຸນາເລືອກວັນທີຊຳລະ"),(!this.form.paymentAmount||this.form.paymentAmount<=0)&&(this.errors.paymentAmount="ກະລຸນາໃສ່ຈຳນວນເງິນຊຳລະທີ່ຖືກຕ້ອງ"),(!this.form.baseAmount||this.form.baseAmount<=0)&&(this.errors.baseAmount="ກະລຸນາໃສ່ຈຳນວນເງິນພື້ນຖານທີ່ຖືກຕ້ອງ"),this.form.paymentMethodId||(this.errors.paymentMethodId="ກະລຸນາເລືອກວິທີການຊຳລະ"),this.form.reference&&this.form.reference.length>100&&(this.errors.reference="ຫມາຍເລກອ້າງອີງຍາວເກີນ 100 ຕົວອັກສອນ"),this.totalAllocated>this.form.baseAmount&&(this.errors.allocation="ຈຳນວນຈັດສັນເກີນຈຳນວນເງິນຊຳລະ"),0===Object.keys(this.errors).length},submitForm:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.validateForm()){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{o=d(d({},t.form),{},{makerId:t.form.makerId||t.user.id,invoiceAllocations:t.selectedInvoices.map((function(t){return{invoiceId:t.id,amount:parseFloat(t.settledAmount||0)}}))}),t.$emit("save",o)}catch(t){console.error("Error submitting form:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},approveSettlement:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.canApprove){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{o={id:t.form.id,status:"approved",checkerId:t.user.id,approvalNote:t.form.approvalNote},t.$emit("approve",o)}catch(t){console.error("Error approving settlement:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},completeSettlement:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.canComplete){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{o={id:t.form.id,status:"completed"},t.$emit("complete",o)}catch(t){console.error("Error completing settlement:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},closeDialog:function(){this.$emit("close")},handleOverlayClick:function(){this.closeDialog()},formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0)},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-GB"):"N/A"}}},m=f,v=(o(1506),o(32)),component=Object(v.a)(m,(function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"modal-overlay",on:{click:t.handleOverlayClick}},[e("div",{staticClass:"settlement-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("h4",[t._v(t._s(t.isEditMode?"ແກ້ໄຂການຊຳລະ":"ສ້າງການຊຳລະໃໝ່"))]),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"dialog-body"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"form-section"},[e("h5",{staticClass:"section-title"},[t._v("ຂໍ້ມູນການຊຳລະ")]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[t._m(0),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.settlementDate,expression:"form.settlementDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.settlementDate},attrs:{type:"date",required:""},domProps:{value:t.form.settlementDate},on:{input:function(e){e.target.composing||t.$set(t.form,"settlementDate",e.target.value)}}}),t._v(" "),t.errors.settlementDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.settlementDate)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ສະຖານະ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.status,expression:"form.status"}],staticClass:"form-control",attrs:{disabled:!t.canModifyStatus},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"status",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:"draft"}},[t._v("ຮ່າງ")]),t._v(" "),e("option",{attrs:{value:"pending"}},[t._v("ລໍຖ້າການອະນຸມັດ")]),t._v(" "),e("option",{attrs:{value:"approved"}},[t._v("ອະນຸມັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"completed"}},[t._v("ສຳເລັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"cancelled"}},[t._v("ຍົກເລີກ")])])])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[t._m(1),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.paymentAmount,expression:"form.paymentAmount",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.paymentAmount},attrs:{type:"number",step:"0.01",min:"0",required:""},domProps:{value:t.form.paymentAmount},on:{input:[function(e){e.target.composing||t.$set(t.form,"paymentAmount",t._n(e.target.value))},t.calculateBaseAmount],blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.paymentAmount?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.paymentAmount)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[t._m(2),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.baseAmount,expression:"form.baseAmount",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.baseAmount},attrs:{type:"number",step:"0.01",min:"0",required:""},domProps:{value:t.form.baseAmount},on:{input:[function(e){e.target.composing||t.$set(t.form,"baseAmount",t._n(e.target.value))},t.calculateUnallocatedAmount],blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.baseAmount?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.baseAmount)+"\n              ")]):t._e()])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[t._m(3),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.paymentMethodId,expression:"form.paymentMethodId"}],staticClass:"form-control",class:{"is-invalid":t.errors.paymentMethodId},attrs:{required:""},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"paymentMethodId",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("ເລືອກວິທີການຊຳລະ")]),t._v(" "),t._l(t.paymentMethods,(function(o){return e("option",{key:o.id,domProps:{value:o.id}},[t._v("\n                  "+t._s(o.payment_name)+"\n                ")])}))],2),t._v(" "),t.errors.paymentMethodId?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.paymentMethodId)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ບັນຊີທະນາຄານ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.bankAccountId,expression:"form.bankAccountId"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"bankAccountId",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("ເລືອກບັນຊີທະນາຄານ")]),t._v(" "),t._l(t.bankAccounts,(function(o){return e("option",{key:o.id,domProps:{value:o.id}},[t._v("\n                  "+t._s(o.accountNumber)+" - "+t._s(o.bankName)+"\n                ")])}))],2)])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ອ້າງອີງ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.reference,expression:"form.reference"}],staticClass:"form-control",attrs:{type:"text",maxlength:"100",placeholder:"ຫມາຍເລກອ້າງອີງ"},domProps:{value:t.form.reference},on:{input:function(e){e.target.composing||t.$set(t.form,"reference",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ຜູ້ສ້າງ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.makerName,expression:"makerName"}],staticClass:"form-control",attrs:{type:"text",disabled:!0},domProps:{value:t.makerName},on:{input:function(e){e.target.composing||(t.makerName=e.target.value)}}})])]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ຄຳອະທິບາຍ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],staticClass:"form-control",attrs:{rows:"3",placeholder:"ຄຳອະທິບາຍການຊຳລະ"},domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ໝາຍເຫດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.note,expression:"form.note"}],staticClass:"form-control",attrs:{rows:"3",placeholder:"ໝາຍເຫດເພີ່ມເຕີມ"},domProps:{value:t.form.note},on:{input:function(e){e.target.composing||t.$set(t.form,"note",e.target.value)}}})])])]),t._v(" "),e("div",{staticClass:"form-section"},[e("div",{staticClass:"section-header"},[e("h5",{staticClass:"section-title"},[t._v("ການຈັດສັນໃບແຈ້ງໜີ້")]),t._v(" "),e("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",disabled:!t.canModifyAllocations},on:{click:function(e){t.showInvoiceSelector=!0}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" ເພີ່ມໃບແຈ້ງໜີ້\n            ")])]),t._v(" "),0===t.selectedInvoices.length?e("div",{staticClass:"no-invoices"},[e("i",{staticClass:"fas fa-file-invoice"}),t._v(" "),e("p",[t._v("ຍັງບໍ່ໄດ້ເລືອກໃບແຈ້ງໜີ້")]),t._v(" "),e("small",[t._v('ກົດປຸ່ມ "ເພີ່ມໃບແຈ້ງໜີ້"\n              ເພື່ອເລືອກໃບແຈ້ງໜີ້ທີ່ຕ້ອງການຊຳລະ')])]):e("div",{staticClass:"invoice-allocations"},[e("table",{staticClass:"table table-sm"},[t._m(4),t._v(" "),e("tbody",t._l(t.selectedInvoices,(function(o,n){var r;return e("tr",{key:o.id},[e("td",[t._v(t._s(o.invoiceNumber))]),t._v(" "),e("td",[t._v(t._s((null===(r=o.vendor)||void 0===r?void 0:r.name)||"N/A"))]),t._v(" "),e("td",[t._v(t._s(t.formatCurrency(o.outstandingAmount)))]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:o.settledAmount,expression:"invoice.settledAmount",modifiers:{number:!0}}],staticClass:"form-control form-control-sm",attrs:{type:"number",step:"0.01",min:"0",max:o.outstandingAmount,disabled:!t.canModifyAllocations},domProps:{value:o.settledAmount},on:{input:[function(e){e.target.composing||t.$set(o,"settledAmount",t._n(e.target.value))},t.calculateTotals],blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-sm btn-danger",attrs:{type:"button",disabled:!t.canModifyAllocations},on:{click:function(e){return t.removeInvoice(n)}}},[e("i",{staticClass:"fas fa-trash"})])])])})),0)]),t._v(" "),e("div",{staticClass:"allocation-summary"},[e("div",{staticClass:"summary-item"},[e("strong",[t._v("ລວມຈັດສັນ: "+t._s(t.formatCurrency(t.totalAllocated)))])]),t._v(" "),e("div",{staticClass:"summary-item"},[e("strong",[t._v("ຍອດເຫຼືອ: "+t._s(t.formatCurrency(t.unallocatedAmount)))])])])])]),t._v(" "),t.showApprovalSection?e("div",{staticClass:"form-section"},[e("h5",{staticClass:"section-title"},[t._v("ການອະນຸມັດ")]),t._v(" "),e("div",{staticClass:"form-row"},[e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ຜູ້ອະນຸມັດ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.checkerName,expression:"checkerName"}],staticClass:"form-control",attrs:{type:"text",disabled:!0},domProps:{value:t.checkerName},on:{input:function(e){e.target.composing||(t.checkerName=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group col-md-6"},[e("label",[t._v("ໝາຍເຫດການອະນຸມັດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.approvalNote,expression:"form.approvalNote"}],staticClass:"form-control",attrs:{rows:"2",placeholder:"ໝາຍເຫດການອະນຸມັດ",disabled:!t.canApprove},domProps:{value:t.form.approvalNote},on:{input:function(e){e.target.composing||t.$set(t.form,"approvalNote",e.target.value)}}})])])]):t._e(),t._v(" "),e("div",{staticClass:"form-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeDialog}},[e("i",{staticClass:"fas fa-times"}),t._v(" ຍົກເລີກ\n          ")]),t._v(" "),t.canApprove&&"pending"===t.form.status?e("button",{staticClass:"btn btn-success",attrs:{type:"button",disabled:t.isSubmitting},on:{click:t.approveSettlement}},[e("i",{staticClass:"fas fa-check"}),t._v(" ອະນຸມັດ\n          ")]):t._e(),t._v(" "),t.canComplete&&["pending","approved"].includes(t.form.status)?e("button",{staticClass:"btn btn-info",attrs:{type:"button",disabled:t.isSubmitting},on:{click:t.completeSettlement}},[e("i",{staticClass:"fas fa-check-circle"}),t._v(" ສຳເລັດ\n          ")]):t._e(),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:t.isSubmitting||!t.canModify}},[e("i",{staticClass:"fas fa-save"}),t._v(" "),t.isSubmitting?e("span",[t._v("ກຳລັງບັນທຶກ...")]):e("span",[t._v(t._s(t.isEditMode?"ອັບເດດ":"ບັນທຶກ"))])])])])])]),t._v(" "),t.showInvoiceSelector?e("div",{staticClass:"invoice-selector-overlay",on:{click:t.closeInvoiceSelector}},[e("div",{staticClass:"invoice-selector-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h5",[t._v("ເລືອກໃບແຈ້ງໜີ້ຄ້າງຈ່າຍ")]),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeInvoiceSelector}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"invoice-filters"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.invoiceSearchTerm,expression:"invoiceSearchTerm"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ຄົ້ນຫາເລກທີໃບແຈ້ງໜີ້..."},domProps:{value:t.invoiceSearchTerm},on:{input:[function(e){e.target.composing||(t.invoiceSearchTerm=e.target.value)},t.filterInvoices]}})]),t._v(" "),e("div",{staticClass:"col-md-6"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedVendorFilter,expression:"selectedVendorFilter"}],staticClass:"form-control",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedVendorFilter=e.target.multiple?o:o[0]},t.filterInvoices]}},[e("option",{attrs:{value:""}},[t._v("ທຸກຜູ້ຂາຍ")]),t._v(" "),t._l(t.availableVendors,(function(o){return e("option",{key:o.id,domProps:{value:o.id}},[t._v("\n                  "+t._s(o.name)+"\n                ")])}))],2)])])]),t._v(" "),e("div",{staticClass:"invoice-list"},[e("table",{staticClass:"table table-sm table-hover"},[t._m(5),t._v(" "),e("tbody",t._l(t.filteredInvoices,(function(o){var n;return e("tr",{key:o.id,class:{"selected-row":t.isInvoiceSelected(o.id)}},[e("td",[e("input",{attrs:{type:"checkbox"},domProps:{checked:t.isInvoiceSelected(o.id)},on:{change:function(e){return t.toggleInvoiceSelection(o,e)}}})]),t._v(" "),e("td",[t._v(t._s(o.invoiceNumber))]),t._v(" "),e("td",[t._v(t._s((null===(n=o.vendor)||void 0===n?void 0:n.name)||"N/A"))]),t._v(" "),e("td",[t._v(t._s(t.formatDate(o.dueDate)))]),t._v(" "),e("td",[t._v(t._s(t.formatCurrency(o.outstandingAmount)))])])})),0)]),t._v(" "),0===t.filteredInvoices.length?e("div",{staticClass:"no-data"},[e("p",[t._v("ບໍ່ພົບໃບແຈ້ງໜີ້ທີ່ຕົງກັບເງື່ອນໄຂ")])]):t._e()]),t._v(" "),e("div",{staticClass:"modal-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.closeInvoiceSelector.apply(null,arguments)}}},[t._v("\n            ຍົກເລີກ\n          ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.confirmInvoiceSelection.apply(null,arguments)}}},[t._v("\n            ຢືນຢັນການເລືອກ ("+t._s(t.tempSelectedInvoices.length)+")\n          ")])])])])]):t._e()]):t._e()}),[function(){var t=this,e=t._self._c;return e("label",[t._v("ວັນທີຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ຈຳນວນເງິນຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ຈຳນວນເງິນພື້ນຖານ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ວິທີການຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",[t._v("ຜູ້ຂາຍ")]),t._v(" "),e("th",[t._v("ຍອດຄ້າງຈ່າຍ")]),t._v(" "),e("th",[t._v("ຈຳນວນຈັດສັນ")]),t._v(" "),e("th",[t._v("ຟັງຊັ່ນ")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("ເລືອກ")]),t._v(" "),e("th",[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",[t._v("ຜູ້ຂາຍ")]),t._v(" "),e("th",[t._v("ວັນທີຄົບກຳນົດ")]),t._v(" "),e("th",[t._v("ຍອດຄ້າງຈ່າຍ")])])])}],!1,null,"6cf28f8a",null);e.default=component.exports}}]);