(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{885:function(t,e,n){"use strict";n.r(e);var r=n(786),o=n(316),c=n(313),l=n(18),d=n(317),m=n(784),f=n(758),h=n(312),v=n(785),y=n(167),O=n(783),C=n(781),E=n(113),k=(n(30),n(35),n(10),n(7),n(12),n(8),n(13),n(62),n(69),n(54),n(34),n(67),n(93),n(53),n(20)),I=n(3),$=(n(92),n(22),n(44),n(63),n(66),n(5),n(121),n(9),n(39),n(51),n(36)),x=(n(943),n(103)),T=n(40);function w(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function _(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function N(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?_(Object(source),!0).forEach((function(e){Object(I.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):_(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var A={props:{isCreate:{type:Boolean,require:!0,default:!0},recordId:{type:Number,require:!1,default:0},orderStatus:{type:String,default:"RECEIVED"}},data:function(){return{showCanvas:!1,barcodeImage:"",customerOptionForOrderId:null,timeoutId:null,customerTel:null,confirmEntries:[],lockSuggest:!1,clientOption:[],status:["ORDERED","RECEIVED","INVOICED"],isloading:!1}},mounted:function(){if("INVOICED"==this.orderStatus){this.confirmEntries=this.$store.state.listOfConfirmPaymentOrder.map((function(t){return N({},JSON.parse(JSON.stringify(t)))})),console.log("$$$$$$$$$  PAYMENT LIST [".concat(this.confirmEntries.length,"] $$$$$$$$$$"));var t,e=w(this.confirmEntries);try{for(e.s();!(t=e.n()).done;){t.value.paymentId=this.paymentList[0].id}}catch(t){e.e(t)}finally{e.f()}}else this.confirmEntries=this.$store.state.listOfConfirmStockInOrder.map((function(t){return N({},JSON.parse(JSON.stringify(t)))})),console.log("$$$$$$$$$ STOCK LIST [".concat(this.confirmEntries.length,"] $$$$$$$$$$"));var n,r=w(this.confirmEntries);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.status=this.orderStatus,o.custel=o.client.telephone,o.cusname=o.client.name}}catch(t){r.e(t)}finally{r.f()}},methods:N(N({handleButtonClick:function(){console.log("LIKE BUTTON CLICK")},testMyTrigger:function(t){var e=this;console.log("Typing on order id: ".concat(t)),this.customerOptionForOrderId=t,this.customerTel=this.confirmEntries[t].client.telephone,null!=this.clientList&&(this.clientOption=this.clientList,console.log("TIMER ".concat(this.timeoutId)),null==this.timeoutId&&(this.timeoutId=setTimeout((function(){console.log("******Reset auto suggest*******"),e.clientOption=[],e.timeoutId=null}),5e3)))},selectedClientNew:function(t,e){var n=this;console.log("SELECT CLIENT CLICK");var r=this.findAllClient.find((function(e){return e.id==t}));null!=r&&(this.lockSuggest=!0,this.confirmEntries[e].client.name=r.name,this.confirmEntries[e].client.telephone=r.telephone,this.clientOption=[],this.timeoutId=setTimeout((function(){console.log("******Reset auto suggest*******"),n.lockSuggest=!1}),5e3))}},Object(T.b)(["removeOrderFromStockConfirm","removeOrderFromPaymentConfirm","clearPaymentList","clearStockList"])),{},{formatNumber:function(t){return Object($.e)(t)},bulkUpdateStatus:function(){var t=this;return Object(k.a)(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isloading){e.next=2;break}return e.abrupt("return");case 2:t.isloading=!0,console.log("order len==== ".concat(t.confirmEntries.length)),n=0;case 5:if(!(n<t.confirmEntries.length)){e.next=30;break}if(console.log("LOOP ####".concat(n)),r=t.confirmEntries[n],o="api/order/update/".concat(r.id),r.id||(o="api/order/create"),r.userId=t.user.id,r.locationId=t.currentTerminal.locationId,e.prev=12,!r.id){e.next=19;break}return e.next=16,t.$axios.put(o,r);case 16:e.sent,e.next=22;break;case 19:return e.next=21,t.$axios.post(o,r);case 21:e.sent;case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(12),e.abrupt("return",Object($.j)(t.$swal,"Error","ເກີດຂໍ້ຜິດພາດ ກະລຸນາລອງໃຫມ່ ພາຍຫລັງ"));case 27:n++,e.next=5;break;case 30:console.log("START REMOVING ENTRY FROM STATE"),t.clearAllFromConfirmEntrie(),t.$emit("close-dialog"),t.refreshData(),t.isloading=!1;case 35:case"end":return e.stop()}}),e,null,[[12,24]])})))()},generateBarcodeImage:function(t){var canvas=this.$refs.barcodeCanvas;console.log(".....Canvas logger....."),console.log(canvas),console.log(canvas.width,canvas.height),canvas.width=40,canvas.height=20,JsBarcode(canvas,t,{format:"code128",displayValue:!0,fontSize:20}),this.barcodeImage=canvas.toDataURL()},merceEntryToPrint:function(){var t=this;return Object(k.a)(regeneratorRuntime.mark((function e(){var n,r,o,c,l,d,m,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.generateBarcodeImage(t.confirmEntries[0].trackingNumber),n="",r=w(t.confirmEntries);try{for(r.s();!(o=r.n()).done;)c=o.value,l=c.shippingFee*c.shippingRate,n+='<div class="ticket">\n            <div class="product-name">'.concat(c.name,'</div>\n            <div class="price">  ').concat(t.formatNumber(l),'</div>\n        </div>\n        <div class="product-name">').concat(c.trackingNumber," X ").concat(t.formatNumber(l),"</div>\n        <br>\n            ")}catch(t){r.e(t)}finally{r.f()}d=new Date,m='\n<div class="ticket">\n            <div class="product-name"></div>\n        <div class="price">THB '.concat(t.formatNumber(t.ticketTotal),"</div>\n    </div>"),f="\n ".concat(t.ticketCommon.header,'\n    <body>\n        <div style="text-align: center;">\n            <img src="').concat(t.companyLogo,'" alt="Description of the image" width="100" height="100">\n        </div>\n        <h3> ເຈ້ນ່ອງ ຂົນສົ່ງ ໄທ-ລາວ</h3>\n        <h3> ໃບຮັບເງິນ</h3>\n        <h5> ວັນທີ ').concat(d.toLocaleString(),"</h5>\n        <h5> Ticket ").concat(t.confirmEntries[0].id," </h5>\n        <h5> Tel ").concat(t.currentTerminal.location.company.tel,"</h5>\n        <h5> ຜູ້ຂາຍ: ").concat(t.user.cus_name,"  </h5>\n        <h5> ຜູ້ຮັບ: ").concat(t.confirmEntries[0].client.name,'  </h5>\n        <hr style="margin-top: 50px;"> </hr>\n        ').concat(n,"\n        <hr> </hr>\n        ").concat(m,'\n        <h2 style="text-align: center; margin-top: 50px;">  <img src="').concat(t.barcodeImage,'"> </h2>\n        <h2 style="text-align: center; margin-top: 50px;"> THANKYOU </h2>\n        \n    </body>\n    </html>\n'),(h=window.open("","","left=0,top=0,width=2480,height=3508,toolbar=0,scrollbars=0,status=0")).document.open(),h.document.write(f),t.bulkUpdateStatus(),setTimeout((function(){h.print(),h.close()}),1e3);case 12:case"end":return e.stop()}}),e)})))()},printTicket:function(t){console.log("".concat(JSON.stringify(t)));var e="",n=t.shippingFee*t.shippingRate;this.generateBarcodeImage(t.trackingNumber),e+='<div class="ticket">\n                    <div class="product-name">'.concat(t.name,'</div>\n                    <div class="price">  ').concat(this.formatNumber(n),'</div>\n                </div>\n                <div class="product-name">').concat(t.trackingNumber," X ").concat(this.formatNumber(n),"</div>\n                <br>\n                    ");var r=new Date,o='\n      <div class="ticket">\n                    <div class="product-name"></div>\n                <div class="price">'.concat(this.findCurrencyById(t.shippingFeeCurrencyId)," ").concat(this.formatNumber(t.shippingFee),"</div>\n            </div>"),c="\n         ".concat(this.ticketCommon.header,'\n            <body>\n                <div style="text-align: center;">\n                    <img src="').concat(this.companyLogo,'" alt="Description of the image" width="100" height="100">\n                </div>\n                <h3> ເຈ້ນ່ອງ ຂົນສົ່ງ ໄທ-ລາວ </h3>\n                <h3> ໃບຮັບເງິນ</h3>\n                <h5> ວັນທີ ').concat(r.toLocaleString(),"</h5>\n                <h5> Ticket ").concat(t.id," </h5>\n                <h5> Tel ").concat(this.currentTerminal.location.company.tel,"</h5>\n                <h5> ຜູ້ຂາຍ: ").concat(this.user.cus_name,"  </h5>\n                <h5> ຜູ້ຮັບ: ").concat(t.client.name,'  </h5>\n                <hr style="margin-top: 50px;"> </hr>\n                ').concat(e,"\n                <hr> </hr>\n                ").concat(o,'\n                <h2 style="text-align: center; margin-top: 50px;">  <img src="').concat(this.barcodeImage,'"> </h2>\n                <h2 style="text-align: center; margin-top: 50px;"> THANKYOU </h2>\n                \n            </body>\n            </html>\n        '),l=window.open("","","left=0,top=0,width=2480,height=3508,toolbar=0,scrollbars=0,status=0");l.document.open(),l.document.write(c),setTimeout((function(){l.print(),l.close()}),1e3)},currencyChange:function(t){var e=this,n=this.confirmEntries.indexOf(t),r=this.currencyList.find((function(t){return t.id==e.confirmEntries[n].shippingFeeCurrencyId}));r&&(this.confirmEntries[n].shippingRate=r.rate)},removeItemFromConfirmEntrie:function(t){var e=this.confirmEntries.indexOf(t);this.confirmEntries.splice(e,1),"RECEIVED"==this.orderStatus?this.removeOrderFromStockConfirm(t):this.removeOrderFromPaymentConfirm(t)},clearAllFromConfirmEntrie:function(){this.confirmEntries=[],"RECEIVED"==this.orderStatus?this.removeOrderFromStockConfirm(entry):this.clearPaymentList()},confirmOrder:function(t){var e=this;return Object(k.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t.shippingFee<=0)){n.next=2;break}return n.abrupt("return",Object($.j)(e.$swal,"Error","ກະລຸນາໃສ່ຄ່າສົ່ງ"));case 2:if(e.isloading){n.next=29;break}if(e.isloading=!0,r="api/order/update/".concat(t.id),t.id||(r="api/order/create"),t.userId=e.user.id,t.locationId=e.currentTerminal.locationId,n.prev=8,t.id){n.next=16;break}return console.log("CREATEING ORDER AND CHANGE DATA STATE"),n.next=13,e.$axios.post(r,t);case 13:n.sent,n.next=19;break;case 16:return n.next=18,e.$axios.put(r,t);case 18:n.sent;case 19:e.removeItemFromConfirmEntrie(t),e.refreshData(),Object($.k)(e.$swal,"Succeed","Your transaction completed"),n.next=28;break;case 24:n.prev=24,n.t0=n.catch(8),console.log("Error: ",n.t0),Object($.j)(e.$swal,"Error","ເກີດຂໍ້ຜິດພາດ ກະລຸນາລອງໃຫມ່ ພາຍຫລັງ");case 28:e.isloading=!1;case 29:case"end":return n.stop()}}),n,null,[[8,24]])})))()},refreshData:function(){this.$emit("reload-data")},findCurrencyById:function(t){return this.findAllCurrency.find((function(e){return e.id==t})).code}}),computed:N({companyData:function(){return console.log("**********COMPANY DATA ".concat(x.b,"**********")),Object(x.b)()},companyLogo:function(){return n(341)("./".concat(this.companyData.ticketLogo))},user:function(){return this.$auth.user||""},clientList:function(){var t=this;return this.findAllClient.filter((function(e){return e.telephone.includes(t.customerTel)}))},currentTerminal:function(){var t=this;return this.findAllTerminal.find((function(e){return e.id==t.findSelectedTerminal}))},ticketCommon:function(){return Object($.l)()},currencyList:function(){return this.findAllCurrency},ticketTotal:function(){return this.confirmEntries.reduce((function(t,e){return t+e.shippingFee*e.shippingRate}),0)},paymentList:function(){return this.findAllPayment}},Object(T.c)(["findAllListOfConfirmPayment","findAllListOfConfirmStockIn","findAllProduct","findAllClient","findAllPayment","findAllUnit","findAllCurrency","findAllTerminal","findSelectedTerminal"]))},L=n(32),component=Object(L.a)(A,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"text-center"},[e(f.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.isloading,callback:function(e){t.isloading=e},expression:"isloading"}},[e("loading-indicator")],1),t._v(" "),e(c.a,{staticClass:"pa-4"},[e(l.d,[e(d.a,{staticClass:"ma-0",attrs:{color:"primary",label:"","text-color":"white"}},[e(y.a,{attrs:{start:""}},[t._v("mdi-label")]),t._v("\n        ຮັບເຄື່ອງ "+t._s(t.confirmEntries.length)+" ລາຍການ\n      ")],1)],1),t._v(" "),e(l.c,[e(v.a,{ref:"form"},[t._l(t.confirmEntries,(function(n,d){return e(c.a,{key:d,staticClass:"mb-2 pa-0"},[e(l.c,{staticClass:"pa-0"},[e(O.a,{staticClass:"pa-0 ma-0"},[e(O.a,{staticClass:"pa-2",attrs:{align:"center"}},[e(m.a,{attrs:{cols:"12"}},[e(E.a,{attrs:{label:"* ເບີໂທ"},on:{input:function(e){return t.testMyTrigger(d)}},model:{value:n.client.telephone,callback:function(e){t.$set(n.client,"telephone",e)},expression:"order.client.telephone"}})],1),t._v(" "),t.clientOption.length>0&&t.customerOptionForOrderId==d?e(m.a,{attrs:{cols:"12"}},t._l(t.clientOption,(function(n){return e(c.a,{key:n.id},[e(l.c,[e(O.a,[e(m.a,{attrs:{cols:"8"}},[t._v("\n                          "+t._s(n.name.concat(" - ").concat(n.telephone))+"\n                        ")]),t._v(" "),e(m.a,{attrs:{cols:"2","align-self":"center"}},[e(o.a,{attrs:{color:"primary",rounded:"",variant:"text"},on:{click:function(e){return t.selectedClientNew(n.id,d)}}},[e("i",{staticClass:"fa-regular fa-circle-check"})])],1)],1)],1)],1)})),1):t._e()],1),t._v(" "),e(m.a,{attrs:{cols:"1"}},[e(E.a,{attrs:{label:"* ຊື່ລູກຄ້າ"},model:{value:n.client.name,callback:function(e){t.$set(n.client,"name",e)},expression:"order.client.name"}})],1),t._v(" "),e(m.a,{attrs:{cols:"2"}},[e(E.a,{attrs:{disabled:"",label:"* Tracking No."},model:{value:n.trackingNumber,callback:function(e){t.$set(n,"trackingNumber",e)},expression:"order.trackingNumber"}})],1),t._v(" "),e(m.a,{attrs:{cols:"1"}},[e(E.a,{attrs:{label:"* ຄ່າສົ່ງ"},model:{value:n.shippingFee,callback:function(e){t.$set(n,"shippingFee",e)},expression:"order.shippingFee"}})],1),t._v(" "),e(m.a,{attrs:{cols:"1"}},[e(r.a,{attrs:{"item-text":"code","item-value":"id",items:t.currencyList,label:"ສະກຸນເງິນ*"},on:{input:function(e){return t.currencyChange(n)}},model:{value:n.shippingFeeCurrencyId,callback:function(e){t.$set(n,"shippingFeeCurrencyId",e)},expression:"order.shippingFeeCurrencyId"}})],1),t._v(" "),e(m.a,{attrs:{cols:"1"}},[e(E.a,{attrs:{disabled:"",label:"ອັດຕາແລກປ່ຽນ"},model:{value:n.shippingRate,callback:function(e){t.$set(n,"shippingRate",e)},expression:"order.shippingRate"}})],1),t._v(" "),"INVOICED"==t.orderStatus?e(m.a,{attrs:{cols:"1"}},[e(r.a,{attrs:{"item-text":"payment_code","item-value":"id",items:t.paymentList,label:"ການຊຳລະ*"},model:{value:n.paymentId,callback:function(e){t.$set(n,"paymentId",e)},expression:"order.paymentId"}})],1):t._e(),t._v(" "),e(C.a),t._v(" "),e(m.a,{attrs:{cols:"1","align-self":"center"}},[e(o.a,{attrs:{color:"warning",rounded:"",variant:"text"},on:{click:function(e){return t.removeItemFromConfirmEntrie(n)}}},[e("i",{staticClass:"fa-solid fa-circle-xmark"})])],1),t._v(" "),e(m.a,{attrs:{cols:"1","align-self":"center"}},[e(o.a,{attrs:{color:"primary",rounded:"",variant:"text"},on:{click:function(e){return t.confirmOrder(n)}}},[e("i",{staticClass:"fa-regular fa-circle-check"})])],1),t._v(" "),"INVOICED"==t.orderStatus?e(m.a,{attrs:{cols:"1","align-self":"center"}},[e(o.a,{attrs:{color:"primary",rounded:"",variant:"text"},on:{click:function(e){t.confirmOrder(n),t.printTicket(n)}}},[e("i",{staticClass:"fa-regular fa-circle-check"}),t._v("\n                  &\n                  "),e("i",{staticClass:"fa-solid fa-print"})])],1):t._e()],1)],1)],1)})),t._v(" "),e(h.a)],2),t._v(" "),e("small",[t._v("* ສະແດງເຖິງຟິວທີ່ຕ້ອງໃສ່ຂໍ້ມູນ")])],1),t._v(" "),e(l.a,[e(C.a),t._v(" "),e(o.a,{attrs:{color:"warning",rounded:"",variant:"text"},on:{click:function(e){"RECEIVED"==t.orderStatus?t.clearStockList():t.clearPaymentList(),t.$emit("close-dialog")}}},[t._v("\n        Close\n      ")]),t._v(" "),"INVOICED"==t.orderStatus?e(o.a,{attrs:{color:"primary",rounded:"",variant:"text"},on:{click:t.merceEntryToPrint}},[e("i",{staticClass:"fa-solid fa-clipboard-check"}),t._v("\n        ອອກບິນໃຫ້ລູກຄ້າ\n      ")]):t._e(),t._v(" "),e("canvas",{ref:"barcodeCanvas",style:{display:t.showCanvas?"block":"none"}})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{LoadingIndicator:n(248).default})}}]);