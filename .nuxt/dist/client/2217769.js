(window.webpackJsonp=window.webpackJsonp||[]).push([[2,58,123],{814:function(t,n,e){"use strict";e.r(n);var r=e(782),o=e(818),c=e(316),l=e(313),d=e(18),f=e(317),m=e(780),h=e(789),v=e(754),y=e(312),x=e(779),O=e(90),_=e(777),k=e(113),I=e(811),w=(e(35),e(131),e(62),e(34),e(69),e(54),e(7),e(67),e(93),e(53),e(10),e(9),e(11),e(8),e(12),e(3)),j=e(27),C=e(20),L=(e(92),e(22),e(105),e(66),e(5),e(30),e(121),e(813),e(820)),N=e(40),$=e(253),R=e(36),E=e(815);function D(object,t){var n=Object.keys(object);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(object);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),n.push.apply(n,e)}return n}function S(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?D(Object(source),!0).forEach((function(n){Object(w.a)(t,n,source[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):D(Object(source)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(source,n))}))}return t}function A(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return T(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return T(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){l=!0,o=t},f:function(){try{c||null==e.return||e.return()}finally{if(l)throw o}}}}function T(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,e=new Array(n);i<n;i++)e[i]=t[i];return e}var P={components:{PricingOption:$.default,CancelTicketForm:E.default},props:{headerId:{type:Number,default:0},isQuotation:{type:Boolean,default:!1},isUpdate:{type:Boolean,default:!1},updateAllow:{type:Boolean,default:!0}},directives:{commaThousand:L.a},created:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.isUpdate){n.next=8;break}return console.log("View old record"),t.isloading=!0,n.next=5,t.loadTransaction();case 5:t.isloading=!1,n.next=15;break;case 8:e=(new Date).toISOString().substr(0,10),t.transaction.bookingDate=e,t.transaction.clientId=1,t.transaction.paymentId=1,t.transaction.currencyId=1,t.transaction.discount=0,t.newRow();case 15:case"end":return n.stop()}}),n)})))()},methods:{cancelOrder:function(){this.transaction.dynamic_customer&&(this.onlineCustomerId=this.transaction.dynamic_customer.id),this.cancelConfirmDialog=!0},updatePricing:function(t){var n=this,e=t.amount;console.log("New pricing ".concat(e)),console.log("New pricing ".concat(JSON.stringify(this.transaction.lines[0])));var r=this.transaction.lines.findIndex((function(t){return t.productId==n.productPricingSelected}));if(!(r<0)){var o=this.transaction.lines[r].quantity,c=this.transaction.lines[r].unitRate,l=this.transaction.lines[r].discount;if("Price"!=t.type){var d=this.transaction.lines[r].price,f=d*e/100+d;this.transaction.lines[r].total=o*c*f-l,this.transaction.lines[r].price=f}else this.transaction.lines[r].total=o*c*e-l,this.transaction.lines[r].price=e}},pricingLogig:function(t){console.log("PRINCING CLICK....".concat(JSON.stringify(t))),this.productPricingSelected=t.productId,this.pricingDialogKey+=1,this.pricingDialog=!0},findCurrency:function(t){return this.findAllCurrency.find((function(n){return n.id==t}))},quotationPreview:function(){var path=this.isQuotation?"PDFQuotation":"PDFInvoice";window.open("/admin/".concat(path,"/").concat(this.headerId),"_blank")},handleKeyDown:function(t){"Tab"===t.key&&(console.log("Tab key pressed"),this.newRow())},currencyChange:function(){var t=this,n=this.currencyList.find((function(n){return n.id==t.transaction.currencyId}));n&&(this.transaction.exchangeRate=n.rate,console.log("Rate exchange ".concat(n.rate," real value ").concat(this.transaction.exchangeRate)))},deleteItem:function(t){var n=this;return Object(C.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=8;break}return console.log("Line has id"),n.isloading=!0,e.next=5,n.$axios.delete("api/".concat(n.apiLine,"Line/find/").concat(t.id)).then((function(e){n.transaction.lines.splice(n.transaction.lines.indexOf(t),1)})).catch((function(t){Object(R.j)(n.$swal,"Error","Operation fail "+t.Error)}));case 5:n.isloading=!1,e.next=10;break;case 8:n.transaction.lines.splice(n.transaction.lines.indexOf(t),1),console.log("Line has no id");case 10:case"end":return e.stop()}}),e)})))()},quantityChange:function(data){console.log("Qty change");var t=this.transaction.lines.indexOf(data),n=Object(R.h)(this.transaction.lines[t].quantity,",",""),e=Object(R.h)(this.transaction.lines[t].unitRate,",",""),r=Object(R.h)(this.transaction.lines[t].discount,",",""),o=Object(R.h)(this.transaction.lines[t].price,",","");this.transaction.lines[t].total=e*n*o-r},unitRateChange:function(data){console.log("Unit rate change");var t=this.transaction.lines.indexOf(data),n=Object(R.h)(this.transaction.lines[t].quantity,",",""),e=Object(R.h)(this.transaction.lines[t].unitRate,",",""),r=Object(R.h)(this.transaction.lines[t].discount,",",""),o=Object(R.h)(this.transaction.lines[t].price,",","");this.transaction.lines[t].total=e*n*o-r},discountChange:function(data){console.log("Discount change");var t=this.transaction.lines.indexOf(data),n=Object(R.h)(this.transaction.lines[t].quantity,",",""),e=Object(R.h)(this.transaction.lines[t].unitRate,",",""),r=Object(R.h)(this.transaction.lines[t].discount,",",""),o=Object(R.h)(this.transaction.lines[t].price,",","");this.transaction.lines[t].total=e*n*o-r},unitChange:function(data){console.log("Unit change");var t=this.unitList.find((function(t){return t.id==data.unitId}));if(null!=t){var n=this.transaction.lines.indexOf(data);this.transaction.lines[n].unitRate=t.unitRate;var e=Object(R.h)(this.transaction.lines[n].quantity,",",""),r=Object(R.h)(this.transaction.lines[n].discount,",",""),o=Object(R.h)(this.transaction.lines[n].price,",","");this.transaction.lines[n].total=t.unitRate*e*o-r}},productChange:function(data){console.log("Product change");var t=this.productList.find((function(t){return t.id==data.productId}));if(null!=t){var n=this.transaction.lines.indexOf(data),e=this.findCurrency(t.saleCurrencyId);console.log("$$$$$$ ".concat(e.id," $$$$$$"));var r=t.pro_price*e.rate;this.transaction.lines[n].price=r;var o=Object(R.h)(this.transaction.lines[n].quantity,",",""),c=Object(R.h)(this.transaction.lines[n].discount,",",""),l=Object(R.h)(this.transaction.lines[n].price,",",""),d=Object(R.h)(this.transaction.lines[n].unitRate,",","");this.transaction.lines[n].total=d*o*l-c}else console.log("Product is not define")},newRow:function(){this.transaction.lines.push({quantity:0,unitRate:1,price:0,discount:0,total:0,isActive:!0,productId:0,unitId:1})},openCustomerDialog:function(){this.customerDialog=!0},loadTransaction:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$axios.get("api/".concat(t.apiLine,"/find/").concat(t.headerId)).then((function(n){t.transaction=n.data,console.log("Data ",n.data)})).catch((function(n){Object(R.j)(t.$swal,"Error","Could no load data "+n.Error)}));case 2:case"end":return n.stop()}}),n)})))()},post:function(){this.errorLineNumber=null;var t,n=A(this.transaction.lines);try{for(n.s();!(t=n.n()).done;){var e=t.value;if(this.errorLineNumber=this.transaction.lines.indexOf(e),!this.validateLine(e,this.errorLineNumber+1))return void(this.sheet=!0);e.total=e.quantity*e.unitRate*e.price-e.discount}}catch(t){n.e(t)}finally{n.f()}console.log("******** No error found process posting ********"),this.errorLineNumber=null},validateLine:function(t,n){var e=t.quantity,r=t.unitRate,o=t.price,c=t.discount,l=t.total,d=t.productId,f=t.unitId;return c=parseInt(c),r=parseInt(r),e=parseInt(e),!Number.isFinite(e)||Number(e)<=0?(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ຈຳນວນ ຕ້ອງໃຫຍ່ກ່ອນ 0  current value is ").concat(e,"********"),!1):!Number.isFinite(r)||Number(r)<=0?(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ອັດຕາຫົວຫນ່ວຍ ຕ້ອງໃຫຍ່ກ່ອນ 0  current value is ").concat(r,"********"),!1):(console.log("Type of price ",Object(j.a)(o)," [price] ",o),!Number.isFinite(o)||Number(o)<=0?(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ລາຄາ ຕ້ອງໃຫຍ່ກ່ອນ 0  current value is ").concat(o,"********"),!1):(console.log("Type of discount1 ",Object(j.a)(c)),Number.isFinite(c)?!Number.isFinite(l)||Number(l)<=0?(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ຍອດລວມ ຕ້ອງໃຫຍ່ກ່ອນ 0 current value is ").concat(l,"********"),!1):Number.isFinite(d)?!!Number.isFinite(f)||(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ຫົວຫນ່ວຍບໍ່ຖືກຕ້ອງ  current value is ").concat(f,"********"),!1):(this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ສິນຄ້າບໍ່ຖືກຕ້ອງ  current value is ").concat(d,"********"),!1):(console.log("Type of discount2 ",Object(j.a)(c)),this.validateErrorMessage="******** Error ລາຍການທີ #".concat(n," ສ່ວນລົດ ຕ້ອງເປັນຕົວເລກ  current value is ").concat(c,"********"),!1)))},validateHeader:function(){return this.headerError=!0,this.sheet=!0,console.log("=== currency id ",this.transaction.currencyId),this.transaction.currencyId?this.transaction.paymentId?this.transaction.clientId?0==this.transaction.lines.length?(this.validateErrorMessage="******** Error Header ບໍ່ມີລາຍການສິນຄ້າ ********",!1):(this.sheet=!1,this.headerError=!1,!0):(this.validateErrorMessage="******** Error Customer in Header #".concat(this.transaction.clientId," ບໍ່ສາມາດເປັນຄ່າວ່າງ ********"),!1):(this.validateErrorMessage="******** Error Payment in Header #".concat(this.transaction.paymentId," ບໍ່ສາມາດເປັນຄ່າວ່າງ ********"),!1):(this.validateErrorMessage="******** Error Currency in Header #".concat(this.transaction.currencyId," ບໍ່ສາມາດເປັນຄ່າວ່າງ ********"),!1)},getFormatNum:function(t){return(new Intl.NumberFormat).format(t)},toggleDialog:function(){this.$emit("close-dialog")},postToInvoice:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function n(){var e,r,o,c,l,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.isloading&&t.validateHeader()){n.next=2;break}return n.abrupt("return");case 2:t.isloading=!0,t.errorLineNumber=null,e=[],r=A(t.transaction.lines),n.prev=6,r.s();case 8:if((o=r.n()).done){n.next=21;break}if(c=o.value,t.errorLineNumber=t.transaction.lines.indexOf(c),t.validateLine(c,t.errorLineNumber+1)){n.next=15;break}return t.sheet=!0,t.isloading=!1,n.abrupt("return");case 15:c.discount=parseInt(Object(R.h)(c.discount,",","")),c.quantity=parseInt(Object(R.h)(c.quantity,",","")),c.unitRate=parseInt(Object(R.h)(c.unitRate,",","")),e.push(c);case 19:n.next=8;break;case 21:n.next=26;break;case 23:n.prev=23,n.t0=n.catch(6),r.e(n.t0);case 26:return n.prev=26,r.f(),n.finish(26);case 29:for(l=0,d=e;l<d.length;l++)d[l].id=null;return console.log("******** No error found process posting ********"),t.errorLineNumber=null,t.transaction.userId=t.user.id,t.transaction.total=t.grandTotal,t.transaction.referenceNo=t.headerId,t.transaction.lines=e,t.transaction.discount=Object(R.h)(t.transaction.discount,",",""),t.transaction.locationId=t.currentTerminal.locationId,console.log("Amount total ".concat(t.transaction.total)),n.next=41,t.$axios.post("api/sale/create",t.transaction).then((function(n){t.$emit("reload"),Object(R.k)(t.$swal,"Succeed","ດຳເນີນການສຳເລັດ")})).catch((function(n){console.error(n),Object(R.j)(t.$swal,"Error",n.response.data);var e=n.response.data.split("#")[1];null!=e&&(t.validateErrorMessage="********  ສິນຄ້າໃນສ້າງບໍ່ພຽງພໍ ********",t.errorLineNumber=t.transaction.lines.indexOf(t.transaction.lines.find((function(t){return t.productId==e}))),t.sheet=!0),console.log("Error ===>: "+n)}));case 41:t.isloading=!1;case 42:case"end":return n.stop()}}),n,null,[[6,23,26,29]])})))()},postTransaction:function(){var t=this;return Object(C.a)(regeneratorRuntime.mark((function n(){var e,r,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.isloading&&t.validateHeader()){n.next=2;break}return n.abrupt("return");case 2:t.isloading=!0,t.errorLineNumber=null,e=A(t.transaction.lines),n.prev=5,e.s();case 7:if((r=e.n()).done){n.next=19;break}if(o=r.value,t.errorLineNumber=t.transaction.lines.indexOf(o),t.validateLine(o,t.errorLineNumber+1)){n.next=14;break}return t.sheet=!0,t.isloading=!1,n.abrupt("return");case 14:o.discount=parseInt(Object(R.h)(o.discount,",","")),o.quantity=parseInt(Object(R.h)(o.quantity,",","")),o.unitRate=parseInt(Object(R.h)(o.unitRate,",",""));case 17:n.next=7;break;case 19:n.next=24;break;case 21:n.prev=21,n.t0=n.catch(5),e.e(n.t0);case 24:return n.prev=24,e.f(),n.finish(24);case 27:if(console.log("******** No error found process posting ********"),t.errorLineNumber=null,t.transaction.userId=t.user.id,t.transaction.total=t.grandTotal,t.transaction.discount=Object(R.h)(t.transaction.discount,",",""),t.transaction.locationId=t.currentTerminal.locationId,console.log("Amount total ".concat(t.transaction.total)),!t.isUpdate){n.next=39;break}return n.next=37,t.$axios.put("api/".concat(t.apiLine,"/update/").concat(t.headerId),t.transaction).then((function(n){t.$emit("reload"),Object(R.k)(t.$swal,"Succeed","ດຳເນີນການສຳເລັດ")})).catch((function(n){console.error(n),Object(R.j)(t.$swal,"Error",n.response.data);var e=n.response.data.split("#")[1];if(null!=e){var r=t.productList.find((function(t){return t.id==e}));t.validateErrorMessage="********  ສິນຄ້າ ".concat(r.pro_name," ໃນສ້າງບໍ່ພຽງພໍ ********"),t.errorLineNumber=t.transaction.lines.indexOf(t.transaction.lines.find((function(t){return t.productId==e}))),t.sheet=!0}console.log("Error ===>: "+n)}));case 37:n.next=41;break;case 39:return n.next=41,t.$axios.post("api/".concat(t.apiLine,"/create"),t.transaction).then((function(n){t.$emit("reload"),Object(R.k)(t.$swal,"Succeed","ດຳເນີນການສຳເລັດ")})).catch((function(n){console.error(n),Object(R.j)(t.$swal,"Error",n.response.data);var e=n.response.data.split("#")[1];null!=e&&(t.validateErrorMessage="********  ສິນຄ້າໃນສ້າງບໍ່ພຽງພໍ ********",t.errorLineNumber=t.transaction.lines.indexOf(t.transaction.lines.find((function(t){return t.productId==e}))),t.sheet=!0),console.log("Error ===>: "+n)}));case 41:t.isloading=!1;case 42:case"end":return n.stop()}}),n,null,[[5,21,24,27]])})))()}},computed:S(S({},Object(N.c)(["findAllProduct","findAllClient","findAllPayment","findAllUnit","findAllCurrency","findAllTerminal","findSelectedTerminal"])),{},{clientList:function(){return this.findAllClient},currentTerminal:function(){var t=this;return console.log("ALL TEMINAL ".concat(this.findAllTerminal.length," SELECTED ").concat(this.findSelectedTerminal)),this.findAllTerminal.find((function(n){return n.id==t.findSelectedTerminal}))},user:function(){return this.$auth.user||""},apiLine:function(){return this.isQuotation?"quotation":"sale"},productList:function(){return this.findAllProduct},paymentList:function(){return this.findAllPayment},unitList:function(){return this.findAllUnit},currencyList:function(){return this.findAllCurrency},numberRule:function(){return[function(t){return null!=t&&""!==t||"Field is required"},function(t){return/^(\d+(\.\d{1,2})?)|(0(\.\d{1,2})?)$/.test(t)||"Rate must be a number with up to 2 decimal places"}]},grandTotal:function(){return this.transaction.lines.reduce((function(t,n){return t+n.total}),0)-Object(R.h)(this.transaction.discount,",","")}}),data:function(){return{cancelConfirmDialog:!1,productPricingSelected:null,pricingDialogKey:1,pricingDialog:!1,search:"",numberCommaRule:function(t){return/^[0-9,]*$/.test(t)||"Only numbers and commas are allowed"},headerError:!1,customerDialog:!1,validateErrorMessage:"",sheet:!1,errorLineNumber:null,onlineCustomerId:null,isloading:!1,transaction:{isActive:!0,exchangeRate:1,lines:[]},headers:[{text:"#",align:"start",value:""},{text:"ສິນຄ້າ",align:"start",value:"product.pro_name"},{text:"ຈຳນວນ",align:"end",value:"quantity"},{text:"ຫົວຫນ່ວຍ",align:"end",value:"unitId",sortable:!0},{text:"unit rate",align:"end",value:"unitRate",sortable:!0},{text:"ລາຄາ",align:"end",value:"price",sortable:!0},{text:"ສ່ວນຫລຸດ",align:"end",value:"discount",sortable:!0},{text:"ລວມ",align:"end",value:"total",sortable:!1},{text:"delete",align:"end",value:"id",sortable:!1}]}}},F=e(32),component=Object(F.a)(P,(function(){var t=this,n=t._self._c;return n("div",[n(v.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.isloading,callback:function(n){t.isloading=n},expression:"isloading"}},[n("loading-indicator")],1),t._v(" "),n(v.a,{attrs:{"max-width":"1024"},model:{value:t.customerDialog,callback:function(n){t.customerDialog=n},expression:"customerDialog"}},[n("customer-list",{on:{"close-dialog":function(n){t.customerDialog=!1}}})],1),t._v(" "),n(v.a,{attrs:{"max-width":"1024"},model:{value:t.cancelConfirmDialog,callback:function(n){t.cancelConfirmDialog=n},expression:"cancelConfirmDialog"}},[n("cancel-ticket-form",{attrs:{id:t.headerId,customerId:t.onlineCustomerId},on:{refresh:function(n){return t.$emit("reload")},"close-dialog":function(n){t.cancelConfirmDialog=!1}}})],1),t._v(" "),n(v.a,{attrs:{"max-width":"1024"},model:{value:t.pricingDialog,callback:function(n){t.pricingDialog=n},expression:"pricingDialog"}},[n("pricing-option",{key:t.pricingDialogKey,attrs:{isBackend:!0,"record-id":t.productPricingSelected},on:{"new-price-update":t.updatePricing,"close-dialog":function(n){t.pricingDialog=!1}}})],1),t._v(" "),n(o.a,{attrs:{inset:""},model:{value:t.sheet,callback:function(n){t.sheet=n},expression:"sheet"}},[n(O.a,{staticClass:"text-center",attrs:{height:"200px"}},[n(c.a,{staticClass:"mt-6",attrs:{text:"",color:"error"},on:{click:function(n){t.sheet=!t.sheet}}},[t._v("\n                close\n            ")]),t._v(" "),n("div",{staticClass:"my-3"},[t._v("\n                "+t._s(t.validateErrorMessage)+"\n            ")])],1)],1),t._v(" "),n(l.a,[n(d.b,[n(x.a,[n(m.a,{attrs:{cols:"6"}}),t._v(" "),n(m.a,{staticStyle:{"text-align":"right"},attrs:{cols:"6"}},[t.isQuotation?n(c.a,{staticClass:"primary",attrs:{size:"large",variant:"outlined",rounded:""},on:{click:t.postToInvoice}},[n("span",{staticClass:"mdi mdi-cancel"}),t._v("Make to invoice\n                    ")]):t._e(),t._v(" "),n(c.a,{staticClass:"warning",attrs:{disabled:!t.isUpdate||!t.transaction.isActive,size:"large",variant:"outlined",rounded:""},on:{click:t.cancelOrder}},[n("span",{staticClass:"mdi mdi-printer-outline"}),t._v("ຍົກເລີກບິນ\n                    ")]),t._v(" "),n(c.a,{staticClass:"primary",attrs:{size:"large",variant:"outlined",rounded:""},on:{click:t.quotationPreview}},[n("span",{staticClass:"mdi mdi-printer-outline"}),t._v("Print\n                    ")])],1)],1)],1),t._v(" "),n(y.a),t._v(" "),n(d.c,{staticClass:"pa-1"},[n(l.a,{staticClass:"pa-1",style:t.headerError?"outline:1px solid red":""},[t._v("\n                "+t._s(t.isQuotation?"Quotation #":"Invoice #")+"\n                "+t._s(t.transaction.id)+"\n                "),n(d.c,[n("div",[n(x.a,[n(m.a,{attrs:{cols:"4"}},[n(x.a,[n(m.a,{attrs:{cols:"12"}},[n(k.a,{attrs:{type:"date",label:"ວັນທີ*",hint:"ເດຶອນ/ວັນ/ປີ 12/31/2023"},model:{value:t.transaction.bookingDate,callback:function(n){t.$set(t.transaction,"bookingDate",n)},expression:"transaction.bookingDate"}})],1),t._v(" "),n(m.a,{attrs:{cols:"12"}},[n(r.a,{attrs:{"item-text":"payment_code","item-value":"id",items:t.paymentList,label:"ການຊຳລະ*"},model:{value:t.transaction.paymentId,callback:function(n){t.$set(t.transaction,"paymentId",n)},expression:"transaction.paymentId"}})],1),t._v(" "),n(m.a,{attrs:{cols:"12"}},[n(k.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"ສ່ວນຫລຸດ*",required:""},model:{value:t.transaction.discount,callback:function(n){t.$set(t.transaction,"discount",n)},expression:"transaction.discount"}})],1),t._v(" "),n(m.a,{attrs:{cols:"12"}},[n(k.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"Q-ReferenceNo",disabled:""},model:{value:t.transaction.referenceNo,callback:function(n){t.$set(t.transaction,"referenceNo",n)},expression:"transaction.referenceNo"}})],1)],1)],1),t._v(" "),n(m.a,{attrs:{cols:"4"}},[n(x.a,[n(m.a,{attrs:{cols:"12"}},[n(r.a,{attrs:{"item-text":"company","item-value":"id",items:t.clientList,label:"ລູກຄ້າ*"},model:{value:t.transaction.clientId,callback:function(n){t.$set(t.transaction,"clientId",n)},expression:"transaction.clientId"}})],1),t._v(" "),n(m.a,{attrs:{cols:"12"}},[n(r.a,{attrs:{"item-text":"code","item-value":"id",items:t.currencyList,label:"ສະກຸນເງິນ*"},on:{input:t.currencyChange},model:{value:t.transaction.currencyId,callback:function(n){t.$set(t.transaction,"currencyId",n)},expression:"transaction.currencyId"}})],1),t._v(" "),n(m.a,{attrs:{cols:"12"}},[t._v("ອັດຕາແລກປ່ຽນ: "+t._s(t.getFormatNum(t.transaction.exchangeRate)))])],1)],1),t._v(" "),n(m.a,{staticStyle:{"text-align":"end"},attrs:{cols:"4"}},[n(x.a,[n(m.a,{attrs:{cols:"12"}},[n(I.a,{attrs:{label:"Notes"},model:{value:t.transaction.remark,callback:function(n){t.$set(t.transaction,"remark",n)},expression:"transaction.remark"}})],1),t._v(" "),t.transaction.user?n(m.a,{attrs:{cols:"12"}},[t._v("ຜູ້ລົງ: "+t._s(t.transaction.user.cus_id)+"\n                                    ")]):t._e(),t._v(" "),t.transaction.user?n(m.a,{attrs:{cols:"12"}},[t._v("ຊື່: "+t._s(t.transaction.user.cus_name))]):t._e(),t._v(" "),n(m.a,{attrs:{cols:"12"}},[n(k.a,{attrs:{disabled:""},scopedSlots:t._u([{key:"label",fn:function(){return[n("span",{staticStyle:{color:"black","font-weight":"bold"}},[t._v(t._s("Total Amount:\n                                                    ".concat(t.getFormatNum(t.grandTotal))))])]},proxy:!0}])})],1)],1)],1)],1)],1)])],1),t._v(" "),n(y.a),t._v(" "),t.transaction.lines?n(h.a,{attrs:{headers:t.headers,search:t.search,items:t.transaction.lines},scopedSlots:t._u([{key:"item",fn:function(e){var o=e.item;return[n("tr",{style:t.errorLineNumber==t.transaction.lines.indexOf(o)?"outline: 1px solid red":""},[n("td",{class:t.errorLineNumber==t.transaction.lines.indexOf(o)?"error":""},[t._v("\n                            "+t._s(t.transaction.lines.indexOf(o)+1)+"\n                        ")]),t._v(" "),n("td",[n(r.a,{attrs:{"item-text":"pro_name","item-value":"id",items:t.productList,label:"ສິນຄ້າ*"},on:{input:function(n){return t.productChange(o)}},model:{value:o.productId,callback:function(n){t.$set(o,"productId",n)},expression:"item.productId"}})],1),t._v(" "),n("td",[n(k.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"ຈຳນວນ",rules:[t.numberCommaRule]},on:{input:function(n){return t.quantityChange(o)}},model:{value:o.quantity,callback:function(n){t.$set(o,"quantity",n)},expression:"item.quantity"}})],1),t._v(" "),n("td",[n(r.a,{attrs:{"item-text":"name","item-value":"id",items:t.unitList,label:"ຫົວຫນ່ວຍ*"},on:{input:function(n){return t.unitChange(o)}},model:{value:o.unitId,callback:function(n){t.$set(o,"unitId",n)},expression:"item.unitId"}})],1),t._v(" "),n("td",[n(k.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"ຈນ ຕໍ່ ຫົວຫນ່ວຍ",rules:[t.numberCommaRule]},on:{input:function(n){return t.unitRateChange(o)}},model:{value:o.unitRate,callback:function(n){t.$set(o,"unitRate",n)},expression:"item.unitRate"}})],1),t._v(" "),n("td",{staticStyle:{"text-align":"right"}},[n(f.a,{staticClass:"ml-0",attrs:{color:"warning",variant:"outlined"},on:{click:function(n){return t.pricingLogig(o)}}},[t._v("\n                                "+t._s(t.getFormatNum(o.price))+"\n                            ")])],1),t._v(" "),n("td",[n(k.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{rules:[t.numberCommaRule],label:"ສ່ວນຫລຸດ"},on:{input:function(n){return t.discountChange(o)}},model:{value:o.discount,callback:function(n){t.$set(o,"discount",n)},expression:"item.discount"}})],1),t._v(" "),n("td",{staticStyle:{"text-align":"right"}},[t._v("\n                            "+t._s(t.getFormatNum(o.total))+"\n                        ")]),t._v(" "),n("td",[n(c.a,{attrs:{disabled:!t.transaction.isActive||!t.updateAllow,color:"error",text:""},on:{click:function(n){return t.deleteItem(o)},keydown:t.handleKeyDown}},[n("i",{staticClass:"fas fa-trash"})])],1)])]}}],null,!1,3233647892)}):t._e(),t._v(" "),0==t.transaction.lines.length?n("tr",[n("td",[n(c.a,{staticClass:"primary",attrs:{size:"large",variant:"outlined",rounded:""},on:{click:t.newRow}},[n("span",{staticClass:"mdi mdi-plus"})])],1)]):t._e()],1),t._v(" "),n(d.a,[n(_.a),t._v(" "),n(c.a,{attrs:{color:"warning",rounded:"",variant:"text"},on:{click:t.toggleDialog}},[t._v("\n                Close\n            ")]),t._v(" "),n(c.a,{attrs:{disabled:!t.transaction.isActive||!t.updateAllow,color:"primary",rounded:"",variant:"text"},on:{click:t.postTransaction}},[t._v("\n                Save\n            ")])],1)],1)],1)}),[],!1,null,null,null);n.default=component.exports;installComponents(component,{LoadingIndicator:e(248).default,CustomerList:e(268).default,CancelTicketForm:e(815).default,PricingOption:e(253).default})},815:function(t,n,e){"use strict";e.r(n);var r=e(316),o=e(313),c=e(18),l=e(754),d=e(781),f=e(777),m=e(113),h=e(20),v=(e(92),e(22),e(5),e(68),e(36)),y={props:{id:{type:Number,require:!1},customerId:{type:Number,require:!1,default:null}},data:function(){return{isLoading:!1,form:{isActive:!1,remark:"",cancel_fee:0},nameRules:[function(t){return!!t||"ກະລຸນາ ໃສ່ເຫດຜົນ"},function(t){return t.toString().length<=100||"Reason must be less than 100 characters"}]}},computed:{user:function(){return this.$auth.user||""}},methods:{submitForm:function(){var t=this;return Object(h.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.$refs.myform.validate()||t.isLoading){n.next=17;break}return t.isLoading=!0,n.prev=2,t.form.customerId=t.customerId,console.log("".concat(JSON.stringify(t.form))),n.next=7,t.$axios.put("api/sale/reverse/".concat(t.id),t.form);case 7:(n.sent.status=200)&&(t.refreshData(),Object(v.k)(t.$swal,"Succeed","ດຳເນີນການສຳເລັດ")),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(2),Object(v.j)(t.$swal,"Error","Something went wrong "+n.t0);case 14:t.isLoading=!1,n.next=18;break;case 17:return n.abrupt("return");case 18:t.isLoading=!1;case 19:case"end":return n.stop()}}),n,null,[[2,11]])})))()},refreshData:function(){this.$emit("reload-data")}}},x=e(32),component=Object(x.a)(y,(function(){var t=this,n=t._self._c;return n("div",[n(l.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.isLoading,callback:function(n){t.isLoading=n},expression:"isLoading"}},[n("loading-indicator")],1),t._v(" "),n(o.a,{staticClass:"pa-4"},[t._v("\n        ຍົກເລີກບິນ\n        "),n(d.a,{ref:"myform",on:{submit:function(n){return n.preventDefault(),t.submitForm.apply(null,arguments)}}},[n(m.a,{attrs:{disabled:"",label:"ເລກທີອໍເດີ "},model:{value:t.id,callback:function(n){t.id=n},expression:"id"}}),t._v(" "),n(m.a,{attrs:{label:"ເຫດຜົນການຍົກເລີກ",rules:t.nameRules},model:{value:t.form.remark,callback:function(n){t.$set(t.form,"remark",n)},expression:"form.remark"}}),t._v(" "),n(m.a,{attrs:{label:"ຄ່າທຳນຽມ"},model:{value:t.form.cancel_fee,callback:function(n){t.$set(t.form,"cancel_fee",n)},expression:"form.cancel_fee"}})],1),t._v(" "),n(c.a,[n(f.a),t._v(" "),n(r.a,{staticClass:"warning",attrs:{text:"",rounded:""},on:{click:function(n){return t.$emit("close-dialog")}}},[t._v("\n                ປິດ\n            ")]),t._v(" "),n(r.a,{staticClass:"primary",attrs:{text:"",rounded:""},on:{click:t.submitForm}},[t._v("\n                ຢືນຢັນ\n            ")])],1)],1)],1)}),[],!1,null,null,null);n.default=component.exports;installComponents(component,{LoadingIndicator:e(248).default})},820:function(t,n,e){"use strict";e(35),e(85);n.a={bind:function(t,n,e){t.addEventListener("input",(function(t){var n=t.target.value.replace(/[^0-9]/g,"");"NaN"===(n=parseInt(n,10).toLocaleString("en-US"))&&(n="0"),e.componentInstance.$emit("input",n)}))}}}}]);