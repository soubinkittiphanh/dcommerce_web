(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{1243:function(t,e,n){var content=n(1527);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("d43801e8",content,!0,{sourceMap:!1})},1526:function(t,e,n){"use strict";n(1243)},1527:function(t,e,n){var r=n(15)((function(i){return i[1]}));r.push([t.i,".settlement-id[data-v-723a8a9c]{color:#333;font-family:monospace;font-weight:600}.ap-settlement-container[data-v-723a8a9c]{margin:0 auto;max-width:1400px;padding:20px}.header-section[data-v-723a8a9c]{align-items:center;display:flex;justify-content:space-between;margin-bottom:30px}.header-actions[data-v-723a8a9c]{align-items:center;display:flex;gap:12px}.page-title[data-v-723a8a9c]{color:#333;font-size:28px;font-weight:600;margin:0}.summary-cards[data-v-723a8a9c]{grid-gap:20px;display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:30px}.summary-card[data-v-723a8a9c]{border:1px solid #e3e6f0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}.card-body[data-v-723a8a9c]{padding:20px;text-align:center}.card-title[data-v-723a8a9c]{color:#666;font-size:14px;font-weight:600;margin-bottom:10px;text-transform:uppercase}.card-value[data-v-723a8a9c]{color:#333;font-size:24px;font-weight:700;margin:0}.card-value.pending[data-v-723a8a9c]{color:#f39c12}.card-value.approved[data-v-723a8a9c]{color:#27ae60}.card-value.completed[data-v-723a8a9c]{color:#3498db}.card-value.cancelled[data-v-723a8a9c]{color:#e74c3c}.card-value.allocated[data-v-723a8a9c]{color:#9b59b6}.filters-section[data-v-723a8a9c]{background:#f8f9fa;border-radius:8px;margin-bottom:20px;padding:20px}.row[data-v-723a8a9c]{display:flex;flex-wrap:wrap;margin:-10px}.col-md-1[data-v-723a8a9c]{flex:0 0 8.333%;max-width:8.333%;padding:10px}.col-md-2[data-v-723a8a9c]{flex:0 0 16.666%;max-width:16.666%;padding:10px}.col-md-3[data-v-723a8a9c]{flex:0 0 25%;max-width:25%;padding:10px}.col-md-6[data-v-723a8a9c]{flex:0 0 50%;max-width:50%;padding:10px}.form-control[data-v-723a8a9c]{border:1px solid #ddd;border-radius:4px;font-size:14px;padding:8px 12px;width:100%}.btn[data-v-723a8a9c]{align-items:center;border:none;border-radius:4px;cursor:pointer;display:inline-flex;font-size:14px;gap:8px;padding:8px 16px;transition:all .2s ease}.btn-primary[data-v-723a8a9c]{background:#007bff;color:#fff}.btn-secondary[data-v-723a8a9c]{background:#6c757d;color:#fff}.btn-info[data-v-723a8a9c]{background:#17a2b8;color:#fff}.btn-block[data-v-723a8a9c]{justify-content:center;width:100%}.btn[data-v-723a8a9c]:hover{opacity:.9;transform:translateY(-1px)}.table-container[data-v-723a8a9c]{background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);overflow:hidden;position:relative}.loading-overlay[data-v-723a8a9c]{align-items:center;background:hsla(0,0%,100%,.8);bottom:0;display:flex;justify-content:center;left:0;position:absolute;right:0;top:0;z-index:10}.spinner[data-v-723a8a9c]{animation:spin-723a8a9c 1s linear infinite;border:4px solid #f3f3f3;border-radius:50%;border-top-color:#3498db;height:40px;width:40px}@keyframes spin-723a8a9c{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.table[data-v-723a8a9c]{border-collapse:collapse;margin:0;width:100%}.table th[data-v-723a8a9c]{background:#f8f9fa;border-bottom:2px solid #dee2e6;font-weight:600;white-space:nowrap}.table td[data-v-723a8a9c],.table th[data-v-723a8a9c]{font-size:13px;padding:15px 10px}.table td[data-v-723a8a9c]{border-top:1px solid #dee2e6;vertical-align:middle}.table-striped tbody tr[data-v-723a8a9c]:nth-of-type(odd){background-color:rgba(0,0,0,.05)}.amount[data-v-723a8a9c]{color:#333;font-weight:600}.status-badge[data-v-723a8a9c]{align-items:center;border:1px solid transparent;border-radius:20px;display:inline-flex;font-size:12px;font-weight:600;gap:6px;padding:6px 12px;text-transform:uppercase}.status-badge.draft[data-v-723a8a9c]{background:#f8f9fa;border-color:#dee2e6;color:#6c757d}.status-badge.pending[data-v-723a8a9c]{background:#fff3cd;border-color:#ffeaa7;color:#856404}.status-badge.approved[data-v-723a8a9c]{background:#d4edda;border-color:#c3e6cb;color:#155724}.status-badge.completed[data-v-723a8a9c]{background:#d1ecf1;border-color:#bee5eb;color:#0c5460}.status-badge.cancelled[data-v-723a8a9c]{background:#f8d7da;border-color:#f5c6cb;color:#721c24}.action-buttons[data-v-723a8a9c]{flex-wrap:wrap;gap:4px}.action-buttons[data-v-723a8a9c],.btn-sm[data-v-723a8a9c]{display:flex;justify-content:center}.btn-sm[data-v-723a8a9c]{align-items:center;border:none;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);cursor:pointer;font-size:11px;height:28px;padding:0;transition:all .2s ease;width:28px}.btn-sm[data-v-723a8a9c]:hover{box-shadow:0 4px 8px rgba(0,0,0,.15);transform:translateY(-2px)}.btn-sm.btn-info[data-v-723a8a9c]{background:#17a2b8;color:#fff}.btn-sm.btn-warning[data-v-723a8a9c]{background:#ffc107;color:#212529}.btn-sm.btn-success[data-v-723a8a9c]{background:#28a745;color:#fff}.btn-sm.btn-primary[data-v-723a8a9c]{background:#007bff;color:#fff}.btn-sm.btn-dark[data-v-723a8a9c]{background:#343a40;color:#fff}.no-data[data-v-723a8a9c]{color:#666;padding:60px 20px;text-align:center}.no-data i[data-v-723a8a9c]{font-size:48px;margin-bottom:15px;opacity:.5}.pagination-nav[data-v-723a8a9c]{display:flex;justify-content:center;margin-top:20px}.pagination[data-v-723a8a9c]{display:flex;list-style:none;margin:0;padding:0}.page-item[data-v-723a8a9c]{margin:0 2px}.page-link[data-v-723a8a9c]{background:#fff;border:1px solid #dee2e6;color:#007bff;cursor:pointer;padding:8px 12px;-webkit-text-decoration:none;text-decoration:none}.page-link[data-v-723a8a9c]:hover{background:#e9ecef}.page-item.active .page-link[data-v-723a8a9c]{background:#007bff;border-color:#007bff;color:#fff}.page-item.disabled .page-link[data-v-723a8a9c]{background:#fff;color:#6c757d;cursor:not-allowed}.modal-overlay[data-v-723a8a9c]{align-items:center;background-color:rgba(0,0,0,.6);display:flex;height:100%;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:1050}.detail-modal[data-v-723a8a9c],.outstanding-modal[data-v-723a8a9c]{background:#fff;border-radius:8px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;max-height:80vh;overflow:hidden;width:100%}.detail-modal[data-v-723a8a9c]{max-width:600px}.outstanding-modal[data-v-723a8a9c]{max-width:900px}.modal-header[data-v-723a8a9c]{align-items:center;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;padding:20px}.modal-header h4[data-v-723a8a9c]{color:#333;margin:0}.close-btn[data-v-723a8a9c]{background:none;border:none;color:#666;cursor:pointer;font-size:18px;padding:5px}.close-btn[data-v-723a8a9c]:hover{color:#333}.modal-body[data-v-723a8a9c]{flex:1;overflow-y:auto;padding:20px}.loading-state[data-v-723a8a9c]{align-items:center;color:#666;justify-content:center;padding:40px}.detail-content[data-v-723a8a9c],.loading-state[data-v-723a8a9c]{display:flex;flex-direction:column}.detail-content[data-v-723a8a9c]{gap:15px}.detail-row[data-v-723a8a9c]{align-items:flex-start;border-bottom:1px solid #f0f0f0;display:flex;padding:10px 0}.detail-row[data-v-723a8a9c]:last-child{border-bottom:none}.detail-row label[data-v-723a8a9c]{color:#333;font-size:14px;font-weight:600;margin-right:15px;min-width:140px}.detail-row span[data-v-723a8a9c]{color:#666;flex:1;font-size:14px}.allocations-section[data-v-723a8a9c]{border-top:2px solid #e9ecef;margin-top:20px;padding-top:20px}.allocations-section h5[data-v-723a8a9c]{color:#333;margin-bottom:15px}.outstanding-filters[data-v-723a8a9c]{background:#f8f9fa;border-radius:6px;margin-bottom:20px;padding:15px}.outstanding-table[data-v-723a8a9c]{max-height:400px;overflow-y:auto}.table-sm td[data-v-723a8a9c],.table-sm th[data-v-723a8a9c]{font-size:12px;padding:8px}@media (max-width:768px){.summary-cards[data-v-723a8a9c]{grid-template-columns:repeat(2,1fr)}.table-container[data-v-723a8a9c]{overflow-x:auto}.table[data-v-723a8a9c]{min-width:900px}.row[data-v-723a8a9c]{flex-direction:column}.col-md-1[data-v-723a8a9c],.col-md-2[data-v-723a8a9c],.col-md-3[data-v-723a8a9c],.col-md-6[data-v-723a8a9c]{flex:1;margin-bottom:10px;max-width:100%}.detail-row[data-v-723a8a9c]{flex-direction:column;gap:5px}.detail-row label[data-v-723a8a9c]{margin-right:0;min-width:auto}}@media (max-width:480px){.summary-cards[data-v-723a8a9c]{grid-template-columns:1fr}.header-section[data-v-723a8a9c]{flex-direction:column;gap:15px;text-align:center}.action-buttons[data-v-723a8a9c]{justify-content:center}}",""]),r.locals={},t.exports=r},1751:function(t,e,n){"use strict";n.r(e);n(44),n(9),n(5),n(7),n(67),n(39),n(34),n(10),n(11),n(8),n(12);var r=n(33),o=n(3),c=n(20),l=(n(54),n(53),n(35),n(131),n(51),n(63),n(30),n(92),n(1632)),d=n(36);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function f(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var m={name:"SettlementManagement",components:{SettlementDialog:l.default},data:function(){return{statusFilter:"",statusLabels:{draft:"ຮ່າງ",pending:"ຄ້າງອະນຸມັດ",approved:"ອະນຸມັດແລ້ວ",completed:"ສຳເລັດແລ້ວ",cancelled:"ຍົກເລີກ"},settlements:[],vendors:[],outstandingInvoices:[],filteredOutstandingInvoices:[],dashboard:null,pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10},filters:{status:"",startDate:"",endDate:""},outstandingFilters:{vendorId:""},searchTerm:"",outstandingSearch:"",loading:!1,detailLoading:!1,outstandingLoading:!1,showDialog:!1,showDetailModal:!1,showOutstandingModal:!1,selectedSettlement:null,settlementDetails:null,searchTimeout:null}},computed:{user:function(){return this.$auth.user||""},safeDashboard:function(){var t,e;return{counts:(null===(t=this.dashboard)||void 0===t?void 0:t.counts)||{total:0,draft:0,pending:0,approved:0,completed:0,cancelled:0},amounts:(null===(e=this.dashboard)||void 0===e?void 0:e.amounts)||{total:0,allocated:0}}},paginationPages:function(){for(var t=[],e=Math.max(1,this.pagination.currentPage-2),n=Math.min(this.pagination.totalPages,this.pagination.currentPage+2),i=e;i<=n;i++)t.push(i);return t}},mounted:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadInitialData();case 2:case"end":return e.stop()}}),e)})))()},methods:{getStatusInLao:function(t){return t?this.statusLabels[t]||t.toUpperCase():"N/A"},getInvoiceNumber:function(t){var e,n;return(null===(e=t.invoiceLineItem)||void 0===e||null===(n=e.invoice)||void 0===n?void 0:n.invoiceNumber)||"N/A"},loadInitialData:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.fetchData(),t.fetchDashboard(),t.fetchVendors()]);case 2:case"end":return e.stop()}}),e)})))()},fetchData:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,r,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,n=f({page:t.pagination.currentPage,limit:t.pagination.itemsPerPage},t.filters),t.statusFilter&&(n.status=t.statusFilter),t.searchTerm&&(n.search=t.searchTerm),e.next=7,t.$axios.get("/api/ap-invoices-settlement",{params:n});case 7:r=e.sent,data=r.data,t.settlements=data.data.settlements,t.pagination=data.data.pagination,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),t.showToast("ເກີດຂໍ້ຜິດພາດໃນການດຶງຂໍ້ມູນການຊຳລະ","error"),console.error(e.t0);case 17:return e.prev=17,t.loading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[1,13,17,20]])})))()},fetchDashboard:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=t.settlements.length,r=t.settlements.reduce((function(t,e){return t[e.status]=(t[e.status]||0)+1,t}),{}),o=t.settlements.reduce((function(t,e){return t+parseFloat(e.baseAmount||0)}),0),t.dashboard={counts:{total:n,draft:r.draft||0,pending:r.pending||0,approved:r.approved||0,completed:r.completed||0,cancelled:r.cancelled||0},amounts:{total:o,allocated:o}}}catch(t){console.error("Error calculating dashboard:",t)}case 1:case"end":return e.stop()}}),e)})))()},fetchVendors:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/vendor/find");case 3:n=e.sent,data=n.data,t.vendors=data||[],e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error fetching vendors:",e.t0),t.vendors=[],t.showToast("ບໍ່ສາມາດດຶງຂໍ້ມູນຜູ້ຂາຍໄດ້","error");case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getOutstandingInvoices:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.outstandingLoading=!0,t.showOutstandingModal=!0,e.prev=2,n={},t.outstandingFilters.vendorId&&(n.vendorId=t.outstandingFilters.vendorId),e.next=7,t.$axios.get("/api/ap-invoices-settlement/invoices/outstanding",{params:n});case 7:o=e.sent,data=o.data,t.outstandingInvoices=data.data||[],t.filteredOutstandingInvoices=Object(r.a)(t.outstandingInvoices),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Error fetching outstanding invoices:",e.t0),t.showToast("ບໍ່ສາມາດດຶງຂໍ້ມູນໃບແຈ້ງໜີ້ຄ້າງຈ່າຍໄດ້","error"),t.outstandingInvoices=[],t.filteredOutstandingInvoices=[];case 19:return e.prev=19,t.outstandingLoading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,13,19,22]])})))()},filterOutstandingInvoices:function(){if(this.outstandingSearch){var t=this.outstandingSearch.toLowerCase();this.filteredOutstandingInvoices=this.outstandingInvoices.filter((function(e){var n,r,o;return e.invoiceNumber.toLowerCase().includes(t)||(null===(n=e.vendorInvoiceNumber)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(r=e.vendor)||void 0===r||null===(o=r.name)||void 0===o?void 0:o.toLowerCase().includes(t))}))}else this.filteredOutstandingInvoices=Object(r.a)(this.outstandingInvoices)},selectInvoiceForSettlement:function(t){this.closeOutstandingModal(),this.openDialog(null,[t])},openDialog:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.selectedSettlement=t,this.showDialog=!0,e.length>0&&this.$nextTick((function(){}))},closeDialog:function(){this.showDialog=!1,this.selectedSettlement=null},closeOutstandingModal:function(){this.showOutstandingModal=!1,this.outstandingFilters.vendorId="",this.outstandingSearch=""},viewDetails:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.selectedSettlement=t,e.showDetailModal=!0,n.prev=2,e.detailLoading=!0,n.next=6,e.$axios.get("/api/ap-invoices-settlement/".concat(t.id));case 6:r=n.sent,data=r.data,e.settlementDetails=data.data,n.next=15;break;case 11:n.prev=11,n.t0=n.catch(2),console.error("Error fetching settlement details:",n.t0),e.showToast("ບໍ່ສາມາດດຶງຂໍ້ມູນລາຍລະອຽດໄດ້","error");case 15:return n.prev=15,e.detailLoading=!1,n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[2,11,15,18]])})))()},closeDetailModal:function(){this.showDetailModal=!1,this.selectedSettlement=null,this.settlementDetails=null},saveSettlement:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var r,o,c,l,d,v,m,h;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,o={reason:t.reason||(t.id?"Updated settlement":"Created new settlement"),userId:null===(r=e.user)||void 0===r?void 0:r.id},!t.id){n.next=9;break}return n.next=5,e.$axios.put("/api/ap-invoices-settlement/".concat(t.id),f(f({},t),o));case 5:c=n.sent,e.showToast("ອັບເດດການຊຳລະສຳເລັດ","success"),n.next=14;break;case 9:return n.next=11,e.$axios.post("/api/ap-invoices-settlement",f(f({},t),o));case 11:c=n.sent,null!=(d=null===(l=c.data)||void 0===l?void 0:l.data)&&d.id?e.showToast("ສ້າງການຊຳລະສຳເລັດ: #".concat(d.id),"success"):e.showToast("ສ້າງການຊຳລະສຳເລັດ","success");case 14:return e.closeDialog(),n.next=17,e.fetchData();case 17:return n.next=19,e.fetchDashboard();case 19:n.next=26;break;case 21:n.prev=21,n.t0=n.catch(0),h=(null===(v=n.t0.response)||void 0===v||null===(m=v.data)||void 0===m?void 0:m.message)||"ເກີດຂໍ້ຜິດພາດໃນການບັນທຶກ",e.showToast(h,"error"),console.error("Save error:",n.t0);case 26:case"end":return n.stop()}}),n,null,[[0,21]])})))()},approveSettlement:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(d.i)(e.$swal,"ຢືນຢັນການອະນຸມັດ","ທ່ານແນ່ໃຈທີ່ຈະອະນຸມັດການຊຳລະ #".concat(t.id," ແມ່ນບໍ່?"),"question","ບໍ່","ຕົກລົງ");case 3:if(!n.sent.isConfirmed){n.next=12;break}return n.next=7,e.$axios.post("/api/ap-invoices-settlement/".concat(t.id,"/approve"));case 7:return e.showToast("ອະນຸມັດການຊຳລະສຳເລັດ","success"),n.next=10,e.fetchData();case 10:return n.next=12,e.fetchDashboard();case 12:n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("Error approving settlement:",n.t0),e.showToast("ເກີດຂໍ້ຜິດພາດໃນການອະນຸມັດ","error");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},completeSettlement:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(d.i)(e.$swal,"ຢືນຢັນການສຳເລັດ","ທ່ານແນ່ໃຈທີ່ຈະສຳເລັດການຊຳລະ #".concat(t.id," ແມ່ນບໍ່?"),"question","ບໍ່","ຕົກລົງ");case 3:if(!n.sent.isConfirmed){n.next=12;break}return n.next=7,e.$axios.post("/api/ap-invoices-settlement/".concat(t.id,"/complete"));case 7:return e.showToast("ສຳເລັດການຊຳລະສຳເລັດ","success"),n.next=10,e.fetchData();case 10:return n.next=12,e.fetchDashboard();case 12:n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("Error completing settlement:",n.t0),e.showToast("ເກີດຂໍ້ຜິດພາດໃນການສຳເລັດ","error");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},cancelSettlement:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(d.i)(e.$swal,"ຢືນຢັນການຍົກເລີກ","ທ່ານແນ່ໃຈທີ່ຈະຍົກເລີກການຊຳລະ #".concat(t.id," ແມ່ນບໍ່?"),"warning","ບໍ່","ຍົກເລີກ");case 3:if(!n.sent.isConfirmed){n.next=12;break}return n.next=7,e.$axios.delete("/api/ap-invoices-settlement/".concat(t.id));case 7:return e.showToast("ຍົກເລີກການຊຳລະສຳເລັດ","success"),n.next=10,e.fetchData();case 10:return n.next=12,e.fetchDashboard();case 12:n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),console.error("Error cancelling settlement:",n.t0),e.showToast("ເກີດຂໍ້ຜິດພາດໃນການຍົກເລີກ","error");case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()},onFilterChange:function(){this.filters.status=this.statusFilter,this.pagination.currentPage=1,this.fetchData(),this.fetchDashboard()},changePage:function(t){t>=1&&t<=this.pagination.totalPages&&(this.pagination.currentPage=t,this.fetchData())},resetFilters:function(){this.filters={status:"",startDate:"",endDate:""},this.searchTerm="",this.statusFilter="",this.pagination.currentPage=1,this.fetchData(),this.fetchDashboard()},debounceSearch:function(){var t=this;clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){t.pagination.currentPage=1,t.fetchData()}),500)},formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0)},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-GB"):"N/A"},showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.$toast?this.$toast[e](t):this.$notify?this.$notify({title:"error"===e?"ຂໍ້ຜິດພາດ":"ສຳເລັດ",message:t,type:"error"===e?"error":"success"}):alert("".concat(e.toUpperCase(),": ").concat(t))}}},h=m,_=(n(1526),n(32)),component=Object(_.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"ap-settlement-container"},[e("div",{staticClass:"header-section"},[e("h1",{staticClass:"page-title"},[t._v("ການຊຳລະໜີ້ (AP Settlement)")]),t._v(" "),e("div",{staticClass:"header-actions"},[e("button",{staticClass:"btn btn-primary",on:{click:function(e){return t.openDialog()}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" ເພີ່ມການຊຳລະໃໝ່\n      ")])])]),t._v(" "),e("div",{staticClass:"summary-cards"},[e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ຈຳນວນການຊຳລະທັງໝົດ")]),t._v(" "),e("p",{staticClass:"card-value"},[t._v(t._s(t.safeDashboard.counts.total))])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ຄ້າງອະນຸມັດ")]),t._v(" "),e("p",{staticClass:"card-value pending"},[t._v(t._s(t.safeDashboard.counts.pending))])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ອະນຸມັດແລ້ວ")]),t._v(" "),e("p",{staticClass:"card-value approved"},[t._v(t._s(t.safeDashboard.counts.approved))])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ສຳເລັດແລ້ວ")]),t._v(" "),e("p",{staticClass:"card-value completed"},[t._v("\n          "+t._s(t.safeDashboard.counts.completed)+"\n        ")])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ຍົກເລີກ")]),t._v(" "),e("p",{staticClass:"card-value cancelled"},[t._v("\n          "+t._s(t.safeDashboard.counts.cancelled)+"\n        ")])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ລວມຍອດທັງໝົດ")]),t._v(" "),e("p",{staticClass:"card-value"},[t._v("\n          "+t._s(t.formatCurrency(t.safeDashboard.amounts.total))+"\n        ")])])]),t._v(" "),e("div",{staticClass:"card summary-card"},[e("div",{staticClass:"card-body"},[e("h5",{staticClass:"card-title"},[t._v("ຍອດທີ່ຈັດສັນແລ້ວ")]),t._v(" "),e("p",{staticClass:"card-value allocated"},[t._v("\n          "+t._s(t.formatCurrency(t.safeDashboard.amounts.allocated))+"\n        ")])])])]),t._v(" "),e("div",{staticClass:"filters-section"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-2"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.statusFilter,expression:"statusFilter"}],staticClass:"form-control",on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.statusFilter=e.target.multiple?n:n[0]},t.onFilterChange]}},[e("option",{attrs:{value:""}},[t._v("ທຸກສະຖານະ")]),t._v(" "),e("option",{attrs:{value:"draft"}},[t._v("ຮ່າງ")]),t._v(" "),e("option",{attrs:{value:"pending"}},[t._v("ຄ້າງອະນຸມັດ")]),t._v(" "),e("option",{attrs:{value:"approved"}},[t._v("ອະນຸມັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"completed"}},[t._v("ສຳເລັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"cancelled"}},[t._v("ຍົກເລີກ")])])]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.startDate,expression:"filters.startDate"}],staticClass:"form-control",attrs:{type:"date",placeholder:"ວັນທີເລີ່ມຕົ້ນ"},domProps:{value:t.filters.startDate},on:{change:t.fetchData,input:function(e){e.target.composing||t.$set(t.filters,"startDate",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.endDate,expression:"filters.endDate"}],staticClass:"form-control",attrs:{type:"date",placeholder:"ວັນທີສິ້ນສຸດ"},domProps:{value:t.filters.endDate},on:{change:t.fetchData,input:function(e){e.target.composing||t.$set(t.filters,"endDate",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchTerm,expression:"searchTerm"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ຄົ້ນຫາເລກອ້າງອີງ..."},domProps:{value:t.searchTerm},on:{input:[function(e){e.target.composing||(t.searchTerm=e.target.value)},t.debounceSearch]}})]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("button",{staticClass:"btn btn-info btn-block",on:{click:t.getOutstandingInvoices}},[e("i",{staticClass:"fas fa-file-invoice"}),t._v(" ໃບແຈ້ງໜີ້ຄ້າງຈ່າຍ\n        ")])]),t._v(" "),e("div",{staticClass:"col-md-1"},[e("button",{staticClass:"btn btn-secondary btn-block",on:{click:t.resetFilters}},[e("i",{staticClass:"fas fa-undo"}),t._v(" ຄ່າເລີ່ມຕົ້ນ\n        ")])])])]),t._v(" "),e("div",{staticClass:"table-container"},[t.loading?e("div",{staticClass:"loading-overlay"},[e("div",{staticClass:"spinner"})]):t._e(),t._v(" "),e("table",{staticClass:"table table-striped"},[t._m(0),t._v(" "),e("tbody",t._l(t.settlements,(function(n){return e("tr",{key:n.id},[e("td",[e("div",{staticClass:"settlement-id"},[t._v("\n              #"+t._s(n.id)+"\n            ")])]),t._v(" "),e("td",[t._v(t._s(t.formatDate(n.settlementDate)))]),t._v(" "),e("td",[e("span",{staticClass:"amount"},[t._v("\n              "+t._s(t.formatCurrency(n.paymentAmount))+"\n            ")])]),t._v(" "),e("td",[e("span",{staticClass:"amount"},[t._v("\n              "+t._s(t.formatCurrency(n.baseAmount))+"\n            ")])]),t._v(" "),e("td",[e("span",{class:["status-badge",n.status||"unknown"]},[t._v("\n              "+t._s(t.getStatusInLao(n.status))+"\n            ")])]),t._v(" "),e("td",[t._v(t._s(n.reference||"N/A"))]),t._v(" "),e("td",[t._v(t._s(n.description||"N/A"))]),t._v(" "),e("td",[e("div",{staticClass:"action-buttons"},[e("button",{staticClass:"btn btn-sm btn-info",attrs:{title:"ເບິ່ງລາຍລະອຽດ"},on:{click:function(e){return t.viewDetails(n)}}},[e("i",{staticClass:"fas fa-eye"})]),t._v(" "),["draft","pending"].includes(n.status)?e("button",{staticClass:"btn btn-sm btn-warning",attrs:{title:"ແກ້ໄຂ"},on:{click:function(e){return t.openDialog(n)}}},[e("i",{staticClass:"fas fa-edit"})]):t._e(),t._v(" "),"pending"===n.status?e("button",{staticClass:"btn btn-sm btn-success",attrs:{title:"ອະນຸມັດ"},on:{click:function(e){return t.approveSettlement(n)}}},[e("i",{staticClass:"fas fa-check"})]):t._e(),t._v(" "),"approved"===n.status?e("button",{staticClass:"btn btn-sm btn-primary",attrs:{title:"ສຳເລັດ"},on:{click:function(e){return t.completeSettlement(n)}}},[e("i",{staticClass:"fas fa-check-double"})]):t._e(),t._v(" "),["draft","pending","approved"].includes(n.status)?e("button",{staticClass:"btn btn-sm btn-dark",attrs:{title:"ຍົກເລີກ"},on:{click:function(e){return t.cancelSettlement(n)}}},[e("i",{staticClass:"fas fa-times"})]):t._e()])])])})),0)]),t._v(" "),t.loading||0!==t.settlements.length?t._e():e("div",{staticClass:"no-data"},[e("i",{staticClass:"fas fa-money-check-alt"}),t._v(" "),e("p",[t._v("ບໍ່ພົບຂໍ້ມູນການຊຳລະ")])])]),t._v(" "),t.pagination.totalPages>1?e("nav",{staticClass:"pagination-nav"},[e("ul",{staticClass:"pagination"},[e("li",{staticClass:"page-item",class:{disabled:1===t.pagination.currentPage}},[e("button",{staticClass:"page-link",on:{click:function(e){return t.changePage(t.pagination.currentPage-1)}}},[t._v("\n          ກ່ອນໜ້າ\n        ")])]),t._v(" "),t._l(t.paginationPages,(function(n){return e("li",{key:n,staticClass:"page-item",class:{active:n===t.pagination.currentPage}},[e("button",{staticClass:"page-link",on:{click:function(e){return t.changePage(n)}}},[t._v("\n          "+t._s(n)+"\n        ")])])})),t._v(" "),e("li",{staticClass:"page-item",class:{disabled:t.pagination.currentPage===t.pagination.totalPages}},[e("button",{staticClass:"page-link",on:{click:function(e){return t.changePage(t.pagination.currentPage+1)}}},[t._v("\n          ຕໍ່ໄປ\n        ")])])],2)]):t._e(),t._v(" "),e("SettlementDialog",{attrs:{visible:t.showDialog,settlement:t.selectedSettlement,"outstanding-invoices":t.outstandingInvoices,user:t.user},on:{close:t.closeDialog,save:t.saveSettlement}}),t._v(" "),t.showOutstandingModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeOutstandingModal}},[e("div",{staticClass:"outstanding-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h4",[t._v("ໃບແຈ້ງໜີ້ຄ້າງຈ່າຍ")]),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeOutstandingModal}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[t.outstandingLoading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),t._v(" "),e("p",[t._v("ກຳລັງໂຫຼດ...")])]):e("div",[e("div",{staticClass:"outstanding-filters"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.outstandingFilters.vendorId,expression:"outstandingFilters.vendorId"}],staticClass:"form-control",on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.outstandingFilters,"vendorId",e.target.multiple?n:n[0])},t.getOutstandingInvoices]}},[e("option",{attrs:{value:""}},[t._v("ທຸກຜູ້ຂາຍ")]),t._v(" "),t._l(t.vendors,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                    "+t._s(n.name)+"\n                  ")])}))],2)]),t._v(" "),e("div",{staticClass:"col-md-6"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.outstandingSearch,expression:"outstandingSearch"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ຄົ້ນຫາເລກທີໃບແຈ້ງໜີ້..."},domProps:{value:t.outstandingSearch},on:{input:[function(e){e.target.composing||(t.outstandingSearch=e.target.value)},t.filterOutstandingInvoices]}})])])]),t._v(" "),e("div",{staticClass:"outstanding-table"},[e("table",{staticClass:"table table-sm"},[t._m(1),t._v(" "),e("tbody",t._l(t.filteredOutstandingInvoices,(function(n){var r;return e("tr",{key:n.id},[e("td",[t._v(t._s(n.invoiceNumber))]),t._v(" "),e("td",[t._v(t._s((null===(r=n.vendor)||void 0===r?void 0:r.name)||"N/A"))]),t._v(" "),e("td",[t._v(t._s(t.formatDate(n.dueDate)))]),t._v(" "),e("td",[t._v(t._s(t.formatCurrency(n.outstandingAmount)))]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-sm btn-primary",on:{click:function(e){return t.selectInvoiceForSettlement(n)}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" ເລືອກ\n                    ")])])])})),0)]),t._v(" "),0===t.filteredOutstandingInvoices.length?e("div",{staticClass:"no-data"},[e("p",[t._v("ບໍ່ພົບໃບແຈ້ງໜີ້ຄ້າງຈ່າຍ")])]):t._e()])])])])]):t._e(),t._v(" "),t.showDetailModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeDetailModal}},[e("div",{staticClass:"detail-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h4",[t._v("ລາຍລະອຽດການຊຳລະ")]),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeDetailModal}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[t.detailLoading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner"}),t._v(" "),e("p",[t._v("ກຳລັງໂຫຼດ...")])]):t.settlementDetails?e("div",{staticClass:"detail-content"},[e("div",{staticClass:"detail-row"},[e("label",[t._v("ID ການຊຳລະ:")]),t._v(" "),e("span",[t._v("#"+t._s(t.settlementDetails.id))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ວັນທີຊຳລະ:")]),t._v(" "),e("span",[t._v(t._s(t.formatDate(t.settlementDetails.settlementDate)))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ຈຳນວນເງິນຊຳລະ:")]),t._v(" "),e("span",[t._v(t._s(t.formatCurrency(t.settlementDetails.paymentAmount)))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ຈຳນວນເງິນພື້ນຖານ:")]),t._v(" "),e("span",[t._v(t._s(t.formatCurrency(t.settlementDetails.baseAmount)))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ສະຖານະ:")]),t._v(" "),e("span",{class:["status-badge",t.settlementDetails.status]},[t._v("\n              "+t._s(t.getStatusInLao(t.settlementDetails.status))+"\n            ")])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ອ້າງອີງ:")]),t._v(" "),e("span",[t._v(t._s(t.settlementDetails.reference||"N/A"))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ຄຳອະທິບາຍ:")]),t._v(" "),e("span",[t._v(t._s(t.settlementDetails.description||"N/A"))])]),t._v(" "),e("div",{staticClass:"detail-row"},[e("label",[t._v("ໝາຍເຫດ:")]),t._v(" "),e("span",[t._v(t._s(t.settlementDetails.note||"N/A"))])]),t._v(" "),t.settlementDetails.invoiceSettlements&&t.settlementDetails.invoiceSettlements.length>0?e("div",{staticClass:"allocations-section"},[e("h5",[t._v("ການຈັດສັນໃບແຈ້ງໜີ້")]),t._v(" "),e("table",{staticClass:"table table-sm"},[t._m(2),t._v(" "),e("tbody",t._l(t.settlementDetails.invoiceSettlements,(function(n){return e("tr",{key:n.id},[e("td",[t._v(t._s(t.getInvoiceNumber(n)))]),t._v(" "),e("td",[t._v(t._s(t.formatCurrency(n.amount)))])])})),0)])]):t._e()]):t._e()])])]):t._e()],1)}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("ID")]),t._v(" "),e("th",[t._v("ວັນທີຊຳລະ")]),t._v(" "),e("th",[t._v("ຈຳນວນເງິນຊຳລະ")]),t._v(" "),e("th",[t._v("ຈຳນວນເງິນພື້ນຖານ")]),t._v(" "),e("th",[t._v("ສະຖານະ")]),t._v(" "),e("th",[t._v("ອ້າງອີງ")]),t._v(" "),e("th",[t._v("ຄຳອະທິບາຍ")]),t._v(" "),e("th",[t._v("ຟັງຊັ່ນ")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",[t._v("ຜູ້ຂາຍ")]),t._v(" "),e("th",[t._v("ວັນທີຄົບກຳນົດ")]),t._v(" "),e("th",[t._v("ຍອດຄ້າງຈ່າຍ")]),t._v(" "),e("th",[t._v("ເລືອກ")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",[t._v("ຈຳນວນທີ່ຈັດສັນ")])])])}],!1,null,"723a8a9c",null);e.default=component.exports}}]);