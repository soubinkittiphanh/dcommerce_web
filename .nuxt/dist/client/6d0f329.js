(window.webpackJsonp=window.webpackJsonp||[]).push([[15,49],{1261:function(t,e,o){var content=o(1558);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("6c4b4926",content,!0,{sourceMap:!1})},1340:function(t,e,o){"use strict";o.r(e);o(44),o(9),o(5),o(35),o(63),o(7),o(67),o(10),o(12),o(8),o(13);var n=o(3),r=o(20);o(92),o(22),o(250);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function c(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var l={name:"AuditLogViewer",props:{invoiceId:{type:[Number,String],default:null},autoLoad:{type:Boolean,default:!0},showFilters:{type:Boolean,default:!0}},emits:["logs-loaded"],data:function(){return{loading:!1,auditLogs:[],expandedId:null,filters:{dateFrom:"",dateTo:"",action:""},pagination:{page:1,limit:10,total:0,pages:0}}},mounted:function(){this.autoLoad&&this.loadAuditLogs()},watch:{invoiceId:function(){this.autoLoad&&this.loadAuditLogs()}},methods:{loadAuditLogs:function(){var t=arguments,e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var n,r,d;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:1,e.loading=!0,o.prev=2,o.next=5,e.$axios.get("/api/ap-invoices/audit/".concat(e.invoiceId),{params:c({page:n,limit:e.pagination.limit},e.filters)});case 5:(r=o.sent).data.success&&(e.auditLogs=e.processAuditLogs(r.data.data),e.pagination=r.data.pagination||{page:1,limit:10,total:e.auditLogs.length,pages:Math.ceil(e.auditLogs.length/10)},e.$emit("logs-loaded",e.auditLogs)),o.next=13;break;case 9:o.prev=9,o.t0=o.catch(2),console.error("Error loading audit logs:",o.t0),null===(d=e.$toast)||void 0===d||d.error("Failed to load audit logs");case 13:return o.prev=13,e.loading=!1,o.finish(13);case 16:case"end":return o.stop()}}),o,null,[[2,9,13,16]])})))()},processAuditLogs:function(t){return t.map((function(t){if("string"==typeof t.recordData)try{t.recordData=JSON.parse(t.recordData)}catch(t){console.warn("Failed to parse recordData:",t)}return t})).sort((function(a,b){return new Date(b.auditDate)-new Date(a.auditDate)}))},toggleExpand:function(t){this.expandedId=this.expandedId===t?null:t},changePage:function(t){t>=1&&t<=this.pagination.pages&&this.loadAuditLogs(t)},clearFilters:function(){this.filters={dateFrom:"",dateTo:"",action:""},this.loadAuditLogs()},showAmountChange:function(t,e){var o,n;if("UPDATE"!==t.action||e===this.auditLogs.length-1)return!1;var r=this.auditLogs[e+1];return!!(r&&null!==(o=r.recordData)&&void 0!==o&&o.totalAmount&&null!==(n=t.recordData)&&void 0!==n&&n.totalAmount)&&r.recordData.totalAmount!==t.recordData.totalAmount},getAmountChange:function(t,e){var o,n,r=this.auditLogs[e+1],d=((null===(o=t.recordData)||void 0===o?void 0:o.totalAmount)||0)-((null==r||null===(n=r.recordData)||void 0===n?void 0:n.totalAmount)||0);return d>0?"+".concat(this.formatCurrency(d)):d<0?"-".concat(this.formatCurrency(Math.abs(d))):""},getActionIcon:function(t){return{CREATE:"fas fa-plus",UPDATE:"fas fa-edit",DELETE:"fas fa-trash",APPROVE:"fas fa-check",REJECT:"fas fa-times"}[t]||"fas fa-circle"},getActionText:function(t){return{CREATE:"Created",UPDATE:"Updated",DELETE:"Deleted",APPROVE:"Approved",REJECT:"Rejected"}[t]||t},getStatusText:function(t){return{draft:"Draft",pending:"Pending",approved:"Approved",rejected:"Rejected",paid:"Paid",cancelled:"Cancelled"}[t]||t},getUserName:function(t){var e,o,n;return(null===(e=t.recordData)||void 0===e||null===(o=e.maker)||void 0===o?void 0:o.cus_name)||(null===(n=t.user)||void 0===n?void 0:n.name)||"Unknown"},formatTime:function(t){if(!t)return"-";var e=new Date,o=new Date(t);return Math.abs(e-o)/36e5<24?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString("en-US",{month:"short",day:"numeric"})},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-US"):"-"},formatCurrency:function(t){return t?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t):"-"}}},f=l,v=(o(994),o(32)),component=Object(v.a)(f,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"audit-log-viewer"},[t.showFilters?e("div",{staticClass:"filters"},[e("div",{staticClass:"filter-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.dateFrom,expression:"filters.dateFrom"}],staticClass:"filter-input",attrs:{type:"date",placeholder:"From date"},domProps:{value:t.filters.dateFrom},on:{input:function(e){e.target.composing||t.$set(t.filters,"dateFrom",e.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filters.dateTo,expression:"filters.dateTo"}],staticClass:"filter-input",attrs:{type:"date",placeholder:"To date"},domProps:{value:t.filters.dateTo},on:{input:function(e){e.target.composing||t.$set(t.filters,"dateTo",e.target.value)}}}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filters.action,expression:"filters.action"}],staticClass:"filter-input",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.filters,"action",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("All Actions")]),t._v(" "),e("option",{attrs:{value:"CREATE"}},[t._v("Created")]),t._v(" "),e("option",{attrs:{value:"UPDATE"}},[t._v("Updated")]),t._v(" "),e("option",{attrs:{value:"DELETE"}},[t._v("Deleted")]),t._v(" "),e("option",{attrs:{value:"APPROVE"}},[t._v("Approved")]),t._v(" "),e("option",{attrs:{value:"REJECT"}},[t._v("Rejected")])]),t._v(" "),e("button",{staticClass:"btn-search",on:{click:t.loadAuditLogs}},[e("i",{staticClass:"fas fa-search"})]),t._v(" "),e("button",{staticClass:"btn-clear",on:{click:t.clearFilters}},[e("i",{staticClass:"fas fa-times"})])])]):t._e(),t._v(" "),t.loading?e("div",{staticClass:"loading"},[e("i",{staticClass:"fas fa-spinner fa-spin"}),t._v("\n    Loading...\n  ")]):t.auditLogs.length>0?e("div",{staticClass:"timeline"},t._l(t.auditLogs,(function(o,n){var r,d,c,l,f,v,m,x,h,y,_,C,w;return e("div",{key:o.id,staticClass:"timeline-item",class:{expanded:t.expandedId===o.id}},[e("div",{staticClass:"timeline-dot",class:"dot-".concat(o.action.toLowerCase())},[e("i",{class:t.getActionIcon(o.action)})]),t._v(" "),e("div",{staticClass:"timeline-content",on:{click:function(e){return t.toggleExpand(o.id)}}},[e("div",{staticClass:"content-header"},[e("div",{staticClass:"action-info"},[e("span",{staticClass:"action-badge",class:"badge-".concat(o.action.toLowerCase())},[t._v("\n              "+t._s(t.getActionText(o.action))+"\n            ")]),t._v(" "),t.showAmountChange(o,n)?e("span",{staticClass:"amount-change"},[t._v("\n              "+t._s(t.getAmountChange(o,n))+"\n            ")]):t._e()]),t._v(" "),e("span",{staticClass:"timestamp"},[t._v(t._s(t.formatTime(o.auditDate)))])]),t._v(" "),e("div",{staticClass:"content-main"},[e("div",{staticClass:"user-info"},[e("i",{staticClass:"fas fa-user"}),t._v(" "),e("span",[t._v(t._s(t.getUserName(o)))])]),t._v(" "),e("div",{staticClass:"invoice-info"},[e("span",{staticClass:"invoice-number"},[t._v(t._s((null===(r=o.recordData)||void 0===r?void 0:r.invoiceNumber)||"-"))]),t._v(" "),e("span",{staticClass:"vendor-name"},[t._v(t._s((null===(d=o.recordData)||void 0===d||null===(c=d.vendor)||void 0===c?void 0:c.name)||"-"))])])]),t._v(" "),o.reason?e("div",{staticClass:"content-reason"},[e("i",{staticClass:"fas fa-comment-alt"}),t._v("\n          "+t._s(o.reason)+"\n        ")]):t._e(),t._v(" "),e("div",{staticClass:"expand-indicator"},[e("i",{staticClass:"fas",class:t.expandedId===o.id?"fa-chevron-up":"fa-chevron-down"})])]),t._v(" "),t.expandedId===o.id?e("div",{staticClass:"expanded-details"},[e("div",{staticClass:"details-grid"},[e("div",{staticClass:"detail-item"},[e("label",[t._v("Invoice #:")]),t._v(" "),e("span",[t._v(t._s((null===(l=o.recordData)||void 0===l?void 0:l.invoiceNumber)||"-"))])]),t._v(" "),e("div",{staticClass:"detail-item"},[e("label",[t._v("Vendor Invoice #:")]),t._v(" "),e("span",[t._v(t._s((null===(f=o.recordData)||void 0===f?void 0:f.vendorInvoiceNumber)||"-"))])]),t._v(" "),e("div",{staticClass:"detail-item"},[e("label",[t._v("Amount:")]),t._v(" "),e("span",{staticClass:"amount"},[t._v(t._s(t.formatCurrency(null===(v=o.recordData)||void 0===v?void 0:v.totalAmount)))])]),t._v(" "),e("div",{staticClass:"detail-item"},[e("label",[t._v("Status:")]),t._v(" "),e("span",{staticClass:"status",class:"status-".concat(null===(m=o.recordData)||void 0===m?void 0:m.status)},[t._v("\n              "+t._s(t.getStatusText(null===(x=o.recordData)||void 0===x?void 0:x.status))+"\n            ")])]),t._v(" "),e("div",{staticClass:"detail-item"},[e("label",[t._v("Due Date:")]),t._v(" "),e("span",[t._v(t._s(t.formatDate(null===(h=o.recordData)||void 0===h?void 0:h.dueDate)))])]),t._v(" "),e("div",{staticClass:"detail-item"},[e("label",[t._v("Currency:")]),t._v(" "),e("span",[t._v(t._s((null===(y=o.recordData)||void 0===y||null===(_=y.currency)||void 0===_?void 0:_.code)||"-"))])])]),t._v(" "),null!==(C=o.recordData)&&void 0!==C&&null!==(w=C.lineItems)&&void 0!==w&&w.length?e("div",{staticClass:"line-items-summary"},[e("h4",[t._v("Line Items ("+t._s(o.recordData.lineItems.length)+")")]),t._v(" "),e("div",{staticClass:"line-items"},[t._l(o.recordData.lineItems.slice(0,3),(function(o){return e("div",{key:o.id,staticClass:"line-item"},[e("span",{staticClass:"item-desc"},[t._v(t._s(o.description))]),t._v(" "),e("span",{staticClass:"item-amount"},[t._v(t._s(t.formatCurrency(o.lineTotal)))])])})),t._v(" "),o.recordData.lineItems.length>3?e("div",{staticClass:"more-items"},[t._v("\n              +"+t._s(o.recordData.lineItems.length-3)+" more items\n            ")]):t._e()],2)]):t._e()]):t._e()])})),0):e("div",{staticClass:"empty-state"},[e("i",{staticClass:"fas fa-history"}),t._v(" "),e("h3",[t._v("No audit records found")]),t._v(" "),e("p",[t._v("No changes have been recorded for this invoice yet")])]),t._v(" "),t.pagination.pages>1?e("div",{staticClass:"pagination"},[e("button",{staticClass:"page-btn",attrs:{disabled:t.pagination.page<=1},on:{click:function(e){return t.changePage(t.pagination.page-1)}}},[e("i",{staticClass:"fas fa-chevron-left"})]),t._v(" "),e("span",{staticClass:"page-info"},[t._v("\n      "+t._s(t.pagination.page)+" / "+t._s(t.pagination.pages)+"\n    ")]),t._v(" "),e("button",{staticClass:"page-btn",attrs:{disabled:t.pagination.page>=t.pagination.pages},on:{click:function(e){return t.changePage(t.pagination.page+1)}}},[e("i",{staticClass:"fas fa-chevron-right"})])]):t._e()])}),[],!1,null,"074f3214",null);e.default=component.exports},1557:function(t,e,o){"use strict";o(1261)},1558:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,".audit-dialog-overlay[data-v-36e4b772]{align-items:center;background-color:rgba(0,0,0,.6);display:flex;height:100%;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100%;z-index:1060}.audit-dialog[data-v-36e4b772]{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;max-height:95vh;max-width:1400px;overflow:hidden;width:100%}.audit-dialog-header[data-v-36e4b772]{align-items:center;background:linear-gradient(135deg,#01532b,#337555);border-bottom:1px solid #e9ecef;color:#fff;display:flex;justify-content:space-between;padding:20px}.header-info h3[data-v-36e4b772]{align-items:center;display:flex;font-size:20px;font-weight:600;gap:10px;margin:0}.invoice-subtitle[data-v-36e4b772]{font-size:14px;margin:5px 0 0;opacity:.9}.close-btn[data-v-36e4b772]{align-items:center;background:none;border:none;border-radius:50%;color:#fff;cursor:pointer;display:flex;font-size:20px;height:36px;justify-content:center;padding:8px;transition:background-color .2s;width:36px}.close-btn[data-v-36e4b772]:hover{background:hsla(0,0%,100%,.2)}.audit-dialog-body[data-v-36e4b772]{background:#f8f9fa;flex:1;min-height:0;overflow-x:hidden;overflow-y:auto;padding:0}.audit-dialog-body[data-v-36e4b772]::-webkit-scrollbar{width:8px}.audit-dialog-body[data-v-36e4b772]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.audit-dialog-body[data-v-36e4b772]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.audit-dialog-body[data-v-36e4b772]::-webkit-scrollbar-thumb:hover{background:#a1a1a1}.audit-dialog-footer[data-v-36e4b772]{background:#fff;border-top:1px solid #e9ecef;display:flex;gap:10px;justify-content:flex-end;padding:20px}.btn[data-v-36e4b772]{align-items:center;border:none;border-radius:6px;cursor:pointer;display:inline-flex;font-size:14px;font-weight:500;gap:8px;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;transition:all .2s ease}.btn-primary[data-v-36e4b772]{background:#667eea;color:#fff}.btn-primary[data-v-36e4b772]:hover{background:#5a6fd8;transform:translateY(-1px)}.btn-secondary[data-v-36e4b772]{background:#6c757d;color:#fff}.btn-secondary[data-v-36e4b772]:hover{background:#5a6268;transform:translateY(-1px)}@media (max-width:768px){.audit-dialog[data-v-36e4b772]{border-radius:0;height:100%;max-height:100vh;max-width:100%}.audit-dialog-header[data-v-36e4b772]{padding:15px}.header-info h3[data-v-36e4b772]{font-size:18px}.audit-dialog-footer[data-v-36e4b772]{flex-direction:column;padding:15px}.btn[data-v-36e4b772]{justify-content:center;width:100%}}@media (max-width:480px){.audit-dialog-overlay[data-v-36e4b772]{padding:0}.audit-dialog-header[data-v-36e4b772]{align-items:flex-start;flex-direction:column;gap:10px;position:relative}.close-btn[data-v-36e4b772]{position:absolute;right:15px;top:15px}.header-info h3[data-v-36e4b772]{font-size:16px}.invoice-subtitle[data-v-36e4b772]{font-size:12px}}",""]),n.locals={},t.exports=n},1704:function(t,e,o){"use strict";o.r(e);var n=o(33),r=o(20),d=(o(92),o(22),o(5),o(54),o(53),o(8),o(30),o(62),o(102),o(44),o(35),o(822),o(447),o(34),o(85),{name:"AuditLogDialog",components:{AuditLogViewer:o(1340).default},props:{visible:{type:Boolean,default:!1},invoiceId:{type:[Number,String],default:null},invoiceInfo:{type:Object,default:null}},emits:["close"],data:function(){return{auditLogs:[],isExporting:!1,showExportOptions:!1}},mounted:function(){document.addEventListener("click",this.handleOutsideClick)},beforeDestroy:function(){document.removeEventListener("click",this.handleOutsideClick)},methods:{handleClose:function(){this.$emit("close")},handleOverlayClick:function(){this.handleClose()},onLogsLoaded:function(t){this.auditLogs=t},hideExportOptions:function(){this.showExportOptions=!1},handleOutsideClick:function(t){var e,o=null===(e=this.$el)||void 0===e?void 0:e.querySelector(".export-dropdown");o&&!o.contains(t.target)&&(this.showExportOptions=!1)},exportAuditLog:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var o,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isExporting){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t.isExporting=!0,null===(o=t.$toast)||void 0===o||o.info("ກຳລັງສົ່ງອອກປະຫວັດການດຳເນີນງານ..."),e.prev=5,e.next=8,t.exportWithJsPDF();case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(5),console.warn("jsPDF not available, using HTML print method:",e.t0),t.exportWithPrintJS();case 14:null===(n=t.$toast)||void 0===n||n.success("ສົ່ງອອກປະຫວັດການດຳເນີນງານສຳເລັດ!"),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(2),console.error("Error exporting audit log:",e.t1),null===(r=t.$toast)||void 0===r||r.error("ບໍ່ສາມາດສົ່ງອອກປະຫວັດການດຳເນີນງານໄດ້");case 21:return e.prev=21,t.isExporting=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[2,17,21,24],[5,10]])})))()},exportWithJsPDF:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,d,c,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(o.bind(null,326));case 2:r=e.sent,d=r.jsPDF,(c=new d).setFontSize(16),c.setFont("helvetica","bold"),c.text("ປະຫວັດການດຳເນີນງານໃບແຈ້ງໜີ້",20,20),t.invoiceInfo&&(c.setFontSize(12),c.setFont("helvetica","normal"),c.text("ເລກທີໃບແຈ້ງໜີ້: ".concat(t.invoiceInfo.invoiceNumber),20,35),c.text("ເລກທີໃບແຈ້ງໜີ້ຜູ້ຂາຍ: ".concat(t.invoiceInfo.vendorInvoiceNumber),20,45),t.invoiceInfo.totalAmount&&c.text("ຍອດລວມ: ".concat(t.formatCurrency(t.invoiceInfo.totalAmount)),20,55)),c.setFontSize(10),c.text("ສ້າງເມື່ອ: ".concat((new Date).toLocaleString("lo-LA")),20,65),l=80,t.auditLogs.forEach((function(e,o){l>250&&(c.addPage(),l=20),c.setFontSize(12),c.setFont("helvetica","bold"),c.text("".concat(o+1,". ").concat(t.getActionText(e.action)),20,l),c.setFontSize(10),c.setFont("helvetica","normal"),l+=10,c.text("ຜູ້ດຳເນີນການ: ".concat(t.getUserName(e)),25,l),l+=8,c.text("ເວລາ: ".concat(t.formatDateTime(e.auditDate)),25,l),e.reason&&(l+=8,c.text("ເຫດຜົນ: ".concat(e.reason),25,l)),e.recordData&&(l+=8,c.text("ເລກທີໃບແຈ້ງໜີ້: ".concat(e.recordData.invoiceNumber||"-"),25,l),l+=8,c.text("ຍອດເງິນ: ".concat(t.formatCurrency(e.recordData.totalAmount)),25,l),l+=8,c.text("ສະຖານະ: ".concat(t.getStatusText(e.recordData.status)),25,l)),l+=15})),f="audit-log-".concat((null===(n=t.invoiceInfo)||void 0===n?void 0:n.invoiceNumber)||t.invoiceId,"-").concat((new Date).toISOString().split("T")[0],".pdf"),c.save(f);case 15:case"end":return e.stop()}}),e)})))()},exportWithPrintJS:function(){var t=this.generateHTMLContent(),e=window.open("","_blank");e.document.write(t),e.document.close(),setTimeout((function(){e.print(),e.close()}),500)},generateHTMLContent:function(){var t=this,e=this.auditLogs.map((function(e,o){return'\n        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">\n          <h4 style="margin: 0 0 10px 0; color: #333;">'.concat(o+1,". ").concat(t.getActionText(e.action),'</h4>\n          <p style="margin: 5px 0;"><strong>ຜູ້ດຳເນີນການ:</strong> ').concat(t.getUserName(e),'</p>\n          <p style="margin: 5px 0;"><strong>ເວລາ:</strong> ').concat(t.formatDateTime(e.auditDate),"</p>\n          ").concat(e.reason?'<p style="margin: 5px 0;"><strong>ເຫດຜົນ:</strong> '.concat(e.reason,"</p>"):"","\n          ").concat(e.recordData?'\n            <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px;">\n              <p style="margin: 3px 0;"><strong>ເລກທີໃບແຈ້ງໜີ້:</strong> '.concat(e.recordData.invoiceNumber||"-",'</p>\n              <p style="margin: 3px 0;"><strong>ຍອດເງິນ:</strong> ').concat(t.formatCurrency(e.recordData.totalAmount),'</p>\n              <p style="margin: 3px 0;"><strong>ສະຖານະ:</strong> ').concat(t.getStatusText(e.recordData.status),"</p>\n            </div>\n          "):"","\n        </div>\n      ")})).join("");return'\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>ປະຫວັດການດຳເນີນງານໃບແຈ້ງໜີ້</title>\n          <meta charset="UTF-8">\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; }\n            h1 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }\n            .invoice-info { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\n            .timestamp { text-align: right; color: #666; font-size: 12px; margin-bottom: 20px; }\n            @media print {\n              body { margin: 0; }\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <h1>ປະຫວັດການດຳເນີນງານໃບແຈ້ງໜີ້</h1>\n          \n          '.concat(this.invoiceInfo?'\n            <div class="invoice-info">\n              <p><strong>ເລກທີໃບແຈ້ງໜີ້:</strong> '.concat(this.invoiceInfo.invoiceNumber,"</p>\n              <p><strong>ເລກທີໃບແຈ້ງໜີ້ຜູ້ຂາຍ:</strong> ").concat(this.invoiceInfo.vendorInvoiceNumber,"</p>\n              ").concat(this.invoiceInfo.totalAmount?"<p><strong>ຍອດລວມ:</strong> ".concat(this.formatCurrency(this.invoiceInfo.totalAmount),"</p>"):"","\n            </div>\n          "):"",'\n          \n          <div class="timestamp">ສ້າງເມື່ອ: ').concat((new Date).toLocaleString("lo-LA"),'</div>\n          \n          <div class="audit-logs">\n            ').concat(e,"\n          </div>\n        </body>\n        </html>\n      ")},exportAsJSON:function(){var t=this;this.showExportOptions=!1;try{var e,o,n={invoiceInfo:this.invoiceInfo,exportDate:(new Date).toISOString(),auditLogs:this.auditLogs.map((function(e){var o,n,r,d,c,l,f,v;return{id:e.id,action:t.getActionText(e.action),user:t.getUserName(e),email:t.getUserEmail(e),timestamp:e.auditDate,reason:e.reason,invoiceData:{invoiceNumber:null===(o=e.recordData)||void 0===o?void 0:o.invoiceNumber,vendorInvoiceNumber:null===(n=e.recordData)||void 0===n?void 0:n.vendorInvoiceNumber,totalAmount:null===(r=e.recordData)||void 0===r?void 0:r.totalAmount,status:t.getStatusText(null===(d=e.recordData)||void 0===d?void 0:d.status),vendor:null===(c=e.recordData)||void 0===c||null===(l=c.vendor)||void 0===l?void 0:l.name,currency:null===(f=e.recordData)||void 0===f||null===(v=f.currency)||void 0===v?void 0:v.code}}}))},r=JSON.stringify(n,null,2),d=new Blob([r],{type:"application/json"}),c=URL.createObjectURL(d),link=document.createElement("a");link.href=c,link.download="audit-log-".concat((null===(e=this.invoiceInfo)||void 0===e?void 0:e.invoiceNumber)||this.invoiceId,"-").concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(c),null===(o=this.$toast)||void 0===o||o.success("ສົ່ງອອກ JSON ສຳເລັດ!")}catch(t){var l;console.error("Error exporting JSON:",t),null===(l=this.$toast)||void 0===l||l.error("ບໍ່ສາມາດສົ່ງອອກ JSON ໄດ້")}},exportAsCSV:function(){var t=this;this.showExportOptions=!1;try{var e,o,r=this.auditLogs.map((function(e,o){var n,r,d,c,l,f,v,m;return[o+1,t.getActionText(e.action),t.getUserName(e),t.getUserEmail(e),t.formatDateTime(e.auditDate),e.reason||"",(null===(n=e.recordData)||void 0===n?void 0:n.invoiceNumber)||"",(null===(r=e.recordData)||void 0===r?void 0:r.vendorInvoiceNumber)||"",(null===(d=e.recordData)||void 0===d?void 0:d.totalAmount)||"",t.getStatusText(null===(c=e.recordData)||void 0===c?void 0:c.status)||"",(null===(l=e.recordData)||void 0===l||null===(f=l.vendor)||void 0===f?void 0:f.name)||"",(null===(v=e.recordData)||void 0===v||null===(m=v.currency)||void 0===m?void 0:m.code)||""]})),d=[["ລຳດັບ","ການດຳເນີນງານ","ຜູ້ດຳເນີນການ","ອີເມວ","ເວລາ","ເຫດຜົນ","ເລກທີໃບແຈ້ງໜີ້","ເລກທີໃບແຈ້ງໜີ້ຜູ້ຂາຍ","ຍອດເງິນ","ສະຖານະ","ຜູ້ຂາຍ","ສະກຸນເງິນ"]].concat(Object(n.a)(r)).map((function(t){return t.map((function(t){return'"'.concat(String(t).replace(/"/g,'""'),'"')})).join(",")})).join("\n"),c=new Blob(["\ufeff"+d],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(c),link=document.createElement("a");link.href=l,link.download="audit-log-".concat((null===(e=this.invoiceInfo)||void 0===e?void 0:e.invoiceNumber)||this.invoiceId,"-").concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(l),null===(o=this.$toast)||void 0===o||o.success("ສົ່ງອອກ CSV ສຳເລັດ!")}catch(t){var f;console.error("Error exporting CSV:",t),null===(f=this.$toast)||void 0===f||f.error("ບໍ່ສາມາດສົ່ງອອກ CSV ໄດ້")}},getUserEmail:function(t){var e,o,n;return(null===(e=t.recordData)||void 0===e||null===(o=e.maker)||void 0===o?void 0:o.cus_email)||(null===(n=t.user)||void 0===n?void 0:n.email)||""},getActionText:function(t){return{CREATE:"ສ້າງໃບແຈ້ງໜີ້",UPDATE:"ອັບເດດໃບແຈ້ງໜີ້",DELETE:"ລຶບໃບແຈ້ງໜີ້",APPROVE:"ອະນຸມັດໃບແຈ້ງໜີ້",REJECT:"ປະຕິເສດໃບແຈ້ງໜີ້"}[t]||t},getStatusText:function(t){return{draft:"ຮ່າງ",pending:"ລໍຖ້າການອະນຸມັດ",approved:"ອະນຸມັດແລ້ວ",rejected:"ປະຕິເສດ",paid:"ຈ່າຍແລ້ວ",cancelled:"ຍົກເລີກ"}[t]||t},getUserName:function(t){var e,o,n;return(null===(e=t.recordData)||void 0===e||null===(o=e.maker)||void 0===o?void 0:o.cus_name)||(null===(n=t.user)||void 0===n?void 0:n.name)||"ບໍ່ຮູ້ຈັກ"},formatDateTime:function(t){return t?new Date(t).toLocaleString("lo-LA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"},formatCurrency:function(t){return t?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t):"-"}}}),c=(o(1557),o(32)),component=Object(c.a)(d,(function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"audit-dialog-overlay",on:{click:t.handleOverlayClick}},[e("div",{staticClass:"audit-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"audit-dialog-header"},[e("div",{staticClass:"header-info"},[t._m(0),t._v(" "),t.invoiceInfo?e("p",{staticClass:"invoice-subtitle"},[t._v("\n          ໃບແຈ້ງໜີ້: "+t._s(t.invoiceInfo.invoiceNumber)+" -\n          "+t._s(t.invoiceInfo.vendorInvoiceNumber)+"\n        ")]):t._e()]),t._v(" "),e("button",{staticClass:"close-btn",attrs:{type:"button"},on:{click:t.handleClose}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"audit-dialog-body"},[e("audit-log-viewer",{ref:"auditLogViewer",attrs:{"invoice-id":t.invoiceId,"auto-load":t.visible},on:{"logs-loaded":t.onLogsLoaded}})],1),t._v(" "),e("div",{staticClass:"audit-dialog-footer"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.handleClose.apply(null,arguments)}}},[e("i",{staticClass:"fas fa-times"}),t._v("\n        ປິດ\n      ")]),t._v(" "),e("div",{staticClass:"export-options"},[e("button",{staticClass:"btn btn-primary main-export-btn",attrs:{type:"button",disabled:t.isExporting},on:{click:t.exportAuditLog}},[t.isExporting?e("i",{staticClass:"fas fa-spinner fa-spin"}):e("i",{staticClass:"fas fa-download"}),t._v("\n          "+t._s(t.isExporting?"ກຳລັງສົ່ງອອກ...":"ສົ່ງອອກ PDF")+"\n        ")]),t._v(" "),e("div",{staticClass:"export-dropdown"},[e("button",{staticClass:"btn btn-outline-primary dropdown-toggle",attrs:{type:"button",disabled:t.isExporting},on:{click:function(e){t.showExportOptions=!t.showExportOptions}}},[e("i",{staticClass:"fas fa-caret-down"})]),t._v(" "),t.showExportOptions?e("div",{staticClass:"dropdown-menu"},[e("button",{staticClass:"dropdown-item",on:{click:t.exportAsJSON}},[e("i",{staticClass:"fas fa-code"}),t._v("\n              ສົ່ງອອກ JSON\n            ")]),t._v(" "),e("button",{staticClass:"dropdown-item",on:{click:t.exportAsCSV}},[e("i",{staticClass:"fas fa-table"}),t._v("\n              ສົ່ງອອກ CSV\n            ")]),t._v(" "),e("button",{staticClass:"dropdown-item",on:{click:t.exportWithPrintJS}},[e("i",{staticClass:"fas fa-print"}),t._v("\n              ພິມ\n            ")])]):t._e()])])])])]):t._e()}),[function(){var t=this._self._c;return t("h3",[t("i",{staticClass:"fas fa-history"}),this._v("\n          ປະຫວັດການດຳເນີນງານ\n        ")])}],!1,null,"36e4b772",null);e.default=component.exports},931:function(t,e,o){var content=o(995);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(16).default)("14cc85f4",content,!0,{sourceMap:!1})},994:function(t,e,o){"use strict";o(931)},995:function(t,e,o){var n=o(15)((function(i){return i[1]}));n.push([t.i,'.audit-log-viewer[data-v-074f3214]{background:#fafafa;display:flex;flex-direction:column;height:100%}.filters[data-v-074f3214]{background:#fff;border-bottom:1px solid #e5e5e5;padding:16px}.filter-group[data-v-074f3214]{align-items:center;display:flex;gap:8px}.filter-input[data-v-074f3214]{background:#fff;border:1px solid #ddd;border-radius:6px;font-size:14px;padding:8px 12px}.filter-input[data-v-074f3214]:focus{border-color:#007bff;outline:none}.btn-clear[data-v-074f3214],.btn-search[data-v-074f3214]{border:none;border-radius:6px;cursor:pointer;font-size:14px;padding:8px 12px}.btn-search[data-v-074f3214]{background:#007bff;color:#fff}.btn-clear[data-v-074f3214]{background:#6c757d;color:#fff}.loading[data-v-074f3214]{align-items:center;color:#666;display:flex;font-size:16px;gap:12px;justify-content:center;padding:48px}.timeline[data-v-074f3214]{flex:1;overflow-y:auto;padding:20px;position:relative}.timeline-item[data-v-074f3214]{align-items:flex-start;display:flex;gap:16px;margin-bottom:20px;position:relative}.timeline-item[data-v-074f3214]:not(:last-child):before{background:#e5e5e5;bottom:-20px;content:"";left:19px;position:absolute;top:40px;width:2px}.timeline-dot[data-v-074f3214]{align-items:center;border-radius:50%;color:#fff;display:flex;flex-shrink:0;font-size:14px;height:38px;justify-content:center;position:relative;width:38px;z-index:1}.dot-create[data-v-074f3214]{background:#28a745}.dot-update[data-v-074f3214]{background:#007bff}.dot-delete[data-v-074f3214]{background:#dc3545}.dot-approve[data-v-074f3214]{background:#28a745}.dot-reject[data-v-074f3214]{background:#dc3545}.timeline-content[data-v-074f3214]{background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);cursor:pointer;flex:1;padding:16px;position:relative;transition:all .2s ease}.timeline-content[data-v-074f3214]:hover{box-shadow:0 4px 8px rgba(0,0,0,.15);transform:translateY(-1px)}.timeline-item.expanded .timeline-content[data-v-074f3214]{border-bottom-left-radius:0;border-bottom-right-radius:0}.content-header[data-v-074f3214]{justify-content:space-between;margin-bottom:12px}.action-info[data-v-074f3214],.content-header[data-v-074f3214]{align-items:center;display:flex}.action-info[data-v-074f3214]{gap:12px}.action-badge[data-v-074f3214]{border-radius:4px;font-size:12px;font-weight:600;padding:4px 8px}.badge-create[data-v-074f3214]{background:#d4edda;color:#155724}.badge-update[data-v-074f3214]{background:#cce7ff;color:#004085}.badge-delete[data-v-074f3214]{background:#f8d7da;color:#721c24}.badge-approve[data-v-074f3214]{background:#d4edda;color:#155724}.badge-reject[data-v-074f3214]{background:#f8d7da;color:#721c24}.amount-change[data-v-074f3214]{background:#fff3cd;border-radius:4px;color:#856404;font-size:12px;font-weight:600;padding:2px 6px}.timestamp[data-v-074f3214]{color:#666;font-size:12px;font-weight:500}.content-main[data-v-074f3214]{justify-content:space-between;margin-bottom:8px}.content-main[data-v-074f3214],.user-info[data-v-074f3214]{align-items:center;display:flex}.user-info[data-v-074f3214]{color:#333;font-size:14px;font-weight:500;gap:6px}.user-info i[data-v-074f3214]{color:#666;font-size:12px}.invoice-info[data-v-074f3214]{align-items:center;display:flex;font-size:14px;gap:12px}.invoice-number[data-v-074f3214]{color:#007bff;font-weight:600}.vendor-name[data-v-074f3214]{color:#666}.content-reason[data-v-074f3214]{align-items:center;color:#666;display:flex;font-size:13px;font-style:italic;gap:6px;margin-bottom:8px}.content-reason i[data-v-074f3214]{font-size:11px}.expand-indicator[data-v-074f3214]{color:#666;font-size:12px;position:absolute;right:16px;top:16px}.expanded-details[data-v-074f3214]{background:#fff;border:1px solid #e5e5e5;border-bottom-left-radius:8px;border-bottom-right-radius:8px;border-top:none;margin-left:54px;padding:16px}.details-grid[data-v-074f3214]{grid-gap:12px;display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:16px}.detail-item[data-v-074f3214]{align-items:center;border-bottom:1px solid #f5f5f5;display:flex;justify-content:space-between;padding:8px 0}.detail-item label[data-v-074f3214]{color:#666;font-size:12px;font-weight:500}.detail-item span[data-v-074f3214]{color:#333;font-size:13px}.amount[data-v-074f3214]{color:#28a745;font-weight:600}.status[data-v-074f3214]{border-radius:4px;font-size:11px;font-weight:500;padding:2px 6px}.status-draft[data-v-074f3214]{background:#e9ecef;color:#495057}.status-pending[data-v-074f3214]{background:#fff3cd;color:#856404}.status-approved[data-v-074f3214]{background:#d4edda;color:#155724}.status-paid[data-v-074f3214]{background:#cce7ff;color:#004085}.line-items-summary h4[data-v-074f3214]{border-bottom:1px solid #e5e5e5;color:#333;font-size:14px;margin:0 0 8px;padding-bottom:4px}.line-items[data-v-074f3214]{display:flex;flex-direction:column;gap:4px}.line-item[data-v-074f3214]{align-items:center;display:flex;font-size:12px;justify-content:space-between;padding:4px 0}.item-desc[data-v-074f3214]{color:#333}.item-amount[data-v-074f3214]{color:#666;font-weight:500}.more-items[data-v-074f3214]{background:#f8f9fa;border-radius:4px;font-size:11px;padding:4px}.empty-state[data-v-074f3214],.more-items[data-v-074f3214]{color:#666;text-align:center}.empty-state[data-v-074f3214]{align-items:center;display:flex;flex-direction:column;justify-content:center;padding:48px 20px}.empty-state i[data-v-074f3214]{color:#ddd;font-size:48px;margin-bottom:16px}.empty-state h3[data-v-074f3214]{font-size:18px;margin:0 0 8px}.empty-state p[data-v-074f3214]{font-size:14px;margin:0}.pagination[data-v-074f3214]{border-top:1px solid #e5e5e5;gap:16px;padding:16px}.page-btn[data-v-074f3214],.pagination[data-v-074f3214]{align-items:center;background:#fff;display:flex;justify-content:center}.page-btn[data-v-074f3214]{border:1px solid #ddd;border-radius:6px;cursor:pointer;height:32px;transition:all .2s;width:32px}.page-btn[data-v-074f3214]:hover:not(:disabled){background:#f8f9fa;border-color:#007bff}.page-btn[data-v-074f3214]:disabled{cursor:not-allowed;opacity:.5}.page-info[data-v-074f3214]{color:#666;font-size:14px;font-weight:500}@media (max-width:768px){.timeline[data-v-074f3214]{padding:16px}.content-main[data-v-074f3214]{align-items:flex-start;flex-direction:column;gap:8px}.details-grid[data-v-074f3214]{grid-template-columns:1fr}.expanded-details[data-v-074f3214]{margin-left:0}.timeline-item[data-v-074f3214]:not(:last-child):before{display:none}.filter-group[data-v-074f3214]{flex-wrap:wrap}}',""]),n.locals={},t.exports=n}}]);