(window.webpackJsonp=window.webpackJsonp||[]).push([[53,65,147],{1005:function(t,e,n){"use strict";n(941)},1006:function(t,e,n){var r=n(14)((function(i){return i[1]}));r.push([t.i,".error-border[data-v-f09cae02]{border:2px solid #f44336!important}.error-row[data-v-f09cae02]{background-color:#ffebee!important}.error-row td[data-v-f09cae02]{border-bottom:1px solid #f44336!important}.v-data-table tbody tr[data-v-f09cae02]:hover{background-color:#f5f5f5!important}.v-card[data-v-f09cae02]{transition:box-shadow .3s ease}.v-card[data-v-f09cae02]:hover{box-shadow:0 4px 8px rgba(0,0,0,.12)!important}.v-text-field--outlined .v-input__control .v-input__slot[data-v-f09cae02]{min-height:40px}.v-autocomplete--is-dirty .v-select__selection[data-v-f09cae02]{color:rgba(0,0,0,.87)}.loading-overlay[data-v-f09cae02]{align-items:center;background:hsla(0,0%,100%,.8);bottom:0;display:flex;justify-content:center;left:0;position:absolute;right:0;top:0;z-index:1000}.v-data-table th[data-v-f09cae02]{background-color:#f8f9fa;font-weight:600}.v-data-table .v-data-table__wrapper[data-v-f09cae02]{border-radius:8px;overflow:hidden}.success--text[data-v-f09cae02]{color:#4caf50!important}.error--text[data-v-f09cae02]{color:#f44336!important}@media (max-width:768px){.v-data-table[data-v-f09cae02]{font-size:.875rem}.v-btn[data-v-f09cae02]{min-width:auto;padding:0 12px}}@media print{.v-btn[data-v-f09cae02],.v-card-actions[data-v-f09cae02]{display:none!important}.v-card[data-v-f09cae02]{border:1px solid #ddd;box-shadow:none!important}}",""]),r.locals={},t.exports=r},1352:function(t,e,n){"use strict";n.r(e);var r=n(799),o=n(836),c=n(321),l=n(318),d=n(19),f=n(322),v=n(797),m=n(806),h=n(771),x=n(317),_=n(168),k=n(29),w=n(796),y=n(91),I=n(998),A=n(794),L=n(112),E=n(828),D=(n(7),n(67),n(34),n(130),n(35),n(12),n(13),n(36)),C=n(3),S=n(17),O=(n(85),n(24),n(5),n(10),n(39),n(30),n(113),n(64),n(8),n(68),n(38),n(52),n(100),n(838),n(54),n(839),n(840),n(841),n(842),n(843),n(844),n(845),n(846),n(847),n(848),n(849),n(850),n(851),n(852),n(853),n(854),n(53),n(9),n(103),n(250),n(833),n(448),n(62),n(855)),F=n(44),N=n(37);function R(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function j(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?R(Object(source),!0).forEach((function(e){Object(C.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):R(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var T={name:"gl-form",props:{GLId:{type:Number,default:null},isUpdate:{type:Boolean,default:!1}},directives:{commaThousand:O.a},created:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.initializeForm();case 2:case"end":return e.stop()}}),e)})))()},data:function(){return{isloading:!1,customerDialog:!1,cancelConfirmDialog:!1,sheet:!1,successSnackbar:!1,successMessage:"",search:"",headerError:!1,errorLineNumber:null,validateErrorMessage:"",validationErrors:{header:{},lines:{}},accountList:[],transaction:{id:null,bookingDate:null,reference:"",description:"",vendorId:null,status:"PENDING",isActive:!0,exchangeRate:1,total:0,poHeaderId:null,locationId:null,user:null,lines:[]},headers:[{text:"#",value:"index",align:"center",sortable:!1,width:"60px"},{text:"Currency",value:"currencyId",align:"start",sortable:!1,width:"150px"},{text:"Amount",value:"amount",align:"end",sortable:!1,width:"120px"},{text:"Rate",value:"rate",align:"end",sortable:!1,width:"120px"},{text:"Debit Account",value:"drAccountId",align:"start",sortable:!1,width:"200px"},{text:"Credit Account",value:"crAccountId",align:"start",sortable:!1,width:"200px"},{text:"Description",value:"description",align:"start",sortable:!1,width:"150px"},{text:"Local Amount",value:"localAmount",align:"end",sortable:!1,width:"120px"},{text:"Actions",value:"actions",align:"center",sortable:!1,width:"80px"}],validationRules:{required:function(t){return!!t||"This field is required"},number:function(t){return!isNaN(parseFloat(t))&&isFinite(t)||"Must be a valid number"},positiveNumber:function(t){return parseFloat(t)>0||"Must be greater than 0"},date:function(t){if(!t)return"Date is required";var e=new Date(t);return!isNaN(e.getTime())||"Must be a valid date"},maxLength:function(t){return function(e){return!e||e.length<=t||"Maximum ".concat(t," characters allowed")}},numberComma:function(t){if(!t)return!0;return/^[0-9,]*$/.test(t)||"Only numbers and commas are allowed"}}}},computed:j(j({},Object(F.c)(["findAllProduct","findAllClient","findAllPayment","findAllUnit","findAllCurrency","findAllTerminal","findSelectedTerminal","findAllLocation"])),{},{currencyList:function(){return this.findAllCurrency||[]},grandTotal:function(){return this.transaction.lines.reduce((function(t,e){return t+(e.localAmount||0)}),0)},canSave:function(){return this.transaction.lines.length>0&&this.transaction.bookingDate&&!this.hasValidationErrors},hasValidationErrors:function(){var t=this,e=Object.keys(this.validationErrors.header).length>0,n=Object.keys(this.validationErrors.lines).some((function(e){return Object.keys(t.validationErrors.lines[e]).length>0}));return e||n},user:function(){return this.$auth.user||null}}),methods:{initializeForm:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.isloading=!0,e.next=4,t.loadChartOfAccount();case 4:if(n=(new Date).toISOString().substr(0,10),t.transaction.bookingDate=n,t.transaction.user=t.user,!t.isUpdate||!t.GLId){e.next=12;break}return e.next=10,t.loadTransaction();case 10:e.next=13;break;case 12:t.newRow();case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),t.showError("Failed to initialize form"),console.error("Initialization error:",e.t0);case 19:return e.prev=19,t.isloading=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,15,19,22]])})))()},loadChartOfAccount:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("api/account/findAll");case 3:n=e.sent,t.accountList=n.data,e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),t.showError("Failed to load chart of accounts"),console.error("Chart of accounts error:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadTransaction:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){var n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("api/gl/find/".concat(t.GLId));case 3:n=e.sent,data=n.data,t.transaction.bookingDate=data.bookingDate,t.transaction.reference=data.reference||"",t.transaction.description=data.description||"",t.transaction.id=data.id,data.lines&&data.lines.length>0?t.transaction.lines=data.lines.map((function(line,t){return j(j({},line),{},{tempId:"line_".concat(t,"_").concat(Date.now())})})):t.transaction.lines=[data],e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),t.showError("Failed to load transaction"),console.error("Load transaction error:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},newRow:function(){if(this.isUpdate)this.showError("Cannot add new lines in update mode");else{var t={tempId:"line_".concat(this.transaction.lines.length,"_").concat(Date.now()),postingReference:"DUMMY",bookingDate:this.transaction.bookingDate,amount:"",currencyId:null,rate:"1",drAccountId:null,crAccountId:null,description:"",localAmount:0,source:"GL",isActive:!0};this.transaction.lines.push(t),this.clearLineErrors(this.transaction.lines.length-1)}},deleteItem:function(t,e){var n=this;return Object(S.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!n.transaction.poHeaderId){r.next=4;break}return n.showError("Cannot delete lines from PO transactions"),r.abrupt("return");case 4:return r.next=6,Object(N.a)(n.$swal,"Delete Line","Are you sure you want to delete this line?");case 6:if(r.sent){r.next=9;break}return r.abrupt("return");case 9:if(!t.id){r.next=13;break}return n.isloading=!0,r.next=13,n.$axios.delete("api/gl/line/find/".concat(t.id));case 13:n.transaction.lines.splice(e,1),n.clearLineErrors(e),n.reindexLineErrors(e),r.next=22;break;case 18:r.prev=18,r.t0=r.catch(0),n.showError("Failed to delete line"),console.error("Delete line error:",r.t0);case 22:return r.prev=22,n.isloading=!1,r.finish(22);case 25:case"end":return r.stop()}}),r,null,[[0,18,22,25]])})))()},currencyChange:function(t,e){var n=this.currencyList.find((function(e){return e.id===t.currencyId}));n&&(t.rate=n.rate||1,this.calculateLocalAmount(t,e),this.validateLineField(e,"currencyId"))},amountChange:function(t,e){this.calculateLocalAmount(t,e),this.validateLineField(e,"amount")},rateChange:function(t,e){this.calculateLocalAmount(t,e),this.validateLineField(e,"rate")},calculateLocalAmount:function(t,e){var n=parseFloat(Object(N.h)(t.amount||"0",",","")),r=parseFloat(Object(N.h)(t.rate||"1",",",""));isNaN(n)||isNaN(r)?t.localAmount=0:t.localAmount=n*r},validateField:function(t){var e=this.transaction[t],n=[];switch(t){case"bookingDate":e?new Date(e)>new Date&&n.push("Booking date cannot be in the future"):n.push("Booking date is required");break;case"reference":e&&e.length>50&&n.push("Reference must be 50 characters or less")}n.length>0?this.validationErrors.header[t]=n:delete this.validationErrors.header[t]},validateLineField:function(t,e){var line=this.transaction.lines[t],n=[];switch(this.validationErrors.lines[t]||(this.validationErrors.lines[t]={}),e){case"currencyId":line.currencyId||n.push("Currency is required");break;case"amount":if(line.amount){var r=parseFloat(Object(N.h)(line.amount,",",""));(isNaN(r)||r<=0)&&n.push("Amount must be greater than 0")}else n.push("Amount is required");break;case"rate":if(line.rate){var o=parseFloat(Object(N.h)(line.rate,",",""));(isNaN(o)||o<=0)&&n.push("Rate must be greater than 0")}else n.push("Rate is required");break;case"drAccountId":line.drAccountId||n.push("Debit account is required");break;case"crAccountId":line.crAccountId||n.push("Credit account is required")}n.length>0?this.validationErrors.lines[t][e]=n:delete this.validationErrors.lines[t][e]},validateAllFields:function(){var t=this;return this.validateField("bookingDate"),this.validateField("reference"),this.transaction.lines.forEach((function(line,e){t.validateLineField(e,"currencyId"),t.validateLineField(e,"amount"),t.validateLineField(e,"rate"),t.validateLineField(e,"drAccountId"),t.validateLineField(e,"crAccountId")})),this.transaction.lines.forEach((function(line,e){line.drAccountId&&line.crAccountId&&line.drAccountId===line.crAccountId&&(t.validationErrors.lines[e]||(t.validationErrors.lines[e]={}),t.validationErrors.lines[e].drAccountId=["Debit and Credit accounts cannot be the same"],t.validationErrors.lines[e].crAccountId=["Debit and Credit accounts cannot be the same"])})),!this.hasValidationErrors},getFieldError:function(t){return this.validationErrors.header[t]||[]},getLineError:function(t,e){var n;return(null===(n=this.validationErrors.lines[t])||void 0===n?void 0:n[e])||[]},clearLineErrors:function(t){delete this.validationErrors.lines[t]},reindexLineErrors:function(t){var e=this,n={};Object.keys(this.validationErrors.lines).forEach((function(r){var o=parseInt(r);o>t?n[o-1]=e.validationErrors.lines[r]:o<t&&(n[o]=e.validationErrors.lines[r])})),this.validationErrors.lines=n},showError:function(t){this.validateErrorMessage=t,this.sheet=!0},showSuccess:function(t){this.successMessage=t,this.successSnackbar=!0},resetForm:function(){this.transaction={id:null,bookingDate:(new Date).toISOString().substr(0,10),reference:"",description:"",vendorId:null,status:"PENDING",isActive:!0,exchangeRate:1,total:0,poHeaderId:null,locationId:null,user:this.user,lines:[]},this.validationErrors={header:{},lines:{}},this.newRow()},printTransaction:function(){this.transaction.id?console.log("Printing transaction:",this.transaction.id):this.showError("Cannot print unsaved transaction")},toggleDialog:function(){this.$emit("close-dialog")},postTransaction:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isloading){e.next=2;break}return e.abrupt("return");case 2:if(t.validateAllFields()){e.next=5;break}return t.showError("Please fix validation errors before saving"),e.abrupt("return");case 5:if(e.prev=5,t.isloading=!0,(n=j({},t.transaction)).lines=n.lines.map((function(line){return j(j({},line),{},{amount:parseFloat(Object(N.h)(line.amount.toString(),",","")),rate:parseFloat(Object(N.h)(line.rate.toString(),",","")),localAmount:parseFloat(line.localAmount||0),bookingDate:n.bookingDate})})),!t.isUpdate){e.next=14;break}return e.next=12,t.updateTransaction(n);case 12:e.next=16;break;case 14:return e.next=16,t.createTransaction(n);case 16:t.showSuccess("Transaction saved successfully"),t.$emit("reload"),t.$emit("close-dialog"),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(5),t.handleSaveError(e.t0);case 24:return e.prev=24,t.isloading=!1,e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[5,21,24,27]])})))()},createTransaction:function(t){var e=this;return Object(S.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.lines.forEach((function(line){delete line.id,delete line.tempId})),n.next=3,e.$axios.post("api/gl/createMulti",t);case 3:return r=n.sent,n.abrupt("return",r.data);case 5:case"end":return n.stop()}}),n)})))()},updateTransaction:function(t){var e=this;return Object(S.a)(regeneratorRuntime.mark((function n(){var line,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1!==t.lines.length){n.next=9;break}return(line=t.lines[0]).bookingDate=t.bookingDate,n.next=5,e.$axios.put("api/gl/update/".concat(e.GLId),line);case 5:return r=n.sent,n.abrupt("return",r.data);case 9:throw new Error("Multiple lines update not supported");case 10:case"end":return n.stop()}}),n)})))()},handleSaveError:function(t){var e;if(console.error("Save error:",t),null!==(e=t.response)&&void 0!==e&&e.data){var n=t.response.data;if(n.includes("#")){var r=n.split("#");if(r.length>1){var o=r[1],c=this.transaction.lines.findIndex((function(line){return line.productId==o}));c>=0&&(this.errorLineNumber=c)}}this.showError(n)}else this.showError("Failed to save transaction. Please try again.")},getFormatNum:function(t){return null==t||isNaN(t)?"0":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(t)},findCurrency:function(t){return this.currencyList.find((function(e){return e.id===t}))},validateBusinessRules:function(){var t=[],e=(this.transaction.lines.reduce((function(t,line){return t+(line.localAmount||0)}),0),this.transaction.lines.reduce((function(t,line){return t+(line.localAmount||0)}),0),new Set);this.transaction.lines.forEach((function(line,n){if(line.drAccountId&&line.crAccountId){var r="".concat(line.drAccountId,"-").concat(line.crAccountId);e.has(r)&&t.push({lineIndex:n,field:"drAccountId",message:"Duplicate account combination found"}),e.add(r)}}));var n=this.transaction.lines.map((function(line){return line.drAccountId&&line.crAccountId?[line.drAccountId,line.crAccountId].sort().join("-"):null})).filter(Boolean);return n.filter((function(t,e){return n.indexOf(t)!==e})).length>0&&t.push({lineIndex:-1,field:"general",message:"Circular account references detected"}),t},validateAccountingPeriod:function(){var t=new Date(this.transaction.bookingDate),e=new Date,n=new Date;return n.setDate(e.getDate()-365),t<n?"Booking date is too far in the past":t>e?"Booking date cannot be in the future":null},filterAccountsByType:function(t){return this.accountList.filter((function(e){return e.accountType===t}))},getDebitAccounts:function(){return this.accountList.filter((function(t){return["ASSET","EXPENSE"].includes(t.accountType)}))},getCreditAccounts:function(){return this.accountList.filter((function(t){return["LIABILITY","EQUITY","REVENUE"].includes(t.accountType)}))},handleKeyboardShortcuts:function(t){t.ctrlKey&&"s"===t.key&&(t.preventDefault(),this.postTransaction()),t.ctrlKey&&"n"===t.key&&(t.preventDefault(),this.newRow()),"Escape"===t.key&&this.toggleDialog()},exportToCSV:function(){var t=this,e=this.transaction.lines.map((function(line,e){var n,r,o;return[e+1,(null===(n=t.currencyList.find((function(t){return t.id===line.currencyId})))||void 0===n?void 0:n.code)||"",line.amount,line.rate,(null===(r=t.accountList.find((function(a){return a.id===line.drAccountId})))||void 0===r?void 0:r.accountNumber)||"",(null===(o=t.accountList.find((function(a){return a.id===line.crAccountId})))||void 0===o?void 0:o.accountNumber)||"",line.description,line.localAmount]})),n=[["Line#","Currency","Amount","Rate","Debit Account","Credit Account","Description","Local Amount"]].concat(Object(D.a)(e)).map((function(t){return t.map((function(t){return'"'.concat(t,'"')})).join(",")})).join("\n"),r=new Blob([n],{type:"text/csv"}),o=window.URL.createObjectURL(r),link=document.createElement("a");link.href=o,link.download="GL_Transaction_".concat(this.transaction.id||"New",".csv"),link.click(),window.URL.revokeObjectURL(o)},setupAutoSave:function(){var t=this;this.autoSaveInterval=setInterval((function(){t.transaction.lines.length>0&&!t.hasValidationErrors&&!t.isloading&&t.autoSave()}),3e4)},autoSave:function(){var t=this;return Object(S.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=j(j({},t.transaction),{},{status:"DRAFT"}),console.log("Auto-saving draft...",n)}catch(t){console.error("Auto-save failed:",t)}case 1:case"end":return e.stop()}}),e)})))()}},mounted:function(){document.addEventListener("keydown",this.handleKeyboardShortcuts),"true"===this.$route.query.autosave&&this.setupAutoSave()},beforeDestroy:function(){document.removeEventListener("keydown",this.handleKeyboardShortcuts),this.autoSaveInterval&&clearInterval(this.autoSaveInterval)},watch:{"transaction.bookingDate":function(t){t&&this.transaction.lines.forEach((function(line){line.bookingDate=t}))},"transaction.lines":{handler:function(){this.$nextTick((function(){}))},deep:!0}}},$=(n(1005),n(31)),component=Object($.a)(T,(function(){var t=this,e=t._self._c;return e("div",[e(h.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.isloading,callback:function(e){t.isloading=e},expression:"isloading"}},[e("loading-indicator")],1),t._v(" "),e(h.a,{attrs:{"max-width":"1024"},model:{value:t.customerDialog,callback:function(e){t.customerDialog=e},expression:"customerDialog"}},[e("customer-list",{on:{"close-dialog":function(e){t.customerDialog=!1}}})],1),t._v(" "),e(h.a,{attrs:{"max-width":"1024"},model:{value:t.cancelConfirmDialog,callback:function(e){t.cancelConfirmDialog=e},expression:"cancelConfirmDialog"}},[e("cancel-ticket-form",{attrs:{id:t.headerId,customerId:t.onlineCustomerId},on:{refresh:function(e){return t.$emit("reload")},"close-dialog":function(e){t.cancelConfirmDialog=!1}}})],1),t._v(" "),e(o.a,{attrs:{inset:""},model:{value:t.sheet,callback:function(e){t.sheet=e},expression:"sheet"}},[e(y.a,{staticClass:"text-center",attrs:{height:"200px"}},[e(c.a,{staticClass:"mt-6",attrs:{text:"",color:"error"},on:{click:function(e){t.sheet=!1}}},[e(_.a,{attrs:{left:""}},[t._v("mdi-close")]),t._v("\n        Close\n      ")],1),t._v(" "),e("div",{staticClass:"my-3 error--text"},[t._v("\n        "+t._s(t.validateErrorMessage)+"\n      ")])],1)],1),t._v(" "),e(I.a,{attrs:{color:"success",timeout:"3000"},scopedSlots:t._u([{key:"action",fn:function(n){var r=n.attrs;return[e(c.a,t._b({attrs:{text:""},on:{click:function(e){t.successSnackbar=!1}}},"v-btn",r,!1),[e(_.a,[t._v("mdi-close")])],1)]}}]),model:{value:t.successSnackbar,callback:function(e){t.successSnackbar=e},expression:"successSnackbar"}},[t._v("\n    "+t._s(t.successMessage)+"\n    ")]),t._v(" "),e(l.a,[e(d.b,[e(w.a,[e(v.a,{attrs:{cols:"6"}},[e(f.a,{staticClass:"pa-5",attrs:{color:"primary",label:"","text-color":"white"}},[e(_.a,{attrs:{start:""}},[t._v("mdi-book-open-variant")]),t._v(" "),e("h3",[t._v("General Ledger")])],1)],1),t._v(" "),e(v.a,{staticClass:"text-right",attrs:{cols:"6"}},[e(c.a,{staticClass:"primary mr-2",attrs:{size:"large",variant:"outlined",rounded:"",disabled:!t.transaction.id},on:{click:t.printTransaction}},[e(_.a,{attrs:{left:""}},[t._v("mdi-printer")]),t._v("\n            Print\n          ")],1),t._v(" "),e(c.a,{attrs:{size:"large",variant:"outlined",color:"secondary",rounded:"",disabled:t.isloading},on:{click:t.resetForm}},[e(_.a,{attrs:{left:""}},[t._v("mdi-refresh")]),t._v("\n            Reset\n          ")],1)],1)],1)],1),t._v(" "),e(x.a),t._v(" "),e(d.c,{staticClass:"pa-4"},[e(l.a,{staticClass:"mb-4 pa-4",class:{"error-border":t.headerError},attrs:{elevation:"2"}},[e(d.d,{staticClass:"pb-2"},[e(_.a,{attrs:{left:"",color:"primary"}},[t._v("mdi-information")]),t._v("\n          Transaction Details\n          "),e(A.a),t._v(" "),t.transaction.id?e(f.a,{attrs:{color:"info",small:""}},[t._v("\n            RECID: "+t._s(t.transaction.id)+"\n          ")]):t._e()],1),t._v(" "),e(d.c,[e(w.a,[e(v.a,{attrs:{cols:"12",md:"4"}},[e(L.a,{attrs:{type:"date",label:"Booking Date *","error-messages":t.getFieldError("bookingDate"),outlined:"",dense:"",required:""},on:{blur:function(e){return t.validateField("bookingDate")}},model:{value:t.transaction.bookingDate,callback:function(e){t.$set(t.transaction,"bookingDate",e)},expression:"transaction.bookingDate"}}),t._v(" "),e(L.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"PO Reference Number",outlined:"",dense:"",disabled:""},model:{value:t.transaction.poHeaderId,callback:function(e){t.$set(t.transaction,"poHeaderId",e)},expression:"transaction.poHeaderId"}})],1),t._v(" "),e(v.a,{attrs:{cols:"12",md:"4"}},[e(L.a,{attrs:{label:"Reference",outlined:"",dense:"","error-messages":t.getFieldError("reference"),maxlength:"50"},on:{blur:function(e){return t.validateField("reference")}},model:{value:t.transaction.reference,callback:function(e){t.$set(t.transaction,"reference",e)},expression:"transaction.reference"}}),t._v(" "),e(E.a,{attrs:{label:"Transaction Description",outlined:"",dense:"",rows:"2",maxlength:"255"},model:{value:t.transaction.description,callback:function(e){t.$set(t.transaction,"description",e)},expression:"transaction.description"}})],1),t._v(" "),e(v.a,{staticClass:"text-right",attrs:{cols:"12",md:"4"}},[t.transaction.user?e("div",{staticClass:"mb-2"},[e("strong",[t._v("Created by:")]),t._v(" "+t._s(t.transaction.user.cus_id)),e("br"),t._v(" "),e("strong",[t._v("Name:")]),t._v(" "+t._s(t.transaction.user.cus_name)+"\n              ")]):t._e(),t._v(" "),e(l.a,{staticClass:"pa-3",attrs:{outlined:""}},[e("div",{staticClass:"text-h6 primary--text"},[t._v("\n                  Total Amount (LCY)\n                ")]),t._v(" "),e("div",{staticClass:"text-h5 font-weight-bold"},[t._v("\n                  "+t._s(t.getFormatNum(t.grandTotal))+"\n                ")])])],1)],1)],1)],1),t._v(" "),e(l.a,{attrs:{elevation:"2"}},[e(d.d,{staticClass:"pb-2"},[e(_.a,{attrs:{left:"",color:"primary"}},[t._v("mdi-format-list-bulleted")]),t._v("\n          Transaction Lines\n          "),e(A.a),t._v(" "),e(c.a,{attrs:{color:"primary",disabled:t.isUpdate||t.isloading,small:""},on:{click:t.newRow}},[e(_.a,{attrs:{left:""}},[t._v("mdi-plus")]),t._v("\n            Add Line\n          ")],1)],1),t._v(" "),e(d.c,[t.transaction.lines&&t.transaction.lines.length>0?e(m.a,{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.transaction.lines,search:t.search,"item-key":"tempId"},scopedSlots:t._u([{key:"top",fn:function(){return[e(L.a,{staticClass:"mb-3",attrs:{label:"Search lines...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",clearable:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})]},proxy:!0},{key:"item",fn:function(n){var o=n.item,l=n.index;return[e("tr",{class:{"error-row":t.errorLineNumber===l}},[e("td",{staticClass:"text-center"},[e(f.a,{attrs:{small:"",color:t.errorLineNumber===l?"error":"primary"}},[t._v("\n                    "+t._s(l+1)+"\n                  ")])],1),t._v(" "),e("td",{staticStyle:{"min-width":"150px"}},[e(r.a,{attrs:{items:t.currencyList,"item-text":"code","item-value":"id",label:"Currency *",outlined:"",dense:"","error-messages":t.getLineError(l,"currencyId"),required:""},on:{change:function(e){return t.currencyChange(o,l)},blur:function(e){return t.validateLineField(l,"currencyId")}},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;return[t._v("\n                      "+t._s(n.code)+" - "+t._s(n.name)+"\n                    ")]}},{key:"item",fn:function(n){var r=n.item;return[e(k.a,[e(k.c,[t._v(t._s(r.code))]),t._v(" "),e(k.b,[t._v(t._s(r.name))])],1)]}}],null,!0),model:{value:o.currencyId,callback:function(e){t.$set(o,"currencyId",e)},expression:"item.currencyId"}})],1),t._v(" "),e("td",{staticStyle:{"min-width":"120px"}},[e(L.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"Amount *",outlined:"",dense:"","error-messages":t.getLineError(l,"amount"),required:""},on:{input:function(e){return t.amountChange(o,l)},blur:function(e){return t.validateLineField(l,"amount")}},model:{value:o.amount,callback:function(e){t.$set(o,"amount",e)},expression:"item.amount"}})],1),t._v(" "),e("td",{staticStyle:{"min-width":"120px"}},[e(L.a,{directives:[{name:"comma-thousand",rawName:"v-comma-thousand"}],attrs:{label:"Exchange Rate *",outlined:"",dense:"","error-messages":t.getLineError(l,"rate"),required:""},on:{input:function(e){return t.rateChange(o,l)},blur:function(e){return t.validateLineField(l,"rate")}},model:{value:o.rate,callback:function(e){t.$set(o,"rate",e)},expression:"item.rate"}})],1),t._v(" "),e("td",{staticStyle:{"min-width":"200px"}},[e(r.a,{attrs:{items:t.accountList,"item-text":"accountNumber","item-value":"id",label:"Debit Account *",outlined:"",dense:"","error-messages":t.getLineError(l,"drAccountId"),required:""},on:{blur:function(e){return t.validateLineField(l,"drAccountId")}},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;return[t._v("\n                      "+t._s(n.accountNumber)+" - "+t._s(n.accountName)+"\n                    ")]}},{key:"item",fn:function(n){var r=n.item;return[e(k.a,[e(k.c,[t._v(t._s(r.accountNumber))]),t._v(" "),e(k.b,[t._v(t._s(r.accountName))])],1)]}}],null,!0),model:{value:o.drAccountId,callback:function(e){t.$set(o,"drAccountId",e)},expression:"item.drAccountId"}})],1),t._v(" "),e("td",{staticStyle:{"min-width":"200px"}},[e(r.a,{attrs:{items:t.accountList,"item-text":"accountNumber","item-value":"id",label:"Credit Account *",outlined:"",dense:"","error-messages":t.getLineError(l,"crAccountId"),required:""},on:{blur:function(e){return t.validateLineField(l,"crAccountId")}},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;return[t._v("\n                      "+t._s(n.accountNumber)+" - "+t._s(n.accountName)+"\n                    ")]}},{key:"item",fn:function(n){var r=n.item;return[e(k.a,[e(k.c,[t._v(t._s(r.accountNumber))]),t._v(" "),e(k.b,[t._v(t._s(r.accountName))])],1)]}}],null,!0),model:{value:o.crAccountId,callback:function(e){t.$set(o,"crAccountId",e)},expression:"item.crAccountId"}})],1),t._v(" "),e("td",{staticStyle:{"min-width":"150px"}},[e(L.a,{attrs:{label:"Description",outlined:"",dense:"",maxlength:"100"},model:{value:o.description,callback:function(e){t.$set(o,"description",e)},expression:"item.description"}})],1),t._v(" "),e("td",{staticClass:"text-right font-weight-bold"},[t._v("\n                  "+t._s(t.getFormatNum(o.localAmount))+"\n                ")]),t._v(" "),e("td",{staticClass:"text-center"},[e(c.a,{attrs:{color:"error",icon:"",small:"",disabled:t.isloading},on:{click:function(e){return t.deleteItem(o,l)}}},[e(_.a,[t._v("mdi-delete")])],1)],1)])]}}],null,!1,1715049908)}):e(l.a,{staticClass:"pa-8 text-center",staticStyle:{border:"2px dashed #ccc"},attrs:{outlined:""}},[e(_.a,{attrs:{size:"64",color:"grey"}},[t._v("mdi-format-list-bulleted")]),t._v(" "),e("h3",{staticClass:"mt-4 mb-2"},[t._v("No transaction lines")]),t._v(" "),e("p",{staticClass:"mb-4"},[t._v("Add your first transaction line to get started")]),t._v(" "),e(c.a,{attrs:{color:"primary",disabled:t.isUpdate||t.isloading},on:{click:t.newRow}},[e(_.a,{attrs:{left:""}},[t._v("mdi-plus")]),t._v("\n              Add First Line\n            ")],1)],1)],1)],1)],1),t._v(" "),e(d.a,{staticClass:"pa-4"},[t.transaction.lines.length>0?e(f.a,{attrs:{color:"info",outlined:""}},[t._v("\n        "+t._s(t.transaction.lines.length)+" line(s)\n      ")]):t._e(),t._v(" "),e(A.a),t._v(" "),e(c.a,{attrs:{color:"grey",text:"",disabled:t.isloading},on:{click:t.toggleDialog}},[e(_.a,{attrs:{left:""}},[t._v("mdi-close")]),t._v("\n        Cancel\n      ")],1),t._v(" "),e(c.a,{attrs:{color:"primary",disabled:t.isloading||!t.canSave,loading:t.isloading},on:{click:t.postTransaction}},[e(_.a,{attrs:{left:""}},[t._v("mdi-content-save")]),t._v("\n        "+t._s(t.isUpdate?"Update":"Save")+"\n      ")],1)],1)],1)],1)}),[],!1,null,"f09cae02",null);e.default=component.exports;installComponents(component,{LoadingIndicator:n(248).default,CustomerList:n(269).default,CancelTicketForm:n(835).default})},835:function(t,e,n){"use strict";n.r(e);var r=n(321),o=n(318),c=n(19),l=n(771),d=n(798),f=n(794),v=n(112),m=n(17),h=(n(85),n(24),n(5),n(68),n(37)),x={props:{id:{type:Number,require:!1},customerId:{type:Number,require:!1,default:null}},data:function(){return{isLoading:!1,form:{isActive:!1,remark:"",cancel_fee:0},nameRules:[function(t){return!!t||"ກະລຸນາ ໃສ່ເຫດຜົນ"},function(t){return t.toString().length<=100||"Reason must be less than 100 characters"}]}},computed:{user:function(){return this.$auth.user||""}},methods:{submitForm:function(){var t=this;return Object(m.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.$refs.myform.validate()||t.isLoading){e.next=17;break}return t.isLoading=!0,e.prev=2,t.form.customerId=t.customerId,console.log("".concat(JSON.stringify(t.form))),e.next=7,t.$axios.put("api/sale/reverse/".concat(t.id),t.form);case 7:(e.sent.status=200)&&(t.refreshData(),Object(h.k)(t.$swal,"Succeed","ດຳເນີນການສຳເລັດ")),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),Object(h.j)(t.$swal,"Error","Something went wrong "+e.t0);case 14:t.isLoading=!1,e.next=18;break;case 17:return e.abrupt("return");case 18:t.isLoading=!1;case 19:case"end":return e.stop()}}),e,null,[[2,11]])})))()},refreshData:function(){this.$emit("reload-data")}}},_=n(31),component=Object(_.a)(x,(function(){var t=this,e=t._self._c;return e("div",[e(l.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[e("loading-indicator")],1),t._v(" "),e(o.a,{staticClass:"pa-4"},[t._v("\n        ຍົກເລີກບິນ\n        "),e(d.a,{ref:"myform",on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e(v.a,{attrs:{disabled:"",label:"ເລກທີອໍເດີ "},model:{value:t.id,callback:function(e){t.id=e},expression:"id"}}),t._v(" "),e(v.a,{attrs:{label:"ເຫດຜົນການຍົກເລີກ",rules:t.nameRules},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}}),t._v(" "),e(v.a,{attrs:{label:"ຄ່າທຳນຽມ"},model:{value:t.form.cancel_fee,callback:function(e){t.$set(t.form,"cancel_fee",e)},expression:"form.cancel_fee"}})],1),t._v(" "),e(c.a,[e(f.a),t._v(" "),e(r.a,{staticClass:"warning",attrs:{text:"",rounded:""},on:{click:function(e){return t.$emit("close-dialog")}}},[t._v("\n                ປິດ\n            ")]),t._v(" "),e(r.a,{staticClass:"primary",attrs:{text:"",rounded:""},on:{click:t.submitForm}},[t._v("\n                ຢືນຢັນ\n            ")])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{LoadingIndicator:n(248).default})},855:function(t,e,n){"use strict";n(34),n(75);e.a={bind:function(t,e,n){t.addEventListener("input",(function(t){var e=t.target.value.replace(/[^0-9]/g,"");"NaN"===(e=parseInt(e,10).toLocaleString("en-US"))&&(e="0"),n.componentInstance.$emit("input",e)}))}}},941:function(t,e,n){var content=n(1006);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(15).default)("de5ee156",content,!0,{sourceMap:!1})}}]);