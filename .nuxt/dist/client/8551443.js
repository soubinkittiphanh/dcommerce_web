(window.webpackJsonp=window.webpackJsonp||[]).push([[249,245],{1305:function(t,e,r){"use strict";r.r(e);var n=r(36),o=r(17),c=(r(30),r(39),r(5),r(8),r(337),r(85),r(353));e.default={data:function(){return{sharedMessage:"Hello from mixin!"}},methods:{exportMinistryReportToExcel:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.ministrySummaryReport.length){e.next=4;break}return t.$toast.warning("No ministry data to export"),e.abrupt("return");case 4:r=t.createExcelWorkbook(),n=t.createMinistryWorksheet(),c.utils.book_append_sheet(r,n,"Ministry Report"),o="Ministry_Report_".concat(t.formatDateForFilename(),".xlsx"),c.writeFile(r,o),t.$toast.success("Ministry report exported successfully"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Export error:",e.t0),t.$toast.error("Failed to export ministry report");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},exportBankAccountReportToExcel:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.bankAccountSummaryReport.length){e.next=4;break}return t.$toast.warning("No bank account data to export"),e.abrupt("return");case 4:r=t.createExcelWorkbook(),n=t.createBankAccountWorksheet(),c.utils.book_append_sheet(r,n,"Bank Account Report"),o="Bank_Account_Report_".concat(t.formatDateForFilename(),".xlsx"),c.writeFile(r,o),t.$toast.success("Bank account report exported successfully"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Export error:",e.t0),t.$toast.error("Failed to export bank account report");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},exportChartAccountReportToExcel:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.chartAccountSummaryReport.length){e.next=4;break}return t.$toast.warning("No chart account data to export"),e.abrupt("return");case 4:r=t.createExcelWorkbook(),n=t.createChartAccountWorksheet(),c.utils.book_append_sheet(r,n,"Chart Account Report"),o="Chart_Account_Report_".concat(t.formatDateForFilename(),".xlsx"),c.writeFile(r,o),t.$toast.success("Chart account report exported successfully"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Export error:",e.t0),t.$toast.error("Failed to export chart account report");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))()},exportAllReportsToExcel:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,n,o,l,d,m,v,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=t.ministrySummaryReport&&t.ministrySummaryReport.length>0,n=t.bankAccountSummaryReport&&t.bankAccountSummaryReport.length>0,o=t.chartAccountSummaryReport&&t.chartAccountSummaryReport.length>0,r||n||o){e.next=7;break}return t.$toast.warning("No data available to export"),e.abrupt("return");case 7:l=t.createExcelWorkbook(),r&&(d=t.createMinistryWorksheet(),c.utils.book_append_sheet(l,d,"Ministry Report")),n&&(m=t.createBankAccountWorksheet(),c.utils.book_append_sheet(l,m,"Bank Account Report")),o&&(v=t.createChartAccountWorksheet(),c.utils.book_append_sheet(l,v,"Chart Account Report")),h="Financial_Reports_".concat(t.formatDateForFilename(),".xlsx"),c.writeFile(l,h),t.$toast.success("All reports exported successfully"),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Export error:",e.t0),t.$toast.error("Failed to export reports");case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))()},createExcelWorkbook:function(){return c.utils.book_new()},createMinistryWorksheet:function(){var t,e=this,r=["#","Ministry Code","Ministry Name","Settlement Count"].concat(Object(n.a)(this.currencyList),["Total (LAK)"]),data=this.ministrySummaryReport.map((function(t,r){var n=[r+1,t.ministryCode,t.ministryName,t.settlementCount];return e.currencyList.forEach((function(e){var r;n.push((null===(r=t.amounts)||void 0===r?void 0:r[e])||0)})),n.push(t.totalLakEquivalent||0),n})),o=["","","TOTAL",this.ministrySummaryReport.reduce((function(t,e){return t+e.settlementCount}),0)];this.currencyList.forEach((function(t){var r,n;o.push((null===(r=e.ministryTotals)||void 0===r||null===(n=r.currencyTotals)||void 0===n?void 0:n[t])||0)})),o.push((null===(t=this.ministryTotals)||void 0===t?void 0:t.totalLakEquivalent)||0);var l=[r].concat(Object(n.a)(data),[o]),d=c.utils.aoa_to_sheet(l);return this.addWorksheetMetadata(d,"Ministry Financial Report"),d},createBankAccountWorksheet:function(){var t,e=this,r=["#","Account Number","Account Name","Bank Name","Account Type","Settlement Count"].concat(Object(n.a)(this.currencyList),["Total (LAK)"]),data=this.bankAccountSummaryReport.map((function(t,r){var n=[r+1,t.accountNumber,t.accountName,t.bankName,t.accountType,t.settlementCount];return e.currencyList.forEach((function(e){var r;n.push((null===(r=t.amounts)||void 0===r?void 0:r[e])||0)})),n.push(t.totalLakEquivalent||0),n})),o=["","","","","TOTAL",this.bankAccountSummaryReport.reduce((function(t,b){return t+b.settlementCount}),0)];this.currencyList.forEach((function(t){var r,n;o.push((null===(r=e.bankAccountTotals)||void 0===r||null===(n=r.currencyTotals)||void 0===n?void 0:n[t])||0)})),o.push((null===(t=this.bankAccountTotals)||void 0===t?void 0:t.totalLakEquivalent)||0);var l=[r].concat(Object(n.a)(data),[o]),d=c.utils.aoa_to_sheet(l);return this.addWorksheetMetadata(d,"Bank Account Financial Report"),d},createChartAccountWorksheet:function(){var t,e=this,r=["#","Account Number","Account Name","Settlement Count"].concat(Object(n.a)(this.currencyList),["Total (LAK)"]),data=this.chartAccountSummaryReport.map((function(t,r){var n=[r+1,t.accountNumber,t.accountName,t.settlementCount];return e.currencyList.forEach((function(e){var r;n.push((null===(r=t.amounts)||void 0===r?void 0:r[e])||0)})),n.push(t.totalLakEquivalent||0),n})),o=["","","TOTAL",this.chartAccountSummaryReport.reduce((function(t,e){return t+e.settlementCount}),0)];this.currencyList.forEach((function(t){var r,n;o.push((null===(r=e.chartAccountTotals)||void 0===r||null===(n=r.currencyTotals)||void 0===n?void 0:n[t])||0)})),o.push((null===(t=this.chartAccountTotals)||void 0===t?void 0:t.totalLakEquivalent)||0);var l=[r].concat(Object(n.a)(data),[o]),d=c.utils.aoa_to_sheet(l);return this.addWorksheetMetadata(d,"Chart Account Financial Report"),d},addWorksheetMetadata:function(t,title){var e,r,n=[[title],["Report Period: ".concat((null===(e=this.dateRange)||void 0===e?void 0:e.start)||"N/A"," to ").concat((null===(r=this.dateRange)||void 0===r?void 0:r.end)||"N/A")],["Generated: ".concat((new Date).toLocaleString())],[""]];c.utils.sheet_add_aoa(t,n,{origin:"A1"});var o=c.utils.decode_range(t["!ref"]);o.e.r+=n.length,t["!ref"]=c.utils.encode_range(o)},formatDateForFilename:function(){var t=new Date,e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return"".concat(e).concat(r).concat(n,"_").concat(o).concat(c)}}}},1306:function(t,e,r){var content=r(1642);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(15).default)("b95b6316",content,!0,{sourceMap:!1})},1641:function(t,e,r){"use strict";r(1306)},1642:function(t,e,r){var n=r(14)((function(i){return i[1]}));n.push([t.i,'.banking-primary--text[data-v-ebeb1d9c]{color:#01532b!important}.banking-success--text[data-v-ebeb1d9c]{color:#059669!important}.summary-card[data-v-ebeb1d9c]{border-left:4px solid transparent;transition:all .3s ease}.summary-card[data-v-ebeb1d9c]:hover{box-shadow:0 8px 25px rgba(1,83,43,.15);transform:translateY(-4px)}.report-card[data-v-ebeb1d9c]{border-left:4px solid #01532b}.report-header[data-v-ebeb1d9c]{background:linear-gradient(90deg,#f8f9fa,#e9ecef);font-weight:600}.banking-table[data-v-ebeb1d9c]{font-family:"Roboto",sans-serif}.banking-table-header[data-v-ebeb1d9c]{background:linear-gradient(135deg,#01532b,#0d4f3c)!important}.banking-table-header th[data-v-ebeb1d9c]{background:transparent!important;border-right:1px solid hsla(0,0%,100%,.2)!important;color:#fff!important;font-size:.875rem!important;font-weight:700!important;padding:12px 8px!important}.banking-table tbody td[data-v-ebeb1d9c]{border-bottom:1px solid #e0e0e0!important;border-right:1px solid #f5f5f5!important;font-size:.8rem!important;padding:8px!important}.banking-table tbody tr[data-v-ebeb1d9c]:hover{background-color:rgba(1,83,43,.05)!important}.banking-row-even[data-v-ebeb1d9c]{background-color:#f8f9fa!important}.banking-row-special[data-v-ebeb1d9c]{background-color:#fef3c7!important}.banking-table-footer[data-v-ebeb1d9c]{background:linear-gradient(90deg,rgba(1,83,43,.1),rgba(1,83,43,.15))!important;border-top:2px solid #01532b!important}.banking-table-footer td[data-v-ebeb1d9c]{background:transparent!important;border-top:2px solid #01532b!important;font-weight:700!important}.data-table-card[data-v-ebeb1d9c]{border-left:4px solid #01532b}.data-table-header[data-v-ebeb1d9c]{background:linear-gradient(90deg,#f8f9fa,#e9ecef);font-weight:600}.banking-data-table[data-v-ebeb1d9c]{background:#fff}.date-chip[data-v-ebeb1d9c]{font-family:"Roboto Mono",monospace;font-size:.75rem}.banking-divider[data-v-ebeb1d9c]{border-color:#01532b!important;border-width:2px!important}.dialog-header[data-v-ebeb1d9c]{background:linear-gradient(135deg,#01532b,#0d4f3c)!important;color:#fff!important;font-weight:600}.sortable[data-v-ebeb1d9c]{cursor:pointer;transition:background-color .2s ease;-webkit-user-select:none;-moz-user-select:none;user-select:none}.sortable[data-v-ebeb1d9c]:hover{background-color:hsla(0,0%,100%,.1)!important}.v-text-field[data-v-ebeb1d9c] .v-input__control .v-input__slot:before{border-color:#01532b!important}.v-text-field[data-v-ebeb1d9c] .v-label{color:#01532b!important}.v-select[data-v-ebeb1d9c] .v-input__control .v-input__slot:before{border-color:#01532b!important}.v-select[data-v-ebeb1d9c] .v-label{color:#01532b!important}.v-textarea[data-v-ebeb1d9c] .v-input__control .v-input__slot:before{border-color:#01532b!important}.v-textarea[data-v-ebeb1d9c] .v-label{color:#01532b!important}@media (max-width:768px){.banking-table[data-v-ebeb1d9c]{font-size:.75rem}.banking-table tbody td[data-v-ebeb1d9c],.banking-table-header th[data-v-ebeb1d9c]{font-size:.7rem!important;padding:6px 4px!important}.report-card[data-v-ebeb1d9c],.summary-card[data-v-ebeb1d9c]{margin-bottom:16px}}',""]),n.locals={},t.exports=n},1871:function(t,e,r){"use strict";r.r(e);var n=r(315),o=r(321),c=r(318),l=r(19),d=r(322),m=r(797),v=r(792),h=r(806),f=r(771),_=r(317),k=r(798),x=r(168),y=r(198),C=r(29),A=r(169),R=r(796),w=r(66),S=r(794),N=r(112),T=r(828),M=r(973),F=r(17),E=(r(5),r(54),r(53),r(30),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(838),r(839),r(840),r(841),r(842),r(843),r(844),r(845),r(846),r(847),r(848),r(849),r(850),r(851),r(852),r(853),r(854),r(8),r(250),r(69),r(63),r(103),r(39),r(85),{name:"SettlementDashboard",mixins:[r(1305).default],data:function(){return{loading:!1,saving:!1,loadingMinistryReport:!1,loadingBankAccountReport:!1,loadingChartAccountReport:!1,dialog:!1,formValid:!1,dialogMode:"create",currentSettlement:{},settlements:[],stats:{totalCount:0,totalAmount:0,thisMonth:0,pending:0},ministrySummaryReport:[],ministryTotals:{},bankAccountSummaryReport:[],bankAccountTotals:{totalLakEquivalent:0,currencyTotals:{}},chartAccountSummaryReport:[],chartAccountTotals:{totalLakEquivalent:0,currencyTotals:{}},currencyList:[],settlementForm:{bookingDate:"",amount:"",method:"",exchangeRate:1,notes:"",userId:null},rules:{required:function(t){return!!t||"This field is required"},positiveNumber:function(t){return t&&t>0||"Must be greater than 0"}},tableOptions:{page:1,itemsPerPage:10,sortBy:["id"],sortDesc:[!0]},pagination:{totalItems:0},tableHeaders:[{text:"ID",value:"id",sortable:!0,width:"80px"},{text:"Date",value:"bookingDate",sortable:!0,width:"120px"},{text:"Amount",value:"amount",sortable:!0,width:"150px"},{text:"Method",value:"method",sortable:!1,width:"140px"},{text:"Proceeder",value:"proceeder",sortable:!1,width:"180px"},{text:"Money Advance",value:"moneyAdvance",sortable:!1,width:"140px"},{text:"Status",value:"status",sortable:!1,width:"120px"},{text:"Actions",value:"actions",sortable:!1,width:"120px"}],methodSelectOptions:[{text:"Cash Payment",value:"cash"},{text:"Bank Transfer",value:"bank_transfer"},{text:"Salary Deduction",value:"deduction"}]}},computed:{dialogTitle:function(){return{create:"Create New Settlement",edit:"Edit Settlement",view:"Settlement Details"}[this.dialogMode]||"Settlement"}},mounted:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadInitialData();case 2:case"end":return e.stop()}}),e)})))()},methods:{loadInitialData:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.fetchSettlements(),t.fetchStats(),t.fetchChartAccountReport(),t.fetchMinistryReport(),t.fetchBankAccountReport()]);case 2:case"end":return e.stop()}}),e)})))()},refreshData:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadInitialData();case 2:t.$toast.success("Data refreshed successfully");case 3:case"end":return e.stop()}}),e)})))()},fetchSettlements:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,c={page:t.tableOptions.page||1,limit:t.tableOptions.itemsPerPage||10,sortBy:(null===(r=t.tableOptions.sortBy)||void 0===r?void 0:r[0])||"id",sortOrder:null!==(n=t.tableOptions.sortDesc)&&void 0!==n&&n[0]?"desc":"asc"},e.next=5,t.$axios.get("/api/settlements",{params:c});case 5:l=e.sent,t.settlements=l.data.data.settlements||[],t.pagination.totalItems=(null===(o=l.data.data.pagination)||void 0===o?void 0:o.totalItems)||0,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error fetching settlements:",e.t0),t.$toast.error("Failed to load settlements");case 14:return e.prev=14,t.loading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})))()},fetchStats:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/settlements/stats");case 3:r=e.sent,t.stats=r.data.data||{},e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching stats:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},fetchChartAccountReport:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,d,m,v,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.loadingChartAccountReport=!0,r=[],n=1,o=1;case 5:return e.next=7,t.$axios.get("/api/settlements",{params:{isPosted:!0,include:["chartAccount","currency"],page:n,limit:50}});case 7:d=e.sent,m=(null===(c=d.data.data)||void 0===c?void 0:c.settlements)||[],r=r.concat(m),(v=null===(l=d.data.data)||void 0===l?void 0:l.pagination)&&(o=v.totalPages),n++;case 13:if(n<=o){e.next=5;break}case 14:h=new Map,f=new Set,r.forEach((function(t){var e,r,n,o,c=t.chartAccount;c?(r=c.id,n=c.accountNumber,o=c.accountName||c.accountLLName):(r="NO_CHART_ACCOUNT",n="N/A",o="No Chart Account Assigned");var l=(null===(e=t.currency)||void 0===e?void 0:e.code)||"LAK",d=parseFloat(t.exchangeRate)||1,m=parseFloat(t.amount)||0,v=m*d;f.add(l),h.has(r)||h.set(r,{chartAccountId:r,accountNumber:n,accountName:o,settlementCount:0,totalLakEquivalent:0,amounts:{}});var _=h.get(r);_.settlementCount+=1,_.totalLakEquivalent+=v,_.amounts[l]=(_.amounts[l]||0)+m})),t.currencyList=Array.from(f).sort(),t.chartAccountSummaryReport=Array.from(h.values()).sort((function(a,b){return"NO_CHART_ACCOUNT"===a.chartAccountId?1:"NO_CHART_ACCOUNT"===b.chartAccountId?-1:a.accountNumber&&b.accountNumber?String(a.accountNumber).localeCompare(String(b.accountNumber)):a.accountName.localeCompare(b.accountName)})),t.chartAccountTotals={totalLakEquivalent:t.chartAccountSummaryReport.reduce((function(t,e){return t+e.totalLakEquivalent}),0),currencyTotals:{}},t.currencyList.forEach((function(e){t.chartAccountTotals.currencyTotals[e]=t.chartAccountSummaryReport.reduce((function(t,r){return t+(r.amounts[e]||0)}),0)})),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error fetching chart account report:",e.t0),t.$toast.error("Failed to fetch chart account report.");case 27:return e.prev=27,t.loadingChartAccountReport=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[0,23,27,30]])})))()},fetchMinistryReport:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,d,m,v,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.loadingMinistryReport=!0,r=[],n=1,o=1;case 5:return e.next=7,t.$axios.get("/api/settlements",{params:{isPosted:!0,include:["ministry","currency"],page:n,limit:50}});case 7:d=e.sent,m=(null===(c=d.data.data)||void 0===c?void 0:c.settlements)||[],r=r.concat(m),(v=null===(l=d.data.data)||void 0===l?void 0:l.pagination)&&(o=v.totalPages),n++;case 13:if(n<=o){e.next=5;break}case 14:h=new Map,f=new Set,r.forEach((function(t){var e,r,n,o,c=t.ministry;c?(r=c.id,n=c.ministryName,o=c.ministryCode):(r="NO_MINISTRY",n="No Ministry Assigned",o="N/A");var l=(null===(e=t.currency)||void 0===e?void 0:e.code)||"LAK",d=parseFloat(t.exchangeRate)||1,m=parseFloat(t.amount)||0,v=m*d;f.add(l),h.has(r)||h.set(r,{ministryId:r,ministryName:n,ministryCode:o,settlementCount:0,totalLakEquivalent:0,amounts:{}});var _=h.get(r);_.settlementCount+=1,_.totalLakEquivalent+=v,_.amounts[l]=(_.amounts[l]||0)+m})),t.currencyList=Array.from(f).sort(),t.ministrySummaryReport=Array.from(h.values()).sort((function(a,b){return"NO_MINISTRY"===a.ministryId?1:"NO_MINISTRY"===b.ministryId?-1:a.ministryName.localeCompare(b.ministryName)})),t.ministryTotals={totalLakEquivalent:t.ministrySummaryReport.reduce((function(t,e){return t+e.totalLakEquivalent}),0),currencyTotals:{}},t.currencyList.forEach((function(e){t.ministryTotals.currencyTotals[e]=t.ministrySummaryReport.reduce((function(t,r){return t+(r.amounts[e]||0)}),0)})),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error fetching ministry report:",e.t0),t.$toast.error("Failed to fetch ministry report.");case 27:return e.prev=27,t.loadingMinistryReport=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[0,23,27,30]])})))()},fetchBankAccountReport:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,d,m,v,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.loadingBankAccountReport=!0,r=[],n=1,o=1;case 5:return e.next=7,t.$axios.get("/api/settlements",{params:{isPosted:!0,include:["bankAccount","currency"],page:n,limit:50}});case 7:d=e.sent,m=(null===(c=d.data.data)||void 0===c?void 0:c.settlements)||[],r=r.concat(m),(v=null===(l=d.data.data)||void 0===l?void 0:l.pagination)&&(o=v.totalPages),n++;case 13:if(n<=o){e.next=5;break}case 14:h=new Map,f=new Set,r.forEach((function(t){var e,r,n,o,c,l,d=t.bankAccount;d?(r=d.id,n=d.accountNumber,o=d.accountName,c=d.bankName,l=d.accountType):(r="NO_BANK_ACCOUNT",n="N/A",o="Cash Transaction",c="No Bank",l="Cash");var m=(null===(e=t.currency)||void 0===e?void 0:e.code)||"LAK",v=parseFloat(t.exchangeRate)||1,_=parseFloat(t.amount)||0,k=_*v;f.add(m),h.has(r)||h.set(r,{bankAccountId:r,accountNumber:n,accountName:o,bankName:c,accountType:l,settlementCount:0,totalLakEquivalent:0,amounts:{}});var x=h.get(r);x.settlementCount+=1,x.totalLakEquivalent+=k,x.amounts[m]=(x.amounts[m]||0)+_})),t.currencyList=Array.from(f).sort(),t.bankAccountSummaryReport=Array.from(h.values()).sort((function(a,b){if("NO_BANK_ACCOUNT"===a.bankAccountId)return 1;if("NO_BANK_ACCOUNT"===b.bankAccountId)return-1;var t=a.bankName.localeCompare(b.bankName);return 0!==t?t:a.accountName.localeCompare(b.accountName)})),t.bankAccountTotals={totalLakEquivalent:t.bankAccountSummaryReport.reduce((function(t,b){return t+b.totalLakEquivalent}),0),currencyTotals:{}},t.currencyList.forEach((function(e){t.bankAccountTotals.currencyTotals[e]=t.bankAccountSummaryReport.reduce((function(t,b){return t+(b.amounts[e]||0)}),0)})),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error fetching bank account report:",e.t0),t.$toast.error("Failed to fetch bank account report.");case 27:return e.prev=27,t.loadingBankAccountReport=!1,e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[0,23,27,30]])})))()},onTableOptionsUpdate:function(t){this.tableOptions=t,this.fetchSettlements()},changeSort:function(t){this.tableOptions.sortBy[0]===t?this.tableOptions.sortDesc[0]=!this.tableOptions.sortDesc[0]:(this.tableOptions.sortBy=[t],this.tableOptions.sortDesc=[!1]),this.fetchSettlements()},getSortIcon:function(t){return this.tableOptions.sortBy[0]!==t?"mdi-sort":this.tableOptions.sortDesc[0]?"mdi-sort-descending":"mdi-sort-ascending"},viewSettlement:function(t){this.dialogMode="view",this.currentSettlement=t,this.dialog=!0},closeDialog:function(){this.dialog=!1,this.dialogMode="create",this.currentSettlement={},this.$refs.form&&this.$refs.form.reset()},saveSettlement:function(){var t=this;return Object(F.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$refs.form.validate()){e.next=2;break}return e.abrupt("return");case 2:if(t.saving=!0,e.prev=3,"create"!==t.dialogMode){e.next=10;break}return e.next=7,t.$axios.post("/api/settlements",t.settlementForm);case 7:t.$toast.success("Settlement created successfully"),e.next=13;break;case 10:return e.next=12,t.$axios.put("/api/settlements/".concat(t.settlementForm.id),t.settlementForm);case 12:t.$toast.success("Settlement updated successfully");case 13:return t.closeDialog(),e.next=16,t.loadInitialData();case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),console.error("Error saving settlement:",e.t0),t.$toast.error((null===(r=e.t0.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Failed to save settlement");case 22:return e.prev=22,t.saving=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,18,22,25]])})))()},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},formatAmount:function(t){return t?parseFloat(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatMethod:function(t){return{cash:"Cash Payment",bank_transfer:"Bank Transfer",deduction:"Salary Deduction"}[t]||t},getMethodColor:function(t){return{cash:"#01532B",bank_transfer:"#059669",deduction:"#F59E0B"}[t]||"grey"},getMethodIcon:function(t){return{cash:"mdi-cash",bank_transfer:"mdi-bank",deduction:"mdi-minus-circle"}[t]||"mdi-help-circle"},getStatusColor:function(t){return{approved:"#059669",settled:"#01532B",pending:"#F59E0B",rejected:"#DC2626"}[t]||"grey"},getStatusIcon:function(t){return{approved:"mdi-check-circle",settled:"mdi-check-all",pending:"mdi-clock-outline",rejected:"mdi-close-circle"}[t]||"mdi-help-circle"},getInitials:function(t){return t?t.split(" ").map((function(t){return t[0]})).join("").toUpperCase().slice(0,2):"?"},getCurrencySymbol:function(t){return{USD:"$",LAK:"₭",THB:"฿",BTH:"฿",EUR:"€",CNY:"¥",VND:"₫"}[t]||"₭"}}}),O=E,D=(r(1641),r(31)),component=Object(D.a)(O,(function(){var t,e=this,r=e._self._c;return r(v.a,{staticClass:"pa-4",attrs:{fluid:""}},[r(R.a,{staticClass:"mb-4"},[r(m.a,{attrs:{cols:"12",md:"8"}},[r("h1",{staticClass:"text-h4 font-weight-bold banking-primary--text"},[e._v("\n        ກະດານ ລາຍຮັບ\n      ")]),e._v(" "),r("p",{staticClass:"text-subtitle-1 grey--text"},[e._v("\n        Manage and monitor all settlement transactions\n      ")])]),e._v(" "),r(m.a,{staticClass:"text-right",attrs:{cols:"12",md:"4"}},[r(o.a,{attrs:{color:"#01532B",large:"",outlined:"",loading:e.loading},on:{click:e.refreshData}},[r(x.a,{attrs:{left:""}},[e._v("mdi-refresh")]),e._v("\n        Refresh\n      ")],1)],1)],1),e._v(" "),r(R.a,{staticClass:"mb-6"},[r(m.a,{attrs:{cols:"12",sm:"6",md:"3"}},[r(c.a,{staticClass:"text-center summary-card",attrs:{color:"#01532B",dark:"",elevation:"3"}},[r(l.c,{staticClass:"pb-2"},[r(x.a,{staticClass:"mb-2",attrs:{size:"40"}},[e._v("mdi-file-document-multiple")]),e._v(" "),r("div",{staticClass:"text-h4 font-weight-bold"},[e._v("\n            "+e._s(e.stats.totalCount||0)+"\n          ")]),e._v(" "),r("div",{staticClass:"text-subtitle-1"},[e._v("Total Settlements")])],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",sm:"6",md:"3"}},[r(c.a,{staticClass:"text-center summary-card",attrs:{color:"#059669",dark:"",elevation:"3"}},[r(l.c,{staticClass:"pb-2"},[r(x.a,{staticClass:"mb-2",attrs:{size:"40"}},[e._v("mdi-currency-usd")]),e._v(" "),r("div",{staticClass:"text-h5 font-weight-bold"},[e._v("\n            ₭"+e._s(e.formatAmount(e.stats.totalAmount)||"0.00")+"\n          ")]),e._v(" "),r("div",{staticClass:"text-subtitle-1"},[e._v("Total Amount")])],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",sm:"6",md:"3"}},[r(c.a,{staticClass:"text-center summary-card",attrs:{color:"#0D7C66",dark:"",elevation:"3"}},[r(l.c,{staticClass:"pb-2"},[r(x.a,{staticClass:"mb-2",attrs:{size:"40"}},[e._v("mdi-calendar-month")]),e._v(" "),r("div",{staticClass:"text-h4 font-weight-bold"},[e._v("\n            "+e._s(e.stats.thisMonth||0)+"\n          ")]),e._v(" "),r("div",{staticClass:"text-subtitle-1"},[e._v("This Month")])],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",sm:"6",md:"3"}},[r(c.a,{staticClass:"text-center summary-card",attrs:{color:"#F59E0B",dark:"",elevation:"3"}},[r(l.c,{staticClass:"pb-2"},[r(x.a,{staticClass:"mb-2",attrs:{size:"40"}},[e._v("mdi-clock-outline")]),e._v(" "),r("div",{staticClass:"text-h4 font-weight-bold"},[e._v(e._s(e.stats.pending||0))]),e._v(" "),r("div",{staticClass:"text-subtitle-1"},[e._v("Pending")])],1)],1)],1)],1),e._v(" "),r(c.a,{staticClass:"data-table-card",attrs:{elevation:"2"}},[r(l.d,{staticClass:"banking-primary--text data-table-header"},[r(x.a,{staticClass:"mr-2",attrs:{color:"#01532B"}},[e._v("mdi-table")]),e._v("\n      ລາຍຮັບ\n      "),r(S.a),e._v(" "),r(d.a,{attrs:{color:"#01532B",outlined:""}},[e._v("\n        "+e._s(e.pagination.totalItems)+" Total Records\n      ")])],1),e._v(" "),r(_.a,{staticClass:"banking-divider"}),e._v(" "),r(h.a,{staticClass:"elevation-0 banking-data-table",attrs:{headers:e.tableHeaders,items:e.settlements,loading:e.loading,"server-items-length":e.pagination.totalItems,options:e.tableOptions,"footer-props":{"items-per-page-options":[10,25,50,100],"show-current-page":!0,"show-first-last-page":!0},"loading-text":"Loading settlements...","no-data-text":"No settlements found"},on:{"update:options":[function(t){e.tableOptions=t},e.onTableOptionsUpdate]},scopedSlots:e._u([{key:"header",fn:function(t){var n=t.props;return[r("thead",{staticClass:"banking-table-header"},[r("tr",e._l(n.headers,(function(header){return r("th",{key:header.text,staticClass:"white--text font-weight-bold",class:[!1!==header.sortable?"sortable":""],on:{click:function(t){!1!==header.sortable&&e.changeSort(header.value)}}},[e._v("\n              "+e._s(header.text)+"\n              "),!1!==header.sortable?r(x.a,{staticClass:"ml-1",attrs:{color:"white",small:""}},[e._v("\n                "+e._s(e.getSortIcon(header.value))+"\n              ")]):e._e()],1)})),0)])]}},{key:"item.bookingDate",fn:function(t){var n=t.item;return[r(d.a,{staticClass:"date-chip",attrs:{small:"",color:"#F3F4F6"}},[r(x.a,{attrs:{left:"",small:"",color:"#01532B"}},[e._v("mdi-calendar")]),e._v("\n          "+e._s(e.formatDate(n.bookingDate))+"\n        ")],1)]}},{key:"item.amount",fn:function(t){var n,o=t.item;return[r("div",[r("span",{staticClass:"font-weight-bold text-h6 banking-success--text"},[e._v("\n            "+e._s(e.getCurrencySymbol(null===(n=o.currency)||void 0===n?void 0:n.code))+e._s(e.formatAmount(o.amount))+"\n          ")]),e._v(" "),o.currency&&"LAK"!==o.currency.code?r("div",{staticClass:"text-caption grey--text"},[e._v("\n            "+e._s(o.currency.code)+" @ "+e._s(o.exchangeRate||1)+"\n          ")]):e._e()])]}},{key:"item.method",fn:function(t){var n=t.item;return[r(d.a,{attrs:{color:e.getMethodColor(n.method),small:"",dark:""}},[r(x.a,{attrs:{left:"","x-small":""}},[e._v(e._s(e.getMethodIcon(n.method)))]),e._v("\n          "+e._s(e.formatMethod(n.method))+"\n        ")],1)]}},{key:"item.proceeder",fn:function(t){var o=t.item;return[o.proceeder?r("div",{staticClass:"d-flex align-center"},[r(n.a,{staticClass:"mr-2",attrs:{size:"24",color:"#01532B"}},[r("span",{staticClass:"white--text text-caption"},[e._v("\n              "+e._s(e.getInitials(o.proceeder.cus_name||o.proceeder.cus_email))+"\n            ")])]),e._v(" "),r("div",[r("div",{staticClass:"font-weight-medium"},[e._v("\n              "+e._s(o.proceeder.cus_name||o.proceeder.cus_email)+"\n            ")]),e._v(" "),r("div",{staticClass:"text-caption grey--text"},[e._v("\n              "+e._s(o.proceeder.cus_email)+"\n            ")])])],1):r("span",{staticClass:"grey--text"},[e._v("N/A")])]}},{key:"item.moneyAdvance",fn:function(t){var n=t.item;return[n.moneyAdvance?r("div",[r(d.a,{staticClass:"mb-1",attrs:{"x-small":"",color:"#01532B",dark:""}},[e._v("\n            #"+e._s(n.moneyAdvance.id)+"\n          ")]),e._v(" "),r("br"),e._v(" "),r(d.a,{attrs:{"x-small":"",color:e.getStatusColor(n.moneyAdvance.status),dark:""}},[e._v("\n            "+e._s(n.moneyAdvance.status)+"\n          ")])],1):r(d.a,{attrs:{"x-small":"",color:"grey",dark:""}},[e._v(" Independent ")])]}},{key:"item.status",fn:function(t){var n=t.item;return[n.moneyAdvance?r(d.a,{attrs:{color:e.getStatusColor(n.moneyAdvance.status),small:"",dark:""}},[r(x.a,{attrs:{left:"","x-small":""}},[e._v(e._s(e.getStatusIcon(n.moneyAdvance.status)))]),e._v("\n          "+e._s(n.moneyAdvance.status)+"\n        ")],1):r(d.a,{attrs:{color:"grey",small:"",dark:""}},[r(x.a,{attrs:{left:"","x-small":""}},[e._v("mdi-check-circle")]),e._v("\n          Independent\n        ")],1)]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticClass:"d-flex"},[r(M.a,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var c=t.on,l=t.attrs;return[r(o.a,e._g(e._b({attrs:{icon:"","x-small":"",color:"#01532B"},on:{click:function(t){return e.viewSettlement(n)}}},"v-btn",l,!1),c),[r(x.a,{attrs:{small:""}},[e._v("mdi-eye")])],1)]}}],null,!0)},[e._v(" "),r("span",[e._v("View Details")])])],1)]}}])})],1),e._v(" "),r(f.a,{attrs:{"max-width":"900px",persistent:"",scrollable:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r(c.a,[r(l.d,{staticClass:"dialog-header white--text"},[r(x.a,{staticClass:"mr-2",attrs:{color:"white"}},[e._v("\n          "+e._s("create"===e.dialogMode?"mdi-plus":"edit"===e.dialogMode?"mdi-pencil":"mdi-eye")+"\n        ")]),e._v("\n        "+e._s(e.dialogTitle)+"\n        "),r(S.a),e._v(" "),r(o.a,{attrs:{icon:"",dark:""},on:{click:e.closeDialog}},[r(x.a,[e._v("mdi-close")])],1)],1),e._v(" "),r(l.c,{staticClass:"pt-6"},["view"!==e.dialogMode?r(k.a,{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r(R.a,[r(m.a,{attrs:{cols:"12",md:"6"}},[r(N.a,{attrs:{type:"date",label:"Booking Date","prepend-icon":"mdi-calendar",rules:[e.rules.required],outlined:"",required:"",color:"#01532B"},model:{value:e.settlementForm.bookingDate,callback:function(t){e.$set(e.settlementForm,"bookingDate",t)},expression:"settlementForm.bookingDate"}})],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(N.a,{attrs:{type:"number",step:"0.01",label:"Amount","prepend-icon":"mdi-currency-usd",rules:[e.rules.required,e.rules.positiveNumber],outlined:"",required:"",color:"#01532B"},model:{value:e.settlementForm.amount,callback:function(t){e.$set(e.settlementForm,"amount",t)},expression:"settlementForm.amount"}})],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(w.a,{attrs:{items:e.methodSelectOptions,label:"Payment Method","prepend-icon":"mdi-credit-card",rules:[e.rules.required],outlined:"",required:"",color:"#01532B"},model:{value:e.settlementForm.method,callback:function(t){e.$set(e.settlementForm,"method",t)},expression:"settlementForm.method"}})],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(N.a,{attrs:{type:"number",step:"0.0001",label:"Exchange Rate","prepend-icon":"mdi-swap-horizontal",placeholder:"1.0000",outlined:"",color:"#01532B"},model:{value:e.settlementForm.exchangeRate,callback:function(t){e.$set(e.settlementForm,"exchangeRate",t)},expression:"settlementForm.exchangeRate"}})],1),e._v(" "),r(m.a,{attrs:{cols:"12"}},[r(T.a,{attrs:{label:"Notes","prepend-icon":"mdi-note-text",rows:"3",outlined:"","no-resize":"",color:"#01532B"},model:{value:e.settlementForm.notes,callback:function(t){e.$set(e.settlementForm,"notes",t)},expression:"settlementForm.notes"}})],1)],1)],1):r("div",[r(R.a,[r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,[r(A.a,[r(x.a,{attrs:{color:"#01532B"}},[e._v("mdi-calendar")])],1),e._v(" "),r(C.a,[r(C.c,{staticClass:"font-weight-bold"},[e._v("Booking Date")]),e._v(" "),r(C.b,{staticClass:"text-h6"},[e._v(e._s(e.formatDate(e.currentSettlement.bookingDate)))])],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,[r(A.a,[r(x.a,{attrs:{color:"#059669"}},[e._v("mdi-currency-usd")])],1),e._v(" "),r(C.a,[r(C.c,{staticClass:"font-weight-bold"},[e._v("Amount")]),e._v(" "),r(C.b,{staticClass:"text-h5 font-weight-bold banking-success--text"},[e._v("\n                    "+e._s(e.getCurrencySymbol(null===(t=e.currentSettlement.currency)||void 0===t?void 0:t.code))+e._s(e.formatAmount(e.currentSettlement.amount))+"\n                  ")])],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,[r(A.a,[r(x.a,{attrs:{color:e.getMethodColor(e.currentSettlement.method)}},[e._v(e._s(e.getMethodIcon(e.currentSettlement.method)))])],1),e._v(" "),r(C.a,[r(C.c,{staticClass:"font-weight-bold"},[e._v("Payment Method")]),e._v(" "),r(C.b,[r(d.a,{attrs:{color:e.getMethodColor(e.currentSettlement.method),small:"",dark:""}},[e._v("\n                      "+e._s(e.formatMethod(e.currentSettlement.method))+"\n                    ")])],1)],1)],1)],1),e._v(" "),r(m.a,{attrs:{cols:"12",md:"6"}},[r(y.a,[r(A.a,[r(x.a,{attrs:{color:"#01532B"}},[e._v("mdi-swap-horizontal")])],1),e._v(" "),r(C.a,[r(C.c,{staticClass:"font-weight-bold"},[e._v("Exchange Rate")]),e._v(" "),r(C.b,{staticClass:"text-h6"},[e._v(e._s(e.currentSettlement.exchangeRate||"1.0000"))])],1)],1)],1),e._v(" "),e.currentSettlement.notes?r(m.a,{attrs:{cols:"12"}},[r(y.a,[r(A.a,[r(x.a,{attrs:{color:"grey"}},[e._v("mdi-note-text")])],1),e._v(" "),r(C.a,[r(C.c,{staticClass:"font-weight-bold"},[e._v("Notes")]),e._v(" "),r(C.b,[e._v(e._s(e.currentSettlement.notes))])],1)],1)],1):e._e()],1)],1)],1),e._v(" "),r(_.a),e._v(" "),r(l.a,{staticClass:"pa-4"},[r(S.a),e._v(" "),r(o.a,{attrs:{outlined:""},on:{click:e.closeDialog}},[e._v("\n          "+e._s("view"===e.dialogMode?"Close":"Cancel")+"\n        ")]),e._v(" "),"view"!==e.dialogMode?r(o.a,{staticClass:"ml-2",attrs:{color:"#01532B",loading:e.saving,disabled:!e.formValid,dark:""},on:{click:e.saveSettlement}},[r(x.a,{attrs:{left:""}},[e._v(e._s("create"===e.dialogMode?"mdi-plus":"mdi-content-save"))]),e._v("\n          "+e._s("create"===e.dialogMode?"Create":"Update")+"\n        ")],1):e._e()],1)],1)],1)],1)}),[],!1,null,"ebeb1d9c",null);e.default=component.exports}}]);