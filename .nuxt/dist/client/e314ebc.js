(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{1284:function(e,t,r){var content=r(1588);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(15).default)("922ad2ca",content,!0,{sourceMap:!1})},1587:function(e,t,r){"use strict";r(1284)},1588:function(e,t,r){var n=r(14)((function(i){return i[1]}));n.push([e.i,'.customer-display-container[data-v-1fef85ee]{background:linear-gradient(135deg,#f8f9fa,#e9ecef);font-family:"Roboto","Arial",sans-serif;min-height:100vh;overflow:hidden}.dcommerce-green[data-v-1fef85ee]{background-color:#01532b!important}.dcommerce-green-text[data-v-1fef85ee]{color:#01532b!important}.welcome-screen[data-v-1fef85ee]{align-items:center;display:flex;flex-direction:column;height:100vh;justify-content:center;padding:2rem;text-align:center}.logo-section[data-v-1fef85ee]{margin-bottom:3rem}.store-name[data-v-1fef85ee]{color:#01532b;font-size:3rem;font-weight:700;letter-spacing:-1px;margin:1rem 0}.welcome-text[data-v-1fef85ee]{color:#6c757d;font-size:1.5rem;margin:.5rem 0}.status-text[data-v-1fef85ee]{color:#01532b;font-size:1.2rem;font-weight:500;margin:.5rem 0}.waiting-animation[data-v-1fef85ee]{align-items:center;display:flex;flex-direction:column}.waiting-text[data-v-1fef85ee]{color:#6c757d;font-size:1.1rem;margin:0}.qr-payment-screen[data-v-1fef85ee]{height:100vh;padding:1.5rem}.payment-layout[data-v-1fef85ee]{display:flex;gap:2rem;height:100%}.order-section[data-v-1fef85ee]{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.1);display:flex;flex:1;flex-direction:column;overflow:hidden}.order-header[data-v-1fef85ee]{align-items:center;background:#01532b;color:#fff;display:flex;justify-content:space-between;padding:1.5rem}.order-title[data-v-1fef85ee]{font-size:1.5rem;font-weight:600;margin:0}.table-badge[data-v-1fef85ee]{background:hsla(0,0%,100%,.2);border-radius:20px;font-size:.9rem;font-weight:500;padding:.5rem 1rem}.order-items[data-v-1fef85ee]{flex:1;overflow-y:auto;padding:1.5rem}.items-list[data-v-1fef85ee]{space-y:1rem}.order-item[data-v-1fef85ee]{align-items:center;border:1px solid #e9ecef;border-radius:12px;display:flex;margin-bottom:.75rem;padding:1rem;transition:background-color .2s}.order-item[data-v-1fef85ee]:hover{background-color:#f8f9fa}.item-details[data-v-1fef85ee]{flex:1}.item-name[data-v-1fef85ee]{color:#212529;font-size:1rem;font-weight:600;margin-bottom:.25rem}.item-description[data-v-1fef85ee]{color:#6c757d;font-size:.85rem}.item-quantity[data-v-1fef85ee]{color:#01532b;font-weight:600;margin:0 1rem;min-width:40px;text-align:center}.item-price[data-v-1fef85ee]{color:#01532b;font-size:1rem;font-weight:700;min-width:80px;text-align:right}.no-items[data-v-1fef85ee]{padding:3rem 1rem;text-align:center}.order-summary[data-v-1fef85ee]{background:#f8f9fa;border-top:2px solid #e9ecef;padding:1.5rem}.summary-line[data-v-1fef85ee]{font-size:.95rem;margin-bottom:.5rem}.summary-line[data-v-1fef85ee],.summary-total[data-v-1fef85ee]{display:flex;justify-content:space-between}.summary-total[data-v-1fef85ee]{border-top:2px solid #01532b;color:#01532b;font-size:1.25rem;font-weight:700;margin-top:.75rem;padding-top:.75rem}.discount[data-v-1fef85ee]{color:#dc3545}.payment-section[data-v-1fef85ee]{align-items:center;display:flex;flex:1;flex-direction:column;text-align:center}.payment-header[data-v-1fef85ee]{margin-bottom:1.5rem}.payment-title[data-v-1fef85ee]{color:#01532b;font-size:2rem;font-weight:700;margin:0}.amount-display[data-v-1fef85ee]{background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(1,83,43,.15);margin-bottom:2rem;min-width:280px;padding:1.5rem}.amount-label[data-v-1fef85ee]{color:#6c757d;font-size:1rem;margin-bottom:.5rem}.amount-value[data-v-1fef85ee]{color:#01532b;font-size:2.5rem;font-weight:700;line-height:1}.currency-label[data-v-1fef85ee]{color:#6c757d;font-size:.9rem;margin-top:.5rem}.qr-container[data-v-1fef85ee]{margin-bottom:1.5rem}.qr-wrapper[data-v-1fef85ee]{background:#fff;border:3px solid #01532b;border-radius:20px;box-shadow:0 15px 45px rgba(1,83,43,.2);padding:1.5rem}.qr-code-image[data-v-1fef85ee]{display:block;height:240px;width:240px}.qr-instructions[data-v-1fef85ee]{margin-bottom:1.5rem}.instruction-steps[data-v-1fef85ee]{display:flex;justify-content:space-around;margin:0 auto;max-width:400px}.step[data-v-1fef85ee]{align-items:center;color:#6c757d;display:flex;flex-direction:column;font-size:.85rem;text-align:center}.step-icon[data-v-1fef85ee]{color:#01532b!important;margin-bottom:.5rem}.payment-status[data-v-1fef85ee]{align-items:center;display:flex;justify-content:center;margin-bottom:1rem}.status-text[data-v-1fef85ee]{font-weight:600}.timer-display[data-v-1fef85ee]{color:#6c757d;font-size:.9rem}.timer-text[data-v-1fef85ee]{font-weight:500}.success-overlay[data-v-1fef85ee]{background:rgba(40,167,69,.95)!important}.success-content[data-v-1fef85ee]{color:#fff;max-width:600px;padding:3rem;text-align:center}.success-icon[data-v-1fef85ee]{animation:successPulse-1fef85ee 1s ease-in-out}@keyframes successPulse-1fef85ee{0%{opacity:0;transform:scale(.8)}50%{transform:scale(1.1)}to{opacity:1;transform:scale(1)}}.success-title[data-v-1fef85ee]{font-size:2.5rem}.success-amount[data-v-1fef85ee],.success-title[data-v-1fef85ee]{font-weight:700;margin-bottom:1rem}.success-amount[data-v-1fef85ee]{font-size:2rem}.success-message[data-v-1fef85ee]{font-size:1.3rem;margin-bottom:.5rem}.success-submessage[data-v-1fef85ee]{font-size:1rem;opacity:.9}.success-timer[data-v-1fef85ee]{margin:0 auto;max-width:300px}@media (max-width:1200px){.payment-layout[data-v-1fef85ee]{flex-direction:column;gap:1rem}.order-section[data-v-1fef85ee]{max-height:40vh}.qr-code-image[data-v-1fef85ee]{height:200px;width:200px}}@media (max-width:768px){.qr-payment-screen[data-v-1fef85ee]{padding:1rem}.order-item[data-v-1fef85ee]{padding:.75rem}.item-name[data-v-1fef85ee]{font-size:.9rem}.amount-value[data-v-1fef85ee]{font-size:2rem}}',""]),n.locals={},e.exports=n},1851:function(e,t,r){"use strict";r.r(t);var n=r(168),o=r(310),c=r(251),m=r(319),d=(r(35),r(7),r(67),r(10),r(12),r(8),r(13),r(3)),l=r(17);r(85),r(34),r(75),r(64),r(5),r(39),r(9),r(344),r(62),r(30),r(337),r(68);function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(d.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={name:"CustomerScreen",layout:"empty",data:function(){return{showQR:!1,qrData:{amount:0,tableNumber:"",qrString:"",timestamp:null,orderItems:[],orderSummary:{}},paymentComplete:!1,timeRemaining:300,timer:null,showCloseButton:!1,successTimeRemaining:5e3,successProgress:0,successTimer:null,orderItems:[],orderSummary:{subtotal:0,tax:0,taxRate:8.5,discount:0}}},computed:{qrCodeUrl:function(){if(!this.qrData.qrString)return"";var e=encodeURIComponent(this.qrData.qrString.replace(/\s/g,""));return"https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=".concat(e,"&format=png&margin=15&color=01532B&bgcolor=ffffff")}},mounted:function(){this.setupCommunication(),this.checkForExistingQR()},beforeDestroy:function(){this.cleanup()},methods:{getProductName:function(e){try{var t=this.filteredProducts.find((function(t){return t.id===parseInt(e)}));return console.info("PRODUCT ".concat(this.filteredProducts.length)),console.info("PRODUCT ".concat(JSON.stringify(this.filteredProducts))),console.info("PRODUCT ".concat(JSON.stringify(t))),(null==t?void 0:t.pro_name)||"Product ".concat(e)}catch(t){return console.error("Error getting product name:",t),"Product ".concat(e)}},setupCommunication:function(){window.addEventListener("storage",this.handleStorageChange),this.checkForExistingQR()},handleStorageChange:function(e){if("customerDisplay"===e.key){var data=e.newValue;if(data)try{var t=JSON.parse(data);this.handleDisplayMessage(t)}catch(e){console.error("Error parsing customer display data:",e)}}},checkForExistingQR:function(){var e=localStorage.getItem("customerDisplay");if(e)try{var t=JSON.parse(e);this.handleDisplayMessage(t)}catch(e){console.error("Error parsing existing customer display data:",e)}},handleDisplayMessage:function(e){console.log("Customer screen received message:",e),"SHOW_QR_PAYMENT"===e.type?this.displayQR(e.data):"HIDE_QR_PAYMENT"===e.type?this.hideQR():"PAYMENT_SUCCESS"===e.type&&this.showPaymentSuccess()},displayQR:function(data){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Displaying QR for:",data),e.qrData=v(v({},data),{},{timestamp:Date.now()}),!data.tableNumber){t.next=5;break}return t.next=5,e.loadOrderDetails(data.tableNumber);case 5:e.showQR=!0,e.paymentComplete=!1,e.startTimer();case 8:case"end":return t.stop()}}),t)})))()},loadOrderDetails:function(e){var t=this;return Object(l.a)(regeneratorRuntime.mark((function r(){var n,o,c,m,d,l,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.log("Loading order details for table:",e),r.next=4,t.$axios.get("/api/ticket/table/".concat(e,"/pending"));case 4:if(n=r.sent,0!==(o=n.data||[]).length){r.next=11;break}return console.log("No pending tickets found for table:",e),t.orderItems=[],t.orderSummary={subtotal:0,tax:0,taxRate:0,discount:0},r.abrupt("return");case 11:return c=o[0],console.log("Current ticket:",c),m=[],r.prev=14,r.next=17,t.$axios.get("/api/product/find");case 17:d=r.sent,l=d.data.data||d.data,m=l.map((function(e){return{id:e.id,name:e.pro_name,description:e.pro_desc||"",category:e.categ_name||"General",price:e.pro_price||0}})),console.log("Products loaded for mapping:",m.length),r.next=26;break;case 23:r.prev=23,r.t0=r.catch(14),console.warn("Could not fetch products for mapping:",r.t0);case 26:f=c.ticketLines||[],t.orderItems=f.map((function(line){var e=m.find((function(p){return p.id===line.productId}));return console.log(" [LINE] ".concat(JSON.stringify(m)," ")),console.log(" LINE ".concat(JSON.stringify(line)," ")),console.log(" product ".concat(JSON.stringify(e)," ")),{id:line.id,name:(null==e?void 0:e.name)||"Product ".concat(line.productId),description:(null==e?void 0:e.description)||line.specialInstructions||"",quantity:line.quantity,unitPrice:line.unitPrice,totalPrice:line.totalPrice,status:line.status}})).filter((function(e){return e.name!=="Product ".concat(e.productId)})),t.orderSummary={subtotal:c.subtotal||0,tax:c.tax||0,taxRate:c.subtotal>0?((c.tax||0)/c.subtotal*100).toFixed(1):0,discount:0,total:c.total||0},console.log("Order details loaded:",{items:t.orderItems.length,summary:t.orderSummary}),r.next=37;break;case 32:r.prev=32,r.t1=r.catch(0),console.error("Error loading order details:",r.t1),t.orderItems=[],t.orderSummary={subtotal:0,tax:0,taxRate:0,discount:0};case 37:case"end":return r.stop()}}),r,null,[[0,32],[14,23]])})))()},hideQR:function(){console.log("Hiding QR display"),this.showQR=!1,this.paymentComplete=!1,this.orderItems=[],this.stopTimer(),this.stopSuccessTimer(),localStorage.removeItem("customerDisplay")},showPaymentSuccess:function(){console.log("Showing payment success"),this.paymentComplete=!0,this.stopTimer(),this.startSuccessTimer()},startTimer:function(){var e=this;this.timeRemaining=300,this.timer=setInterval((function(){e.timeRemaining--,e.timeRemaining<=0&&e.hideQR()}),1e3)},stopTimer:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},startSuccessTimer:function(){var e=this;this.successTimeRemaining=5e3,this.successProgress=0,this.successTimer=setInterval((function(){e.successTimeRemaining-=100,e.successProgress=(5e3-e.successTimeRemaining)/5e3*100,e.successTimeRemaining<=0&&e.hideQR()}),100)},stopSuccessTimer:function(){this.successTimer&&(clearInterval(this.successTimer),this.successTimer=null)},cleanup:function(){window.removeEventListener("storage",this.handleStorageChange),this.stopTimer(),this.stopSuccessTimer()},formatPrice:function(e){if(!e)return"0 ₭";var t=new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e));return"".concat(t," ₭")},formatTime:function(e){var t=Math.floor(e/60),r=e%60;return"".concat(t,":").concat(r.toString().padStart(2,"0"))},onQRError:function(){console.error("Failed to load QR code image")}}},y=(r(1587),r(31)),component=Object(y.a)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"customer-display-container"},[e.showQR?e._e():t("div",{staticClass:"welcome-screen"},[t("div",{staticClass:"logo-section"},[t(n.a,{staticClass:"dcommerce-green-text mb-4",attrs:{size:"120"}},[e._v("mdi-storefront")]),e._v(" "),t("h1",{staticClass:"store-name"},[e._v("DCOMMERCE CAFE")]),e._v(" "),t("p",{staticClass:"welcome-text"},[e._v("Customer Display")]),e._v(" "),t("p",{staticClass:"status-text"},[e._v("Ready for QR Payment")])],1),e._v(" "),t("div",{staticClass:"waiting-animation"},[t(c.a,{staticClass:"mb-4",attrs:{indeterminate:"",color:"#01532B",size:"64",width:"4"}}),e._v(" "),t("p",{staticClass:"waiting-text"},[e._v("Waiting for payment request...")])],1)]),e._v(" "),e.showQR?t("div",{staticClass:"qr-payment-screen"},[t("div",{staticClass:"payment-layout"},[t("div",{staticClass:"order-section"},[t("div",{staticClass:"order-header"},[t("h3",{staticClass:"order-title"},[e._v("Your Order")]),e._v(" "),e.qrData.tableNumber?t("div",{staticClass:"table-badge"},[t(n.a,{staticClass:"mr-1",attrs:{small:""}},[e._v("mdi-table-furniture")]),e._v("\n            Table "+e._s(e.qrData.tableNumber)+"\n          ")],1):e._e()]),e._v(" "),t("div",{staticClass:"order-items"},[e.orderItems.length>0?t("div",{staticClass:"items-list"},e._l(e.orderItems,(function(r,n){return t("div",{key:n,staticClass:"order-item"},[t("div",{staticClass:"item-details"},[t("div",{staticClass:"item-name"},[e._v(e._s(r.name))]),e._v(" "),r.description?t("div",{staticClass:"item-description"},[e._v("\n                  "+e._s(r.description)+"\n                ")]):e._e()]),e._v(" "),t("div",{staticClass:"item-quantity"},[e._v(e._s(r.quantity)+"x")]),e._v(" "),t("div",{staticClass:"item-price"},[e._v(e._s(e.formatPrice(r.totalPrice)))])])})),0):t("div",{staticClass:"no-items"},[t(n.a,{staticClass:"mb-2",attrs:{size:"48",color:"grey lighten-2"}},[e._v("mdi-cart-outline")]),e._v(" "),t("p",{staticClass:"grey--text"},[e._v("Loading order details...")])],1)]),e._v(" "),t("div",{staticClass:"order-summary"},[t("div",{staticClass:"summary-line"},[t("span",[e._v("Subtotal:")]),e._v(" "),t("span",[e._v(e._s(e.formatPrice(e.orderSummary.subtotal)))])]),e._v(" "),e.orderSummary.tax>0?t("div",{staticClass:"summary-line"},[t("span",[e._v("Tax ("+e._s(e.orderSummary.taxRate)+"%):")]),e._v(" "),t("span",[e._v(e._s(e.formatPrice(e.orderSummary.tax)))])]):e._e(),e._v(" "),e.orderSummary.discount>0?t("div",{staticClass:"summary-line"},[t("span",[e._v("Discount:")]),e._v(" "),t("span",{staticClass:"discount"},[e._v("-"+e._s(e.formatPrice(e.orderSummary.discount)))])]):e._e(),e._v(" "),t("div",{staticClass:"summary-total"},[t("span",[e._v("Total:")]),e._v(" "),t("span",[e._v(e._s(e.formatPrice(e.qrData.amount)))])])])]),e._v(" "),t("div",{staticClass:"payment-section"},[e._m(0),e._v(" "),t("div",{staticClass:"amount-display"},[t("div",{staticClass:"amount-label"},[e._v("Total Amount")]),e._v(" "),t("div",{staticClass:"amount-value"},[e._v(e._s(e.formatPrice(e.qrData.amount)))]),e._v(" "),t("div",{staticClass:"currency-label"},[e._v("Lao Kip (LAK)")])]),e._v(" "),t("div",{staticClass:"qr-container"},[t("div",{staticClass:"qr-wrapper"},[t("img",{staticClass:"qr-code-image",attrs:{src:e.qrCodeUrl,alt:"Payment QR Code"},on:{error:e.onQRError}})])]),e._v(" "),t("div",{staticClass:"qr-instructions"},[t("div",{staticClass:"instruction-steps"},[t("div",{staticClass:"step"},[t(n.a,{staticClass:"step-icon"},[e._v("mdi-numeric-1-circle")]),e._v("\n              Open banking app\n            ")],1),e._v(" "),t("div",{staticClass:"step"},[t(n.a,{staticClass:"step-icon"},[e._v("mdi-numeric-2-circle")]),e._v("\n              Scan QR code\n            ")],1),e._v(" "),t("div",{staticClass:"step"},[t(n.a,{staticClass:"step-icon"},[e._v("mdi-numeric-3-circle")]),e._v("\n              Confirm payment\n            ")],1)])]),e._v(" "),t("div",{staticClass:"payment-status"},[e.paymentComplete?t(n.a,{staticClass:"mr-2",attrs:{color:"success",size:"20"}},[e._v("mdi-check-circle")]):t(c.a,{staticClass:"mr-2",attrs:{indeterminate:"",color:"#01532B",size:"20"}}),e._v(" "),t("span",{staticClass:"status-text",class:e.paymentComplete?"success--text":"dcommerce-green-text"},[e._v("\n            "+e._s(e.paymentComplete?"Payment Received!":"Waiting for payment...")+"\n          ")])],1),e._v(" "),e.timeRemaining>0&&!e.paymentComplete?t("div",{staticClass:"timer-display"},[t(n.a,{staticClass:"mr-1",attrs:{small:""}},[e._v("mdi-timer-outline")]),e._v(" "),t("span",{staticClass:"timer-text"},[e._v("Expires in: "+e._s(e.formatTime(e.timeRemaining)))])],1):e._e()])])]):e._e(),e._v(" "),e.paymentComplete?t(o.a,{staticClass:"success-overlay"},[t("div",{staticClass:"success-content"},[t(n.a,{staticClass:"mb-4 success-icon",attrs:{size:"100",color:"white"}},[e._v("mdi-check-circle")]),e._v(" "),t("h2",{staticClass:"success-title"},[e._v("Payment Successful!")]),e._v(" "),t("div",{staticClass:"success-amount"},[e._v(e._s(e.formatPrice(e.qrData.amount)))]),e._v(" "),t("p",{staticClass:"success-message"},[e._v("Thank you for your payment")]),e._v(" "),t("p",{staticClass:"success-submessage"},[e._v("Please keep your receipt")]),e._v(" "),t("div",{staticClass:"success-timer mt-4"},[t(m.a,{attrs:{value:e.successProgress,color:"white","background-color":"rgba(255,255,255,0.3)",height:"4",rounded:""}}),e._v(" "),t("p",{staticClass:"caption mt-2"},[e._v("Screen will reset in "+e._s(Math.ceil(e.successTimeRemaining/1e3))+"s")])],1)],1)]):e._e()],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"payment-header"},[e("h2",{staticClass:"payment-title"},[this._v("Scan to Pay")])])}],!1,null,"1fef85ee",null);t.default=component.exports}}]);