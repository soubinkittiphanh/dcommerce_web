(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{917:function(e,t,r){"use strict";r.r(t);var n=r(799),o=r(321),c=r(318),l=r(19),d=r(797),m=r(792),f=r(806),v=r(771),h=r(317),w=r(798),y=r(796),R=r(794),x=r(881),_=r(112),k=(r(63),r(35),r(69),r(54),r(7),r(67),r(93),r(17)),I=(r(85),r(24),r(34),r(38),r(52),r(113),r(5),r(8),r(831),r(873),r(53),r(39),r(342));r(37);function $(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var L={props:{isEdit:{type:Boolean,default:!1},headerId:{type:Number,default:null}},data:function(){return{productList:[],currencyList:[],showAddRowDialog:!1,dialog:!1,title:"ສ້າງ ໃບສັ່ງຊື້",valid:!1,isLoading:!1,form:{header:{bookingDate:"",deliveryDate:"",vendor:"Acme Inc.",notes:"Please deliver to loading dock B.",isActive:!0,locking_session_id:""}},rules:{required:function(e){return!!e||"This field is required"},dateAfter:function(e){return function(t){return!e||(new Date(t)>=new Date(e)||"Date must be after start date")}},dateAfterToday:function(e){return new Date(e)>=new Date||"Date must be after today"},number:function(e){return!isNaN(parseFloat(e))&&isFinite(e)||"Value must be a number"}},headers:[{text:"ສິນຄ້າ",value:"date"},{text:"ລາຄາຕໍ່ຫນ່ວຍ",value:"reach"},{text:"ຈຳນວນ",value:"results"},{text:"ສະກຸນ",value:"reach"},{text:"ອັດຕາແລກປ່ຽນ",value:"comments"},{text:"ລວມ",value:"purchaseQty"}],lines:[],lineError:[],newRow:{rate:1,qty:1,price:25,total:250,isActive:!0,currencyId:1,productId:2,locking_session_id:""}}},mounted:function(){var e=(new Date).toISOString().substr(0,10);this.form.header.bookingDate=e,this.form.header.deliveryDate=e,this.loadPurchaseOrder(),this.loadProduct(),this.loadCurrency()},computed:{dateRules:function(){return[function(e){return!!e||"Field is required"},function(e){return/^(\d{4})-(\d{2})-(\d{2})$/.test(e)||"Invalid date format (YYYY-MM-DD)"}]},rateRules:function(){return[function(e){return!!e||"Rate is required"},function(e){return/^[0-9]+(\.[0-9]{1,2})?$/.test(e)||"Rate must be a number with up to 2 decimal places"}]},qtyRules:function(){return[function(e){return!!e||"Quantity is required"},function(e){return/^\d+$/.test(e)||"Quantity must be a whole number"}]},priceRules:function(){return[function(e){return!!e||"Price is required"},function(e){return/^\d+(\.\d{1,2})?$/.test(e)||"Price must be a number with up to 2 decimal places"}]},totalRules:function(){return[function(e){return!!e||"Total is required"},function(e){return/^\d+(\.\d{1,2})?$/.test(e)||"Total must be a number with up to 2 decimal places"}]},currencyIdRules:function(){return[function(e){return!!e||"Currency ID is required"},function(e){return/^\d+$/.test(e)||"Currency ID must be a whole number"}]},productIdRules:function(){return[function(e){return!!e||"Product ID is required"},function(e){return/^\d+$/.test(e)||"Product ID must be a whole number"}]}},methods:{deleteItem:function(e){var t=this,r=this.lines.indexOf(e);r>-1&&(this.isEdit&&e.id?Object(I.a)(this.$swal,"warning",Object(k.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("Delete record function"),t.isLoading=!0,n.next=4,t.$axios.delete("/api/purchasing/line/find/".concat(e.id)).then((function(e){console.log("response=>",e.data),e.data.includes("successfully")&&t.lines.splice(r,1)})).catch((function(e){Object(I.b)(t.$swal,"ເກີດຂໍ້ຜິດພາດ",e.response.data)}));case 4:t.isLoading=!1;case 5:case"end":return n.stop()}}),n)})))):this.lines.splice(r,1))},open:function(){this.dialog=!0},close:function(){this.dialog=!1},validateLine:function(){var e=this;this.lines.forEach((function(t,r){var n=t.rate,o=t.qty,c=t.price,l=t.total,d=t.isActive,m=t.currencyId,f=t.productId;console.log("===>Rate ",n),n&&Number.isFinite(n)||e.lineError.push(" Rate must be a number"),o&&Number.isInteger(o)||e.lineError.push(" Quantity must be an integer"),c&&Number.isFinite(c)||e.lineError.push(" Price must be a number"),l&&Number.isFinite(l)||e.lineError.push(" Total must be a number"),"boolean"!=typeof d&&e.lineError.push(" isActive must be a boolean"),m&&Number.isInteger(m)||e.lineError.push(" Currency ID must be an integer"),f&&Number.isInteger(f)||e.lineError.push(" Product ID must be an integer")}))},loadPurchaseOrder:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoading=!0,!e.isEdit){t.next=4;break}return t.next=4,e.$axios.get("/api/purchasing/find/".concat(e.campaignId)).then((function(t){e.form.header=t.data,e.form.header.start=t.data.start.split("T")[0],e.form.header.end=t.data.end.split("T")[0],e.campaignEntry.length=0;var r,n=$(t.data.entries);try{for(n.s();!(r=n.n()).done;){var o=r.value,c=o;c.date=o.date.split("T")[0],e.campaignEntry.push(c)}}catch(e){n.e(e)}finally{n.f()}})).catch((function(e){console.log("Load cammpaign error",e)}));case 4:e.isLoading=!1;case 5:case"end":return t.stop()}}),t)})))()},submit:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoading){t.next=20;break}if(e.isLoading=!0,0!=e.lines.length){t.next=5;break}return e.isLoading=!1,t.abrupt("return",Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ","ບໍ່ມີລາຍການ ກະລຸນາເພີ່ມຢ່າງນ້ອຍ 1 ລາຍການ"));case 5:if(e.validateLine(),!(e.lineError.length>0)){t.next=10;break}return Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ","ກະລຸນາ ກວດຂໍ້ມູນຄືນໃຫ້ຖືກຕ້ອງ ".concat(e.lineError," ")),e.isLoading=!1,t.abrupt("return",e.lineError.length=0);case 10:if(e.form.header.lines=e.lines,!e.isEdit||!e.headerId){t.next=17;break}return console.log("====> update campaign"),t.next=15,e.$axios.put("/api/purchasing/update/".concat(e.headerId),e.form.header).then((function(t){200==t.status?Object(I.c)(e.$swal,"Succeed","ດຳເນີນການສຳເລັດ"):Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ",t.data)})).catch((function(t){Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ",t.response.data)}));case 15:t.next=19;break;case 17:return t.next=19,e.$axios.post("/api/purchasing/create",e.form.header).then((function(t){200==t.status?Object(I.c)(e.$swal,"Succeed","ດຳເນີນການສຳເລັດ"):Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ",t.data)})).catch((function(t){Object(I.b)(e.$swal,"ເກີດຂໍ້ຜິດພາດ",t.response.data)}));case 19:e.isLoading=!1;case 20:e.close();case 21:case"end":return t.stop()}}),t)})))()},addRow:function(){this.$refs.addRowForm.validate()&&(this.lines.push(this.newRow),this.newRow={rate:2.5,qty:10,price:25,total:250,isActive:!0},this.showAddRowDialog=!1)},loadProduct:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,e.$axios.get("product_mobile_f").then((function(t){e.productList=t.data.map((function(e){return e})),console.log("all data1: ",e.productList[0].img_path)})).catch((function(e){console.log("Data: "+e)}));case 3:e.isLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},loadCurrency:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,e.$axios.get("api/currency/find").then((function(t){e.currencyList=t.data.map((function(e){return e}))})).catch((function(e){console.log("Data: "+e)}));case 3:e.isLoading=!1;case 4:case"end":return t.stop()}}),t)})))()}}},A=r(31),component=Object(A.a)(L,(function(){var e=this,t=e._self._c;return t("div",[t(v.a,{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}},[t("loading-indicator")],1),e._v(" "),t(v.a,{attrs:{"max-width":"800"},model:{value:e.showAddRowDialog,callback:function(t){e.showAddRowDialog=t},expression:"showAddRowDialog"}},[t(c.a,[t(l.d,[e._v("ເພີ່ມລາຍການໃຫມ່")]),e._v(" "),t(l.c,[t(w.a,{ref:"addRowForm"},[t(n.a,{attrs:{"item-text":"pro_name","item-value":"id",items:e.productList,label:"ເລືອກສິນຄ້າ *",rules:e.productIdRules},model:{value:e.newRow.productId,callback:function(t){e.$set(e.newRow,"productId",t)},expression:"newRow.productId"}}),e._v(" "),t(_.a,{attrs:{type:"number",step:"0.01",min:"0",label:"ລາຄາຕໍ່ຫນ່ວຍ",required:"",rules:e.priceRules},model:{value:e.newRow.price,callback:function(t){e.$set(e.newRow,"price",e._n(t))},expression:"newRow.price"}}),e._v(" "),t(_.a,{attrs:{type:"number",label:"ຈຳນວນ",required:"",rules:e.qtyRules},model:{value:e.newRow.qty,callback:function(t){e.$set(e.newRow,"qty",e._n(t))},expression:"newRow.qty"}}),e._v(" "),t(n.a,{attrs:{"item-text":"code","item-value":"id",items:e.currencyList,label:"ສະກຸນ *",rules:e.currencyIdRules},model:{value:e.newRow.currencyId,callback:function(t){e.$set(e.newRow,"currencyId",t)},expression:"newRow.currencyId"}}),e._v(" "),t(_.a,{attrs:{type:"number",step:"0.01",min:"0",label:"ອັດຕາແລກປ່ຽນ",rules:e.rateRules,required:""},model:{value:e.newRow.rate,callback:function(t){e.$set(e.newRow,"rate",e._n(t))},expression:"newRow.rate"}}),e._v(" "),t(_.a,{attrs:{type:"number",step:"0.01",min:"0",label:"ລວມ",rules:e.totalRules,required:""},model:{value:e.newRow.total,callback:function(t){e.$set(e.newRow,"total",e._n(t))},expression:"newRow.total"}})],1)],1),e._v(" "),t(l.a,[t(o.a,{attrs:{color:"primary"},on:{click:e.addRow}},[e._v("ເພີ່ມ")]),e._v(" "),t(o.a,{attrs:{color:"secondary"},on:{click:function(t){e.showAddRowDialog=!1}}},[e._v("ປິດ")])],1)],1)],1),e._v(" "),t(c.a,[t(l.d,[t("span",{staticClass:"headline"},[e._v(e._s(e.title))])]),e._v(" "),t(l.c,[t(m.a,[t(y.a,[t(d.a,{attrs:{cols:"12",sm:"4",md:"4"}},[t(w.a,{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(_.a,{attrs:{label:"Vendor",rules:[e.rules.required],required:""},model:{value:e.form.header.vendor,callback:function(t){e.$set(e.form.header,"vendor",t)},expression:"form.header.vendor"}}),e._v(" "),t(_.a,{attrs:{label:"Remark",rules:[e.rules.required],required:""},model:{value:e.form.header.notes,callback:function(t){e.$set(e.form.header,"notes",t)},expression:"form.header.notes"}})],1)],1),e._v(" "),t(d.a,{attrs:{cols:"12",sm:"4",md:"4"}},[t(w.a,{on:{submit:function(t){return t.preventDefault(),e.submitForm.apply(null,arguments)}},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(_.a,{attrs:{type:"date",label:"ວັນທີສັ່ງ*",hint:"example of helper text only on focus"},model:{value:e.form.header.bookingDate,callback:function(t){e.$set(e.form.header,"bookingDate",t)},expression:"form.header.bookingDate"}})],1)],1),e._v(" "),t(d.a,{attrs:{cols:"12",sm:"4",md:"4"}},[t(w.a,{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)}}},[t(_.a,{attrs:{type:"date",label:"ວັນທີຮັບເຄື່ອງ*",hint:"example of helper text only on focus"},model:{value:e.form.header.deliveryDate,callback:function(t){e.$set(e.form.header,"deliveryDate",t)},expression:"form.header.deliveryDate"}}),e._v(" "),t(x.a,{attrs:{label:"Active","true-value":!0,"false-value":!1},model:{value:e.form.header.isActive,callback:function(t){e.$set(e.form.header,"isActive",t)},expression:"form.header.isActive"}})],1)],1)],1),e._v(" "),t(h.a),e._v(" "),t(o.a,{attrs:{color:"primary"},on:{click:function(t){e.showAddRowDialog=!0}}},[e._v("ເພີ່ມລາຍການ")]),e._v(" "),t(f.a,{attrs:{headers:e.headers,items:e.lines},scopedSlots:e._u([{key:"item",fn:function(r){var c=r.item;return[t("tr",[t("td",[t(n.a,{attrs:{"item-text":"pro_name","item-value":"id",items:e.productList,rules:e.productIdRules,label:"ເລືອກສິນຄ້າ *"},model:{value:c.productId,callback:function(t){e.$set(c,"productId",t)},expression:"item.productId"}})],1),e._v(" "),t("td",[t(_.a,{attrs:{type:"number",label:"ລາຄາ",rules:e.priceRules},model:{value:c.price,callback:function(t){e.$set(c,"price",e._n(t))},expression:"item.price"}})],1),e._v(" "),t("td",[t(_.a,{attrs:{type:"number",label:"ຈຳນວນ",rules:e.qtyRules},model:{value:c.qty,callback:function(t){e.$set(c,"qty",e._n(t))},expression:"item.qty"}})],1),e._v(" "),t("td",[t(n.a,{attrs:{"item-text":"code","item-value":"id",items:e.currencyList,label:"ສະກຸນ *",rules:e.currencyIdRules},model:{value:c.currencyId,callback:function(t){e.$set(c,"currencyId",t)},expression:"item.currencyId"}})],1),e._v(" "),t("td",[t(_.a,{attrs:{type:"number",step:"0.01",min:"0",label:"ອັດຕາແລກປ່ຽນ",rules:e.rateRules},model:{value:c.rate,callback:function(t){e.$set(c,"rate",e._n(t))},expression:"item.rate"}})],1),e._v(" "),t("td",[t(_.a,{attrs:{type:"number",step:"0.01",min:"0",label:"ລວມ",rules:e.totalRules},model:{value:c.total,callback:function(t){e.$set(c,"total",e._n(t))},expression:"item.total"}})],1),e._v(" "),t("td",[t(o.a,{attrs:{color:"warning",variant:"text"},on:{click:function(t){return e.deleteItem(c)}}},[e._v("\n                                    ລົບ\n                                ")])],1)])]}}])})],1),e._v(" "),t("small",[e._v("* ສະແດງເຖິງຟິວທີ່ຕ້ອງໃສ່ຂໍ້ມູນ")])],1),e._v(" "),t(l.a,[t(R.a),e._v(" "),t(o.a,{attrs:{color:"warning",rounded:"",variant:"text"},on:{click:function(t){return e.$emit("close-dialog")}}},[e._v("\n                Close\n            ")]),e._v(" "),t(o.a,{attrs:{color:"primary",rounded:"",variant:"text"},on:{click:e.submit}},[e._v("\n                Save\n            ")])],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{LoadingIndicator:r(248).default})}}]);