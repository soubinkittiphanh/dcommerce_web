(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1282:function(t,e,n){var content=n(1584);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(15).default)("7f6f85df",content,!0,{sourceMap:!1})},1583:function(t,e,n){"use strict";n(1282)},1584:function(t,e,n){var o=n(14)((function(i){return i[1]}));o.push([t.i,".modal-overlay[data-v-6a45fe38]{align-items:center;background-color:rgba(0,0,0,.7);justify-content:center;left:0;padding:0;position:fixed;top:0;z-index:1000}.modal-overlay[data-v-6a45fe38],.settlement-dialog[data-v-6a45fe38]{display:flex;height:100vh;width:100vw}.settlement-dialog[data-v-6a45fe38]{background:#fff;flex-direction:column;overflow:hidden}.dialog-header[data-v-6a45fe38]{align-items:center;background:linear-gradient(135deg,#01532b,#337555);border-bottom:1px solid #e9ecef;color:#fff;display:flex;justify-content:space-between;min-height:50px;padding:12px 20px}.dialog-header h4[data-v-6a45fe38]{font-size:16px;font-weight:600;margin:0}.header-actions[data-v-6a45fe38]{gap:8px}.audit-btn[data-v-6a45fe38],.header-actions[data-v-6a45fe38]{align-items:center;display:flex}.audit-btn[data-v-6a45fe38]{background:hsla(0,0%,100%,.2);border:none;border-radius:4px;color:#fff;cursor:pointer;font-size:12px;gap:4px;padding:6px 10px;transition:all .2s ease}.audit-btn[data-v-6a45fe38]:hover{background:hsla(0,0%,100%,.3)}.audit-text[data-v-6a45fe38]{font-size:11px}.close-btn[data-v-6a45fe38]{background:none;border:none;border-radius:50%;color:#fff;cursor:pointer;font-size:16px;padding:4px;transition:all .2s ease}.close-btn[data-v-6a45fe38]:hover{background:hsla(0,0%,100%,.2)}.dialog-body[data-v-6a45fe38]{flex:1;overflow-y:auto;padding:0}.form-section[data-v-6a45fe38]{background:#fafafa;border-bottom:1px solid #e9ecef;margin:0;padding:15px}.section-title[data-v-6a45fe38]{align-items:center;border-bottom:1px solid #17a2b8;color:#333;display:flex;font-size:14px;font-weight:600;gap:6px;margin-bottom:12px;padding-bottom:4px}.section-title i[data-v-6a45fe38]{color:#17a2b8;font-size:13px}.section-header[data-v-6a45fe38]{gap:10px;justify-content:space-between;margin-bottom:12px}.section-actions[data-v-6a45fe38],.section-header[data-v-6a45fe38]{align-items:center;display:flex;flex-wrap:wrap}.section-actions[data-v-6a45fe38]{gap:15px}.allocation-info[data-v-6a45fe38]{display:flex;font-size:11px;gap:12px}.info-item[data-v-6a45fe38]{background:#fff;border:1px solid #ddd;border-radius:4px;padding:4px 8px}.form-grid[data-v-6a45fe38]{grid-gap:10px;display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.span-2[data-v-6a45fe38]{grid-column:span 2}.form-group[data-v-6a45fe38]{margin-bottom:0}.form-group label[data-v-6a45fe38]{color:#333;display:block;font-size:12px;font-weight:500;margin-bottom:3px}.required[data-v-6a45fe38]{color:#e74c3c}.form-control[data-v-6a45fe38]{border:1px solid #ddd;border-radius:4px;font-size:12px;height:32px;padding:6px 8px;transition:border-color .2s ease;width:100%}.form-control[data-v-6a45fe38]:focus{border-color:#17a2b8;box-shadow:0 0 0 2px rgba(23,162,184,.1);outline:none}.form-control[data-v-6a45fe38]:disabled{background-color:#f8f9fa;color:#6c757d}.form-control.is-invalid[data-v-6a45fe38]{border-color:#e74c3c}.form-control-xs[data-v-6a45fe38]{font-size:11px;height:28px;padding:4px 6px}.invalid-feedback[data-v-6a45fe38]{color:#e74c3c;display:block;font-size:10px;margin-top:2px;width:100%}.no-invoices[data-v-6a45fe38]{background:#fff;border:2px dashed #ddd;border-radius:6px;color:#666;padding:30px 20px;text-align:center}.no-invoices i[data-v-6a45fe38]{font-size:32px;margin-bottom:10px;opacity:.5}.no-invoices p[data-v-6a45fe38]{font-size:14px;font-weight:600;margin:8px 0}.invoice-allocations[data-v-6a45fe38]{background:#fff;border:1px solid #e9ecef;border-radius:6px;overflow:hidden}.table[data-v-6a45fe38]{border-collapse:collapse;font-size:11px;margin:0}.table th[data-v-6a45fe38]{background:#f8f9fa;border-bottom:1px solid #dee2e6;font-size:10px;font-weight:600;padding:6px 4px;text-align:center;white-space:nowrap}.table td[data-v-6a45fe38]{border-top:1px solid #dee2e6;padding:4px;vertical-align:middle}.line-number[data-v-6a45fe38]{color:#666;font-size:10px;font-weight:600;text-align:center}.amount-cell[data-v-6a45fe38]{font-size:10px;font-weight:500;text-align:right}.allocation-summary[data-v-6a45fe38]{background:#f8f9fa;border-top:1px solid #dee2e6;padding:10px}.totals-inline[data-v-6a45fe38]{flex-wrap:wrap;font-size:11px;gap:10px;justify-content:space-between}.total-item[data-v-6a45fe38],.totals-inline[data-v-6a45fe38]{align-items:center;display:flex}.btn[data-v-6a45fe38],.total-item[data-v-6a45fe38]{gap:4px}.btn[data-v-6a45fe38]{align-items:center;border:none;border-radius:4px;cursor:pointer;display:inline-flex;font-size:12px;font-weight:500;padding:6px 12px;transition:all .2s ease}.btn-primary[data-v-6a45fe38]{background:#007bff;color:#fff}.btn-secondary[data-v-6a45fe38]{background:#6c757d;color:#fff}.btn-success[data-v-6a45fe38]{background:#28a745;color:#fff}.btn-info[data-v-6a45fe38]{background:#17a2b8;color:#fff}.btn-danger[data-v-6a45fe38]{background:#dc3545;color:#fff}.btn-sm[data-v-6a45fe38]{font-size:11px;padding:4px 8px}.btn-xs[data-v-6a45fe38]{align-items:center;border-radius:50%;display:flex;font-size:10px;height:24px;justify-content:center;padding:0;width:24px}.btn[data-v-6a45fe38]:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}.btn[data-v-6a45fe38]:disabled{cursor:not-allowed;opacity:.6;transform:none}.dialog-footer[data-v-6a45fe38]{background:#f8f9fa;border-top:1px solid #e9ecef;min-height:56px;padding:12px 20px}.footer-actions[data-v-6a45fe38]{display:flex;gap:8px;justify-content:flex-end}.invoice-selector-overlay[data-v-6a45fe38]{align-items:center;background-color:rgba(0,0,0,.8);display:flex;height:100vh;justify-content:center;left:0;padding:20px;position:fixed;top:0;width:100vw;z-index:1100}.invoice-selector-modal[data-v-6a45fe38]{background:#fff;border-radius:6px;box-shadow:0 10px 30px rgba(0,0,0,.3);display:flex;flex-direction:column;max-height:80vh;max-width:800px;overflow:hidden;width:100%}.modal-header[data-v-6a45fe38]{align-items:center;background:#f8f9fa;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;padding:12px 15px}.modal-header h5[data-v-6a45fe38]{color:#333;font-size:14px;font-weight:600;margin:0}.modal-body[data-v-6a45fe38]{flex:1;overflow-y:auto;padding:15px}.invoice-filters[data-v-6a45fe38]{background:#f8f9fa;border-radius:4px;margin-bottom:15px;padding:10px}.filter-grid[data-v-6a45fe38]{grid-gap:10px;display:grid;gap:10px;grid-template-columns:1fr 1fr}.invoice-list[data-v-6a45fe38]{border:1px solid #e9ecef;border-radius:4px;max-height:400px;overflow-y:auto}.table-hover tbody tr[data-v-6a45fe38]:hover{background-color:rgba(0,0,0,.075)}.selected-row[data-v-6a45fe38]{background-color:rgba(23,162,184,.1)!important}.no-data[data-v-6a45fe38]{color:#666;font-size:13px;padding:30px 20px;text-align:center}.modal-actions[data-v-6a45fe38]{background:#f8f9fa;border-top:1px solid #e9ecef;display:flex;gap:8px;justify-content:flex-end;padding:12px 15px}@media (max-width:768px){.form-grid[data-v-6a45fe38]{grid-template-columns:1fr}.span-2[data-v-6a45fe38]{grid-column:span 1}.section-actions[data-v-6a45fe38],.section-header[data-v-6a45fe38]{align-items:flex-start;flex-direction:column}.section-actions[data-v-6a45fe38]{width:100%}.allocation-info[data-v-6a45fe38]{flex-direction:column;gap:6px;width:100%}.totals-inline[data-v-6a45fe38]{align-items:flex-start;gap:6px}.footer-actions[data-v-6a45fe38],.totals-inline[data-v-6a45fe38]{flex-direction:column}.footer-actions .btn[data-v-6a45fe38]{justify-content:center;width:100%}.invoice-selector-modal[data-v-6a45fe38]{max-width:95vw}.filter-grid[data-v-6a45fe38]{grid-template-columns:1fr}.invoice-list[data-v-6a45fe38]{overflow-x:auto}.table[data-v-6a45fe38]{min-width:500px}}@media (max-width:480px){.dialog-header[data-v-6a45fe38]{padding:10px 15px}.dialog-header h4[data-v-6a45fe38]{font-size:14px}.header-actions[data-v-6a45fe38]{gap:6px}.audit-text[data-v-6a45fe38]{display:none}.dialog-body[data-v-6a45fe38]{padding:0}.form-section[data-v-6a45fe38]{padding:12px}.dialog-footer[data-v-6a45fe38]{padding:10px 15px}}",""]),o.locals={},t.exports=o},1727:function(t,e,n){"use strict";n.r(e);n(39),n(9),n(5),n(7),n(67),n(35),n(38),n(12),n(13);var o=n(3),r=n(36),c=n(17);n(85),n(253),n(54),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(53),n(8),n(52),n(64),n(113),n(10);function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function d(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={name:"SettlementDialog",components:{SettlementAuditDialog:n(1728).default},props:{visible:{type:Boolean,default:!1},settlement:{type:Object,default:null},outstandingInvoices:{type:Array,default:function(){return[]}}},data:function(){return{form:{id:null,settlementDate:(new Date).toISOString().split("T")[0],paymentAmount:0,baseAmount:0,paymentMethodId:"",bankAccountId:"",reference:"",description:"",note:"",status:"draft",makerId:null,checkerId:null,approvalNote:""},selectedInvoices:[],tempSelectedInvoices:[],paymentMethods:[],bankAccounts:[],errors:{},isSubmitting:!1,showInvoiceSelector:!1,showAuditDialog:!1,invoiceSearchTerm:"",selectedVendorFilter:"",filteredInvoices:[]}},computed:{user:function(){return this.$auth.user||""},isEditMode:function(){return!(!this.settlement||!this.settlement.id)},canModify:function(){return["draft","pending"].includes(this.form.status)},canModifyStatus:function(){return this.user.canManageSettlements||this.form.makerId===this.user.id},canModifyAllocations:function(){return this.canModify},canApprove:function(){return this.user.canApproveSettlements&&"pending"===this.form.status},canComplete:function(){return this.user.canCompleteSettlements&&["pending","approved"].includes(this.form.status)},showApprovalSection:function(){return this.isEditMode&&["pending","approved","completed"].includes(this.form.status)},totalAllocated:function(){return this.selectedInvoices.reduce((function(t,e){return t+parseFloat(e.settledAmount||0)}),0)},unallocatedAmount:function(){return parseFloat(this.form.baseAmount)-this.totalAllocated},availableVendors:function(){var t=[],e=new Map;return this.outstandingInvoices.forEach((function(n){n.vendor&&!e.has(n.vendor.id)&&(e.set(n.vendor.id,n.vendor),t.push(n.vendor))})),t},makerName:function(){var t;return this.isEditMode&&null!==(t=this.settlement)&&void 0!==t&&t.maker?this.settlement.maker.cus_name||this.settlement.maker.username:this.user.cus_name||this.user.username},checkerName:function(){var t;return this.isEditMode&&null!==(t=this.settlement)&&void 0!==t&&t.checker?this.settlement.checker.fullName||this.settlement.checker.username:""},settlementInfoForAudit:function(){return this.isEditMode?{settlementId:this.form.id,paymentAmount:this.form.paymentAmount,baseAmount:this.form.baseAmount,settlementDate:this.form.settlementDate,status:this.form.status,reference:this.form.reference,description:this.form.description,note:this.form.note}:null}},watch:{visible:function(t){t&&this.initializeDialog()},settlement:{handler:function(t){t&&this.loadSettlementData(t)},immediate:!0}},mounted:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadReferenceData();case 2:case"end":return e.stop()}}),e)})))()},methods:{initializeDialog:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadReferenceData();case 2:t.settlement?t.loadSettlementData(t.settlement):t.resetForm(),t.filteredInvoices=Object(r.a)(t.outstandingInvoices);case 4:case"end":return e.stop()}}),e)})))()},loadReferenceData:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([t.loadPaymentMethods(),t.loadBankAccounts()]);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error loading reference data:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},loadPaymentMethods:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/paymentMethod/find");case 3:n=e.sent,data=n.data,t.paymentMethods=data||[],e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error loading payment methods:",e.t0),t.paymentMethods=[];case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadBankAccounts:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$axios.get("/api/bank_account/find");case 3:n=e.sent,data=n.data,t.bankAccounts=data||[],e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Error loading bank accounts:",e.t0),t.bankAccounts=[];case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()},loadSettlementData:function(t){this.form={id:t.id,settlementDate:t.settlementDate||(new Date).toISOString().split("T")[0],paymentAmount:parseFloat(t.paymentAmount||0),baseAmount:parseFloat(t.baseAmount||0),paymentMethodId:t.paymentMethodId||"",bankAccountId:t.bankAccountId||"",reference:t.reference||"",description:t.description||"",note:t.note||"",status:t.status||"draft",makerId:t.makerId||this.user.id,checkerId:t.checkerId||null,approvalNote:t.approvalNote||""},t.invoiceSettlements&&(this.selectedInvoices=t.invoiceSettlements.map((function(t){return{id:t.invoice.id,invoiceNumber:t.invoice.invoiceNumber,vendor:t.invoice.vendor,outstandingAmount:parseFloat(t.invoice.outstandingAmount||0),settledAmount:parseFloat(t.amount||0)}})))},resetForm:function(){this.form={id:null,settlementDate:(new Date).toISOString().split("T")[0],paymentAmount:0,baseAmount:0,paymentMethodId:"",bankAccountId:"",reference:"",description:"",note:"",status:"draft",makerId:this.user.id,checkerId:null,approvalNote:""},this.selectedInvoices=[],this.errors={}},calculateBaseAmount:function(){this.form.paymentAmount&&(this.form.baseAmount=this.form.paymentAmount)},calculateUnallocatedAmount:function(){this.$forceUpdate()},calculateTotals:function(){this.$forceUpdate()},openAuditDialog:function(){var t;this.isEditMode?this.showAuditDialog=!0:null===(t=this.$toast)||void 0===t||t.warning("ບໍ່ສາມາດເບິ່ງປະຫວັດການດຳເນີນງານໄດ້ ເນື່ອງຈາກຍັງບໍ່ໄດ້ບັນທຶກການຊຳລະ")},closeAuditDialog:function(){this.showAuditDialog=!1},filterInvoices:function(){var t=this,e=Object(r.a)(this.outstandingInvoices);if(this.invoiceSearchTerm){var n=this.invoiceSearchTerm.toLowerCase();e=e.filter((function(t){var e,o;return t.invoiceNumber.toLowerCase().includes(n)||(null===(e=t.vendor)||void 0===e||null===(o=e.name)||void 0===o?void 0:o.toLowerCase().includes(n))}))}this.selectedVendorFilter&&(e=e.filter((function(e){var n;return(null===(n=e.vendor)||void 0===n?void 0:n.id)===t.selectedVendorFilter}))),this.filteredInvoices=e},toggleInvoiceSelection:function(t,e){e.target.checked?this.tempSelectedInvoices.find((function(e){return e.id===t.id}))||this.tempSelectedInvoices.push(d(d({},t),{},{settledAmount:parseFloat(t.outstandingAmount||0)})):this.tempSelectedInvoices=this.tempSelectedInvoices.filter((function(e){return e.id!==t.id}))},isInvoiceSelected:function(t){return this.tempSelectedInvoices.some((function(e){return e.id===t}))},confirmInvoiceSelection:function(){var t=this;try{this.tempSelectedInvoices.forEach((function(e){t.selectedInvoices.find((function(t){return t.id===e.id}))||t.selectedInvoices.push(e)})),this.closeInvoiceSelector(),this.calculateTotals()}catch(t){console.error("Error in confirmInvoiceSelection:",t)}},removeInvoice:function(t){this.selectedInvoices.splice(t,1),this.calculateTotals()},closeInvoiceSelector:function(){this.showInvoiceSelector=!1,this.tempSelectedInvoices=[],this.invoiceSearchTerm="",this.selectedVendorFilter="",this.filteredInvoices=Object(r.a)(this.outstandingInvoices)},validateForm:function(){return this.errors={},this.form.settlementDate||(this.errors.settlementDate="ກະລຸນາເລືອກວັນທີຊຳລະ"),(!this.form.paymentAmount||this.form.paymentAmount<=0)&&(this.errors.paymentAmount="ກະລຸນາໃສ່ຈຳນວນເງິນຊຳລະທີ່ຖືກຕ້ອງ"),(!this.form.baseAmount||this.form.baseAmount<=0)&&(this.errors.baseAmount="ກະລຸນາໃສ່ຈຳນວນເງິນພື້ນຖານທີ່ຖືກຕ້ອງ"),this.form.paymentMethodId||(this.errors.paymentMethodId="ກະລຸນາເລືອກວິທີການຊຳລະ"),this.form.reference&&this.form.reference.length>100&&(this.errors.reference="ຫມາຍເລກອ້າງອີງຍາວເກີນ 100 ຕົວອັກສອນ"),this.totalAllocated>this.form.baseAmount&&(this.errors.allocation="ຈຳນວນຈັດສັນເກີນຈຳນວນເງິນຊຳລະ"),0===Object.keys(this.errors).length},submitForm:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.validateForm()){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{n=d(d({},t.form),{},{makerId:t.form.makerId||t.user.id,invoiceAllocations:t.selectedInvoices.map((function(t){return{invoiceId:t.id,amount:parseFloat(t.settledAmount||0)}}))}),t.$emit("save",n)}catch(t){console.error("Error submitting form:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},approveSettlement:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.canApprove){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{n={id:t.form.id,status:"approved",checkerId:t.user.id,approvalNote:t.form.approvalNote},t.$emit("approve",n)}catch(t){console.error("Error approving settlement:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},completeSettlement:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.canComplete){e.next=2;break}return e.abrupt("return");case 2:t.isSubmitting=!0;try{n={id:t.form.id,status:"completed"},t.$emit("complete",n)}catch(t){console.error("Error completing settlement:",t)}finally{t.isSubmitting=!1}case 4:case"end":return e.stop()}}),e)})))()},closeDialog:function(){this.$emit("close")},handleOverlayClick:function(){this.closeDialog()},formatCurrency:function(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0)},formatDate:function(t){return t?new Date(t).toLocaleDateString("en-GB"):"N/A"}}},m=f,v=(n(1583),n(31)),component=Object(v.a)(m,(function(){var t=this,e=t._self._c;return t.visible?e("div",{staticClass:"modal-overlay",on:{click:t.handleOverlayClick}},[e("div",{staticClass:"settlement-dialog",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"dialog-header"},[e("h4",[t._v(t._s(t.isEditMode?"ແກ້ໄຂການຊຳລະ":"ສ້າງການຊຳລະໃໝ່"))]),t._v(" "),e("div",{staticClass:"header-actions"},[t.isEditMode?e("button",{staticClass:"audit-btn",attrs:{type:"button",title:"ເບິ່ງປະຫວັດການດຳເນີນງານ"},on:{click:t.openAuditDialog}},[e("i",{staticClass:"fas fa-history"}),t._v(" "),e("span",{staticClass:"audit-text"},[t._v("ປະຫວັດ")])]):t._e(),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeDialog}},[e("i",{staticClass:"fas fa-times"})])])]),t._v(" "),e("div",{staticClass:"dialog-body"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[e("div",{staticClass:"form-section"},[t._m(0),t._v(" "),e("div",{staticClass:"form-grid"},[e("div",{staticClass:"form-group"},[t._m(1),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.settlementDate,expression:"form.settlementDate"}],staticClass:"form-control",class:{"is-invalid":t.errors.settlementDate},attrs:{type:"date",required:""},domProps:{value:t.form.settlementDate},on:{input:function(e){e.target.composing||t.$set(t.form,"settlementDate",e.target.value)}}}),t._v(" "),t.errors.settlementDate?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.settlementDate)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",[t._v("ສະຖານະ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.status,expression:"form.status"}],staticClass:"form-control",attrs:{disabled:!t.canModifyStatus},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"status",e.target.multiple?n:n[0])}}},[e("option",{attrs:{value:"draft"}},[t._v("ຮ່າງ")]),t._v(" "),e("option",{attrs:{value:"pending"}},[t._v("ລໍຖ້າການອະນຸມັດ")]),t._v(" "),e("option",{attrs:{value:"approved"}},[t._v("ອະນຸມັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"completed"}},[t._v("ສຳເລັດແລ້ວ")]),t._v(" "),e("option",{attrs:{value:"cancelled"}},[t._v("ຍົກເລີກ")])])]),t._v(" "),e("div",{staticClass:"form-group"},[t._m(2),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.paymentAmount,expression:"form.paymentAmount",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.paymentAmount},attrs:{type:"number",step:"0.01",min:"0",required:""},domProps:{value:t.form.paymentAmount},on:{input:[function(e){e.target.composing||t.$set(t.form,"paymentAmount",t._n(e.target.value))},t.calculateBaseAmount],blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.paymentAmount?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.paymentAmount)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[t._m(3),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.form.baseAmount,expression:"form.baseAmount",modifiers:{number:!0}}],staticClass:"form-control",class:{"is-invalid":t.errors.baseAmount},attrs:{type:"number",step:"0.01",min:"0",required:""},domProps:{value:t.form.baseAmount},on:{input:[function(e){e.target.composing||t.$set(t.form,"baseAmount",t._n(e.target.value))},t.calculateUnallocatedAmount],blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t.errors.baseAmount?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.baseAmount)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[t._m(4),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.paymentMethodId,expression:"form.paymentMethodId"}],staticClass:"form-control",class:{"is-invalid":t.errors.paymentMethodId},attrs:{required:""},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"paymentMethodId",e.target.multiple?n:n[0])}}},[e("option",{attrs:{value:""}},[t._v("ເລືອກວິທີການຊຳລະ")]),t._v(" "),t._l(t.paymentMethods,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                  "+t._s(n.payment_name)+"\n                ")])}))],2),t._v(" "),t.errors.paymentMethodId?e("div",{staticClass:"invalid-feedback"},[t._v("\n                "+t._s(t.errors.paymentMethodId)+"\n              ")]):t._e()]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",[t._v("ບັນຊີທະນາຄານ")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.form.bankAccountId,expression:"form.bankAccountId"}],staticClass:"form-control",on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.form,"bankAccountId",e.target.multiple?n:n[0])}}},[e("option",{attrs:{value:""}},[t._v("ເລືອກບັນຊີທະນາຄານ")]),t._v(" "),t._l(t.bankAccounts,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                  "+t._s(n.accountNumber)+" - "+t._s(n.bankName)+"\n                ")])}))],2)]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",[t._v("ອ້າງອີງ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.reference,expression:"form.reference"}],staticClass:"form-control",attrs:{type:"text",maxlength:"100",placeholder:"ຫມາຍເລກອ້າງອີງ"},domProps:{value:t.form.reference},on:{input:function(e){e.target.composing||t.$set(t.form,"reference",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",[t._v("ຜູ້ສ້າງ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.makerName,expression:"makerName"}],staticClass:"form-control",attrs:{type:"text",disabled:!0},domProps:{value:t.makerName},on:{input:function(e){e.target.composing||(t.makerName=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group span-2"},[e("label",[t._v("ຄຳອະທິບາຍ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],staticClass:"form-control",attrs:{rows:"2",placeholder:"ຄຳອະທິບາຍການຊຳລະ"},domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group span-2"},[e("label",[t._v("ໝາຍເຫດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.note,expression:"form.note"}],staticClass:"form-control",attrs:{rows:"2",placeholder:"ໝາຍເຫດເພີ່ມເຕີມ"},domProps:{value:t.form.note},on:{input:function(e){e.target.composing||t.$set(t.form,"note",e.target.value)}}})])])]),t._v(" "),e("div",{staticClass:"form-section"},[e("div",{staticClass:"section-header"},[t._m(5),t._v(" "),e("div",{staticClass:"section-actions"},[e("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button",disabled:!t.canModifyAllocations},on:{click:function(e){t.showInvoiceSelector=!0}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" ເພີ່ມໃບແຈ້ງໜີ້\n              ")]),t._v(" "),e("div",{staticClass:"allocation-info"},[e("span",{staticClass:"info-item"},[t._v("\n                  ຈັດສັນ: "),e("strong",[t._v(t._s(t.formatCurrency(t.totalAllocated)))])]),t._v(" "),e("span",{staticClass:"info-item"},[t._v("\n                  ເຫຼືອ: "),e("strong",[t._v(t._s(t.formatCurrency(t.unallocatedAmount)))])])])])]),t._v(" "),0===t.selectedInvoices.length?e("div",{staticClass:"no-invoices"},[e("i",{staticClass:"fas fa-file-invoice"}),t._v(" "),e("p",[t._v("ຍັງບໍ່ໄດ້ເລືອກໃບແຈ້ງໜີ້")]),t._v(" "),e("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(e){t.showInvoiceSelector=!0}}},[e("i",{staticClass:"fas fa-plus-circle"}),t._v("\n              ເລືອກໃບແຈ້ງໜີ້\n            ")])]):e("div",{staticClass:"invoice-allocations"},[e("table",{staticClass:"table"},[t._m(6),t._v(" "),e("tbody",t._l(t.selectedInvoices,(function(n,o){var r;return e("tr",{key:n.id},[e("td",{staticClass:"line-number"},[t._v(t._s(o+1))]),t._v(" "),e("td",[t._v(t._s(n.invoiceNumber))]),t._v(" "),e("td",[t._v(t._s((null===(r=n.vendor)||void 0===r?void 0:r.name)||"N/A"))]),t._v(" "),e("td",{staticClass:"amount-cell"},[t._v(t._s(t.formatCurrency(n.outstandingAmount)))]),t._v(" "),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:n.settledAmount,expression:"invoice.settledAmount",modifiers:{number:!0}}],staticClass:"form-control form-control-xs",attrs:{type:"number",step:"0.01",min:"0",max:n.outstandingAmount,disabled:!t.canModifyAllocations},domProps:{value:n.settledAmount},on:{input:[function(e){e.target.composing||t.$set(n,"settledAmount",t._n(e.target.value))},t.calculateTotals],blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-xs btn-danger",attrs:{type:"button",disabled:!t.canModifyAllocations},on:{click:function(e){return t.removeInvoice(o)}}},[e("i",{staticClass:"fas fa-trash"})])])])})),0)]),t._v(" "),e("div",{staticClass:"allocation-summary"},[e("div",{staticClass:"totals-inline"},[e("span",{staticClass:"total-item"},[t._v("\n                  ລວມຈັດສັນ: "),e("strong",[t._v(t._s(t.formatCurrency(t.totalAllocated)))])]),t._v(" "),e("span",{staticClass:"total-item"},[t._v("\n                  ຍອດເຫຼືອ: "),e("strong",[t._v(t._s(t.formatCurrency(t.unallocatedAmount)))])])])])])]),t._v(" "),t.showApprovalSection?e("div",{staticClass:"form-section"},[t._m(7),t._v(" "),e("div",{staticClass:"form-grid"},[e("div",{staticClass:"form-group"},[e("label",[t._v("ຜູ້ອະນຸມັດ")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.checkerName,expression:"checkerName"}],staticClass:"form-control",attrs:{type:"text",disabled:!0},domProps:{value:t.checkerName},on:{input:function(e){e.target.composing||(t.checkerName=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",[t._v("ໝາຍເຫດການອະນຸມັດ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.approvalNote,expression:"form.approvalNote"}],staticClass:"form-control",attrs:{rows:"2",placeholder:"ໝາຍເຫດການອະນຸມັດ",disabled:!t.canApprove},domProps:{value:t.form.approvalNote},on:{input:function(e){e.target.composing||t.$set(t.form,"approvalNote",e.target.value)}}})])])]):t._e()])]),t._v(" "),e("div",{staticClass:"dialog-footer"},[e("div",{staticClass:"footer-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:t.closeDialog}},[e("i",{staticClass:"fas fa-times"}),t._v(" ຍົກເລີກ\n        ")]),t._v(" "),t.canApprove&&"pending"===t.form.status?e("button",{staticClass:"btn btn-success",attrs:{type:"button",disabled:t.isSubmitting},on:{click:t.approveSettlement}},[e("i",{staticClass:"fas fa-check"}),t._v(" ອະນຸມັດ\n        ")]):t._e(),t._v(" "),t.canComplete&&["pending","approved"].includes(t.form.status)?e("button",{staticClass:"btn btn-info",attrs:{type:"button",disabled:t.isSubmitting},on:{click:t.completeSettlement}},[e("i",{staticClass:"fas fa-check-circle"}),t._v(" ສຳເລັດ\n        ")]):t._e(),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:t.isSubmitting||!t.canModify},on:{click:t.submitForm}},[e("i",{staticClass:"fas fa-save"}),t._v(" "),t.isSubmitting?e("span",[t._v("ກຳລັງບັນທຶກ...")]):e("span",[t._v(t._s(t.isEditMode?"ອັບເດດ":"ບັນທຶກ"))])])])])]),t._v(" "),t.showInvoiceSelector?e("div",{staticClass:"invoice-selector-overlay",on:{click:t.closeInvoiceSelector}},[e("div",{staticClass:"invoice-selector-modal",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h5",[t._v("ເລືອກໃບແຈ້ງໜີ້ຄ້າງຈ່າຍ")]),t._v(" "),e("button",{staticClass:"close-btn",on:{click:t.closeInvoiceSelector}},[e("i",{staticClass:"fas fa-times"})])]),t._v(" "),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"invoice-filters"},[e("div",{staticClass:"filter-grid"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.invoiceSearchTerm,expression:"invoiceSearchTerm"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ຄົ້ນຫາເລກທີໃບແຈ້ງໜີ້..."},domProps:{value:t.invoiceSearchTerm},on:{input:[function(e){e.target.composing||(t.invoiceSearchTerm=e.target.value)},t.filterInvoices]}}),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedVendorFilter,expression:"selectedVendorFilter"}],staticClass:"form-control",on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedVendorFilter=e.target.multiple?n:n[0]},t.filterInvoices]}},[e("option",{attrs:{value:""}},[t._v("ທຸກຜູ້ຂາຍ")]),t._v(" "),t._l(t.availableVendors,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n                "+t._s(n.name)+"\n              ")])}))],2)])]),t._v(" "),e("div",{staticClass:"invoice-list"},[e("table",{staticClass:"table table-hover"},[t._m(8),t._v(" "),e("tbody",t._l(t.filteredInvoices,(function(n){var o;return e("tr",{key:n.id,class:{"selected-row":t.isInvoiceSelected(n.id)}},[e("td",[e("input",{attrs:{type:"checkbox"},domProps:{checked:t.isInvoiceSelected(n.id)},on:{change:function(e){return t.toggleInvoiceSelection(n,e)}}})]),t._v(" "),e("td",[t._v(t._s(n.invoiceNumber))]),t._v(" "),e("td",[t._v(t._s((null===(o=n.vendor)||void 0===o?void 0:o.name)||"N/A"))]),t._v(" "),e("td",[t._v(t._s(t.formatDate(n.dueDate)))]),t._v(" "),e("td",{staticClass:"amount-cell"},[t._v(t._s(t.formatCurrency(n.outstandingAmount)))])])})),0)]),t._v(" "),0===t.filteredInvoices.length?e("div",{staticClass:"no-data"},[e("p",[t._v("ບໍ່ພົບໃບແຈ້ງໜີ້ທີ່ຕົງກັບເງື່ອນໄຂ")])]):t._e()]),t._v(" "),e("div",{staticClass:"modal-actions"},[e("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.closeInvoiceSelector.apply(null,arguments)}}},[t._v("\n            ຍົກເລີກ\n          ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.confirmInvoiceSelection.apply(null,arguments)}}},[t._v("\n            ຢືນຢັນການເລືອກ ("+t._s(t.tempSelectedInvoices.length)+")\n          ")])])])])]):t._e(),t._v(" "),e("settlement-audit-dialog",{attrs:{visible:t.showAuditDialog,"settlement-id":t.form.id,"settlement-info":t.settlementInfoForAudit},on:{close:t.closeAuditDialog}})],1):t._e()}),[function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-credit-card"}),this._v("\n            ຂໍ້ມູນການຊຳລະ\n          ")])},function(){var t=this,e=t._self._c;return e("label",[t._v("ວັນທີຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ຈຳນວນເງິນຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ຈຳນວນເງິນພື້ນຖານ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this,e=t._self._c;return e("label",[t._v("ວິທີການຊຳລະ "),e("span",{staticClass:"required"},[t._v("*")])])},function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-file-invoice-dollar"}),this._v("\n              ການຈັດສັນໃບແຈ້ງໜີ້\n            ")])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{width:"30px"}},[t._v("#")]),t._v(" "),e("th",{staticStyle:{width:"120px"}},[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ຜູ້ຂາຍ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ຍອດຄ້າງຈ່າຍ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ຈຳນວນຈັດສັນ")]),t._v(" "),e("th",{staticStyle:{width:"40px"}},[t._v("ລຶບ")])])])},function(){var t=this._self._c;return t("h5",{staticClass:"section-title"},[t("i",{staticClass:"fas fa-check-circle"}),this._v("\n            ການອະນຸມັດ\n          ")])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{staticStyle:{width:"40px"}},[t._v("ເລືອກ")]),t._v(" "),e("th",{staticStyle:{width:"120px"}},[t._v("ເລກທີໃບແຈ້ງໜີ້")]),t._v(" "),e("th",{staticStyle:{width:"100px"}},[t._v("ຜູ້ຂາຍ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ວັນທີຄົບກຳນົດ")]),t._v(" "),e("th",{staticStyle:{width:"80px"}},[t._v("ຍອດຄ້າງຈ່າຍ")])])])}],!1,null,"6a45fe38",null);e.default=component.exports}}]);